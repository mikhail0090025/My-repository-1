define(["OK/utils/throttle","OK/reactions/Reaction","OK/reactions/ReactionController"],function(c,d,a){function b(){this.onClick=this.onClick.bind(this);this.onUpdate=this.onUpdate.bind(this);this.onScroll=c(500,this.onScroll.bind(this));}b.prototype={activate:function(e){this.el=e;this.owner=e.getAttribute("data-owner")||null;this.refId=e.getAttribute("data-like-reference-id")||null;this.reactionId=d.parseReactionId(e.getAttribute("data-react"));this.link=e.querySelector(".photo-layer_klass_link");this.linkContainer=e.querySelector(".photo-layer_klass_link-cnt");this.likeTitle=e.getAttribute("data-like-title");this.unlikeTitle=e.getAttribute("data-unlike-title");this.likeLogTarget=e.getAttribute("data-like-log-target");this.unlikeLogTarget=e.getAttribute("data-unlike-log-target");this.switchLogTarget();this.switchTitle();this.link.addEventListener("click",this.onClick);a.subscribe(this.refId,this.onUpdate);this.container=document.getElementById("photoLayerWrapper");this.footer=this.container.querySelector(".photo-layer_bottom_cnt");if(this.footer){this.container.addEventListener("scroll",this.onScroll);}},deactivate:function(){this.link.removeEventListener("click",this.onClick);this.container.removeEventListener("scroll",this.onScroll);a.unsubscribe(this.refId,this.onUpdate);},onScroll:function(){var e=this.footer.getBoundingClientRect();var f=this.el.getBoundingClientRect();var g=e.top>f.bottom;this.el.classList.toggle("__hide",!g);},onClick:function(){var e=this.reactionId===null?0:null;a.notify({refId:this.refId,reactionId:e,prevReactionId:this.reactionId,owner:this.owner});},onUpdate:function(e){if(this.reactionId!==e.reactionId){this.reactionId=e.reactionId;if(this.reactionId===null){this.linkContainer.classList.remove("__active","__anim");}else{this.linkContainer.classList.add("__active","__anim");}this.switchLogTarget();this.switchTitle();}},switchLogTarget:function(){if(this.reactionId===null){this.link.setAttribute("data-l",this.likeLogTarget);}else{this.link.setAttribute("data-l",this.unlikeLogTarget);}},switchTitle:function(){if(this.reactionId===null){this.link.setAttribute("title",this.likeTitle);}else{this.link.setAttribute("title",this.unlikeTitle);}}};return b;});