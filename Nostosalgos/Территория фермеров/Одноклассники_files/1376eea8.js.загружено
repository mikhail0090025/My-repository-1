define([],function(){var j="__FAPI__";var h="appContainer_Div";var g="appMain_Div";var b="hook_Block_MainContainer";var d="st.";var a=d+"cmd";var l=d+"layer.";var f=l+"cmd";function k(m){return m?encodeURIComponent(m):"";}function e(o,n){var m=new Object();m.x=m.y=0;while(o!=null&&o!=n){m.x+=o.offsetLeft;m.y+=o.offsetTop;o=o.offsetParent;}return m;}function i(){var m=window.location.href;if(m.indexOf("?")<0){m+="?";}else{m+="&";}if(m.indexOf("st.cmd")<0){var n=document.getElementById(h);var o=n?n.getAttribute("data-appid"):null;m+=a+"="+OK.getCurrentDesktopModelId()+"&st.appId="+k(o)+"&";}return m;}function c(x,u){var p=document.getElementById(x);var o=p.getAttribute("href"),y=p.getAttribute("hrefattrs");var n=o+(o.indexOf("?")>-1?"&":"?")+(y||"");if(!u){return n;}var w=Math.max(0,n.indexOf("?")+1);var r=n.substring(w).split("&");var v=n.substring(0,w);var t={};for(var s=0;s<r.length;s++){var q=r[s];var m=q.split("=")[0];if(q.indexOf(m+"=")===0&&m in u&&u[m]!==undefined){v+=m+"="+k(u[m])+"&";t[m]=true;}else{v+=q+"&";}}for(m in u){if(u.hasOwnProperty(m)&&!t.hasOwnProperty(m)&&t[m]!==true){v+=m+"="+k(u[m])+"&";}}return v;}return{methods:{ping:function(n,m){n.success(m);},fail:function(n,m){n.error(m);},gok:function(s,p){try{if(p==="download"){var q=document.getElementById("appContainer_Div");var n=new Date();var r=n.getTime();var o=r+Number(q.getAttribute("data-gok-dnd-timeout"));n.setTime(o);document.cookie=q.getAttribute("data-gok-dnd-name")+"="+Number(q.getAttribute("data-userId")).toString(16)+";expires="+n.toGMTString()+";domain="+q.getAttribute("data-gok-dnd-domain")+";path=/";s.success(p);}}catch(m){s.error(p);}},openMessages:function(o,n){var m="/messages/";if(n){m+=k(n);}navigateOnUrlFromJS(m);},openProfile:function(o,n){var m="/profile/"+k(n)+"?st.cmd=friendMain&st.friendId="+k(n);navigateOnUrlFromJS(m);},getPageInfo:function(s){var n=document.getElementById(b);var p=document.getElementById(h);var r=e(p,n);var q=window.innerHeight;var m=window.innerWidth;if(!q&&document.documentElement){q=document.documentElement.clientHeight;m=document.documentElement.clientWidth;}var o=JSON.stringify({clientWidth:n.clientWidth,clientHeight:n.clientHeight,scrollLeft:(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,scrollTop:(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,offsetLeft:r.x,offsetTop:r.y,innerHeight:q,innerWidth:m});s.success(o);},changeHistory:function(s,q,r){if(!window.OK.historyManager){return;}var m=window.OK.historyManager.getState();if(!m){return;}var n=m.indexOf("?");if(n!=-1){m=m.substring(0,n);}if(q){m+="?"+q;}if(m!=window.OK.historyManager.getState()){if(r){window.OK.historyManager.replaceState(m);}else{window.OK.historyManager.pushState(m);}var p=document.getElementById(h);if(!p||!p.hasAttribute("data-appid")){return;}var o=a+"=appMain&"+d+"appId="+p.getAttribute("data-appid");window.OK.historyManager.putItemToCache(m,o);s.success("ok");}},prepareMidroll:function(o){var n=document.getElementById(h);var m=function(p,q){o[p=="error"?"error":"success"](q);window.OK.logging.logger.success("FAPI","prepareMidroll-"+p+"-"+q,n.getAttribute("data-appid"));};window.require(["OK/GameVideoAdv"],function(q){if(n.getAttribute("data-midroll")){var s=n.getAttribute("data-midroll");var p=n.getAttribute("data-userId");var r=n.getAttribute("data-video-adv-params");q.prepare(s,p,r?JSON.parse(r):null,0,m);}else{o.error("disabled");}},function(p){o.error("javascript");});},showMidroll:function(p){var n=document.getElementById(h);var o=new Date().getTime();var m=function(q,r){p[q=="error"?"error":"success"](r);var s=Math.max(0,Math.min(4,Math.floor((new Date().getTime()-o)/5000))).toString();window.OK.logging.logger.success("FAPI","durationMidroll-"+q+"-"+r+"-"+s,n.getAttribute("data-appid"));window.OK.logging.logger.success("FAPI","showMidroll-"+q+"-"+r,n.getAttribute("data-appid"));};window.require(["OK/GameVideoAdv"],function(r){if(n.getAttribute("data-midroll")){var s=n.getAttribute("data-midroll");var q=n.getAttribute("data-userId");r.show(s,q,m);}else{p.error("disabled");}},function(q){p.error("javascript");});},showPreroll:function(p){var n=document.getElementById(h);var o=0;var m=function(q,r){p[q=="error"?"error":"success"](r);var s=Math.min(4,Math.floor((new Date().getTime()-o)/5000)).toString();window.OK.logging.logger.success("FAPI","durationPreroll-"+q+"-"+r+"-"+s,n.getAttribute("data-appid"));window.OK.logging.logger.success("FAPI","showPreroll-"+q+"-"+r,n.getAttribute("data-appid"));};window.require(["OK/GameVideoAdv"],function(r){if(n.getAttribute("data-preroll")){var t=n.getAttribute("data-preroll");var q=n.getAttribute("data-userId");var s=n.getAttribute("data-video-adv-params");r.prepare(t,q,s?JSON.parse(s):null,1,function(u,v){if(u=="ok"&&v=="ready"){o=new Date().getTime();r.show(t,q,m);}else{p(u,v);}});}else{p.error("disabled");}},function(q){p.error("javascript");});},showGroupTopic:function(n,m){window.require(["OK/MediaLayer"],function(p){var o=p.showTopicInLayer(m,"GROUP_THEME");if(n!=null){o.fail(function(){n.error("error");}).done(function(){n.success("ok");});}});},showInvite:function(p,o,n,m){if(o&&o.length>0&&o.trim().length>0){navigateOnUrlFromJS(c("__app_invite_link",{"st.layer.appAttributes":n,"st.layer.appSelIds":m,"st.layer.msg":o}));}else{p.error("text");}},showNotification:function(p,o,n,m){if(o&&o.length>0&&o.trim().length>0){navigateOnUrlFromJS(c("__app_notification_link",{"st.layer.appAttributes":n,"st.layer.appSelIds":m,"st.layer.msg":o}));}else{p.error("text");}},showPayment:function(v,m,u,n,q,w,p,t,o,s){var r=new Date().getTime();navigateOnUrlFromJS(c("__app_payment_link",{"st.layer.timestamp":r,"st.layer.appName":m,"st.layer.appDescription":u,"st.layer.appCode":n,"st.layer.currency":t,"st.layer.appPrice":q,"st.layer.appOptions":w,"st.layer.appAttributes":p,"st.layer.appUiConf":s,"st.layer.callback":o,"st.layer.appCardOnly":"off"}));},showPaymentCardOnly:function(v,m,u,n,q,w,p,t,o,s){var r=new Date().getTime();navigateOnUrlFromJS(c("__app_payment_card_link",{"st.layer.timestamp":r,"st.layer.appName":m,"st.layer.appDescription":u,"st.layer.appCode":n,"st.layer.currency":t,"st.layer.appPrice":q,"st.layer.appOptions":w,"st.layer.appAttributes":p,"st.layer.appUiConf":s,"st.layer.callback":o,"st.layer.appCardOnly":"on"}));},showPaymentSubscription:function(p,n,m){var o=new Date().getTime();navigateOnUrlFromJS(c("__app_payment_subscription_link",{"st.layer.timestamp":o,"st.layer.appCode":n,"st.layer.appPrice":m}));},showActivePaymentSubscriptions:function(m){navigateOnUrlFromJS(c("__app_active_payment_subscriptions_link",{}));},showPortalPayment:function(m){navigateOnUrlFromJS(c("__app_portal_payment_link",{}));},showPaymentForApp:function(x,n,w,o,r,z,q,u,p,t,y,v){var s=new Date().getTime();var m=i();m+="cmd=PopLayer";m+="&"+f+"=PopLayerPaymentWizardOuter";m+="&st.layer.timestamp="+s;m+="&st.layer.appId="+k(y);m+="&st.layer.appDescription="+k(w);m+="&st.layer.appName="+k(n);m+="&st.layer.appCode="+k(o);m+="&st.layer.currency="+k(u);m+="&st.layer.appPrice="+k(r);m+="&st.layer.appOptions="+k(z);m+="&st.layer.appAttributes="+k(q);m+="&st.layer.appUiConf="+k(t);m+="&st.layer.callback="+k(p);m+="&st.layer.srv=22";m+="&st.layer.appOptionCode="+k(v);m+="&st.layer.appCardOnly=off";navigateOnUrlFromJS(m);},showPermissions:function(o,m,n){navigateOnUrlFromJS(c("__app_permissions_link",{"st.layer.appPermisssions":m,"st.layer.appUiConf":n}));},setWindowSize:function(r,n,p){var m=document.getElementById(h);var o=document.getElementById(g);var q=Math.max(100,m.getAttribute("data-inf-height")==="1"?Number(p):Math.min(4000,Number(p)));if(!Number.isNaN(q)){o.style.height=q+"px";m.style.height=q+"px";r.success("ok");}else{r.error("NaN");}},scrollTo:function(o,m,n){window.scrollTo(parseInt(m,10),parseInt(n,10));o.success("ok");},scrollToTop:function(m){window.scrollTo(0,0);m.success("ok");},showWindow:function(p,o,n,m){navigateOnUrlFromJS(c("__app_confirm_link",{"st.layer.method":o,"st.layer.msg":n,"st.layer.param":m}));},showConfirmation:function(p,o,n,m){navigateOnUrlFromJS(c("__app_confirm_link",{"st.layer.method":o,"st.layer.msg":n,"st.layer.param":m}));},showChangePassword:function(m){navigateOnUrlFromJS(c("__app_change_password_link",{}));},showChangePhone:function(m){navigateOnUrlFromJS(c("__app_change_phone_link",{}));},showPromoPayment:function(u,s,m,t,q,p,w,r){var o=document.getElementById(h);var v=o?o.getAttribute("promo-payment-appid"):null;var n=i();n+="cmd=PopLayer";n+="&"+f+"=PopLayerPaymentWizardOuterFromApi";n+="&st.layer.friendId="+k(s?s:"");n+="&st.layer.friendIdForOkGift="+k(s);n+="&st.layer.presentId="+k(m);n+="&st.layer.or=APPLICATION";if(p){n+="&st.layer.fPromoAppId="+k(p);}if(v){n+="&st.layer.appId="+k(v);}n+="&st.layer.mode="+k(t);n+="&st.layer.appPrice="+k(r);n+="&st.layer.fixedPrice=on";n+="&st.layer.holidayId="+k(q);n+="&st.layer.sd="+k(w?w:"o:A");navigateOnUrlFromJS(n);},showPromo:function(t,s,n,m,q,o,r,p){navigateOnUrlFromJS(c("__app_promo_link",{"st.layer.gfPresent":s,"st.layer.holidayId":n,"st.layer.gfLinkOnPmnt":m,"st.layer.appId":q,"st.layer.mode":r,"st.layer.friendSelectStrategy":p}));},showPaymentPromo:function(q){var o=document.getElementById(h);var p=o?o.getAttribute("data-appid"):null;var m=o!=null?o.getAttribute("has-payment-promo"):null;if(m&&p&&m==="true"){var n=i();n+="cmd=PopLayer";n+="&"+f+"=PopLayerPaymentPromo";n+="&st.appId="+k(p);n+="&st.manual=true";o.removeAttribute("has-payment-promo");navigateOnUrlFromJS(n);}q.error("disabled");},postMediatopic:function(q,p,m,n,o){navigateOnUrlFromJS(c("__app_mediatopic_post_link",{"st.layer.attachment":p,"st.layer.showStatus":m,"st.layer.mtPlatforms":n,"st.layer.groupId":o,}));},showGroupPermissions:function(r,p,n){var o=document.getElementById(h);var q=o?o.getAttribute("data-appid"):null;var m="/group/"+k(n)+"?st.cmd=altGroupMain";m+="&st.groupId="+k(n);m+="&cmd=PopLayer";m+="&"+f+"=PopLayerGroupAppPermissions";m+="&st.layer.groupId="+k(n);m+="&st.layer.appId="+k(q);m+="&st.layer.appPermisssions="+k(p);navigateOnUrlFromJS(m);},playPortalTrack:function(n,m){window.odklMusic.playPortalTrack(m,"musicGifts",null,"FAPI");},playingTrack:function(m){m.success("{trackId:"+window.odklMusic.playingTrack()+"}");},goToGroup:function(q,o,m,p){var n="/group/"+k(o)+"?";n+=a+"=altGroupMain";n+="&"+f+"=PopLayerClose";n+="&st.groupId="+k(o);n+="&st._aid="+k(m);if(p&&p.length>0){window.OK.historyManager.pushState(p);}else{window.OK.historyManager.pushState("/group/"+k(o));}navigateOnUrlFromJS(n);},showSendOkPayment:function(t,o,n,s,q,p,r){var m=i();m+="cmd=PopLayer";m+="&"+f+"=PopLayerPaymentWizardOuterFromApi";m+="&st.layer.friendId="+k(n);m+="&st.layer.friendIdForOkGift="+k(n);m+="&st.layer.or=APPLICATION";m+="&st.layer.mode="+k(s);m+="&st.layer.srv="+k(r);m+="&st.layer.appPrice="+k(q);m+="&st.layer.fixedPrice="+k(p);m+="&st.layer.sd=o:A";navigateOnUrlFromJS(m);},showSendPresent:function(o,n){var m="/gifts?";m+=f+"=PopLayerClose";m+="&"+a+"=giftsFront";m+="&st._aid=FAPI_SP";if(n&&n.length>0){m+="&st.friendId="+k(n);}m+="&st.cat=liveGifts";m+="&st.or=PROMO";m+="&st._forceSetHistory=true";navigateOnUrlFromJS(m);},playLivePresent:function(q,p){var o=document.getElementById(h);var n=o?o.getAttribute("data-live-present-player-id"):null;if(!n){n="189461760";}var m="/gifts?";m+="cmd=PromoMainLayer";m+="&"+f+"=PopLayerClose";m+="&"+a+"=giftsFront";m+="&st.or=PROMO";m+="&st._forceSetHistory=true";m+="&st.prm.applicationId="+k(n);m+="&st.prm.show=on";m+="&st.prm.userPresentId="+k(p);m+="&st.prm.promoLayerViewType=LIVE_PRESENTS_LAYER";navigateOnUrlFromJS(m);},goToUser:function(p,n,o){var m=(o?o:("/profile/"+k(n)))+"?";m+=f+"=PopLayerClose";m+="&"+a+"=friendMain";m+="&st.friendId="+k(n);if(o&&o.length>0){window.OK.historyManager.pushState(o);}else{window.OK.historyManager.pushState("/profile/"+k(n));}navigateOnUrlFromJS(m);},showCloseConfirmation:function(n){var m=i();m+="cmd=PopLayer";m+="&"+f+"=PostingFormQuitConfirmation";m+="&st.layer.confirmType=YOULA_NOT_EMPTY";navigateOnUrlFromJS(m);},goToApp:function(q,p){var n=document.getElementById(h);var o=n?n.getAttribute("promo-payment-appid"):null;var m=n.getAttribute("data-app-short-link");navigateOnUrlFromJSFull((m?m:"/app/"+o),a+"=appMain&st.appId="+k(o)+"&close=true",p);},showEditUserProfile:function(n){var m=i();m+="cmd=PopLayer";m+="&"+f+"=PopLayerEditUserProfileNew";m+="&st.layer.callback=true";navigateOnUrlFromJS(m);},showFriendSelectLayer:function(s,r,q,n,m,p){var o=i();o+="cmd=PopLayer";o+="&"+f+"=PopLayerSendPresentSelectFriendComposite";o+="&st.layer.or=APPLICATION";o+="&st.layer.mode="+k(r);o+="&st.layer.appPrice="+k(q);o+="&st.layer.fixedPrice="+k(n);o+="&st.layer.sendOk="+k(m);o+="&st.layer.sd="+(p?p:"o:A");navigateOnUrlFromJS(o);},goToGiftsFront:function(r,n,o,p,q){var m="/gifts?";m+=f+"=PopLayerClose";m+="&"+a+"=giftsFront";m+="&st.or=PROMO";m+="&st._forceSetHistory=true";if(n&&n.length>0){m+="&st.friendId="+k(n);}if(o&&o.length>0){m+="&st.presentId="+k(o);}if(p&&p.length>0){m+="&st.cat="+k(p);}if(q&&q.length>0){m+="&st.bId="+k(q);}navigateOnUrlFromJS(m);},goToThankYouGifts:function(o,n){var m="/gifts?";m+=f+"=PopLayerClose";m+="&"+a+"=giftsFront";m+="&st.or=NOTIFICATION_THANKYOU";m+="&st.friendId="+k(n);m+="&st._forceSetHistory=true";m+="&st.cat=thankYou";navigateOnUrlFromJS(m);},refreshProfileAvatar:function(n){var m=i();m+="&cmd=PromoMainLayer";m+="&st.layer.action=ChangeAvatar";navigateOnUrlFromJS(m);},refreshStatus:function(n){var m=i();m+="&cmd=PromoMainLayer";m+="&st.layer.action=ChangeStatus";navigateOnUrlFromJS(m);},closeAppLayer:function(n){var m=i();m+="&cmd=PromoMainLayer";m+="&st.prm.hide=on";m+="&st.layer.action=RefreshPromoAppLayer";navigateOnUrlFromJS(m);},closeRamblerKassa:function(m){OK.hookModel.setHookContent("PopLayer","");},},createCallback:function(m){return{success:function(n){OKAPI.postCallback(m,"ok",n);},error:function(n){OKAPI.postCallback(m,"error",n);}};},handle:function(p){try{if(!p||!p.data||(typeof p.data!=="string")){return false;}var n=p.data.split("$",-1);if(n.length==0){return false;}n=n.map(decodeURIComponent);var m=n[0];if(m.indexOf(j)==0){m=m.substr(j.length);}var r=n[0]=this.createCallback(m);if(this.methods.hasOwnProperty(m)){try{var o=this.methods[m].apply(this.methods,n);if(o!==undefined){r.success(o);}}catch(q){r.error(q.message);}return true;}else{r.error("unknown_method");}}catch(q){r.error("unknown_error");console.warn(q);}return false;},activate:function(p){var t=this.start=new Date().getTime(),n=this;var r=document.getElementById("appContainer_Div");if(r){var s=r.getAttribute("data-appid");var q=r.getAttribute("data-watch-session-interval");var m=r.getAttribute("data-ref-place");if(q&&s&&Number(q)>1000&&!isNaN(Number(m))){var o=this.log=function(u){OK.logging.logger.success("GSW",u,JSON.stringify({start:t,now:new Date().getTime(),appId:s,ref:Number(m),focus:document.hasFocus&&document.hasFocus()?1:0}));};o("start");this.interval=setInterval(function(){o("continue");},Number(q));}}window.OKAPI={html5:false,appFrame:null,remoteWindow:null,remoteOrigin:null,attachedToApp:false,attachToApp:function(){this.appFrame=document.getElementById(g);if(this.appFrame==null){this.remoteWindow=null;this.remoteOrigin=null;this.attachedToApp=false;}else{var u=document.createElement("a");u.href=this.appFrame.src;this.remoteWindow=this.appFrame.contentWindow;this.remoteOrigin=u.protocol+"//"+u.host;if(this.remoteOrigin.substr(this.remoteOrigin.length-3)==":80"){this.remoteOrigin=this.remoteOrigin.substr(0,this.remoteOrigin.length-3);}if(this.remoteOrigin.substr(this.remoteOrigin.length-4)==":443"){this.remoteOrigin=this.remoteOrigin.substr(0,this.remoteOrigin.length-4);}this.attachedToApp=true;}return this.attachedToApp;},init:function(){this.html5=!(typeof window.postMessage=="undefined");if(this.html5){this.initListener();}},initListener:function(){if(typeof window.addEventListener!="undefined"){window.addEventListener("message",this.onPostMessage,false);}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",this.onPostMessage);}}this.attachToApp();if(this.appFrame&&this.appFrame.parentNode.parentNode.hasAttribute("data-post-scroll")){var u=function(w){if(window.OKAPI.appFrame.contentWindow){window.OKAPI.appFrame.contentWindow.postMessage("ok_scrollY$"+window.scrollY,window.OKAPI.remoteOrigin);}};var v=function(x){if(window.OKAPI.appFrame.contentWindow){var y=window.innerHeight;var w=window.innerWidth;if(!y&&document&&document.documentElement){y=document.documentElement.clientHeight;w=document.documentElement.clientWidth;}window.OKAPI.appFrame.contentWindow.postMessage("ok_resize$"+y+"_"+w,window.OKAPI.remoteOrigin);}};if(typeof window.addEventListener!="undefined"){window.addEventListener("scroll",u,false);window.addEventListener("resize",v,false);}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onscroll",u);window.attachEvent("onresize",v);}}}window.__FAPI__ShowPayment=function(){var w=[].slice.call(arguments);w[0]=n.createCallback("ShowPayment");n.methods.showPayment.apply(n.methods,w);};},onPostMessage:function(u){if("__FAPI__attach"==u.data){if(window.OKAPI.attachToApp()){window.OKAPI.remoteWindow.postMessage("attach$ok$ok",window.OKAPI.remoteOrigin);}return;}if(!window.OKAPI.attachedToApp&&!window.OKAPI.attachToApp()){return;}if(window.OKAPI.remoteOrigin==null||u.origin!=window.OKAPI.remoteOrigin){return;}n.handle(u);},postCallback:function(v,u,w){try{if(this.html5){if(this.attachedToApp){this.remoteWindow.postMessage(decodeURIComponent(v)+"$"+decodeURIComponent(u)+"$"+decodeURIComponent(w),this.remoteOrigin);}}}catch(x){}try{document.getElementById("apiProxy").__FAPI__CallBack(v,u,w);}catch(x){}}};OKAPI.init();},deactivate:function(m){if(this.interval){this.log("end");clearInterval(this.interval);this.interval=null;}if(OKAPI){delete window.__FAPI__ShowPayment;window.removeEventListener("message",OKAPI.onPostMessage);window.removeEventListener("onmessage",OKAPI.onPostMessage);}}};});