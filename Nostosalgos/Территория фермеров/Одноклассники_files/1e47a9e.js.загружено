define(["OK/utils/utils"],function(b){var a=b.deferred(),c=[];function d(e){c.forEach(function(f){f(e);});}return{activate:function(e){a.resolve(e);},listen:function(g,e,f){a.promise.then(function(h){h.addListener(g,e,f);});},add:function(e,f){a.promise.then(function(g){var i={};var h={ui:e,online:f||0};i[e]=h;g.updateUserCache(i);d([h]);});},remove:function(e){a.promise.then(function(f){f.removeRefFromCache(e);});},ifOnline:function(e){return new Promise(function(g,f){a.promise.then(function(i){var h=i.getFromUserCache(e);var j=h&&(h.online===1||h.online===4||h.online===5);if(j){g();}else{f();}});});},registerOnAddListener:function(e){c.push(e);},unregisterOnAddListener:function(f){var e=c.indexOf(f);if(e>-1){c.splice(e,1);}}};});