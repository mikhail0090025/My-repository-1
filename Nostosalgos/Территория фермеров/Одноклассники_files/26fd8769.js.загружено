define(["module","OK/utils/vanilla"],function(e,j){var n={},m=[],p={},f,g="$Hash$",c=e.config().timeout||60000;function o(s){var t=p[s]||[],r=t.length;while(r--){t[r]();}}function b(r){return n.hasOwnProperty(r);}function d(r){var s=n[r];return s.data;}function i(s,r){var t={data:JSON.parse(r.data)};t[g]=r[g];n[s]=t;o(s);return d(s);}function q(){var v=[],t,s=0,r=m.length,u;for(;s<r;s+=1){t=m[s];u=n[t];v.push({alias:t,hash:u[g]||"0"});}return JSON.stringify(v);}function k(){j.ajax({url:"/web-api/upms",headers:{"Content-Type":"application/json"},data:q(),dataType:"json"}).then(function(t){var v=t.response,u=Object.keys(v),w,s=0,r=u.length;for(;s<r;s+=1){w=u[s];i(w,v[w]);}});}function l(r){if(!r){return;}if(m.indexOf(r)===-1){m.push(r);}if(!f&&(c>0)){f=window.setInterval(k,c);}}if(typeof window!=="undefined"){window.cfgStore={getCfg:function(r){l(r);return d(r);},subscribe:function(r,s){if(!p[r]){p[r]=[];}p[r].push(s);}};if(window.inline_resources!==undefined&&window.inline_resources.pms!==undefined){for(var h in window.inline_resources.pms){i(h,window.inline_resources.pms[h]);l(h);}window.inline_resources.pms={};}}function a(r){return j.ajax({type:"GET",url:"/web-api/pms?name="+encodeURIComponent(r),headers:{"Content-Type":"application/json"},dataType:"json"}).then(function(s){return Promise.resolve(s.response);});}return{load:function(s,t,u,r){if(r.isBuild){u();return;}if(b(s)){u(d(s));}else{a(s).then(function(v){u(i(s,v));});}}};});