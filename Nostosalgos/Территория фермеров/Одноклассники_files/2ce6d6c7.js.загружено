define(["OK/utils/dom","OK/autofocus"],function(b,d){var c="__active";function a(){this.options={closable:"0",resetActiveItems:"1",autofocus:""};this._activeItems=[];this._toogle=this._toogle.bind(this);}a.prototype={_show:function(){if(this.options.resetActiveItems==="1"){var e=this._activeItems;b.byClass(this._filter,"filter_i").forEach(function(f){if(f.classList.contains(c)){e.push(f);f.classList.remove(c);}});}this._el.classList.add(c);this._toogleNext();this._filter.classList.add("__search-visible");},_toogleNext:function(){var f=this._filter.nextElementSibling,e=this.options.autofocus;while(f){f.classList.toggle("invisible");f=f.nextElementSibling;}if(e){e=this._filter.parentNode.querySelector(e);if(e){d.activate(e);}}},_hide:function(){if(this.options.closable==="0"){return;}this._activeItems.forEach(function(e){e.classList.add(c);});this._activeItems=[];this._el.classList.remove(c);this._toogleNext();this._filter.classList.remove("__search-visible");},_toogle:function(f){var e=this._el;f.preventDefault();if(e.classList.contains(c)){this._hide();}else{this._show();}},_initOptions:function(e){Object.assign(this.options,e);},activate:function(e){this._initOptions(e.dataset);this._filter=b.parent(e,"filter");if(!this._filter){return;}this._el=e;e.addEventListener("click",this._toogle);},deactivate:function(){this._el.removeEventListener("click",this._toogle);OK.util.clean(this);}};return a;});