define(["OK/utils/dom","OK/AttachPicker"],function(d,b){var a="&st.layer.objectId=";function c(){}c.prototype={activate:function(e){this.element=e;this.objectId=e.getAttribute("data-object-id");this.url=e.getAttribute("data-url");if(this.url.indexOf(a)<0){var f=d.firstByClass(document,"js-chat");this.objectId=f.getAttribute("data-object-id");this.url+=a+this.objectId;}e.addEventListener("click",this);},vchatLoad:function(e){this.element=e;this.url=e.getAttribute("data-url");e.addEventListener("click",this);},deactivate:function(){this.element.removeEventListener("click",this);},handleEvent:function(g){g.stopPropagation();if(this.objectId){var f=this.url+"&st.layer.maxCount="+b.getRemainingCount(this.objectId);navigateOnUrlFromJS(f);}else{navigateOnUrlFromJS(this.url);require(["OK/videochat/flash/VideoChat","swfobject"]);}return false;}};return c;});