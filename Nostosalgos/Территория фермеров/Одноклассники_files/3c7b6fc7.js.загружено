define("OK/AbstractShortcutMenu",["OK/utils/dom","OK/utils/vanilla","OK/utils/delegate"],function(h,f,e){var d=54;var c="ShortcutMenu";var b=null;var g=document.createElement("div");g.id="hook_Block_"+c;document.body.appendChild(g);OK.hookModel.captureBlockHook("body",g);g.addEventListener("change",function(){if(b&&b.visible()){b.positingElement();}});function a(){this.holder=null;this.menuElement=null;this.showTimeout=null;this.hideTimeout=null;this.ajaxRequest=null;this.direction="";this.position="center";this._visible=false;this.inplace=false;this.detectScrollableContainer=false;this.menuElementHoverInListenerCalled=false;}a.getActiveInstance=function(){return b;};a.setActiveInstance=function(i){b=i;};a.getBlockId=function(){return c;};a.prototype.getBlock=function(){if(this.inplace){return this.block;}return g;};a.prototype.getHtml=function(){};a.prototype.initListeners=function(i){this.shortcutMenuDelegate=new e(i);this.shortcutMenuDelegate.on("click",".sc-menu a",this.menuElementLinkClickListener.bind(this));this.shortcutMenuDelegate.on("click",".sc-menu .js-hide",this.menuElementClickListener.bind(this));this.shortcutMenuDelegate.on("click",".js-forceHide",this.hideMenu.bind(this));this.shortcutMenuDelegate.on("mouseenter",this.menuElementHoverInListener.bind(this));this.shortcutMenuDelegate.on("mouseleave",this.hoverOutListener.bind(this));if(OK.device.isTouch){this.shortcutMenuDelegate.on("touchstart",this.holderTouchStartListener.bind(this));}};a.prototype.processHTML=function(k){var j=[];if(this.inplace){this.initBlock();j[0]=this.blockId;}else{j[0]=a.getBlockId();}var i=this.getBlock();f.updateBlocks(k,j);this.initListeners(i);this.menuElement=h.firstByClass(i,"sc-menu");this.positingElement();this.menuElement.classList.remove("sc-menu__hidden");this.holder.classList.add("__vis");a.setActiveInstance(this);this._visible=true;};a.prototype.showMenu=function(){clearTimeout(this.hideTimeout);this.showTimeout=null;if(this.visible()){return;}if(b){b.hide();}this.processHTML(this.getHtml());};a.prototype.hideMenu=function(){this.clearShowTimeout();this.clearHideTimeout();if(this.menuElement){this.menuElement.classList.add("sc-menu__hidden");OK.hookModel.setHookContent(c,"");this.menuElement=null;}this.holder.classList.remove("__vis");if(this.shortcutMenuDelegate){this.shortcutMenuDelegate.off();}this._visible=false;a.setActiveInstance(null);};a.prototype.hide=function(){this.clearShowTimeout();this.clearHideTimeout();if(this.menuElement){this.hideMenu();}};a.prototype.getClosestScrollable=function(k){if(!this.closestScrollable){var i=/(auto|scroll)/;var j=h.traverseParents(this.element,function(l){var m=window.getComputedStyle(l);var n=i.test(m.overflow+m.overflowY+m.overflowX);return n&&(!k||(l.scrollHeight>l.clientHeight));});this.closestScrollable=j||window;}return this.closestScrollable;};a.prototype.isTopDirection=function(m,j){var l=this.holder.getBoundingClientRect().top;if(this.detectScrollableContainer){var k=this.holder.getBoundingClientRect().height;var n=this.getClosestScrollable();var q=l-n.getBoundingClientRect().top;var i=n.clientHeight-k;var p=n.scrollTop+q+k+j;var o=n.scrollHeight;return i/2<q||(p>o);}else{return window.innerHeight-m-l<j;}};a.prototype.isInsideViewportWhileCentered=function(o){var j=this.holder.getBoundingClientRect();var k=j.left;var l=window.innerWidth-OK.scrollBar.width;if(this.detectScrollableContainer){var i=this.getClosestScrollable().getBoundingClientRect();k=k-i.left;l=i.right;}var n=k+(j.width-o)/2;var m=n+o;return n>0&&m<l;};a.prototype.toRightFromHolder=function(j,l){if(this.detectScrollableContainer){var i=this.getClosestScrollable().getBoundingClientRect();var k=this.holder.getBoundingClientRect().left-i.left;return i.width/2>k;}else{return(window.innerWidth-OK.scrollBar.width)>(j.left+l);}};a.prototype.visible=function(){return this._visible;};a.prototype.getOffset=function(i){var j=i.getBoundingClientRect();return{left:j.left+window.pageXOffset,top:j.top+window.pageYOffset};};a.prototype.positingElement=function(){var i=h.outerSize(this.holder,false,true);var v=this.inplace?{top:0,left:0}:this.getOffset(this.holder);var p=h.outerSize(this.holder,true,true);var k=h.outerSize(this.menuElement,true,true);var y=this.position;if(y==="center"&&!this.isInsideViewportWhileCentered(k)){y="auto";}if(y!=="center"&&y!=="auto"){this.menuElement.classList.add("__noarrow");}var A;var j=h.outerSize(this.menuElement,false,true);if(this.direction==="top_force"||this.direction==="bottom_force"){A=this.direction==="top_force";}else{if(this.direction==="top"){A=this.getOffset(this.holder).top-window.pageYOffset-90>j;}else{if(this.direction==="bottom"){A=false;}else{A=this.isTopDirection(i,j);}}}var r=v.top;var l=[];if(A){this.menuElement.classList.add("sc-menu__top");var m;if(this.inplace){m=r+i;l.push("top: auto; bottom: "+Math.round(m)+"px;");}else{r-=j;l.push("bottom: auto; top: "+Math.round(r)+"px;");}}else{this.menuElement.classList.remove("sc-menu__top");if(!this.inplace){r+=i;}l.push("bottom: auto; top: "+Math.round(r)+"px;");}var w=Math.round(v.left-(k-p));var z=Math.round(v.left);var t=Math.round(v.left+((p-k)/2));switch(y){case"left":l.push("left: "+w+"px;");break;case"right":l.push("left: "+z+"px;");break;case"auto":var x=h.firstByClass(this.menuElement,"entity-shortcut-menu_arw"),u=0,s=x?d:0,q=this.toRightFromHolder(v,k);if(q){this.menuElement.classList.remove("__right");this.menuElement.classList.add("__left");}else{this.menuElement.classList.add("__right");this.menuElement.classList.remove("__left");}if(!s){x=h.firstByClass(this.menuElement,"sc-menu_arw");if(x){var o=x.getBoundingClientRect();if(o.width){var n=this.menuElement.getBoundingClientRect();if(q){s=(o.left-n.left)*2+o.width;}else{s=((n.left+n.width)-(o.left+o.width))*2+o.width;}}}}if(p<s){u=(s-p)/2;}if(q){l.push("left: "+(z-u)+"px;");}else{l.push("left: "+(w+u)+"px;");}break;default:l.push("left: "+t+"px;");break;}this.menuElement.setAttribute("style",l.join(""));};a.prototype.ajaxClose=function(i){if(this.ajaxRequest){this.ajaxRequest.xhr.abort();this.ajaxRequest=null;if(typeof i==="function"){i();}}};a.prototype.hoverInListener=function(i){if(OK.device.isTouch&&i){return;}this.clearHideTimeout();if(!this.showTimeout&&!this.visible()){this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelay);}};a.prototype.hoverOutListener=function(){this.clearShowTimeout();this.ajaxClose();if(!this.hideTimeout&&this.visible()){this.hideTimeout=setTimeout(function(){if(this.hideOnBlurElement!==document.activeElement){this.hideMenu();}else{this.hideTimeout=null;}}.bind(this),this.hideDelay);}};a.prototype.menuElementHoverInListener=function(){this.menuElementHoverInListenerCalled=true;if(this.hideTimeout){this.hideTimeout=clearTimeout(this.hideTimeout);}};a.prototype.menuElementLinkClickListener=function(i){if(!h.parent(i.target,"js-doNotHide",this.block)){this.menuElementClickListener();}};a.prototype.menuElementClickListener=function(){if(true===this.hideTimeout){this.hideTimeout=null;}this.hoverOutListener();};a.prototype.holderTouchStartListener=function(i){i.stopPropagation();};a.prototype.clearShowTimeout=function(){if(this.showTimeout){this.showTimeout=clearTimeout(this.showTimeout);}};a.prototype.clearHideTimeout=function(){if(this.hideTimeout){this.hideTimeout=clearTimeout(this.hideTimeout);}};return a;});define("OK/ShortcutMenu",["OK/logger","OK/utils/vanilla","OK/utils/dom","OK/utils/delegate","OK/AbstractShortcutMenu"],function(b,e,f,d,a){function c(g){a.call(this);this.hookId=g;this.stopClick=true;this.ajaxRequest=null;this.cacheable=true;this.loaded=false;this.showOnClick=true;}c.prototype=Object.create(a.prototype);c.prototype.constructor=c;Object.assign(c.prototype,{activate:function(h){this.element=h;this.holder=this.getHolder();this.blockId=this.element.getAttribute("data-blockid");this.block=document.getElementById("hook_Block_"+this.blockId);this.inplace=this.element.getAttribute("data-inplace");this.loaded=this.element.getAttribute("data-loaded");this.showDelay=parseInt(this.element.getAttribute("data-show"),10)||300;this.hideDelay=parseInt(this.element.getAttribute("data-hide"),10)||100;this.cacheable=!this.element.getAttribute("data-nocache");this.saveChanges=this.element.getAttribute("data-save-changes");this.direction=this.element.getAttribute("data-direction");this.position=this.element.getAttribute("data-position")||"center";this.showOnClick=this.element.getAttribute("data-onClick");this.isShowImmediately=this.element.getAttribute("data-showImmediately");this.showImmediatelySelector=this.element.getAttribute("data-showImmediatelySelector");this.relatedMenu=this.getRelatedMenu();this.hideOnClick=this.element.getAttribute("data-hideOnClick");this.hideOnMouseDown=this.element.getAttribute("data-hideOnMouseDown");this.hideOnScroll=this.element.getAttribute("data-hideOnScroll");this.hideOnBlurSelector=this.element.getAttribute("data-hideOnBlurSelector");this.hideOnBlurElement=null;this.detectScrollableContainer=this.element.getAttribute("data-detect-scrollable");if(!this.holder){b.error("asm","noholder");b.success("asm","noholder",this.buildParamFingerprint());return;}this.handlers={};this.boundAjaxFail=this.ajaxFail.bind(this);this.boundAjaxDone=this.ajaxDone.bind(this);this.holderDelegate=new d(this.holder);if(OK.device.isTouch){this.holderDelegate.on("touchstart",this.holderTouchStartListener);var g=this.holder.getElementsByTagName("a")[0];if(!g){g=f.traverseParents(this.holder,function(i){return i.tagName.toUpperCase()==="A";},document.body,true);}if(g){this.linkDelegate=new d(g);this.linkDelegate.on("touchstart",this.touchHandle.bind(this),true);}}this.holderDelegate.on("mouseleave",this.hoverOutListener.bind(this));if(this.showOnClick){this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu);}else{this.holderDelegate.on("mouseenter",this.hoverInListener.bind(this));if(this.hideOnClick){this.holderDelegate.on("click",this.hoverOutListener.bind(this));}if(this.hideOnMouseDown){this.holderDelegate.on("mousedown",this.hoverOutListener.bind(this));}}if(this.inplace&&this.loaded){this.initListeners(this.getBlock());}if(this.isShowImmediately){this.showImmediately();}},deactivate:function(){if(!this.holder){return;}this.ajaxClose();this.hide();this.removeOneTimeListener(this.oneClickListener);this.removeOneTimeListener(this.oneScrollListener);this.removeOneTimeListener(this.oneBodyTouchListener);this.removeOneTimeListener(this.oneImmediatelyHandler);this.removeOneTimeListener(this.oneBlurListener);this.holderDelegate.destroy();if(this.linkDelegate){this.linkDelegate.destroy();}if(this.shortcutMenuDelegate){this.shortcutMenuDelegate.destroy();}},buildParamFingerprint:function(){var h=[this.inplace,this.loaded,this.cacheable,this.showOnClick,this.hideOnClick,this.hideOnScroll];var g="";h.forEach(function(i){g+=(!!i*1).toString();});return g;},getHolder:function(){var g=this.element.getAttribute("data-holder");return g?document.getElementById(g):this.element.previousElementSibling;},getRelatedMenu:function(){var g=this.element.getAttribute("data-related"),h;if(g){h=OK.hookModel.getHookById(g);return h.getInstance?h.getInstance():null;}return null;},getHtml:function(){if(!this.block){return"";}var g=this.block.innerHTML;if(!this.inplace||!this.cacheable){OK.hookModel.setHookContent(this.blockId,"");if(this.cacheable){this.block.innerHTML=g;}}return g;},initBlock:function(){if(this.element&&!this.block){var i=Array.prototype.slice.call(this.element.children);var j=null;for(var g=0;g<i.length;g++){if(i[g].classList.contains("posR")){j=i[g];break;}}if(!j){var h=document.createElement("div");h.id="hook_Block_"+this.blockId;h.className="posR";this.element.appendChild(h);this.block=h;OK.hookModel.captureBlockHook(this.hookId,h);}else{this.block=j;}}},initListeners:function(g){a.prototype.initListeners.call(this,g);if(this.hideOnBlurSelector){this.hideOnBlurElement=this.block.querySelector(this.hideOnBlurSelector);this.oneBlurListener=this.addOneTimeListener(this.hideOnBlurElement,"blur",this.hoverOutListener.bind(this));}},showMenu:function(){clearTimeout(this.hideTimeout);this.showTimeout=null;if(this.relatedMenu&&this.relatedMenu.hide){this.relatedMenu.hide();}if(this.visible()){return;}if(a.getActiveInstance()){a.getActiveInstance().hide();}if(this.showOnClick){this.removeOneTimeListener(this.oneClickListener);this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.hideMenu);}if(this.hideOnScroll){this.oneScrollListener=this.addOneTimeListener(this.getClosestScrollable(true),"scroll",this.hoverOutListener);}this.showTimeout=null;if(OK.device.isTouch){this.oneBodyTouchListener=this.addOneTimeListener(document.body,"touchstart",this.hoverOutListener);}if(this.ajaxRequest){return;}this.startTime=Date.now();if(this.loaded){var h=this.getHtml();this.processHTML(h,undefined,!this.inplace||!this.cacheable);b.success("asm","show","cache");}else{var g=this.element.getAttribute("data-url");this.ajaxRequest=e.ajax({url:g,dataType:"html"});this.ajaxRequest.then(this.boundAjaxDone,this.boundAjaxFail);}},showImmediately:function(){var g=this;if(g.showImmediatelySelector){setTimeout(function(){var h=g.showImmediatelySelector+":hover";g.showImmediatelyElement=f.traverseParents(g.holder,function(i){return i.matches(h);});if(g.showImmediatelyElement.matches(h)){g.showMenu();g.oneImmediatelyHandler=this.addOneTimeListener(g.showImmediatelyElement,"mouseleave",function(){setTimeout(function(){if(!g.menuElementHoverInListenerCalled){g.hideMenu();}},g.hideDelay);});}},1);}},hideMenu:function(){this.clearShowTimeout();if(!this.visible()&&!this.showOnClick){return;}this.clearHideTimeout();this.stopClick=true;if(this.showOnClick){this.removeOneTimeListener(this.oneClickListener);this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu);}this.ajaxClose(function(){b.success("asm","ajax","to");});if(this.menuElement){this.menuElement.classList.add("sc-menu__hidden");this.getHtml();if(this.saveChanges&&!this.inplace&&this.loaded&&this.cacheable){this.initBlock();this.block.innerHTML=this.getBlock().innerHTML;}OK.hookModel.setHookContent(a.getBlockId(),"");this.menuElement=null;}this.holder.classList.remove("__vis");if(this.shortcutMenuDelegate&&!this.cacheable){this.shortcutMenuDelegate.off();}this._visible=false;a.setActiveInstance(null);},touchHandle:function(g){if(this.stopClick){g.preventDefault();g.stopPropagation();this.stopClick=false;if(!this.showOnClick){this.hoverInListener();}return false;}else{this.hoverOutListener();}},processHTML:function(j,k,h){var i=[];if(k&&k.getResponseHeader(OK.navigation.HEADER)){i=k.getResponseHeader(OK.navigation.HEADER).split(",");}if(this.inplace){this.initBlock();i[0]=this.blockId;}else{i[0]=a.getBlockId();}var g=this.getBlock();if(h){e.updateBlocks(j,i);this.initListeners(g);}this.menuElement=f.firstByClass(g,"sc-menu");this.positingElement();this.menuElement.classList.remove("sc-menu__hidden");this.holder.classList.add("__vis");a.setActiveInstance(this);this._visible=true;},ajaxDone:function(g){b.duration("asm",Date.now()-this.startTime,"ajax");var h=g.response;if(!h||(h.split(OK.navigation.SPLITER)[0]).length===0){b.success("asm","ajax","e");return;}b.success("asm","show","ajax");if(this.cacheable&&this.element){this.loaded=true;this.initBlock();this.block.innerHTML=h.split(OK.navigation.SPLITER)[0];}this.processHTML(h,g.xhr,true);this.ajaxClose();},ajaxFail:function(){this.ajaxClose(function(){b.error("asm","ajax");});},addOneTimeListener:function(g,i,h){var k=this;var j=function j(l){g.removeEventListener(l.type,j);h.call(k,l);};g.addEventListener(i,j);return{element:g,type:i,handler:j};},removeOneTimeListener:function(g){if(g){g.element.removeEventListener(g.type,g.handler);g=null;}}});return c;});define("b/shortcutMenuBundle",["OK/AbstractShortcutMenu","OK/ShortcutMenu"],{});