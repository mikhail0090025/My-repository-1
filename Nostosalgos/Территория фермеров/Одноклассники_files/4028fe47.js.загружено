define(["OK/logger","OK/PhotoUploadController"],function(d,c){var a=";";var g=/^(image|video)\//;function e(){this.onDragEnter=this.onDragEnter.bind(this);this.onDragEnd=this.onDragEnd.bind(this);this.onDrop=this.onDrop.bind(this);}e.prototype={activate:function(i){this.el=i;var h=this.overlay=i.querySelector(".dnd-overlay");try{this.context=JSON.parse(i.getAttribute("data-context"));}catch(j){}this.excludeSelectors=h.hasAttribute("data-exclude-selectors")?h.getAttribute("data-exclude-selectors").split(a):[];if(h&&this.context){document.body.addEventListener("dragenter",this.onDragEnter);h.addEventListener("dragover",this.onDragEnter);h.addEventListener("dragleave",this.onDragEnd);h.addEventListener("dragend",this.onDragEnd);h.addEventListener("drop",this.onDrop);}},deactivate:function(){var h=this.overlay;if(h){document.body.removeEventListener("dragenter",this.onDragEnter);h.removeEventListener("dragover",this.onDragEnter);h.removeEventListener("dragleave",this.onDragEnd);h.removeEventListener("dragend",this.onDragEnd);h.removeEventListener("drop",this.onDrop);}},onDragEnter:function(h){h.preventDefault();var k=this.overlay,m=h.dataTransfer&&h.dataTransfer.items,i=!(m&&m.length),p=f(m).length>0,o=h.x,n=h.y;var j=this.excludeSelectors.find(function(r){return b(r,o,n);}),q=OK.Layers.isAnyLayerOpened(),l=(p||i)&&!j&&!q;if(l&&!k.classList.contains("__enabled")){d.success("dnd.layer","drag_started");}k.classList.toggle("__enabled",l);},onDragEnd:function(){this.overlay.classList.remove("__enabled");d.success("dnd.layer","drag_ended");},onDrop:function(j){j.preventDefault();var h=j.dataTransfer&&j.dataTransfer.files;var i=f(h);c.uploadPhotos(i,this.context);this.overlay.classList.remove("__enabled");d.success("dnd.layer","dropped");}};function f(h){var l=[];if(h&&h.length){for(var j=0;j<h.length;j++){var k=h[j];if(g.test(k.type)){l.push(k);}}}return l;}function b(i,h,l){var j=document.querySelector(i);if(!j){return false;}var k=j.getBoundingClientRect();return k.left<=h&&k.right>=h&&k.top<=l&&k.bottom>=l;}return e;});