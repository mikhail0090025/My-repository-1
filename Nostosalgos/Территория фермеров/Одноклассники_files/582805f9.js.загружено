define("OK/reactions/ReactionAnimatable",["OK/EventFactory"],function(b){var a=window.performance;var e=a&&typeof a.now==="function";var d="@no_name_animation";function c(i,g,h){this.elem=i;this.drawFn=g||new Error("Render function must be specified.");this.animationId=null;this.animationsDone=[];this.animationsStopped=[];this.animationsCount=0;this.onAnimationStart=b.create();this.onAnimationChainStart=b.create();this.onAnimationStop=b.create();this.onAnimationEnd=b.create();this.onAllAnimationsEnd=b.create();i._okAnimatable=this;var f=this;this.onAnimationEnd.attach(function(k){var j=f.animationsDone;j.push(k.type||k.name);if(j.length===f.animationsCount){setTimeout(function(){f.done=true;f.onAllAnimationsEnd.trigger(k);},0);}});this.props=h;}c.prototype={run:function(){var h=this.props;if(h.name){this.animationsCount=1;this._animate(h);}else{for(var g in h){if(h.hasOwnProperty(g)){this.animationsCount++;var f=h[g];f.name=g;this._animate(f);}}}},stop:function(f){var g=f?this.props[f]:this.props;g.stopped=true;this.animationsStopped.push(f);cancelAnimationFrame(g.animationId);},attachListener:function(f,g){var h=this[f];h&&h.attach(g);return this;},addProps:function(f){this.props=f;return this;},_animate:function(w){var i=0,u=this.elem,j=w.drawFn||this.drawFn,x=w.name||d,l=w.group,f=w.duration,v=w.delay,r=w.from,g=w.to,h=w.timingFn;if(l){w.totalTypesCount=0;if(Object.keys){w.totalTypesCount=Object.keys(l).length;}else{for(var s in l){w.totalTypesCount++;}}w.progressMap={};f=f||l.duration;v=v||l.delay;r=r||l.from;g=g||l.to;h=h||l.timingFn;this.animationsCount+=w.totalTypesCount-1;}f=f||150;v=v||0;r=r||0;g=g||0;var p=(e?a:Date).now();var o=g-r;var t=p+v;var q=this;if(l){w.animationId=requestAnimationFrame(n);}else{w.animationId=requestAnimationFrame(m);q.onAnimationStart.trigger({elem:u,name:x});w.started=true;}function n(k){k=e&&k||Date.now();var K=w.progressMap;var H;for(var D in l){var A=l[D];if(A.queue){l[D]=A=A.next;A.isNext=true;A.startWithDelay=k+(A.delay||0);}var z=A.to||g;var G=A.from||r;var y=A.delay||v;var C=A.startWithDelay||(A.startWithDelay=p+y);if(A.done){K[D]=z;continue;}if(!A.started){if(A.started=k>=C){A.eventData={elem:u,name:x,type:D};if(A.isNext){A.eventData.chain=A.name;q.onAnimationChainStart.trigger(A.eventData);}else{q.onAnimationStart.trigger(A.eventData);}}else{K[D]=G;continue;}}if(A.notSameProgress===undefined){A.notSameProgress=A.duration>0||A.timingFn||y>0;}var I=A.progress||0;var F=A.diff||(A.diff=z-G);if(I>=1){A.progress=1;K[D]=z;if(A.next){A.queue=true;}else{A.done=true;w.totalTypesCount-=1;q.onAnimationEnd.trigger(A.eventData);}}else{var J=A.duration||f;var E=A.timingFn||h;var B;if(A.notSameProgress||H===undefined){I=A.progress=(k-C)/J;B=E?E(I):I;if(!A.notSameProgress){H=B;}}else{A.progress=B=H;}K[D]=G+(B*F);}}if(w.stopped){return q.onAnimationStop.trigger(A.eventData);}j(K,w,u);if(w.totalTypesCount===0){cancelAnimationFrame(w.animationId);w.done=true;w.animationId=null;return;}w.animationId=requestAnimationFrame(n);}function m(y){y=e&&y||Date.now();i=w.progress=(y-t)/f;var k=w.tweenProgress=h?h(i):i;if(i>=1){j(g,w,u);cancelAnimationFrame(w.animationId);w.animationId=null;q.onAnimationEnd.trigger({elem:u,name:x});return;}else{if(w.stopped){return q.onAnimationStop.trigger({elem:u,name:x});}}j(r+(k*o),w,u);w.animationId=requestAnimationFrame(m);}}};return{build:c};});define("OK/reactions/ReactionAnimationUtils",[],function(){var k=Math.PI;var e=k*2;function a(l){return l*(l>1?a(l-1):1);}var c=function(l,m){return a(m)/(a(l)*a(m-l));};var j=function(m,o,l){return c(m,o)*Math.pow(l,m)*Math.pow(1-l,o-m);};var g=function(p,n,q,m,o){var l=1-p;return(3*p*Math.pow(l,2)*q)+(3*Math.pow(p,2)*l*o)+Math.pow(p,3);};var b=function(l){return(l*k)/180;};var i=function(){return Math.random()>0.5?1:-1;};var h=function(m,o,l,n){return{getYByX:function(p){return((p-m)/(l-m))*(n-o)+o;},getXByY:function(p){return((p-o)/(n-o))*(l-m)+m;}};};var d=function(){var n=true;var m=0;var l=0;return function o(p,q){p=p||0;q=q||1;if(n=!n){return(Math.sqrt(-2*Math.log(m))*Math.cos(e*l))*q+p;}m=Math.random();while(m===0){m=Math.random();}l=Math.random();while(l===0){l=Math.random();}return(Math.sqrt(-2*Math.log(m))*Math.sin(e*l))*q+p;};};var f=function(){var m=Math.random();var l=11;while(l--){m+=Math.random();}return m/12;};return{getCubicBezierTiming:g,createVector:h,angleToRad:b,randomSign:i,factorial:a,createGaussRandomizer:d,normalizedRandomBy12:f};});define("OK/reactions/Reaction",["OK/EventFactory","OK/reactions/ReactionAnimatable","OK/reactions/ReactionAnimationUtils","OK/SpriteAnimation"],function(C,c,y,B){var w=425;var x=400;var r=0;var p=125;var d=350;var u=350;var v=1200;var k=100;var A=1.8;var z=1.3;var s=48/96;var a=c.build;var m=y.createGaussRandomizer();var j=y.createGaussRandomizer();var f=false;function e(E,D){this.el=E;this.props=D;this.id=D.id;this.superId=D.superId;this.superClickCount=D.superClickCount;this.clickCount=0;this.isSuper=E.getAttribute("data-reaction-is-super")==="true";this.icoEl=E.querySelector(".reaction_ico");this.wrappers={simpleMode:{id:e.parseReactionId(E.getAttribute("data-reaction-id")),icon:E.getAttribute("data-reaction-icon"),text:E.getAttribute("data-reaction-text"),textExt:E.getAttribute("data-reaction-text-ext")},superMode:{id:e.parseReactionId(E.getAttribute("data-super-reaction-id")),icon:E.getAttribute("data-super-reaction-icon"),text:E.getAttribute("data-super-reaction-text"),textExt:E.getAttribute("data-super-reaction-text-ext")}};this.spriteAnimation=D.animationEnabled&&this.activateSpriteAnimation();this.applyCustomPosition(D.customPosition);this.clickEvent=C.create();this.onClick=this.onClick.bind(this);this.el.addEventListener("click",this.onClick);}e.parseReactionId=function(E){var D=parseInt(E,10);return isNaN(D)?null:D;};e.prototype={deactivate:function(){this.spriteAnimation&&this.spriteAnimation.deactivate();this.el.removeEventListener("click",this.onClick);},onClick:function(F){F.preventDefault();F.stopPropagation();if(f){return;}var E=!this.isSuper&&(++this.clickCount>=this.superClickCount);var D=E?this.superId:this.getWrapper().id;this.clickEvent.trigger({reactionId:D});},activateSpriteAnimation:function(){var D=this.el;var F=D.querySelector(".reaction_anim");F.setAttribute("data-image","/res/i/reaction/anim/96/reaction_"+D.getAttribute("data-reaction-icon")+"_sprite.png");F.setAttribute("data-frames","auto");var E=new B();E.activate(F).then(function(){D.classList.add("__anim");});return E;},getWrapper:function(){return this.isSuper?this.wrappers.superMode:this.wrappers.simpleMode;},select:function(D){var E=!this.isSuper&&this.superId===D;if(E){this.isSuper=true;this._processSuperReaction();}var F=this.getWrapper();this.el.setAttribute("title",F.textExt);this.el.classList.add("__selected");this.icoEl.classList.toggle("__sup",this.isSuper);if(!E){this._processAnimation();}},unselect:function(){var D=this.getWrapper();this.el.setAttribute("title",D.textExt);this.el.classList.remove("__selected");this.icoEl.classList.remove("__sup");this.isSuper=false;this.clickCount=0;},_processAnimation:function(){var E=this.el;var F=this.icoEl.cloneNode(false);F.classList.add("__clone");this.cloneContainer().appendChild(F);if(this.props.clickAnimationEnabled){i(E,function(){E.classList.remove("__active");},k);E.classList.add("__active");}var D=l(F);D.onAllAnimationsEnd.attachOnce(function(){this.cloneContainer().removeChild(F);if(this.clickCount>0){this.clickCount--;}}.bind(this));D.run();},_processSuperReaction:function(){var E=this.cloneContainer().querySelectorAll(".__clone"),R=[],I=0,U=0;for(var S=0,K=E.length;S<K;S++){var G=E[S],F=G._okAnimatable;if(!F){continue;}var J=F.props.transform.group;var aa=J.translateX;var Z=J.translateY;var T=J.rotate;var P=aa.to;var N=Z.to;var Q=T.to;if(!aa.done){P*=aa.progress;}if(!Z.done){N*=Z.progress;}if(!T.done){Q*=T.progress;}F.stop("transform");I+=P;U+=N;if(isNaN(I)||isNaN(U)){console.warn(J);}R.push({startX:P,startY:N,rotateFrom:Q,animation:new a(G,o)});}var L=R.length;I/=L;U/=L;I-=50*Math.random();U-=50*Math.random();var Y=this.icoEl.cloneNode(false);Y.classList.add("__clone");Y.classList.add("__first-super");var D=this.cloneContainer();i(Y,function(){D.removeChild(Y);},v);D.appendChild(Y);q(u);var H=(144-48)/2;Y.style.top=U-H+"px";Y.style.left=I-H+"px";for(S=0,K=R.length;S<K;S++){var V=R[S];var W=V.animation;var O=V.startX;var X=V.startY;var M=V.rotateFrom;W.onAnimationEnd.attach(function(ab){if(ab.elem&&ab.name==="transform"){ab.elem._okAnimatable.stop();if(ab.elem.parentNode){ab.elem.parentNode.removeChild(ab.elem);}}});W.addProps({transform:{duration:d,timingFn:n,group:{translateX:{from:O,to:(I+(0.5-Math.random())*400)},translateY:{from:X,to:(U+(0.5-Math.random())*400)},rotate:{from:M,to:M+270},scale:{from:s,to:0,delay:d/3}}},opacity:{drawFn:b,duration:d,from:1,to:0}}).run();}},applyCustomPosition:function(D){if(!D){return;}if(D.left){this.el.style.left=D.left+"px";}if(D.top){this.el.style.top=D.top+"px";}if(D.angle){this.el.style.transform="rotate("+D.angle+"deg)";}},cloneContainer:function(){if(this._cloneCnt){return this._cloneCnt;}var E=this._cloneCnt=document.createElement("div");var D=this.props.customPosition;if(D&&D.angle){E.style.transform="rotate("+(-D.angle)+"deg)";}E.classList.add("__clone-cnt");this.el.appendChild(E);return E;}};return e;function l(D){return new a(D,g,{transform:{duration:w,timingFn:n,group:{translateY:{to:Math.min(-48*2.5,-48*4+Math.random()*48)},translateX:{to:48*m()},rotate:{to:30*j()},scale:{from:s*0.85,to:s*A,next:{name:"scale-bounce",from:s*A,to:s*z,delay:r,duration:x,timingFn:t,next:{name:"scale-end",from:s*z,to:0,duration:p}}}}}});}function i(F,H,D){function E(){clearTimeout(G);F.removeEventListener("animationend",E);F.removeEventListener("transitionend",E);F.removeEventListener("transitioncancel",E);H();}var G=setTimeout(E,D);F.addEventListener("animationend",E);F.addEventListener("transitionend",E);F.addEventListener("transitioncancel",E);return G;}function q(D){f=true;setTimeout(function(){f=false;},D);}function n(D){return Math.sqrt(D);}function t(D){return Math.abs(Math.sin(Math.PI*D));}function g(F,E,G){var D=E.name;if(D==="transform"){h(G,F);}}function b(E,D,F){F.style.opacity=E;}function o(E,D,F){h(F,E);}function h(E,D){E.style.transform="translate3d("+D.translateX+"px, "+D.translateY+"px, 0) rotate("+D.rotate+"deg) scale("+D.scale+")";}});define("OK/reactions/ReactionController",["OK/utils/vanilla","OK/utils/throttle","OK/LinkedHooksStore"],function(j,k,e){var c="/dk?cmd=ReactBlock";var g={};var f={};var d=2000;var m=new Function();var n={INIT:0,BEFORE_DRAW:1,AFTER_DRAW:2,BEFORE_SAVE:4,AFTER_SAVE:8};var i={SIMPLE:1,ONLY_DRAW:2,ONLY_SAVE:4,DEBOUNCE_SAVE:8};function b(o){return j.ajax({type:"POST",url:c,data:o},function(){});}function l(o){(g[o.refId]||[]).forEach(function(p){p(o);});}function a(o,p,q){this.time=Date.now();this.refId=o.refId;this.reactionId=o.reactionId;this.prevReactionId=o.prevReactionId;this.owner=o.owner;this.payload=o.payload;this.linkedHooks=p;this.callback=typeof q==="function"?q:m;this.args=null;this.stage=this.stages.INIT;this.mode=o.mode||this.modes.SIMPLE;this.stopped=false;}a.prototype={stages:n,modes:i,execute:function(){if(this.reactionId===this.prevReactionId){return;}switch(this.mode){case this.modes.ONLY_DRAW:this.draw().then(j.updateBlockModelCallback);return;case this.modes.ONLY_SAVE:this.save();return;case this.modes.DEBOUNCE_SAVE:this.draw().then(j.updateBlockModelCallback);this._saveTimeout=setTimeout(this.save.bind(this),d);return;default:this.save().then(j.updateBlockModelCallback);}},collectArgs:function(){var o={};var p=this.refId.split(":");o["st.v.type"]=p[0];o["st.v.refId1"]=p[1];o["st.v.refId2"]=p[2]||0;if(this.owner){o["st.v.owner"]=this.owner;}if(this.mode!==this.modes.SIMPLE&&this.stage===this.stages.BEFORE_DRAW){if(this.reactionId!==null){o["st.v.ncr"]=this.reactionId;}else{o["st.v.drawEmpty"]="on";}}if(this.stage===this.stages.BEFORE_SAVE){if(this.reactionId!==null){o["st.v.reaction"]=this.reactionId;o["st.v.like"]="on";}else{o["st.v.like"]="off";}}if(this.mode===this.modes.SIMPLE||this.stage===this.stages.BEFORE_DRAW){this._appendLinkedHooks(o);}this._appendPayload(o);return o;},_appendLinkedHooks:function(o){this.linkedHooks&&Object.keys(this.linkedHooks).forEach(function(p){var q=this.linkedHooks[p];if(q.length){o["st.v."+p]=q.join(";");}}.bind(this));},_appendPayload:function(o){this.payload&&Object.keys(this.payload).forEach(function(p){if(this.payload[p]===null){return;}if(p==="impressionId"){if(this.stage!==this.stages.BEFORE_SAVE){return;}}o["st.v."+p]=this.payload[p];}.bind(this));},draw:function(){if(this.stopped){return;}this.stage=this.stages.BEFORE_DRAW;this.args=this.collectArgs();this.callback(this);return b(this.args).then(function(o){this.stage=this.stages.AFTER_DRAW;this.callback(this);return o;}.bind(this));},save:function(){if(this.stopped){return;}this.stage=this.stages.BEFORE_SAVE;this.args=this.collectArgs();this.callback(this);return b(this.args).then(function(o){this.stage=this.stages.AFTER_SAVE;this.callback(this);return o;}.bind(this));},cancel:function(){this.stopped=true;clearTimeout(this._saveTimeout);}};function h(){}h.prototype={orderStages:n,orderModes:i,subscribe:function(p,q){var o=g[p]||[];o.push(q);g[p]=o;},unsubscribe:function(q,r){var p=g[q]||[];var o=p.indexOf(r);if(o!==-1){p.splice(o,1);}g[q]=p;},notify:function(q){var p=f[q.refId];p&&p.cancel();var r=e.get(q.refId);var o=new a(q,r,l);f[q.refId]=o;l(o);o.execute();}};return new h();});define("b/reactions",["OK/reactions/Reaction","OK/reactions/ReactionAnimatable","OK/reactions/ReactionAnimationUtils","OK/reactions/ReactionController"],{});