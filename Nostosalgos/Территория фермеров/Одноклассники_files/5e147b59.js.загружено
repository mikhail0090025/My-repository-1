define("OK/gifts/GiftBookmark",["OK/utils/vanilla"],function(b){function a(f,d,c,e){this._presentId=f;this._presentToken=d;this._controllerUrl=c;this._actionFrom=e;this._xhr=null;}a.prototype.addBookmark=function(){var c=this;return this._ajaxCall(b.ajax({url:c._controllerUrl,data:{"upb.action":"CREATE","upb.presentId":c._presentId,"upb.presentToken":c._presentToken,"upb.actionFrom":c._actionFrom}}));};a.prototype.deleteBookmark=function(){var c=this;return this._ajaxCall(b.ajax({url:c._controllerUrl,data:{"upb.action":"DELETE","upb.presentId":c._presentId,"upb.actionFrom":c._actionFrom}}));};a.prototype.isExist=function(){var c=this;return this._ajaxCall(b.ajax({url:c._controllerUrl,data:{"upb.action":"CHECK","upb.presentId":c._presentId}})).then(function(d){return d.exists===true;});};a.prototype.isLoading=function(){return this._xhr!==null;};a.prototype.deactivate=function(){if(this._xhr!==null){this._xhr.abort();}};a.prototype._ajaxCall=function(d){this._xhr=d.xhr;var c=this;return d.then(function(g,e,h){c._xhr=null;var f=JSON.parse(g.response);if(typeof g==="object"&&g.response&&f.success===true){return f;}else{return Promise.reject();}},function(){c._xhr=null;return Promise.reject();});};return a;});define("OK/gifts/BookmarkToggleButton",["OK/gifts/GiftBookmark","OK/NonBlockingTip"],function(c,f){var d="__sec";var b="__light";function e(){this._element=null;this._bookmark=null;this._onClickButton=this._onClickButton.bind(this);}e.prototype.activate=function(h){var k=parseInt(h.getAttribute("data-present-id"),10);var g=h.getAttribute("data-present-token");var i=h.getAttribute("data-controller-url");var j=h.getAttribute("data-action-from");this._bookmark=new c(k,g,i,j);this._element=h;h.addEventListener("click",this._onClickButton,false);};e.prototype._onClickButton=function(){if(this._bookmark.isLoading()){return;}var h=this;var g=h.isExistBookmark()?h._bookmark.deleteBookmark().then(function(){h.setExistBookmark(false);a(h._element.getAttribute("data-text-bookmark-removed"));}):h._bookmark.addBookmark().then(function(){h.setExistBookmark(true);a(h._element.getAttribute("data-text-bookmark-added"));});g["catch"](function(){a(h._element.getAttribute("data-text-bookmark-action-error"));});};e.prototype.isExistBookmark=function(){return this._element.classList.contains(d);};e.prototype.setExistBookmark=function(g){var h=this._element.classList;if(g){h.add(d);h.remove(b);}else{h.remove(d);h.add(b);}};function a(g){f.create({fixed:true,mid:true,anim:true,message:g});}e.prototype.deactivate=function(g){g.removeEventListener("click",this._onClickButton,false);this._bookmark.deactivate();};return e;});define("OK/Timer",[],function(){var b=function(){};var a=function(e,f,h,k){if(k<10){k="0"+k;}if(h<10){h=(h===0)?"00":"0"+h;}if(e.printHours&&f<10){f=(f===0)?"00":"0"+f;}var d=h+":"+k;if(f){d=f+":"+d;}if(e.digitClassName){var j="";for(var g=0;g<d.length;g++){j+=(d[g]===":")?d[g]:"<span class='"+e.digitClassName+"'>"+d[g]+"</span>";}e.element.innerHTML=j;}else{e.element.textContent=d;}};function c(e,d,g,f){this.element=e;this.timerFinishCallback=d||b;this.timerTickCallback=g||b;this.printer=f||a;this.tId=null;this.digitClassName=null;this.printHours=false;this.isPrint=true;}c.prototype.start=function(){var d=this;var i=this.element.getAttribute("data-duration")||this.element.textContent;var h=i.split(":");var e=h.length===2?parseInt(h[0],10)*60+parseInt(h[1],10):parseInt(h[0],10)*3600+parseInt(h[1],10)*60+parseInt(h[2],10);var g=Date.now();function f(){var l=e-Math.floor((Date.now()-g)/1000);if(l<0){l=0;}if(d.isPrint){var j=0;if(l>=3600){j=Math.floor(l/3600);}var k=Math.floor((l-j*3600)/60);var m=Math.floor(l%60);d.printer(d,j,k,m);}d.timerTickCallback(l);if(l===0){d.stop();d.timerFinishCallback();}}if(e>0){this.tId=window.setInterval(f,1000);f();}return this;};c.prototype.stop=function(){window.clearInterval(this.tId);return this;};c.prototype.setDigitClassName=function(d){this.digitClassName=d;return this;};c.prototype.setPrintHours=function(d){this.printHours=d;return this;};c.prototype.setIsPrint=function(d){this.isPrint=d;return this;};return c;});define("OK/utils/throttle",[],function(){
/*!
     * jQuery throttle / debounce - v1.1 - 3/7/2010
     * http://benalman.com/projects/jquery-throttle-debounce-plugin/
     *
     * Copyright (c) 2010 "Cowboy" Ben Alman
     * Dual licensed under the MIT and GPL licenses.
     * http://benalman.com/about/license/
     */
return function a(c,d,h,g){var f,b=0;if(typeof d!=="boolean"){g=h;h=d;d=undefined;}return function e(){var m=this,k=Date.now()-b,l=arguments;function j(){b=Date.now();h.apply(m,l);}function i(){f=undefined;}if(g&&!f){j();}if(f){clearTimeout(f);}if(g===undefined&&k>c){j();}else{if(d!==true){f=setTimeout(g?i:j,g===undefined?c-k:c);}}};};});define("OK/ViewportTracker",["OK/utils/throttle","OK/utils/dom"],function(i,c){var h="js-viewport-container",a=[],f=false,j=i(100,function(){a.forEach(function(k){k.calculate();});});function d(l){var k=null;a.some(function(m){if(m.element===l){k=m;return true;}});return k;}function g(m,l){var k=m.indexOf(l);if(k>-1){m.splice(k,1);}}function b(m,l,n,k){this.element=m;this.container=l;this.callback=n;this.predicate=k?k.bind(this):null;}b.prototype={destroy:function(){this.container=null;},isInViewport:function(){var n=this.container.rect,m=this.element.getBoundingClientRect(),k=n.top,l=n.bottom;return(m.top>=k&&m.top<=l)||(m.bottom>=k&&m.bottom<=l);},calculate:function(){var k=this.predicate?this.predicate():this.isInViewport();if(this.visible===k){return;}this.visible=k;this.callback.call(this.element,k);}};function e(k){this.element=k;this.items=[];this.listener=i(100,this.calculate.bind(this));this.element.addEventListener("scroll",this.listener);this.updateRect();}e.prototype={add:function(k){this.items.push(k);this.updateRect();k.calculate();},updateRect:function(){this.rect=this.element.getBoundingClientRect();},remove:function(l){var k=null;this.items.forEach(function(m){if(m.element===l){k=m;return true;}});if(k){k.destroy();g(this.items,k);}},isEmpty:function(){return this.items.length===0;},isLast:function(k){return this.items[this.items.length-1]===k;},calculate:function(){this.updateRect();this.items.forEach(function(k){k.calculate();});},destroy:function(){this.element.removeEventListener("scroll",this.listener);}};return{add:function(m,o,k){var n=c.parent(m,h),l;if(n===null){n=window;}l=d(n);if(!l){l=new e(n);a.push(l);}l.add(new b(m,l,o,k));if(!f){window.addEventListener("resize",j);f=true;}},remove:function(l){var m=c.parent(l,h),k;if(m===null){m=window;}k=d(m);if(k){k.remove(l);if(k.isEmpty()){k.destroy();g(a,k);}}if(f&&a.length===0){window.removeEventListener("resize",j);f=false;}},getContainer:function(k){var l=c.parent(k,h);return d(l);}};});define("OK/gifts/FixPriceTimerCountdown",["OK/Timer","OK/ViewportTracker"],function(c,a){function b(){this._timer=null;}b.prototype.activate=function(d){var e=this._timer=new c(d,function(){a.remove(d);});this._timer.start();a.add(d,function(f){e.setIsPrint(f);});};b.prototype.deactivate=function(d){this._timer.stop();a.remove(d);};return b;});define("OK/gifts/GiftDeletedLayer",[],function(){function a(b){this._container=b;this._retrieveButton=b.querySelector(".js-retrieve-gift");this._onClick=null;}a.prototype.onRetrieveClick=function(b){if(this._retrieveButton!==null){this._onClick=b;this._retrieveButton.addEventListener("click",b,false);}};a.prototype.show=function(){this._container.classList.add("__visible");};a.prototype.hide=function(){this._container.classList.remove("__visible");};a.prototype.deactivate=function(){if(typeof this._onClick==="function"){this._retrieveButton.removeEventListener("click",this._onClick,false);}};return a;});define("OK/gifts/GiftCardBookmark",["OK/gifts/GiftBookmark","OK/gifts/GiftDeletedLayer","OK/utils/dom"],function(l,k,e){var i="__bookmark-exist";var a="__bookmark-not-exist";var b="__hidden";var f="gift-card";var d=c(false,"__bubble-add-bookmark");var j=c(true,"__bubble-added-bookmark");var g=c(true,"__bubble-remove-bookmark");function h(){this._element=null;this._buttonElement=null;this._deletedLayer=null;this._bookmark=null;this._bubble=null;this._mouseleaveButtonTimeoutId=-1;this._lazyloadTimeoutId=-1;this._lazyloadHandlerElement=null;this._allowDeleting=true;this._checkBookmarkDelay=0;this._needChangeStateToRemove=false;this._clickButton=this._clickButton.bind(this);this._mouseleaveButton=this._mouseleaveButton.bind(this);this._mouseenterButton=this._mouseenterButton.bind(this);this._mouseleaveContainer=this._mouseleaveContainer.bind(this);this._mouseenterContainer=this._mouseenterContainer.bind(this);}h.prototype.activate=function(q){this._element=q;var m=parseInt(q.getAttribute("data-present-id"),10);var t=q.getAttribute("data-present-token");var n=q.getAttribute("data-controller-url");var p=q.getAttribute("data-action-from");var r=this._bookmark=new l(m,t,n,p);this._bubble=q.querySelector(".js-gift-action-bubble");var o=Boolean(q.getAttribute("data-is-bookmarks-page"));this._allowDeleting=o||Boolean(q.getAttribute("data-allow-deleting"));var s=this.getBookmarkExistence();if(s===true){if(this._allowDeleting){this.setBookmarkExistence(g);}else{this.setBookmarkExistence(j);}}else{if(s===false){this.setBookmarkExistence(d);}}var u=this;if(o){this._deletedLayer=new k(q.parentNode.querySelector(".js-gift-deleted-layer"));this._deletedLayer.onRetrieveClick(function(v){if(!r.isLoading()){r.addBookmark().then(function(){u.setBookmarkExistence(g);});}});}this._buttonElement=q.querySelector(".js-gift-bookmark-button");this._buttonElement.addEventListener("click",this._clickButton,false);if(this._allowDeleting){q.addEventListener("mouseleave",this._mouseleaveButton,false);q.addEventListener("mouseenter",this._mouseenterButton,false);}if(!q.classList.contains(i)&&!q.classList.contains(a)){this.initLazyLoadBookmarkStatus();}};h.prototype._mouseleaveButton=function(){var m=this;this._mouseleaveButtonTimeoutId=setTimeout(function(){if(m.getBookmarkExistence()===true){m.setBookmarkExistence(g);m._mouseleaveButtonTimeoutId=false;}},500);};h.prototype._mouseenterButton=function(){if(this._needChangeStateToRemove){clearTimeout(this._mouseleaveButtonTimeoutId);}};h.prototype._clickButton=function(){if(!this._bookmark.isLoading()){var m=this.getBookmarkExistence();if(m!==null){var n=this;if(m){if(this._allowDeleting){this._bookmark.deleteBookmark().then(function(){n.setBookmarkExistence(d);});}}else{this._bookmark.addBookmark().then(function(){n.setBookmarkExistence(j);if(n._allowDeleting){n._needChangeStateToRemove=true;}});}}}};h.prototype._mouseleaveContainer=function(){clearTimeout(this._lazyloadTimeoutId);};h.prototype._mouseenterContainer=function(){var m=this;this._lazyloadTimeoutId=setTimeout(function(){m._bookmark.isExist().then(function(n){m._lazyloadHandlerElement.removeEventListener("mouseenter",m._mouseenterContainer,false);m._lazyloadHandlerElement.removeEventListener("mouseleave",m._mouseleaveContainer,false);if(n){if(m._allowDeleting){m.setBookmarkExistence(g);}else{m.setBookmarkExistence(j);}}else{m.setBookmarkExistence(d);}});},this._checkBookmarkDelay);};h.prototype.initLazyLoadBookmarkStatus=function(){this._checkBookmarkDelay=parseInt(this._element.getAttribute("data-check-bookmark-delay"),10);this._lazyloadHandlerElement=e.parent(this._element,f);this._lazyloadHandlerElement.addEventListener("mouseenter",this._mouseenterContainer,false);this._lazyloadHandlerElement.addEventListener("mouseleave",this._mouseleaveContainer,false);};h.prototype.getBookmarkExistence=function(){if(this._element.classList.contains(i)){return true;}else{if(this._element.classList.contains(a)){return false;}else{return null;}}};h.prototype.setBookmarkExistence=function(m){if(m.bookmarkExists){this._element.classList.add(i);this._element.classList.remove(a);if(this._deletedLayer){this._deletedLayer.hide();this._element.classList.remove(b);}}else{this._element.classList.remove(i);this._element.classList.add(a);if(this._deletedLayer){this._deletedLayer.show();this._element.classList.add(b);}}this._bubble.classList.remove(d.localizationModificator,j.localizationModificator,g.localizationModificator);this._bubble.classList.add(m.localizationModificator);};h.prototype.deactivate=function(m){this._buttonElement.removeEventListener("click",this._clickButton,false);if(this._allowDeleting){this._element.removeEventListener("mouseleave",this._mouseleaveButton,false);this._element.removeEventListener("mouseenter",this._mouseenterButton,false);}if(this._lazyloadHandlerElement!==null){this._lazyloadHandlerElement.removeEventListener("mouseenter",this._mouseenterContainer,false);this._lazyloadHandlerElement.removeEventListener("mouseleave",this._mouseleaveContainer,false);}if(this._deletedLayer!==null){this._deletedLayer.deactivate();}this._bookmark.deactivate();};function c(m,n){return{bookmarkExists:m,localizationModificator:n};}return h;});define("b/gifts",["OK/gifts/BookmarkToggleButton","OK/gifts/FixPriceTimerCountdown","OK/gifts/GiftBookmark","OK/gifts/GiftCardBookmark","OK/gifts/GiftDeletedLayer"],function(){});