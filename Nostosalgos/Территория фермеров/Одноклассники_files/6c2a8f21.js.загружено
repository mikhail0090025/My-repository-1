define("OK/postingForm/decoration/model/bg/BgDecoratorSimple",[],function(){function a(b){this.color=b.color;}a.prototype={applyBg:function(b){b.style.backgroundColor=this.color;},applyPreviewBg:function(b){this.applyBg(b);},cleanBg:function(b){b.style.backgroundColor="";}};return a;});define("OK/postingForm/decoration/model/bg/BgDecoratorLinearGradient",[],function(){function a(b){this.angle=b.angle;this.startColor=b.startColor;this.endColor=b.endColor;}a.prototype={applyBg:function(b){b.style.backgroundColor=this.endColor;b.style.backgroundImage="linear-gradient("+this.angle+"deg,"+this.startColor+","+this.endColor+")";},applyPreviewBg:function(b){this.applyBg(b);},cleanBg:function(b){b.style.backgroundColor="";b.style.backgroundImage="";}};return a;});define("OK/postingForm/decoration/model/bg/BgDecoratorSimpleImage",[],function(){function a(c){if(c[0]!=="#"){return c;}return"rgb("+parseInt(c.slice(1,3),16)+","+parseInt(c.slice(3,5),16)+","+parseInt(c.slice(5,7),16)+")";}function b(c){this.bkgColor=c.bkgColor;this.startColor=c.startColor;this.endColor=c.endColor;this.angle=c.angle;this.pictureUrl=c.pictureUrl;this.previewUrl=c.previewUrl;}b.prototype={_applyStyles:function(c,e){if(this.bkgColor){c.style.backgroundColor=this.bkgColor;}var d=[];if(e){d.push('url("'+e+'")');}if(this.startColor){d.push("linear-gradient("+this.angle+"deg,"+a(this.startColor)+","+a(this.endColor)+")");}c.style.backgroundImage=d.join(",");if(!c.style.backgroundImage){c.style.backgroundImage=d[0];}},applyBg:function(c){this._applyStyles(c,this.pictureUrl);},applyPreviewBg:function(c){this._applyStyles(c,this.previewUrl);},cleanBg:function(c){c.style.backgroundColor="";c.style.backgroundImage="";}};return b;});define("OK/postingForm/decoration/model/bg/BgDecorator",["OK/postingForm/decoration/model/bg/BgDecoratorSimple","OK/postingForm/decoration/model/bg/BgDecoratorLinearGradient","OK/postingForm/decoration/model/bg/BgDecoratorSimpleImage"],function(a,b,c){return{factory:function(d){switch(d.type){case"SIMPLE":return new a(d);break;case"LINEAR_GRADIENT":return new b(d);break;case"SIMPLE_IMAGE":return new c(d);break;}}};});define("OK/postingForm/decoration/model/Decorator",["OK/postingForm/decoration/model/bg/BgDecorator"],function(b){function a(c){this.id=c.id;this.color=c.color;this.bgDecorator=b.factory(c.background);}a.prototype={applyTextColor:function(c){c.style.color=this.color;}};a.fromConfig=function(d){var c={};for(var e in d){if(d.hasOwnProperty(e)){c[e]=new a(d[e]);}}return c;};return a;});define("OK/postingForm/decoration/model/DecoratorStorage",["OK/postingForm/decoration/model/Decorator"],function(a){var b={};return{add:function(c){b[c.id]=new a(c);},addMap:function(c){for(var d in c){if(c.hasOwnProperty(d)){this.add(c[d]);}}},getByUid:function(c){return b[c];}};});define("OK/postingForm/decoration/utils/ColorPickerUtils",["OK/utils/vanilla","OK/postingForm/decoration/model/DecoratorStorage"],function(b,a){function c(e,d){var f={formType:e};if(d){f.groupId=d;}return b.ajax({type:"POST",url:"/dk?cmd=MediaTopicDecorators",data:f}).then(function(g){var h=OK.util.parseJsonCorrected(g.response);if(h.decorators){a.addMap(h.decorators);}delete h.decorators;return h;});}return{requestDecoratorsCatalog:c};});define("OK/postingForm/decoration/TextSizeControl",["OK/utils/vanilla"],function(b){function c(n,m,l,k){var j=false;if(n){k++;if(n.charAt(n.length-1)!=="\n"){n+="\n";}}var e=n?n.length:0;if(e<=m){var f=0;var d=0;for(var g=0;g<e;g++){var h=false;if(n.charAt(g)==="\n"){d=0;h=true;}else{d++;if(l>0){if(d>l){d=0;h=true;}}}if(h){f++;if(f>=k){break;}}}j=f<k;}return j;}function a(d){this.colorPicker=d;this.onTextChange=this.onTextChange.bind(this);this.onBgColorChange=this.onBgColorChange.bind(this);}a.prototype={activate:function(d){this.totalLength=d.getAttribute("data-totalLength");this.lineLength=d.getAttribute("data-lineLength");this.maxLines=d.getAttribute("data-maxLines");this.hugeLength=d.getAttribute("data-hugeLength");d.addEventListener("pfBlockTextChange",this.onTextChange);d.addEventListener("pfBgColorChange",this.onBgColorChange);this.el=d;},deactivate:function(){this.el.removeEventListener("pfBlockTextChange",this.onTextChange);this.el.removeEventListener("pfBgColorChange",this.onBgColorChange);OK.util.clean(this);},updateTextSize:function(){var f=this.text;var e=c(f,this.totalLength,this.lineLength,this.maxLines);if(e){if(this.colorPicker&&this.colorPicker.getSelectedBkg()){var d=c(f,this.hugeLength,this.hugeLength,1);this._setTextSize(d?"3":"2");}else{this._setTextSize("1");}}else{this._setTextSize();}if(this.colorPicker){if(e){this.colorPicker.enablePicker("text");}else{this.colorPicker.disablePicker("text");}}},_setTextSize:function(d){if(this.textSize===d){return;}if(d){this.el.classList.toggle("emoji-m",true);this.el.classList.toggle("__size-"+d,true);}if(!d){this.el.classList.toggle("emoji-m",false);}if(this.textSize){this.el.classList.toggle("__size-"+this.textSize,false);}this.textSize=d;},onTextChange:function(d){if(!d.detail.singleMode){this._setTextSize();}else{if(d.detail.text!==this.text){this.text=d.detail.text;this.updateTextSize();}}},onBgColorChange:function(d){this.updateTextSize();}};return a;});define("text!OK/postingForm/decoration/ColorPickerCatalog.dot",[],function(){return'<div class="cp-catalog_scrollable custom-scrolling js-scrollable">\n    <div class="cp-catalog_body">\n    {{~it.categories :category}}\n        <div class="cp-catalog_category">\n            <div class="cp-catalog_category_t">{{= category.title }}</div>\n            <div class="cp-catalog_category_grid ugrid __m">\n                <div class="ugrid_cnt">\n                    {{~category.items :item}}\n                        <div class="ugrid_i">\n                            <div\n                                class="cp-catalog_i js-color-picker-i {{? item.selected }}__selected js-selected{{?}}"\n                                data-uid="{{= item.uid }}">\n                            </div>\n                        </div>\n                    {{~}}\n                </div>\n            </div>\n        </div>\n    {{~}}\n    </div>\n</div>';});define("OK/postingForm/decoration/ColorPickerCatalog",["doT","text!OK/postingForm/decoration/ColorPickerCatalog.dot","OK/postingForm/decoration/model/DecoratorStorage","OK/postingForm/decoration/utils/ColorPickerUtils","OK/utils/dom","OK/pts!posting.color-picker"],function(c,f,a,e,h,g){var d;function b(){if(!d){d=c.template(f);}this.visible=false;this.el=document.createElement("div");this.el.className="cp-catalog";this.onBodyEvent=this.onBodyEvent.bind(this);this.onMenuClick=this.onMenuClick.bind(this);this.onMouseWheel=this.onMouseWheel.bind(this);this.el.addEventListener("click",this.onMenuClick);}b.prototype={readyData:function(){var i=this;return e.requestDecoratorsCatalog(this.postingFormType,this.groupId).then(function(j){i.decoratorsCatalog=j;});},ready:function(){var j=this,i;i=j.readyData().then(function(){return j;});this.ready=function(){return i;};return i;},deactivate:function(){if(this.visible){this.hide();}this.el.removeEventListener("click",this.onMenuClick);OK.util.clean(this);},toggle:function(){if(!this.visible){this.show();}else{this.hide();}},isVisible:function(){return this.visible;},setPostingFormType:function(i){this.postingFormType=i;return this;},setGroupId:function(i){this.groupId=i;return this;},setLeftOrientation:function(i){this.leftOrientation=i;return this;},setSelectedDecorator:function(i){this.selectedDecorator=i;return this;},setTrigger:function(i){this.triggerEl=i;return this;},onSelectDecorator:function(i){this.selectCallback=i;return this;},show:function(){var q=this,I=q.el,o=q.decoratorsCatalog,G=q.selectedDecorator,t=document.body,m=[],D=o.order||[];for(var F=0;F<D.length;F++){var K=D[F];if(!o.hasOwnProperty(K)){continue;}var z=[];o[K].forEach(function(i){z.push({uid:i,selected:i===G});});if(o[K].length){m.push({title:g.getLMsg("category-"+K),items:z});}}I.innerHTML=d({categories:m});var B={};h.byClass(I,"js-color-picker-i").forEach(function(M){var L=M.getAttribute("data-uid"),i=a.getByUid(L);if(i){i.bgDecorator.applyPreviewBg(M);}B[L]=M;if(M.classList.contains("js-selected")){q.selectedItem=M;}});q.items=B;q.menuScrollableEl=h.firstByClass(this.el,"js-scrollable");t.appendChild(this.el);var u=document.documentElement,r=q.triggerEl,j=r.getBoundingClientRect(),y=this.getScrollableEl(),s=j.width,J=j.height,x=8,k=j.top-x*2,C=j.left-x*2,H=u.clientHeight-j.top-J-x*2,E=u.clientWidth-j.left-s-x*2,p=250,A=500,v=478;if(H>p){y.style.maxHeight=(H>A?A:H)+"px";I.style.top=(j.top+J+x)+"px";if(this.leftOrientation){I.style.left=(j.left)+"px";}else{I.style.left=(j.left+s-I.offsetWidth)+"px";}}else{var l,n,w;if(this.leftOrientation){l=C>v;}else{l=E<v;}y.style.maxHeight=(k>A?A:k)+"px";if(!l){n=j.left;w=(j.top-I.offsetHeight-x);}else{n=(j.left+s-I.offsetWidth);w=(j.top-I.offsetHeight-x);}I.style.left=n+"px";I.style.top=w+"px";}I.focus();q.visible=true;t.addEventListener("click",q.onBodyEvent,true);document.addEventListener("scroll",q.onBodyEvent,false);this.getScrollableEl().addEventListener("wheel",q.onMouseWheel,false);},getScrollableEl:function(){return this.menuScrollableEl;},hide:function(){document.body.removeChild(this.el);this.visible=false;document.body.removeEventListener("click",this.onBodyEvent,true);document.removeEventListener("scroll",this.onBodyEvent,false);this.getScrollableEl().removeEventListener("wheel",this.onMouseWheel,false);},onMouseWheel:function(k){var j=this.getScrollableEl(),l=k.deltaY||k.detail||k.wheelDelta,i=false;if(l>0){if(j.scrollTop+j.offsetHeight>=j.scrollHeight){i=true;}}else{if(j.scrollTop<=0){i=true;}}if(i){k.preventDefault();}},externalEvent:function(j){var k=this.el,i=this.triggerEl;return !h.traverseParents(j.target,function(l){return(l===k)||(l===i);},null,true);},onBodyEvent:function(i){if(!this.visible){return;}if(this.externalEvent(i)){this.hide();}},onMenuClick:function(j){var i=h.parent(j.target,"js-color-picker-i",false,true);if(!i||(i===this.selectedItem)){return;}if(this.selectedItem){this.selectedItem.classList.remove("__selected","js-selected");}this.selectedItem=i;i.classList.add("__selected","js-selected");if(this.selectCallback){this.selectCallback(i.getAttribute("data-uid"));}}};return b;});define("OK/postingForm/decoration/ColorPickerCatalogBtn",["OK/logger","OK/postingForm/decoration/ColorPickerCatalog"],function(c,a){var b="pf_head_cp";function d(){}d.prototype={activate:function(e){this.el=e;this.el.addEventListener("click",this);},deactivate:function(){this.el.removeEventListener("click",this);},ready:function(){var g=this,f=g.el,e;g.menu=new a();g.menu.setPostingFormType(f.getAttribute("data-form-type")).setGroupId(f.getAttribute("data-group-id")).setTrigger(f).onSelectDecorator(g.onSelect.bind(this));e=g.menu.ready();this.ready=function(){return e;};return e;},handleEvent:function(f){this.ready().then(function(e){e.toggle();c.success(b,e.isVisible()?"show":"hide");});},onSelect:function(e){this.menu.hide();var f=this.el.getAttribute("data-link");f+="&"+this.el.getAttribute("data-field-name")+"="+e;if(window.navigateOnUrlFromJS){c.success(b,"select",e);window.navigateOnUrlFromJS(f);}}};return d;});define("text!OK/postingForm/decoration/ColorPickerList.dot",[],function(){return'<div class="posting_cp_select_inner">\n    <div class="posting_cp-lst js-color-picker-list {{? it.full }}__full{{?}}">\n\n        <div class="posting_cp_i __toggler iblock-cloud_show" uid="hide">\n            {{? it.full }}\n            <div class="posting_cp_i_ic ic ic_arrow-l-gr"></div>\n            {{??}}\n            <div class="posting_cp_i_ic ic12 ic12_close-nh"></div>\n            {{?}}\n            <div class="iblock-cloud __dark">\n                <div class="iblock-cloud_cnt">\n                    <div class="st-suggest-txt js-color-picker-cloud-hide"></div>\n                </div>\n            </div>\n        </div><!--\n        лишний пробел закрадывается в dom\n     -->{{? it.catalogBtnLeftOrientation }}\n            <div class="posting_cp_i __more{{? it.catalogBtnHighlight }} __highlight{{?}} iblock-cloud_show js-color-picker-i-more" uid="more">\n                {{? it.catalogInfobubbleEnabled }}\n                    <div class="iblock-cloud __cp-infobubble __active js-color-picker-infobubble">\n                        <div class="iblock-cloud_cnt">\n                            <div class="st-suggest-txt">\n                                {{= it.catalogInfobubbleTitle }}\n                            </div>\n                            <a class="ic10 ic10_close-w iblock-cloud_close js-color-picker-infobubble-close"></a>\n                        </div>\n                    </div>\n                {{??}}\n                    <div class="iblock-cloud __dark">\n                        <div class="iblock-cloud_cnt">\n                            <div class="st-suggest-txt">\n                                {{= it.moreBtnTitle }}\n                            </div>\n                        </div>\n                    </div>\n                {{?}}\n            </div>\n        {{?}}\n\n        <div class="posting_cp_i js-color-picker-i __clear" uid="0">\n            <div class="posting_cp_i_inner-border"></div>\n        </div>\n\n        {{~it.items :item}}\n            <div class="posting_cp_i js-color-picker-i js-color-picker-i-{{= item.id }}" uid="{{= item.id }}">\n                <div class="posting_cp_i_inner-border"></div>\n            </div>\n        {{~}}<!--\n        лишний пробел закрадывается в dom\n     -->{{? it.catalogBtnRightOrientation }}\n            <div class="posting_cp_i __more{{? it.catalogBtnHighlight }} __highlight{{?}} iblock-cloud_show js-color-picker-i-more" uid="more">\n                {{? it.catalogInfobubbleEnabled }}\n                    <div class="iblock-cloud __cp-infobubble __active js-color-picker-infobubble">\n                        <div class="iblock-cloud_cnt">\n                            <div class="st-suggest-txt">\n                                {{= it.catalogInfobubbleTitle }}\n                            </div>\n                            <a class="ic10 ic10_close-w iblock-cloud_close js-color-picker-infobubble-close"></a>\n                        </div>\n                    </div>\n                {{??}}\n                    <div class="iblock-cloud __dark">\n                        <div class="iblock-cloud_cnt">\n                            <div class="st-suggest-txt">\n                                {{= it.moreBtnTitle }}\n                            </div>\n                        </div>\n                    </div>\n                {{?}}\n            </div>\n        {{?}}\n    </div>\n</div>';});define("OK/postingForm/decoration/ColorPickerList",["doT","text!OK/postingForm/decoration/ColorPickerList.dot","OK/utils/dom","OK/postingForm/decoration/model/DecoratorStorage","OK/pts!posting.color-picker","OK/TransitionAndTransform"],function(g,j,c,a,k,f){var h;var d=f.transform;var b="pf-cp-infobubble";function e(l,m){if(m){l.style[d]="translateX(-"+l.offsetLeft+"px)";}else{l.style[d]="";}}function i(p,n,m,l){this.cp=p;this.el=p.pickerElement;try{this.catalogInfobubbleEnabled=p.catalogInfobubbleEnabled&&(localStorage.getItem(b)!=="1");}catch(o){this.catalogInfobubbleEnabled=false;}this.isFull=n;this.catalogBtnLeftOrientation=m;this.catalogBtnHighlight=l;this.onClick=this.onClick.bind(this);this.el.addEventListener("click",this.onClick);}i.prototype={deactivate:function(){this.el.removeEventListener("click",this.onClick);OK.util.clean(this);},getElements:function(){return c.byClass(this.el,"js-color-picker-i");},getCatalogButton:function(){return c.firstByClass(this.el,"js-color-picker-i-more");},setSelectedBkg:function(m){var l=this.getElements();l.forEach(function(n){n.classList.remove("__selected");});m=m||"0";l.forEach(function(n){if(n.getAttribute("uid")===m){n.classList.add("__selected");}});},setCollapsed:function(l){this.collapsed=l;this.getElements().forEach(function(m){e(m,l);});if(this.isFull){e(this.getCatalogButton(),l);}},updateClouds:function(){var l=c.firstByClass(this.el,"js-color-picker-cloud-hide");l.textContent=k.getLMsg("btn-hide-title-"+(this.collapsed?"expand":"collapse"));},render:function(l){if(!h){h=g.template(j);}var m=[],n=this.el;l.forEach(function(o){m.push({id:o});});n.innerHTML=h({full:this.isFull,catalogInfobubbleEnabled:this.catalogInfobubbleEnabled,catalogInfobubbleTitle:k.getLMsg("btn-more-infobubble-title"),items:m,moreBtnTitle:k.getLMsg("btn-more-title"),catalogBtnLeftOrientation:this.isFull&&this.catalogBtnLeftOrientation,catalogBtnRightOrientation:this.isFull&&!this.catalogBtnLeftOrientation,catalogBtnHighlight:this.isFull&&this.catalogBtnHighlight});this.getElements().forEach(function(q){var p=q.getAttribute("uid"),o=a.getByUid(p);if(o){o.bgDecorator.applyPreviewBg(q);}});},closeInfobubble:function(){var l=c.firstByClass(this.el,"js-color-picker-infobubble");if(l){l.parentNode.removeChild(l);}try{localStorage.setItem(b,"1");}catch(m){}},onClick:function(l){if(l.target.classList.contains("js-color-picker-infobubble-close")){this.closeInfobubble();}}};return i;});define("OK/postingForm/decoration/ColorPicker",["OK/logger","OK/utils/dom","OK/utils/vanilla","OK/postingForm/decoration/TextSizeControl","OK/postingForm/decoration/model/DecoratorStorage","OK/postingForm/decoration/ColorPickerList","OK/postingForm/decoration/ColorPickerCatalog"],function(i,b,f,h,a,g,e){var d=function(j,k){this.hookId=j;this.randomBkg=false;this.onColorPickerExternalSetColor=this.onColorPickerExternalSetColor.bind(this);};d.prototype.logSubmitStatistic=function(){if(this.disabled()){i.success("mt.pf","picker_Imba");}else{if(this.randomBkg){if(this.randomBkg==this.selectedBkg){i.success("mt.pf","picker_C_Random");}else{if(this.selectedBkg){i.success("mt.pf","picker_C_Replace");}else{i.success("mt.pf","picker_N_Remove");}}}else{if(this.selectedBkg){i.success("mt.pf","picker_C_Custom");}else{i.success("mt.pf","picker_N_Nothing");}}}if(this.textSize&&!this.disabled()){i.success("mt.pf","picker_S_"+this.textSize);}else{i.success("mt.pf","picker_S_Normal");}};var c=function(m){var l=m.target;var k,j=0;do{k=l.getAttribute("uid");}while(j++<3&&!k&&(l=l.parentElement));if(k){if(this.disabled()){return;}if(k=="hide"){this.handleHide();i.success("mt.pf","color_hide");}else{if(k=="more"){this.toggleBgCatalog();i.success("mt.pf","color_more");}else{this.handleSelect(k);i.success("mt.pf","color_"+k);}}}this.handleColorPickerClicked&&this.handleColorPickerClicked(this.selectedBkg,true);};d.prototype.activate=function(l){this.containerElement=l;this.blockEl=b.firstByClass(l,"js-color-picker-block-w");this.pickerElement=b.firstByClass(l,"js-color-picker");this.collapsed=this.containerElement.classList.contains("__collapsed");var k=this.containerElement.classList.contains("__disabled");this.enableStates={block:!k,text:!k};this.isFull=this.containerElement.getAttribute("data-full")==="1";this.catalogBtnLeftOrientation=this.containerElement.getAttribute("data-catalog-btn-left-orientation")==="1";this.catalogBtnHighlight=this.containerElement.hasAttribute("data-catalog-btn-highlight");this.formType=this.containerElement.getAttribute("data-form-type");this.groupId=this.containerElement.getAttribute("data-group-id");this.loadGlobalConfig();l.addEventListener("click",c.bind(this));this.blockEl.okColorPicker=this;this.blockType=this.blockEl.getAttribute("data-cp-body-type");if(this.blockType==="text"){this.textSizeDecorator=new h(this);this.textSizeDecorator.activate(this.blockEl);}if(this.pickerElement){this.list=new g(this,this.isFull,this.catalogBtnLeftOrientation,this.catalogBtnHighlight);this.renderList(this.decoratorsList);}var j=this.containerElement.getAttribute("data-bkg");this._setSelectedBkg(j||null);var m=b.parent(l,"js-posting");if(m){m.addEventListener("colorPickerExternalSetColor",this.onColorPickerExternalSetColor);}this.handleSelect=this.handleSelect.bind(this);};d.prototype.onColorPickerExternalSetColor=function(j){if(!this.disabled()){this._setSelectedBkg(j.detail);}};d.prototype.loadGlobalConfig=function(){var j=document.getElementById("color-picker-decorators"),k=j.getAttribute("data-list");this.catalogInfobubbleEnabled=j.getAttribute("data-catalog-infobubble")==="1";this.decoratorsList=JSON.parse(k);a.addMap(JSON.parse(j.getAttribute("data-map")));};d.prototype.renderList=function(j){this.list.render(j);this.list.updateClouds();};d.prototype.disabled=function(){return !(this.enableStates.block&&this.enableStates.text);};d.prototype.deactivate=function(){if(this.list){this.list.deactivate();}if(this.decoratorsCatalogMenu){this.decoratorsCatalogMenu.deactivate();}if(this.textSizeDecorator){this.textSizeDecorator.deactivate();}if(this.pickerElement){b.removeAllListeners(this.pickerElement);}if(this.containerElement){this.containerElement.okColorPicker=null;}var j=b.parent(this.containerElement,"js-posting");if(j){j.addEventListener("colorPickerExternalSetColor",this.onColorPickerExternalSetColor);}OK.util.clean(this);};d.prototype.enablePicker=function(j){if(!this.disabled()){return;}this.enableStates[j]=true;if(this.disabled()){return;}if(this.disabledBkg){if(!this.selectedBkg){this._setSelectedBkg(this.disabledBkg);this._setCollapsed(false);}this.disabledBkg=null;}this._setDisabled(false);i.success("mt.pf","color_enable");};d.prototype.disablePicker=function(k){var j=this.disabled();this.enableStates[k]=false;if(j){return;}this._setDisabled(true);this._setCollapsed(true);this.disabledBkg=this.selectedBkg;this._setSelectedBkg(null);i.success("mt.pf","color_disable");};d.prototype.getSelectedBkg=function(){if(!this.disabled()){return this.selectedBkg;}return null;};d.prototype.handleHide=function(){this._setCollapsed(!this.collapsed);};d.prototype.handleShow=function(){this._setCollapsed(false);};d.prototype.getMoreBtn=function(){return b.firstByClass(this.pickerElement,"js-color-picker-i-more");};d.prototype.toggleBgCatalog=function(){var j=this,k;if(!j.decoratorsCatalogMenu){j.decoratorsCatalogMenu=new e();j.decoratorsCatalogMenu.setLeftOrientation(j.catalogBtnLeftOrientation).setPostingFormType(j.formType).setGroupId(j.groupId).onSelectDecorator(j.handleSelect);}k=j.decoratorsCatalogMenu;k.ready().then(function(){if(j.list){j.list.closeInfobubble();}k.setSelectedDecorator(j.getSelectedBkg()).setTrigger(j.getMoreBtn()).toggle();});};d.prototype.handleSelect=function(j){var k=this.collapsed;this._setCollapsed(false);if(!k){this._setSelectedBkg(j);}};d.prototype.applyRandomBkg=function(){if(this.selectedBkg||this.disabled()||!this.list){return;}var k=[],l=this.list.getElements();b.forEach(l,function(n){var m=n.getAttribute("uid");if(m){k.push(m);}});var j=k[Math.floor(Math.random()*(k.length-1))+1];this._setCollapsed(false);this._setSelectedBkg(j);this.randomBkg=j;i.success("mt.pf","color_random");this.handleColorPickerClicked&&this.handleColorPickerClicked(this.selectedBkg,false);};d.prototype._setCollapsed=function(j){if(this.collapsed!=j){this.collapsed=j;this.pickerElement&&this.pickerElement.classList.toggle("__collapsed",j);this.containerElement.classList.toggle("__collapsed",j);if(this.list){this.list.setCollapsed(j);this.list.updateClouds();}}};d.prototype._setDisabled=function(j){this.pickerElement&&this.pickerElement.classList.toggle("__disabled",j);this.containerElement.classList.toggle("__disabled",j);if(this.textSize){this.containerElement.classList.toggle("emoji-m",!j);this.containerElement.classList.toggle("__size-"+this.textSize,!j);}f.trigger(this.containerElement,"pfColorPickerSetDisabled",j);};d.prototype.logError=function(j){i.error(j);};d.prototype._setSelectedBkg=function(l){if(l==="0"){l=null;}if(this.selectedBkg===l){return;}if(this.selectedBkg){var j=a.getByUid(this.selectedBkg);if(j){j.bgDecorator.cleanBg(this.containerElement);}else{this.logError("Current decorator not found");}this.blockEl.style.color="";}this.selectedBkg=l;if(this.selectedBkg){var k=a.getByUid(this.selectedBkg);if(k){k.applyTextColor(this.blockEl);k.bgDecorator.applyBg(this.containerElement);}else{this.logError("New decorator not found");}}this.containerElement.classList.toggle("__has-bg",this.selectedBkg);if(this.list){this.list.setSelectedBkg(l);}f.trigger(this.blockEl,"pfBgColorChange",{color:l});};return d;});define("b/postingDecoration",["OK/postingForm/decoration/utils/ColorPickerUtils","OK/postingForm/decoration/model/bg/BgDecoratorSimple","OK/postingForm/decoration/model/bg/BgDecoratorLinearGradient","OK/postingForm/decoration/model/bg/BgDecoratorSimpleImage","OK/postingForm/decoration/model/bg/BgDecorator","OK/postingForm/decoration/model/Decorator","OK/postingForm/decoration/model/DecoratorStorage","OK/postingForm/decoration/TextSizeControl","OK/postingForm/decoration/ColorPickerCatalog","OK/postingForm/decoration/ColorPickerCatalogBtn","OK/postingForm/decoration/ColorPickerList","OK/postingForm/decoration/ColorPicker"],function(){});