define(["jquery","OK/utils/throttle"],function(e,d){var f=[];function c(h,g){h[0].style.cssText="transform: "+g+"; -webkit-transform: "+g+"; -moz-transform: "+g+"; -ms-transform: "+g+";";}function a(h,g){this.el=h[0];this.lockDelay=g;this._onLockTimeout=this._onLockTimeout.bind(this);}a.prototype={hide:function(){if(this.locked){return;}if(!this.lockDelay){this.setHidden(true);}else{this.lock();}},setHidden:function(g){if(this.el){this.el.classList.toggle("hidden",g);}},setLocked:function(g){this.locked=g;if(this.el){this.el.classList.toggle("__lock",g);}},lock:function(){this.setLocked(true);this.lockTimeout=setTimeout(this._onLockTimeout,this.lockDelay);},unlock:function(){if(!this.locked){return;}this.setLocked(false);if(this.lockTimeout){clearTimeout(this.lockTimeout);this.lockTimeout=0;}},_onLockTimeout:function(){this.lockTimeout=0;this.unlock();this.setHidden(true);},show:function(){if(this.locked){this.unlock();}this.setHidden(false);},onClick:function(g){if(this.el){this.callback=g;this.el.addEventListener("click",this);}},handleEvent:function(g){if(g.type==="click"&&!this.locked&&this.callback){this.callback();}},destroy:function(){if(this.el){if(this.callback){this.el.removeEventListener("click",this);this.callback=null;}this.el=null;}}};function b(){this.interval=null;}b.prototype={activate:function(h){var C=this,D=C.$el=e(h);C.$content=D.find(".uslider_cnt");var y=D.attr("data-type");C.isCarousel=y!=undefined&&y=="carousel";var p=D.attr("data-play");C.autoplay=p!=undefined&&p=="auto";var o=D.attr("data-customEvent");C.customEvent=o!=undefined&&o=="true";var A=D.attr("data-delete-enabled");C.intervalTime=D.attr("data-interval");var s=+D.attr("data-lock-delay-of-scrolling-end")||0;var q=D.attr("data-in-layer");C.inLayer=q!=undefined&&q=="true";var B=D.attr("data-loop");C.loop=B!=undefined&&B=="true";C.autoPlayForward=true;var r=D.attr("data-gap");C.options={gap:r?parseInt(r):6};if(C.isCarousel){C.options.gap=0;}var v=C.$nextBtn=new a(D.find(".uslider_ctrl.__next"),s);var l=C.$prevBtn=new a(D.find(".uslider_ctrl.__prev"),s);var x=C.$container=D.find(".uslider_hld");var u=D.attr("data-slide-width");var j=x.children();C.slideWidth=u?u:e(j[0]).outerWidth(true);var g=D.attr("data-visibleSlides");C.maxVisibleSlides=C.calcVisibleSlides();C.visibleSlides=g?parseInt(g):C.maxVisibleSlides;D.attr("data-visibleSlides",C.visibleSlides);var n=D.attr("data-ring");C.ring=n!=undefined&&n=="true"&&j.length>=C.visibleSlides*4;var i=D.attr("data-ring-manual-init-transform");C.ringManualInitTransform=i!=undefined&&i=="true";var k=D.attr("data-resizable");C.resizable=k!==undefined&&k==="true";var w=D.attr("data-manualButtonOffset");C.buttonOffset=w?parseInt(w):Math.floor((C.$content.outerWidth()-(C.visibleSlides*C.slideWidth))/2);C.totalSlides=j.length;C.offset=0;if(C.ring){v.show();l.show();C.offset=C.visibleSlides;if(!C.ringManualInitTransform){x.addClass("__noanim");var t=Math.min(Math.floor((C.totalSlides-C.visibleSlides)/3),C.visibleSlides);var z=x[0];while(t-->0){z.insertBefore(z.lastChild,z.firstChild);}C.setTransalateX(C.offset*C.slideWidth-C.buttonOffset);setTimeout(function(){x.removeClass("__noanim");},50);}}else{C.scrollToOffset();}v.onClick(function(){C.handleClick(true);C.resetAutoPlayInterval();});l.onClick(function(){C.handleClick(false);C.resetAutoPlayInterval();});D.on("uSliderUpdateCount",function(F){var E=F.originalEvent.detail;switch(E.type){case"remove":C.deleteItem(true);break;case"append":C.updateCount();if(E.offset!==undefined){C.setOffset(E.offset);}else{C.scrollToOffset();}break;}});D.on("uSliderClick",function(E){C.handleClick(E.originalEvent.detail.forward);C.resetAutoPlayInterval();});x.on("transitionend.slider",function(E){if(E.target===x[0]){C.createCustomSlideEvent("slideend");}});if(C.autoplay&&C.totalSlides>1){D.hover(function(){clearInterval(C.interval);},function(){C.autoPlay();});C.autoPlay();}if(A){x.on("click.slide",".js-delete-item",function(){C.deleteItem(false);});}if(C.resizable){C.isOldLayoutIsSmall=e(window).width()<1274;e(window).on("resize.slider",d(200,function(){C.resizeHandler();}));}var m=f.indexOf(h);if(m===-1){f.push(h);}},calcVisibleSlides:function(){return Math.floor((this.$content.outerWidth()+this.options.gap*2)/this.slideWidth);},updateCount:function(){this.totalSlides=this.$container.children().length;},setOffset:function(i){var g,h=this.totalSlides-this.visibleSlides;switch(i){case"start":g=0;break;case"end":g=h;break;default:g=i;if(g>h){g=h;}if(g<0){g=0;}break;}this.offset=g;this.scrollToOffset();},deactivate:function(i){var h=this.$el;h.find(".uslider_ctrl").off(".slider");h.off("uSliderUpdateCount");h.off("uSliderClick");clearInterval(this.interval);if(this.$nextBtn){this.$nextBtn.destroy();this.$nextBtn=null;}if(this.$prevBtn){this.$prevBtn.destroy();this.$prevBtn=null;}var g=f.indexOf(i);if(g!==-1){f.splice(g,1);}if(!f.length){if(this.resizable){e(window).off("resize.slider");}}},setTransalateX:function(g){c(this.$container,"translateX(-"+g+"px)");},createCustomSlideEvent:function(i,h){var g=this;if(g.customEvent&&typeof CustomEvent==="function"){g.$el[0].dispatchEvent(new CustomEvent("uSliderAction",{bubbles:true,detail:{offset:g.offset,totalSlides:g.totalSlides,visibleSlides:g.visibleSlides,container:g.$container[0],action:i,data:h||null}}));}},handleClick:function(g){var h=this;if(h.isCarousel&&h.offset==h.totalSlides-1&&g){h.offset=0;}else{if(g){h.offset+=(h.offset+h.visibleSlides)<(h.totalSlides-h.visibleSlides)?h.visibleSlides:h.totalSlides-(h.offset+h.visibleSlides);}else{h.offset-=(h.offset-h.visibleSlides>0)?h.visibleSlides:h.offset;}}h.scrollToOffset();h.createCustomSlideEvent("slide");},scrollToOffset:function(){var k=this,l=k.$container,m=k.$nextBtn,h=k.$prevBtn;if(k.ring&&(k.offset<1||k.offset>=k.totalSlides-k.visibleSlides)){l.addClass("__noanim");var j=l[0],g=Math.min(Math.floor((k.totalSlides-k.visibleSlides)/3),k.visibleSlides),i=g;if(k.offset<1){while(i-->0){k.createCustomSlideEvent("moveFromRightToLeft",j.lastChild);j.insertBefore(j.lastChild,j.firstChild);}}else{g=-g;while(i-->0){k.createCustomSlideEvent("moveFromLeftToRight",j.firstChild);j.appendChild(j.removeChild(j.firstChild));}}k.offset+=g;k.setTransalateX((k.offset+g)*k.slideWidth-k.buttonOffset);setTimeout(function(){l.removeClass("__noanim");k.setTransalateX(k.offset*k.slideWidth-k.buttonOffset);},50);return;}if(k.offset<1){h.hide();if(k.visibleSlides<k.totalSlides){if(k.maxVisibleSlides>k.visibleSlides&&k.maxVisibleSlides>=k.totalSlides){m.hide();}else{m.show();}}else{m.hide();}k.setTransalateX(k.offset*k.slideWidth+k.options.gap);}else{if(k.offset<k.totalSlides-k.visibleSlides){h.show();m.show();k.setTransalateX(k.offset*k.slideWidth-k.buttonOffset);}else{h.show();m.hide();k.setTransalateX(k.offset*k.slideWidth-k.buttonOffset*2-k.options.gap);}}},autoPlay:function(){var g=this;g.interval=setInterval(function(){var h=g.$content.offset().top;if((OK.Layers.isAnyLayerOpened()&&!g.inLayer)||e(window).scrollTop()>h){return;}if(g.loop){var i=g.offset;g.handleClick(g.autoPlayForward);if(i===g.offset){g.handleClick(g.autoPlayForward=!g.autoPlayForward);}}else{g.handleClick(true);}},g.intervalTime);},resetAutoPlayInterval:function(){if(!this.autoplay){return;}clearInterval(this.interval);},deleteItem:function(h){var g=this;g.totalSlides=h?g.$container.children().length:g.$container.children().length-1;var i=g.offset;if(g.offset+g.visibleSlides>g.totalSlides){g.offset=g.offset>0?--i:i;}g.scrollToOffset();g.createCustomSlideEvent("remove");},resizeHandler:function(){var h=this;var g=e(window).width()<1274;if(h.isOldLayoutIsSmall===g){return false;}else{h.isOldLayoutIsSmall=g;}h.offset=0;h.visibleSlides=Math.floor((h.$content.outerWidth()+h.options.gap*2)/h.slideWidth);var i=h.$el.attr("data-manualButtonOffset");h.buttonOffset=i?parseInt(i):Math.floor((h.$content.outerWidth()-(h.visibleSlides*h.slideWidth))/2);h.scrollToOffset();}};return b;});