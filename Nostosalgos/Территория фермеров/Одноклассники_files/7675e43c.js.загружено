define(function(c){var i=c("OK/utils/utils"),e=c("OK/utils/dom"),j=c("OK/logger"),f="data-no-suggestion",g="data-delay-on-smile",a="StickerSuggester",h=function(k){return e.firstByClass(k.parentNode,"js-smile-st-suggest");},d=function(m){var l=h(m),k=e.parent(m,"comments_smiles_cnt"),n=m.offsetTop-k.scrollTop,o=m.offsetLeft-k.scrollLeft;l.style.top=n+"px";l.style.left=o+"px";};var b=function(k){this.showDelay=k.getAttribute(g);this.smileSuggesterPopupStub=k.cloneNode(true);this.smileSuggesterPopupStub.classList.remove("invisible");this.smileSuggesterPopupStub.removeAttribute(g);};b.prototype={suggestOnSmile:function(m){var l=this,q=m.getAttribute("alt"),p=m.getAttribute(f),o=m.parentNode,k,n;if(p){return;}k=h(m);if(k){d(m);}else{k=l.smileSuggesterPopupStub.cloneNode(true);o.appendChild(k);d(m);i.ajax({url:"/dk?cmd=SuggestStickers",data:{"st.q":q,"st.sm":true}}).fail(function(){j.error(a,"ajax");}).done(function(r){if(r){n=k&&e.firstByClass(k,"js-smile-st-suggest_cnt");if(n&&document.body.contains(n)){n.innerHTML=r;c(["OK/capture"],function(s){s.activate(n);});}j.success(a,"show-on-smile",q);}else{e.remove(k);j.success(a,"nothing",q);m.setAttribute(f,"true");}});}},getDelay:function(){return this.showDelay;}};return b;});