define(function(){var c=function(){};var a=function(){};var b=null;c.prototype={hideCurrent:function(){if(b){b.hide();}},hide:function(){clearTimeout(this.hideTimerId);clearTimeout(this.showTimerId);if(!this.visible){return;}this.visible=false;if(this===b){b=null;}this.settings.onHide();},show:function(){if(this!==b){this.hideCurrent();}clearTimeout(this.hideTimerId);clearTimeout(this.showTimerId);if(!this.visible){this.visible=true;this.settings.onShow();}},hideOnTimer:function(){clearTimeout(this.hideTimerId);clearTimeout(this.showTimerId);this.hideTimerId=setTimeout(this.hide.bind(this),this.settings.timeout);},showOnTimer:function(){if(this.settings.showTimeout>0){clearTimeout(this.hideTimerId);clearTimeout(this.showTimerId);this.showTimerId=setTimeout(this.show.bind(this),this.settings.showTimeout);}else{this.show();}},onClickHandler:function(){if(!this.visible){this.show();}else{if(!this.settings.remainOnClick){this.hide();}}},toggleHandler:function(d){d.stopPropagation();if(this.visible){this.hide();}else{this.show();}},onMouseenterHandler:function(){this.showOnTimer();},onTouchendHandler:function(){if(this.visible){this.hideOnTimer();}},processEvents:function(e){var f=this.settings.event.split(" ");var d=this;if(d.trigger){f.forEach(function(g){switch(g){case"click":e.call(d.trigger,"click",d.triggerClickHandler);break;case"mouseenter":e.call(d.trigger,"mouseenter",d.triggerMouseenterHandler);break;}});e.call(d.popup,"mouseenter",d.popupMouseenterHandler);if(this.triggerMouseleaveHandler){e.call(d.trigger,"mouseleave",d.triggerMouseleaveHandler);}}if(this.popupMouseleaveHandler){e.call(d.popup,"mouseleave",d.popupMouseleaveHandler);}if(OK.device.isTouch){if(d.trigger){e.call(d.trigger,"touchend",d.triggerTouchendHandler);}e.call(document.body,"touchend",d.bodyTouchendHandler);}if(this.settings.toggleControl){e.call(this.settings.toggleControl,"click",d.toggleClickHandler);}},create:function(e,d,f){if(!d){return;}this.trigger=e;this.popup=d;this.showTimerId=null;this.hideTimerId=null;this.visible=false;f.timeout=f.timeout!==0?f.timeout:1;this.settings={event:f.event||"click",timeout:f.timeout||800,showTimeout:f.showTimeout||0,remainOnClick:f.remainOnClick||false,onShow:f.onShow||a,onHide:f.onHide||a,toggleControl:f.toggleControl};this.triggerClickHandler=this.onClickHandler.bind(this);this.triggerMouseenterHandler=this.onMouseenterHandler.bind(this);this.popupMouseenterHandler=this.showOnTimer.bind(this);this.bodyTouchendHandler=this.onTouchendHandler.bind(this);this.triggerTouchendHandler=function(g){g.stopPropagation();};if(!OK.logging.isSeleniumBot){this.triggerMouseleaveHandler=this.hideOnTimer.bind(this);this.popupMouseleaveHandler=this.hideOnTimer.bind(this);}if(this.settings.toggleControl){this.toggleClickHandler=this.toggleHandler.bind(this);}this.processEvents(window.Element.prototype.addEventListener);},getElement:function(d){if(!d){return null;}return d.charAt(0)==="#"?document.getElementById(d.slice(1)):document.querySelector(d);},activate:function(l){var i="data-popup-active-class";var j="data-popup-local-selector";var f=this.getElement(l.getAttribute("data-trigger-selector"));var h=!!f?f:l;var e=l.hasAttribute(j)?l.querySelector(l.getAttribute(j)):this.getElement(l.getAttribute("data-popup-selector"));var q=l.getAttribute(i)||null;var k=l.getAttribute("data-popup-hidden-class")||"";var p=parseInt(l.getAttribute("data-timeout"),10);var o=parseInt(l.getAttribute("data-show-timeout"),10);var d=l.getAttribute("data-event");var m=l.getAttribute("data-active-class")||"";var g=l.hasAttribute("data-remain-on-click");var n=l.hasAttribute("data-toggle-selector")?l.querySelector(l.getAttribute("data-toggle-selector")):null;if(q===null||q.indexOf(" ")!==-1){if(OK.fn.isDebug()){window.console.log("OK/SimplePopup bad usage on",e,' Use "'+i+'"');window.alert("OK/SimplePopup bad usage. See console log for details");}}this.create(h,e,{timeout:p,showTimeout:o,event:d,remainOnClick:g,toggleControl:n,onShow:function(){e.classList.add(q);if(e.getBoundingClientRect().bottom>window.innerHeight){e.classList.add("__top");}if(k){e.classList.remove(k);}if(m){h.classList.add(m);}},onHide:function(){e.classList.remove(q,"__top");if(k){e.classList.add(k);}if(m){h.classList.remove(m);}}});if(l.hasAttribute("data-expanded")){this.show();}},deactivate:function(){this.processEvents(window.Element.prototype.removeEventListener);}};return c;});