define("OK/utils/md5",[],function(){function c(o,q){var p=o[0],n=o[1],s=o[2],r=o[3];p=a(p,n,s,r,q[0],7,-680876936);r=a(r,p,n,s,q[1],12,-389564586);s=a(s,r,p,n,q[2],17,606105819);n=a(n,s,r,p,q[3],22,-1044525330);p=a(p,n,s,r,q[4],7,-176418897);r=a(r,p,n,s,q[5],12,1200080426);s=a(s,r,p,n,q[6],17,-1473231341);n=a(n,s,r,p,q[7],22,-45705983);p=a(p,n,s,r,q[8],7,1770035416);r=a(r,p,n,s,q[9],12,-1958414417);s=a(s,r,p,n,q[10],17,-42063);n=a(n,s,r,p,q[11],22,-1990404162);p=a(p,n,s,r,q[12],7,1804603682);r=a(r,p,n,s,q[13],12,-40341101);s=a(s,r,p,n,q[14],17,-1502002290);n=a(n,s,r,p,q[15],22,1236535329);p=i(p,n,s,r,q[1],5,-165796510);r=i(r,p,n,s,q[6],9,-1069501632);s=i(s,r,p,n,q[11],14,643717713);n=i(n,s,r,p,q[0],20,-373897302);p=i(p,n,s,r,q[5],5,-701558691);r=i(r,p,n,s,q[10],9,38016083);s=i(s,r,p,n,q[15],14,-660478335);n=i(n,s,r,p,q[4],20,-405537848);p=i(p,n,s,r,q[9],5,568446438);r=i(r,p,n,s,q[14],9,-1019803690);s=i(s,r,p,n,q[3],14,-187363961);n=i(n,s,r,p,q[8],20,1163531501);p=i(p,n,s,r,q[13],5,-1444681467);r=i(r,p,n,s,q[2],9,-51403784);s=i(s,r,p,n,q[7],14,1735328473);n=i(n,s,r,p,q[12],20,-1926607734);p=e(p,n,s,r,q[5],4,-378558);r=e(r,p,n,s,q[8],11,-2022574463);s=e(s,r,p,n,q[11],16,1839030562);n=e(n,s,r,p,q[14],23,-35309556);p=e(p,n,s,r,q[1],4,-1530992060);r=e(r,p,n,s,q[4],11,1272893353);s=e(s,r,p,n,q[7],16,-155497632);n=e(n,s,r,p,q[10],23,-1094730640);p=e(p,n,s,r,q[13],4,681279174);r=e(r,p,n,s,q[0],11,-358537222);s=e(s,r,p,n,q[3],16,-722521979);n=e(n,s,r,p,q[6],23,76029189);p=e(p,n,s,r,q[9],4,-640364487);r=e(r,p,n,s,q[12],11,-421815835);s=e(s,r,p,n,q[15],16,530742520);n=e(n,s,r,p,q[2],23,-995338651);p=l(p,n,s,r,q[0],6,-198630844);r=l(r,p,n,s,q[7],10,1126891415);s=l(s,r,p,n,q[14],15,-1416354905);n=l(n,s,r,p,q[5],21,-57434055);p=l(p,n,s,r,q[12],6,1700485571);r=l(r,p,n,s,q[3],10,-1894986606);s=l(s,r,p,n,q[10],15,-1051523);n=l(n,s,r,p,q[1],21,-2054922799);p=l(p,n,s,r,q[8],6,1873313359);r=l(r,p,n,s,q[15],10,-30611744);s=l(s,r,p,n,q[6],15,-1560198380);n=l(n,s,r,p,q[13],21,1309151649);p=l(p,n,s,r,q[4],6,-145523070);r=l(r,p,n,s,q[11],10,-1120210379);s=l(s,r,p,n,q[2],15,718787259);n=l(n,s,r,p,q[9],21,-343485551);o[0]=d(p,o[0]);o[1]=d(n,o[1]);o[2]=d(s,o[2]);o[3]=d(r,o[3]);}function k(v,p,o,n,u,r){p=d(d(p,v),d(n,r));return d((p<<u)|(p>>>(32-u)),o);}function a(p,o,v,u,n,r,q){return k((o&v)|((~o)&u),p,o,n,r,q);}function i(p,o,v,u,n,r,q){return k((o&u)|(v&(~u)),p,o,n,r,q);}function e(p,o,v,u,n,r,q){return k(o^v^u,p,o,n,r,q);}function l(p,o,v,u,n,r,q){return k(v^(o|(~u)),p,o,n,r,q);}function j(q){txt="";var t=q.length,r=[1732584193,-271733879,-1732584194,271733878],p;for(p=64;p<=q.length;p+=64){c(r,m(q.substring(p-64,p)));}q=q.substring(p-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(p=0;p<q.length;p++){o[p>>2]|=q.charCodeAt(p)<<((p%4)<<3);}o[p>>2]|=128<<((p%4)<<3);if(p>55){c(r,o);for(p=0;p<16;p++){o[p]=0;}}o[14]=t*8;c(r,o);return r;}function m(o){var p=[],n;for(n=0;n<64;n+=4){p[n>>2]=o.charCodeAt(n)+(o.charCodeAt(n+1)<<8)+(o.charCodeAt(n+2)<<16)+(o.charCodeAt(n+3)<<24);}return p;}var h="0123456789abcdef".split("");function f(q){var p="",o=0;for(;o<4;o++){p+=h[(q>>(o*8+4))&15]+h[(q>>(o*8))&15];}return p;}function b(n){for(var o=0;o<n.length;o++){n[o]=f(n[o]);}return n.join("");}function g(n){return b(j(n));}function d(o,n){return(o+n)&4294967295;}return g;});define("OK/music/autoplay",["module","OK/logger","OK/cookie"],function(d,l,b){var e=d.config().stub||"/res/default/sound/no_sound_stub.mp3",n="playerjs",g="musicusage",c="musicerror",j,m;function a(p){var o=b.readCookie("dme");if((o&&("true"===o.toLowerCase()))||document.getElementById("__gwtd__m")){console.log(p);}}function k(o){l.success(g,n,o);}function f(o){l.success(c,n,o);}function i(){return new Promise(function(p,o){function q(){a("Cheating with "+j.src);j.play().then(function(){k("cheat.ok");a("Pause cheating");return j.pause();}).then(p).then(null,function(){k("cheat.fail");a("Fail cheating");o();});window.removeEventListener("click",q,true);}window.addEventListener("click",q,true);});}function h(){return new Promise(function(r){var q,s=window.navigator.appVersion.toLowerCase(),p=/webkit\//.test(s)&&!/chrome/.test(s)&&/safari/.test(s),o=d.config().force;if(p||o){a("Checking autoplay");j.src=e;q=j.play();if(q){q.then(function(){k("autoplay.ok");a("Autoplay ok");j.pause();r();},function(){k("autoplay.blocked");a("Autoplay blocked");i().then(r,r);});}else{f("autoplay.fail");a("Autoplay w/o promise");j.pause();r();}}else{a("Autoplay not checked");r();}});}return{setPlayer:function(o){j=o;},init:function(){if(!m){m=h();}return m;}};});(function(){var doT={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:true,append:true,selfcontained:false,doNotSkipEncoded:false},template:undefined,compile:undefined},_globals;doT.encodeHTMLSource=function(doNotSkipEncoded){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=doNotSkipEncoded?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m;}):"";};};_globals=(function(){return this||(0,eval)("this");}());if(typeof module!=="undefined"&&module.exports){module.exports=doT;}else{if(typeof define==="function"&&define.amd){define("doT",[],function(){return doT;});}else{_globals.doT=doT;}}var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(c,block,def){return((typeof block==="string")?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){if(code.indexOf("def.")===0){code=code.substring(4);}if(!(code in def)){if(assign===":"){if(c.defineParams){value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v};});}if(!(code in def)){def[code]=value;}}else{new Function("def","def['"+code+"']="+value)(def);}}return"";}).replace(c.use||skip,function(m,code){if(c.useParams){code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");def.__exp=def.__exp||{};def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2");return s+"def.__exp['"+rw+"']";}});}var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v;});}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ");}doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var cse=c.append?startend.append:startend.split,needhtmlencode,sid=0,indv,str=(c.use||c.define)?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/<!--[\s\S]*?-->/g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end;}).replace(c.encode||skip,function(m,code){needhtmlencode=true;return cse.startencode+unescape(code)+cse.end;}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?(code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='"):(code?"';if("+unescape(code)+"){out+='":"';}out+='");}).replace(c.iterate||skip,function(m,iterate,vname,iname){if(!iterate){return"';} } out+='";}sid+=1;indv=iname||"i"+sid;iterate=unescape(iterate);return"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='";}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='";})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"");if(needhtmlencode){if(!c.selfcontained&&_globals&&!_globals._encodeHTML){_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded);}str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||"")+"));"+str;}try{return new Function(c.varname,str);}catch(e){if(typeof console!=="undefined"){console.log("Could not create a template function: "+str);}throw e;}};doT.compile=function(tmpl,def){return doT.template(tmpl,null,def);};}());define("text",["module"],function(d){var n,i,h,c,o,f=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],m=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,k=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,b=typeof location!=="undefined"&&location.href,e=b&&location.protocol&&location.protocol.replace(/\:/,""),g=b&&location.hostname,a=b&&(location.port||undefined),l={},j=(d.config&&d.config())||{};n={version:"2.0.13+",strip:function(p){if(p){p=p.replace(m,"");var q=p.match(k);if(q){p=q[1];}}else{p="";}return p;},jsEscape:function(p){return p.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029");},createXhr:j.createXhr||function(){var s,p,q;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest();}else{if(typeof ActiveXObject!=="undefined"){for(p=0;p<3;p+=1){q=f[p];try{s=new ActiveXObject(q);}catch(r){}if(s){f=[q];break;}}}}return s;},parseName:function(r){var v,u,p,t=false,q=r.lastIndexOf("."),s=r.indexOf("./")===0||r.indexOf("../")===0;if(q!==-1&&(!s||q>1)){v=r.substring(0,q);u=r.substring(q+1);}else{v=r;}p=u||v;q=p.indexOf("!");if(q!==-1){t=p.substring(q+1)==="strip";p=p.substring(0,q);if(u){u=p;}else{v=p;}}return{moduleName:v,ext:u,strip:t};},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(s,w,q,p){var u,v,t,r=n.xdRegExp.exec(s);if(!r){return true;}u=r[2];v=r[3];v=v.split(":");t=v[1];v=v[0];return(!u||u===w)&&(!v||v.toLowerCase()===q.toLowerCase())&&((!t&&!v)||t===p);},finishLoad:function(p,r,s,q){s=r?n.strip(s):s;if(j.isBuild){l[p]=s;}q(s);},load:function(t,v,u,s){if(s&&s.isBuild&&!s.inlineText){u();return;}j.isBuild=s&&s.isBuild;var q=n.parseName(t),w=q.moduleName+(q.ext?"."+q.ext:""),r=v.toUrl(w),p=(j.useXhr)||n.useXhr;if(r.indexOf("empty:")===0){u();return;}if(!b||p(r,e,g,a)){n.get(r,function(x){n.finishLoad(t,q.strip,x,u);},function(x){if(u.error){u.error(x);}});}else{v([w],function(x){n.finishLoad(q.moduleName+"."+q.ext,q.strip,x,u);});}},write:function(t,q,r,p){if(l.hasOwnProperty(q)){var s=n.jsEscape(l[q]);r.asModule(t+"!"+q,"define(function () { return '"+s+"';});\n");}},writeFile:function(u,q,w,x,r){var v=n.parseName(q),p=v.ext?"."+v.ext:"",s=v.moduleName+p,t=w.toUrl(v.moduleName+p)+".js";n.load(s,w,function(y){var z=function(A){return x(t,A);};z.asModule=function(A,B){return x.asModule(A,t,B);};n.write(u,s,z,r);},r);}};if(j.env==="node"||(!j.env&&typeof process!=="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])){i=require.nodeRequire("fs");n.get=function(q,t,p){try{var r=i.readFileSync(q,"utf8");if(r[0]==="\uFEFF"){r=r.substring(1);}t(r);}catch(s){if(p){p(s);}}};}else{if(j.env==="xhr"||(!j.env&&n.createXhr())){n.get=function(q,u,p,s){var r=n.createXhr(),t;r.open("GET",q,true);if(s){for(t in s){if(s.hasOwnProperty(t)){r.setRequestHeader(t.toLowerCase(),s[t]);}}}if(j.onXhr){j.onXhr(r,q);}r.onreadystatechange=function(w){var v,x;if(r.readyState===4){v=r.status||0;if(v>399&&v<600){x=new Error(q+" HTTP status: "+v);x.xhr=r;if(p){p(x);}}else{u(r.responseText);}if(j.onXhrComplete){j.onXhrComplete(r,q);}}};r.send(null);};}else{if(j.env==="rhino"||(!j.env&&typeof Packages!=="undefined"&&typeof java!=="undefined")){n.get=function(p,w){var r,x,q="utf-8",s=new java.io.File(p),t=java.lang.System.getProperty("line.separator"),v=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),q)),u="";try{r=new java.lang.StringBuffer();x=v.readLine();if(x&&x.length()&&x.charAt(0)===65279){x=x.substring(1);}if(x!==null){r.append(x);}while((x=v.readLine())!==null){r.append(t);r.append(x);}u=String(r.toString());}finally{v.close();}w(u);};}else{if(j.env==="xpconnect"||(!j.env&&typeof Components!=="undefined"&&Components.classes&&Components.interfaces)){h=Components.classes;c=Components.interfaces;Components.utils["import"]("resource://gre/modules/FileUtils.jsm");o=("@mozilla.org/windows-registry-key;1" in h);n.get=function(r,v){var q,s,t,p={};if(o){r=r.replace(/\//g,"\\");}t=new FileUtils.File(r);try{q=h["@mozilla.org/network/file-input-stream;1"].createInstance(c.nsIFileInputStream);q.init(t,1,0,false);s=h["@mozilla.org/intl/converter-input-stream;1"].createInstance(c.nsIConverterInputStream);s.init(q,"utf-8",q.available(),c.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);s.readString(q.available(),p);s.close();q.close();v(p.value);}catch(u){throw new Error((t&&t.path||"")+": "+u);}};}}}}return n;});define("text!t/music/attachContent.dot",[],function(){return'<div class="inav __island gm-cl-aft">\n    <div class="inav_search search-wrapper">\n        <div class="it_w search-input">\n            <label>\n                <input class="search-input_it it" placeholder="{{=it.l10n.m_search_input_default}}">\n                <div class="search-input_control search-input_process">\n                    <i class="search-input_ic ic18 ic18_anim-procces"></i>\n                </div>\n                <div class="search-input_control search-input_search-ic">\n                    <i class="search-input_ic ic ic_search"></i>\n                </div>\n            </label>\n            <span class="search-input_control search-input_close">\n                <i class="search-input_ic ic ic_close-g"></i>\n            </span>\n        </div>\n    </div>\n    <div class="inav_nav">\n        <ul class="inav_ul inav__search_l">\n            <li class="inav_ul_li curPointer inav_ul_li_ac" data-tab="choose">\n                <span class="inav_a">\n                    {{=it.l10n.m_sec_track}}\n                </span>\n            </li>\n            <li class="inav_ul_li curPointer" data-tab="selected">\n                <span class="inav_a">\n                    {{=it.l10n.m_new_personal_pl_selected}}\n                    <span class="hcount">0</span>\n                </span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="mus-tr_lst">\n    <!-- attachItems.dot -->\n</div>';});define("t/music/attachContent",["doT","text!t/music/attachContent.dot"],function(a,b){return a.template(b);});define("text!t/music/track.dot",[],function(){return'<div class="mus-tr_hld">\n    <span class="mus-tr_play{{? item.isPlaying}} __pause{{?? item.track.playRestricted }} __disabled{{??}} __play{{?}}"\n        {{? !item.track.playRestricted }}title="{{=it.l10n.m_track_play_title}}"{{?}}\n        data-handler="play" data-id="{{=item.track.id}}" data-section="{{=it.section}}" data-pos="{{=item.position}}"{{? it.pid }} data-pid="{{=it.pid}}{{?}}"></span>\n    <div class="mus-tr_cnt">\n        {{? item.track.fileName }}\n        {{!item.track.fileName}}\n        {{??}}\n        <a class="mus-tr_a mus-tr_artist" data-open="1"\n            {{? item.track.masterArtistId < 0}}\n            data-handler="search" data-query="{{!item.track.ensemble}}"\n            {{??}}\n            data-handler="artist" data-id="{{=item.track.masterArtistId}}"\n            {{?}}>\n            {{!item.track.ensemble}}\n        </a>\n        &nbsp;&ndash;&nbsp;\n        <a class="mus-tr_a mus-tr_song" data-open="1"\n            data-handler="search" data-query="{{!item.track.ensemble}} {{!item.track.name}}">{{!item.track.name}}</a>\n        <span class="foh-s mus-tr_info">\n            {{? item.album }}\n                &nbsp;{{=it.l10n.m_track_from_album_}}&nbsp;\n                <a class="mus-tr_a mus-tr_album" data-open="1"\n                    data-handler="search" data-query="{{!item.track.ensemble}} {{!item.album.name}}">\n                    <span class="mus-tr_album-ic ic10_album"></span>\n                    {{!item.album.name}}\n                </a>\n            {{?}}\n            {{? item.track.idForDownload }}\n                &nbsp;{{=it.l10n.m_track_from_user_}} {{!item.track.copyrightOwnerName}}\n            {{?? item.friend }}\n                &nbsp;{{=it.l10n.m_track_from_user_}} <a class="mus-tr_a mus-tr_source" data-open="1"\n                    data-handler="user" data-id="{{=item.track.id}}">{{!item.friend.fullName}}</a>\n            {{?}}\n        </span>\n        {{?}}\n    </div>\n    <div class="mus-tr_right-controls foh-s">\n        <span class="mus-tr_add" title="{{=it.l10n.m_track_title_klass}}" tsid="trkAdd"\n            data-handler="add" data-id="{{=item.track.id}}" data-section="{{=it.section}}" data-ctx="{{=item.track.ctx}}"></span>\n        <span class="mus-tr_dropdown" title="{{=it.l10n.m_track_in_ppl}}" tsid="trkAddToPPL"\n            data-handler="dropdown" data-id="{{=item.track.id}}" data-section="{{=it.section}}" data-ctx="{{=item.track.ctx}}"></span>\n    </div>\n    <span class="mus-tr_time">{{=item.fmt_duration}}</span>\n</div>';});define("text!t/music/attachItems.dot",[],function(){return'{{? it.tracks }}\n    {{~it.tracks :item}}\n        {{? item.track }}\n            <div data-id="{{=item.track.id}}"\n                class="track __selectable {{? item.active}} __active{{?}}{{? item.selected}} __selected{{?}} soh-s{{? item.track.fileName }} __filename{{?}}{{? item.track.playRestricted }} __disabled{{?}}"\n                {{? item.track.playRestricted || item.track.copyrightDbg }}title="\n                    {{? item.track.playRestricted}}{{=it.l10n.m_copy_right_error_key}}{{?}} {{!item.track.copyrightDbg}}\n                "{{?}}>\n\n                <div class="track_hld">\n                    <span class="track_play{{? item.isPlaying}} m_portal_track_pause{{?? item.track.playRestricted }} __disabled{{??}}{{?}}"\n                          {{? !item.track.playRestricted }}title="{{=it.l10n.m_track_play_title}}"{{?}}\n                          data-id="{{=item.track.id}}">\n                    </span>\n\n                    <div class="track_cnt">\n                        {{? item.track.fileName }}\n                        {{!item.track.fileName}}\n                        {{??}}\n                        <span class="track_artist">{{!item.track.ensemble}}</span>\n                        &nbsp;&ndash;&nbsp;\n                        <span class="track_song">{{!item.track.name}}</span>\n                        {{?}}\n                    </div>\n\n                    <span class="track_ac foh-s">\n                        <span data-id="{{=item.track.id}}" class="track_add js-track_add"></span>\n                    </span>\n                </div>\n            </div>\n        {{?}}\n    {{~}}\n{{??}}\n    <div class="mus-tr_stub">\n        <div class="stub-empty __music">\n            <div class="stub-empty_img"></div>\n            <div class="stub-empty_t">{{=it.l10n.m_tab_no_tracks}}</div>\n        </div>\n    </div>\n{{?}}';});define("t/music/attachItems",["doT","text!t/music/track.dot","text!t/music/attachItems.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("OK/music/bus",[],function(){var c={},b=-1;function d(g,i){i=i||{};i.eventName=g;if(!c[g]){var h=i.attempt||0;if(h<5){i.attempt=h+1;setTimeout(function(){d(g,i);},1000);}return;}var j=c[g],f=j.length;while(f--){j[f].notify(i);}}function a(f,h){if(!c[f]){c[f]=[];}var g=(b++).toString();c[f].push({token:g,notify:h});return g;}function e(i){var h,j,g,f;for(h in c){if(c.hasOwnProperty(h)){j=c[h];for(g=0,f=j.length;g<f;g+=1){if(j[g].token===i){j.splice(g,1);return i;}}}}return null;}return{publish:d,subscribe:a,unsubscribe:e};});define("OK/music/model",[],function(){function t(){}function h(){}function f(){}function g(){}function a(){}function v(){}function i(){}function p(y){}function l(y,z){}function e(y,z){}function k(y){}function d(y){}function x(y){}function o(y){}function u(z,y){}function w(y,z){}function n(z,y){}function r(y){}function s(y){}function q(y){}function m(y){}function j(y,A,z){}function c(){}function b(){}return{getCfg:t,uid:h,trackData:f,playlists:g,openMessaging:a,myTracks:v,getActiveContentType:i,setActiveContentType:p,open:l,start:e,search:k,artist:d,user:x,collection:o,playlist:u,createPlaylist:w,add:n,addCollection:r,playCollection:s,playPlaylist:q,sharePlaylist:m,loadMore:j,now:c,present:b};});define("OK/music/attach",["module","OK/logger","t/music/attachContent","t/music/attachItems","PTS/data-pane.music","PTS/gwt.resources.common","OK/utils/delegate","OK/utils/dom","OK/music/bus","OK/music/model"],function(ax,F,A,ak,ar,X,am,y,D,x){var P="track",K="track_play",u="__active",m="__selected",G="__disabled",aw="inav_ul_li",ab="inav_ul_li_ac",C="search-input_active",a="search-input_searching",r="formaddpl",au="choose",Q="selected",n="search",w=500,B=ax.config().limit||50,Z=ax.config().timeout||1500,ad,s,an,ac,ae,M,l,ay,k,T,v,J="",L,g,af=0,ah,f,O=[],aa,H="OK/music2/app",q="OK/messages2/app";function ap(aB){var az=Math.floor(aB/60),aA=Math.floor(aB%60);return az+":"+(aA<10?"0":"")+aA;}function aj(aA){var az={};if(aA){aA.forEach(function(aB){az[aB.id]=aB;});}return az;}function z(aB){if(!aB){return aB;}var az={},aA;for(aA in aB){if(aB.hasOwnProperty(aA)){az[aA]=aB[aA];}}return az;}function d(aA){var az;if(require.defined(H)){az=require(H).getCurrentTrack();return az&&az.id===aA;}az=x.trackData().track;return az&&az.playlistType===r&&az.songObj.id===aA;}function E(az){if(az.playlistObj){az=az.playlistObj.content;}f=aj(az.tracks);if(!az.tracks){return null;}return az.tracks.map(function(aC){var aB=z(f[aC.id]),aA={};if(aB){aA.track=aB;aA.position=af;af+=1;aA.active=d(aB.id);if(aA.active){aA.isPlaying=require.defined(H)?aC.playing:x.trackData().isPlaying;}aA.fmt_duration=ap(aB.duration||0);aA.selected=(O.findIndex(function(aD){return aD.id===aB.id;})!==-1);}return aA;});}function b(az){ac.insertAdjacentHTML("beforeend",ak({l10n:ar,section:r,pid:ah,tracks:E(az)}));}function h(aB,az){var aA=y.firstByClass(aB,K);if(aA){aA.classList.toggle("m_portal_track_pause",az);}}function V(az){return az&&az.playlistType===r;}function ag(aA,aB){if(V(aA)){g=aB;var az=y.byClass(ac,P),aD=""+aA.songObj.id,aC=az.find(function(aE){return aE.getAttribute("data-id")===aD;});if(aC){aC.classList.toggle(u,aB);h(aC,aB);}return true;}return false;}function aq(az){if(az.prev){ag(az.prev,false);}ag(az.now,true);}function S(az){ag(az.track,false);}function at(aA){var az=x.trackData().track;ag(az,aA.isPlaying);}function av(){return new Promise(function(aC,aB){var aA=0,az=function(){var aD=window.__getMusicFlash;if(aD){aC(aD());}else{aA+=1;if(aA<=50){setTimeout(az,500);}else{aB(new Error("Timeout expired"));}}};az();});}function p(aA){var az=this.classList.contains("__disabled"),aB=this.classList.contains("m_portal_track_pause"),aC=this.getAttribute("data-id");if(az){return;}aA._skipSelect=true;if(require.defined(H)){odklMusic.playPortalTrack(aC,"formaddpl",this,"formaddpl");return;}av().then(function(aD){if(aB){aD.lcPause();}else{if(d(+aC)){aD.lcResume();}else{aD.lcPlayTrack({songId:aC},"m_sec_add_tracks_to_ppl");}}});}function N(){if(!ae){ae=document.createElement("div");ae.className="tip __active __mid __l";ae.innerHTML='<div class="tip_cnt">'+ar.too_much_attaches+"</div>";ac.parentElement.appendChild(ae);setTimeout(function(){ac.parentElement.removeChild(ae);ae=null;},Z);}}function ao(aB){if(aB._skipSelect){return;}var aE=this.classList,aA,aD=this.getAttribute("data-id"),aC,az;if(aE.contains(m)){aC=O.findIndex(function(aF){return aF.id===+aD;});if(aC>=-1){O.splice(aC,1);}}else{if(O.length>=B){N();return;}az=f[+aD];if(az){O.push(az);}}aE.toggle(m);an.textContent=O.length;T.classList.toggle(G,O.length===0);M.innerHTML="";O.forEach(function(aF){aA=document.createElement("input");aA.type="hidden";aA.value=aF.id;M.appendChild(aA);});}function W(){J=ay.value="";l.classList.remove(C);}function e(aB){af=0;if(require.defined(H)){if(n===aB){return require(H).searchTracks(J).then(function(aC){l.classList.remove(a);return{tracks:aC};});}W();if(Q===aB){az=O.length?JSON.parse(JSON.stringify(O)):null;return Promise.resolve({tracks:az});}return require(H).loadMyTracks().then(function(aC){return{tracks:aC};});}var aA,az;return av().then(function(aC){if(n===aB){aA=aC.lcRelevantTracks(J,"attach");aA.then(function(){l.classList.remove(a);});return aA;}W();if(Q===aB){az=O.length?JSON.parse(JSON.stringify(O)):null;return Promise.resolve({tracks:az});}return aC.lcLoadFriendList(ah);});}function j(az){ac.innerHTML="";return e(az).then(b);}function o(){if(!this.classList.contains(ab)){y.byClass(s.rootElement,aw).forEach(function(az){az.classList.remove(ab);});this.classList.add(ab);j(this.getAttribute("data-tab"));}}function R(az){y.byClass(s.rootElement,aw).forEach(function(aA){aA.classList.toggle(ab,aA.getAttribute("data-tab")===az);});}function Y(az){if(!az&&ay.value.trim()===J){return;}if(L){clearTimeout(L);}J=ay.value.trim();l.classList.add(a);L=setTimeout(function(){R(au);j(n);},w);}function c(){W();j(au);}function i(aA){var az=aA.type,aB=ay.value.trim().length===0;if(az==="click"){c();return;}if(az==="keydown"){switch(aA.which){case 13:Y(true);aA.preventDefault();break;case 27:c();aA.stopPropagation();break;}}else{Y(false);}l.classList.toggle(C,!aB);}function al(aA,aB){g=aB;var az=y.byClass(ac,P),aD=""+aA.id,aC=az.find(function(aE){return aE.getAttribute("data-id")===aD;});if(aC){aC.classList.toggle(u,aB);h(aC,aB);}}function I(az){if(aa&&aa.id!==az.id){al(aa,false);}aa=az;al(az,!!az.playing);}function t(){if(require.defined(q)){var az=this.elements["st.objectId"].value,aB=[];for(var aC=0;aC<O.length;aC++){var aA=O[aC];aB.push({type:"MUSIC",trackId:aA.id,title:aA.name,artistName:aA.ensemble,imageUrl:aA.imageUrl,duration:aA.duration,context:aA.ctx});}require(q).attachesSelected({objectId:az,attaches:aB});}}function U(az){ah=az.getAttribute("data-uid");az.innerHTML=A({l10n:ar});s=new am(y.firstByClass(az,"inav_nav"));s.on("click","."+aw,o);an=y.firstByClass(az,"hcount");l=y.firstByClass(az,"search-input");ay=y.firstByClass(az,"search-input_it");k=y.firstByClass(az,"ic_close-g");ay.addEventListener("keydown",i);ay.addEventListener("keyup",i);ay.addEventListener("keypress",i);ay.addEventListener("paste",i);k.addEventListener("click",i);ac=y.firstByClass(az,"mus-tr_lst");v=new am(ac);v.on("click",".track_play",p);v.on("click",".track",ao);M=document.createElement("div");ac.parentElement.insertBefore(M,ac);T=y.firstByClass(az.parentElement,"attachButton");j(au).then(function(){if(require.defined(H)){var aA=require(H);aA.on("current-track-changed",I);aa=aA.getCurrentTrack();if(aa){al(aa,!!aa.playing);}}});if(az.getAttribute("data-tt")){az.parentElement.addEventListener("submit",t);}if(!ad){ad=true;D.subscribe("mf_lcSetPlayerState",at);D.subscribe("mf_lcNewSongStarted",aq);D.subscribe("mf_stop",S);}}function ai(az){if(require.defined(H)){require(H).off("current-track-changed",I);}if(g){if(require.defined(H)){require(H).pause();}else{av().then(function(aA){aA.lcStop();});}g=false;}if(v){v.destroy();v=null;}f=null;O=[];az.parentElement.removeEventListener("submit",t);}return{activate:U,deactivate:ai};});define("OK/music/garbage",["module","OK/utils/md5"],function(c,k){var n=3840,h=256,g=1024,d={play:"playTrack",add:"clickOnTrackKlass"},f=c.config().c,e=c.config().v.split(",");function m(q,s,r){var o=s&n,p=d[q];if(o===h){return p+"_"+r;}if(o===g){return p+"Catalog_"+r;}}function a(o){if(o<0){return -1;}if(o>0&&o<10){return 2;}if(o>=10){return 3;}return 1;}function i(o){var s=/md5=(\w*)/g.exec(o)[1],r=k(s+"secret"),v=r.length,u=0,q,w,t,p="";for(q=0;q<v;q+=1){u+=parseInt(r[q],16);}for(q=0;q<v;q+=1){w=parseInt(r[q],16);if(q===v-1){t=w;}else{t=parseInt(r[q+1],16);}p+=Math.abs(u-(w*t*e[q]));}return o+"&client="+f+"&clientHash="+p;}function j(p){var o="";switch(p){case"\u0430":o="a";break;case"\u0431":o="b";break;case"\u0432":o="v";break;case"\u0433":o="g";break;case"\u0434":o="d";break;case"\u0435":o="e";break;case"\u0451":o="jo";break;case"\u0436":o="zh";break;case"\u0437":o="z";break;case"\u0438":o="i";break;case"\u0439":o="j";break;case"\u043a":o="k";break;case"\u043b":o="l";break;case"\u043c":o="m";break;case"\u043d":o="n";break;case"\u043e":o="o";break;case"\u043f":o="p";break;case"\u0440":o="r";break;case"\u0441":o="s";break;case"\u0442":o="t";break;case"\u0443":o="u";break;case"\u0444":o="f";break;case"\u0445":o="h";break;case"\u0446":o="c";break;case"\u0447":o="ch";break;case"\u0448":o="sh";break;case"\u0449":o="csh";break;case"\u044a":o="";break;case"\u044b":o="y";break;case"\u044c":o="";break;case"\u044d":o="je";break;case"\u044e":o="yu";break;case"\u044f":o="ya";break;default:o=p;break;}return o;}function b(r){var o="",p,q;for(q=0;q<r.length;q+=1){p=r.charAt(q);o+=j(p.toLowerCase());}return o;}function l(){return new Promise(function(r,q){var p=0,o=function(){var s=window.__getMusicFlash;if(s){r(s());}else{p+=1;if(p<=50){setTimeout(o,500);}else{q(new Error("Timeout expired"));}}};o();});}return{calc:i,translit:b,operation:m,range:a,getImpl:l};});define("OK/music/sid",["OK/logger","OK/utils/utils"],function(d,b){var a;function c(){if(!a){a=new Promise(function(g,f){b.ajax({url:"/web-api/music/conf"}).done(function(i,l,k){try{var h=JSON.parse(k.responseText);if(h.sid){g(h.sid);}else{f(new Error("empty"));}}catch(j){f(new Error("json"));}}).fail(function(){f(new Error("failed"));});});}a["catch"](function(f){d.success("musicerror","sidjs",f.message);a=null;});return a;}function e(){a=null;}return{get:c,reset:e};});define("OK/music/wmf",["module","OK/logger","OK/music/sid"],function(c,j,a){var i="error.notloggedin",b="error.service.not.available",h=[i,b],k=c.config().host,f=c.config().hd||false,l=c.config().hdp||"imgfmt=hidpi",g=false;if(f){if(window.matchMedia){g=window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches;}if(!g&&window.devicePixelRatio){g=window.devicePixelRatio>1.3;}}function d(n,m){return new Promise(function(p,o){a.get().then(function(q){var s=new XMLHttpRequest(),r=k+"/"+n+";jsessionid="+q;if(f&&g){m=m?l+"&"+m:l;}if(m){r+="?"+m;}s.open("GET",r);s.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");s.onload=function(){if(s.status===200){try{var v=JSON.parse(s.responseText),t=v.error;if(t&&(h.indexOf(t)>-1)){o(new Error(t));}else{p(v);}}catch(u){o(u);}}else{o(new Error(s.statusText));}};s.onerror=o;s.send();},o);});}function e(n,m){return new Promise(function(r,q){var p=0,s;function o(t){var u;if(t){if(t.stack){j.clob("musicclob.error",t.stack,"wmf",n);}u=t.message;if(u===b){p=10;}else{if(u===i){a.reset();}}}p+=1;if(p<3){if(s){clearTimeout(s);}s=setTimeout(function(){d(n,m).then(r,o);},1000);}else{j.success("musicerror","wmfjs",n+(u?"_"+u:""));q(t);if(u===b){from1x1("error",{type:"ServiceNA"});}else{from1x1("error",{type:"GlobalError",place:n+"_wmfjs"});}}}d(n,m).then(r,o);});}return{request:e};});define("OK/music/playlist",["OK/logger","OK/music/wmf"],function(t,n){function i(v){var u={};if(v){v.forEach(function(w){u[w.id]=w;});}return u;}var h={},d={},l=function(u){return u.tracks;},c=function(u){if(u.tracks){return u.tracks;}if(u.bestMatch.tracks){return u.bestMatch.tracks;}return null;},b={relevant:c,search_relevant:c,search_tracks:c,search_artists:c,search_albums:c,search_playlists:c,history:function(v){var u=i(v.tracks);if(!v.history){return null;}return v.history.filter(function(w){return u[w.id];});}},s={search_relevant:"relevant",search_tracks:"tracks",search_artists:"artists",search_albums:"albums",search_playlists:"playlists",personalpl:"my",friend:"my",pplRecTracks:"custom",track:"custom",gifts:"custom"},k={search_relevant:"relevant",search_tracks:"relevant",search_artists:"relevant",search_albums:"relevant",search_playlists:"relevant",chatpl:"custom"},e={downloaded:4,history:3,pop:2,my:1},q={search_relevant:1,search_tracks:1,search_artists:1,search_albums:1,search_playlists:1,downloaded:1,history:1,pop:1,my:1,myRadio:1,chatpl:1};function p(v){var u;for(u in q){if(q.hasOwnProperty(u)){if(v.indexOf(u+"_")===0){return u;}}}switch(v){case"relevant_5":return"search_tracks";case"relevant_6":return"search_albums";case"relevant_7":return"search_artists";case"relevant_0":return"search_relevant";}return v;}function a(y,w){var x=y.playlistObj.content,v=0,u=false;["tracks","albums","artists","history","friends"].forEach(function(z){if(w[z]){if(!x[z]){x[z]=[];}Array.prototype.push.apply(x[z],w[z]);}});if(x.tracks){v=x.tracks.length;}if(w.chunk&&w.chunk.more){u=true;}x.chunk={start:0,count:v,more:u};return y;}function o(u){u=p(u);return h[u];}function m(u){var w=o(u),v;if(w){v=b[w.type]||l;return v(w.playlistObj.content);}}function j(u){u=p(u);h[u]=[];}function r(u,v){if(u.tracks){u.tracks.forEach(function(w){w.songNum=v;v+=1;});}}function g(v,w){var u={pid:e[v]||0};switch(v){case"myRadio":break;case"personalpl":u.pid=w.pid;u.id=""+w.pid;u.playlistId=""+w.pid;break;case"my":break;case"artist":u.pid=w.artistId;u.artistId=w.artistId;break;case"album":u.pid=w.albumId;u.albumId=w.albumId;break;case"collection":u.pid=w.collectionId;u.collectionId=w.collectionId;break;case"friend":u.pid=w.uid;u.friendId=""+w.uid;break;case"downloaded":case"history":break;case"similarTracksForArtist":u.pid=w.artistId;u.artistId=w.artistId;break;case"pop":break;case"search_relevant":case"search_tracks":case"search_artists":case"search_albums":case"search_playlists":u.type=w.location||"";u.query=encodeURIComponent(w.q);break;case"feed":u.pid=w.friendId;u.friendId=""+w.friendId;u.ids=w.ids;break;case"statuspl":u.pid=5;u.ids=""+w.tid;break;case"playlistMT":u.pid=w.pid;u.uid=w.pid;u.ids=""+w.ids;u.location=w.location;u.topicId=w.topicId;break;case"formaddpl":u.pid=w.tid;break;case"custom":case"pplRecTracks":case"track":u.pid=w.pid;u.ids=""+w.ids;break;case"formdlfeat":break;case"chatpl":u.pid="0";u.ids="";u.location="messaging";break;}return u;}function f(D,z,x,C){var u=z||{},E,y=[],B=D,v,w,A=g(D,z),F;if(!q.hasOwnProperty(B)){B+="_"+A.pid;}F=d[B];if(F){return F;}u.start=u.start||0;if(u.from){u.start=u.from;delete u.from;}if(!u.count){u.count=u.start?50:100;}for(E in u){if(u.hasOwnProperty(E)){y.push(E+"="+encodeURIComponent(u[E]));}}F=n.request(s[D]||D,y.join("&"));d[B]=F;F.then(function(G){d[B]=null;if(D.indexOf("search_")===0){if(G.tracks){A.subType="tracks";A.pid=5;}else{if(G.bestMatch){r(G.bestMatch,0);}if(G.artists){A.subType="artists";A.pid=7;}else{if(G.albums){A.subType="albums";A.pid=6;}else{if(G.playlists){A.subType="playlists";A.pid=8;}else{A.subType="relevant";A.pid=0;}}}}B="search_"+A.subType;}if("myRadio"===D){v="lcPlaylistLoaded";w=h[B];if(w){a(w,G);G=w.playlistObj.content;r(G,0);}else{w={playlistObj:{content:G},paramsObj:A,type:D,curItemNum:0};h[B]=w;}}else{if(u.start&&D!=="chatpl"){v="lcAdditionalTracksRequested";r(G,u.start);w=h[B];a(w,G);}else{v="lcPlaylistLoaded";r(G,0);w={playlistObj:{content:G},paramsObj:A,type:k[D]||D,curItemNum:0};h[B]=w;}}if(!C){from1x1(v,{playlistObj:{content:JSON.parse(JSON.stringify(G))},paramsObj:A,type:k[D]||D,curItemNum:0});}},function(){t.success("musicerror","playlistjs",D);d[B]=null;});return F;}return{getCache:function(){return h;},getPlaylist:o,getTracks:m,mergeChunk:a,removeTracks:j,load:f};});define("OK/music/playerA",["module","OK/logger","OK/cookie","OK/music/garbage","OK/music/wmf","OK/music/bus","OK/music/model","OK/music/playlist","OK/music/autoplay"],function(ar,G,J,O,b,y,w,Q,Z){var m="playerjs",K="musicusage",M="musicerror",x="musicVolume",aj=ar.config().section||"postroll",B=0.5,D=0,aq=1,f=2,ac=30000,r=false,ap=D,ag=new Audio(""),S=false,af,L,t=0,W,am,I,H,g=[],ae=[],ao,F,Y,U=false,ad=false,au=ar.config().slot||3564,s=ar.config().c,an=ar.config().tns||"https://www.tns-counter.ru/V13a****digitalaudio_ru/ru/CP1251/tmsec=digitalaudio_network/";function q(aw){var av=J.readCookie("dme");if((av&&("true"===av.toLowerCase()))||document.getElementById("__gwtd__m")){console.log(aw);}}function p(av){G.success(K,m,av);}function a(av){G.success(M,m,av);}function aa(){return ~~performance.now();}function T(aw,av){p("adv-try");return new Promise(function(ay,ax){require(["adman"],function(az){var aA=new az(),aB;p("adv-init");aA.init({slot:au,audioEl:ag,params:{duration:aw,ok_id:w.uid(),ok_catid:af,puid22:av},wrapper:document.documentElement,browser:{}});aA.onError(function(aC){p("adv-error");ax(aC);});aA.onReady(function(aD){aB=aA.getBannersForSection(aj);if(aB&&aB.length){p("adv-request");ay(aA);if(aD&&aD.settings&&aD.settings[aj]){var aC=aD.settings[aj];if(aC.maxBannersShow>1){p("adv-mbs");}if(aC.loop){p("adv-loop");}}}else{p("adv-skip");ax(new Error("skip"));}});},function(){a("adv-request");ax(new Error("request"));});});}function h(){var av="tid="+am.track.id+"&type="+af+"&position="+ae[t];if(am.track.ctx){av+="&ctx="+encodeURIComponent(am.track.ctx);}if(L){av+="&id="+L;}b.request("play30",av);p("report");}function R(av){S=av;from1x1("lcSetPlayerState",{isPlaying:S});if(I){clearTimeout(I);}if(S&&!ad){I=setTimeout(h,ac);}}function d(ay){var ax=ay.length,aw,av;while(0!==ax){av=Math.floor(Math.random()*ax);ax-=1;aw=ay[ax];ay[ax]=ay[av];ay[av]=aw;}return ay;}function j(){var aw,av;if(ae.length<g.length){av=ae.slice(t+1);for(aw=ae.length;aw<g.length;aw+=1){av.push(aw);}if(r){av=d(av);}ae.length=t+1;Array.prototype.push.apply(ae,av);}}function E(){j();if(ap===aq){return true;}var aw=t-1,av;while(aw>=0){av=g[aw];if(!av.playRestricted){return true;}aw-=1;}return false;}function e(){var aw=t,av;do{aw-=1;if(aw<0){aw=ae.length-1;}av=g[aw];}while(av.playRestricted);return aw;}function V(){j();if(ap===aq){return true;}var aw=t+1,av;while(aw<ae.length){av=g[aw];if(!av.playRestricted){return true;}aw+=1;}return false;}function A(){var aw=t,av;do{aw+=1;if(aw===ae.length){aw=0;}av=g[aw];}while(av.playRestricted);return aw;}function u(aA,av){var aw=aA.error,ax=aw?"":aA.track.id+"@"+av,az,ay={};if(aw){a("start."+aw);if("error.copyright.restriction"===aw){from1x1("error",{type:"CopyRightError"});}setTimeout(P,3000);}if(W===ax){am=aA;az=O.calc(aA.play);y.publish("mf_lcChangeButtonState",{next:V(),prev:E()});if(af==="personalpl"){ay.id=H.paramsObj.id;}else{if(af==="collection"){ay.collectionId=H.paramsObj.collectionId;}else{if(af==="artist"){ay.artistId=H.paramsObj.artistId;}else{if(af==="album"){ay.albumId=H.paramsObj.albumId;}else{if(af==="friend"){ay.friendId=H.paramsObj.friendId;}else{if(af==="feed"){ay.friendId=H.paramsObj.friendId;ay.ids=H.paramsObj.ids;}else{if(af==="playlistMT"){ay.uid=H.paramsObj.uid;}else{if(af==="custom"||af==="chatpl"){ay.pid=H.paramsObj.pid;ay.uid=H.paramsObj.pid;ay.ids=H.paramsObj.ids;ay.location=H.paramsObj.location;}else{if(af==="pplRecTracks"){ay.pid=H.paramsObj.pid;ay.ids=H.paramsObj.ids;}else{if(af==="track"){ay.pid=H.paramsObj.pid;ay.ids=H.paramsObj.ids;}else{if(af==="similarTracksForArtist"){ay.artistId=H.paramsObj.pid;}else{if(af==="relevant"){ay.query=H.paramsObj.query;ay.subType=H.paramsObj.subType;ay.uid=H.paramsObj.type;}}}}}}}}}}}}from1x1("lcNewSongStarted",{songObj:aA.track,playlistType:af,paramsObj:ay,songNum:av});from1x1("lcPlayRequestData",aA);U=true;ag.src=az;ag.play();p("start");}}function ak(aw){var av;if(aw.commercial){ao=null;av=T(aw.track.duration,aw.commercialGenre);}else{av=Promise.reject("adv-no");}return av.then(function(ax){return new Promise(function(az,ay){ad=true;am=null;from1x1("stop");if(ag.loop){ag.loop=false;p("adv-player-loop");}ax.onStarted(function(){if(ad){from1x1("lcAdStarted",{});p("adv-started");}});ax.onTimeRemained(function(aA){if(ad){y.publish("mf_lcCurTime",{curTime:aA.currentTime,totalTime:aA.duration});}});ax.onCompleted(function(){if(ad){from1x1("lcAdFinished",null);p("adv-finished");az();}});ax.onError(function(aA){if(ad){p("adv-error-play");ax.stop();ay(aA);}});ax.start(aj);});});}function v(aw,av){var ax=aw.id;ao=ax;F=aa();var ay="client="+s+"&jsonp=&tid="+ax;if(aw.ctx){ay+="&ctx="+encodeURIComponent(aw.ctx);}b.request("play",ay).then(function(aA){if(aA.firstPlay){p("tnsUniq");new Image().src=an+aa();}if(aA.commercial){p("adv-get");}y.publish("pay_ms",{subscribed:document.getElementById("hook_ToolbarIconMusic_ToolbarIconMusic").hasAttribute("data-is")||aA.subscribed});var az=function(){ag.loop=(ap===f);ad=false;if(aA.track&&aw.msgId){aA.track.msgId=aw.msgId;}u(aA,av);};ak(aA).then(az,az);},function(){a("loadTrack");});}function c(ax){t=ax;var aw=ae[ax],av=g[aw];W=av.id+"@"+aw;if(am){ag.pause();}v(av,aw);}function ai(aw){var av;ae=[];t=0;for(av=0;av<g.length;av+=1){if(av!==aw||!r){ae.push(av);}}if(r){ae=d(ae);ae.unshift(aw);q("-- generate shuffle sequence "+ae);}}function o(ay,ax,av,aw){Z.init().then(function(){if(ad){p("adv-playlist-play");ag.pause();from1x1("lcAdFinished",null);ag.loop=(ap===f);ad=false;}else{if(!S&&am){if(af===ax&&L===(aw||"")){if(am.track&&(""+am.track.id)===ay){ag.play();return;}}}}af=ax;L=aw||"";if("myRadio"===af){r=false;y.publish("mf_setShuffle",{state:r});}var az=ax;if(aw){az+="_"+aw;}H=Q.getPlaylist(az);g=Q.getTracks(az);if(av<g.length){if(g[av].id!==+ay){av=g.findIndex(function(aA){return +ay===aA.id;});if(av===-1){return;}}ai(+av);c(r?0:+av);}});}function N(){if(ad){p("adv-playlist-pause");}ag.pause();}function ah(){if(ad){p("adv-playlist-resume");}ag.play();}function z(){if(ad){p("adv-playlist-prev");return;}if(E()){c(e());}}function P(){if(ad){p("adv-playlist-next");return;}if(V()){c(A());}}function l(){return ag.volume;}function ab(av){ag.volume=av;var aw=av;if(aw<B){aw=B;}try{if(localStorage){localStorage.setItem(x,aw);}}catch(ax){}}function at(av){if(am){ag.currentTime=av*am.track.duration;}}function i(){r=!r;}function n(){ap+=1;if(ap>f){ap=D;}ag.loop=(ap===f);}function al(){var ax=ag.buffered,aw=0,av=0;if(ax.length&&am){aw=ax.end(ax.length-1);av=aw/am.track.duration;}return av;}ag.addEventListener("progress",function(){if(!U){return;}if(ad){return;}var av=al();if(av){y.publish("mf_lcLoadProgress",{loadProgress:av});}});ag.addEventListener("suspend",function(){if(!U){return;}if(ad){return;}if(ag.networkState===1){var av=al();if(av>0.9){y.publish("mf_lcLoadProgress",{loadProgress:1});}}});ag.addEventListener("timeupdate",function(){if(!U){return;}if(ad){return;}if(am){y.publish("mf_lcCurTime",{curTime:ag.currentTime,totalTime:am.track.duration,trackInfo:am});}});ag.addEventListener("play",function(){if(!U){return;}R(true);});ag.addEventListener("pause",function(){if(!U){return;}R(false);});ag.addEventListener("ended",function(){if(!U){return;}if(ad){return;}if(V()){P();}else{R(false);am=null;from1x1("stop");}});ag.addEventListener("error",function(){if(!U){return;}if(ad){a("error-adv");}else{var ay="fail",aw="error-",ax=0;try{ay=ag.canPlayType("audio/mpeg");}catch(av){ay="ex-"+av.name;}if(ag.error){ax=ag.error.code||0;q("Player got code "+ax);aw="error"+ax+"-";}a(aw+ay);}});ag.addEventListener("loadstart",function(){if(!U){return;}if(am&&ao===am.track.id){Y=aa();}});function C(aw){if(aw<=0){return 0;}if(aw>1000000){aw=1000000;}var av=Math.ceil(Math.log(aw)/Math.log(10))-1;if(av<2){av=2;}av=Math.pow(10,av);return Math.round(aw/av)*av;}ag.addEventListener("playing",function(){if(!U){return;}if(am&&ao===am.track.id){var av=aa(),ax,aw;ao=null;ax=C(av-F);aw=C(av-Y);if(ax){p("ltp-"+ax);}if(aw){p("stp-"+aw);}q("Playback delay ["+ax+","+aw+"]");}});function k(){var av=af;if(L){av+="_"+L;}return av;}Z.setPlayer(ag);Z.init();(function X(){try{if(localStorage){var av=+localStorage.getItem(x);if(!av||av<B){av=B;}ag.volume=av;setTimeout(function(){y.publish("mf_setVolume",{value:av});},1000);}}catch(aw){}}());return{getPlaylist:k,play:o,pause:N,resume:ah,prev:z,next:P,getVolume:l,setVolume:ab,setPosition:at,shuffle:i,repeat:n};});define("OK/music/player",["OK/music/bus","OK/music/model","OK/music/playerA"],function(a,b,d){var f="__getMusicFlash",e=0.5;function c(g,h){var i=window[f]&&window[f]();if(i){if(h!==undefined){i[g](h);}else{i[g]();}}}return{play:function(j,i,g,h){if(!OK.flash.useNative){setTimeout(function(){var l={tid:j,playlistType:i},k=b.now();if(typeof g==="number"){l.itemNum=g;}if(k){l.paramsObj=JSON.parse(JSON.stringify(k));}c("lcPlaylistItemClicked",l);},500);}else{setTimeout(function(){d.play(j,i,g,h);},500);}},pause:function(){if(OK.flash.useNative){d.pause();}else{c("lcPause");}},resume:function(){if(OK.flash.useNative){d.resume();}else{c("lcResume");}},prev:function(){if(OK.flash.useNative){d.prev();}else{c("lcPrev");}},next:function(){if(OK.flash.useNative){d.next();}else{c("lcNext");}},setVolume:function(g){if(OK.flash.useNative){d.setVolume(g);}else{c("lcNewVolumeLevel",g);}e=g;},getVolume:function(){if(OK.flash.useNative){return d.getVolume();}return e;},setPosition:function(g){if(OK.flash.useNative){d.setPosition(g);}else{c("lcTimelineNewLevel",g);}},shuffle:function(){if(OK.flash.useNative){d.shuffle();}else{c("lcShuffle");}},repeat:function(){if(OK.flash.useNative){d.repeat();}else{c("lcRepeat");}},tune:function(g){c("lcLoadMyRadio",g);},getPlaylist:d.getPlaylist};});define("OK/music/chat",["module","OK/logger","OK/music/model","OK/music/player","OK/music/playlist"],function(d,p,h,n,e){var a="chatpl",g=d.config().before||0,j={},l,f=document.getElementById("music_layer");function o(r){var q=h.trackData().track;return q&&q.playlistType===a&&("musmsg_"+q.songObj.msgId)===r.id;}function i(s){if(s.classList.contains("__disabled")){return;}if(s.classList.contains("__pause")||s.classList.contains("m_portal_track_pause")){n.pause();}else{if(o(s)){n.resume();}else{var r={start:s.getAttribute("data-start")},q,t;if(g){r.before=g;}e.load(a,r).then(function(u){t=u.msgIndex||0;q=u.tracks;if(q&&q.length>t){n.play(q[t].id,a,t);}});}}}function c(r,q){if(f){if(!j[r]){j[r]=[];}j[r].push(q);}}function k(t,s){var r=j[t],q;if(r){q=r.indexOf(s);if(q>-1){r.splice(q,1);}}}function b(q){var r=j[l];if(r){r.forEach(function(s){s.classList.toggle("m_portal_track_pause",q);});}}if(f){f.addEventListener("current-track-changed",function(r){var q=r.detail||{};if(l){b(false);}if(q.msgId){l=q.msgId;b(!!q.playing);}});}function m(q,r){this.element=r;this.msgId=r.getAttribute("data-start");}m.prototype={activate:function(q){if(q.classList.contains("__disabled")){return;}q.addEventListener("click",this);c(this.msgId,q);if(f&&f.currentTrack&&this.msgId===f.currentTrack.msgId){l=this.msgId;b(!!f.currentTrack.playing);}},deactivate:function(q){k(this.msgId,q);q.removeEventListener("click",this);},handleEvent:function(){if(!require.defined("OK/music2/app")){i(this.element);}else{if(this.element.classList.contains("m_portal_track_pause")){f.pause();}else{require("OK/music2/app").play({qid:"messaging:"+this.msgId});}}}};return m;});define("text!t/music/collection.dot",[],function(){return'<div class="mus_card_i">\n    <div class="mus_card{{? item.active}} mus_card__playing{{?}}{{? item.added}} mus_card__added{{?}}" data-handler="collection" data-id="{{=item.id}}">\n        <div class="col-card">\n            <div class="mus_card_img_w mus_card_img_w__col">\n                {{? item.image }}\n                <img src="{{! item.image }}" class="mus_card_img"></img>\n                {{?}}\n                <div class="mus_card_ac_lst">\n                    <span class="mus_card_ac_i mus_card_ac_i__pl" data-handler="playCollection" data-id="{{=item.id}}">\n                        <span class="mus_card_play"></span>{{=it.l10n.alb_mn_play}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__ps" data-handler="pauseCollection" data-id="{{=item.id}}">\n                        <span class="mus_card_play __pause"></span>{{=it.l10n.alb_mn_pause}}\n                    </span>\n                    {{? item.allowSubscribe }}\n                    <span class="mus_card_ac_i mus_card_ac_i__add" data-handler="addCollection" data-id="{{=item.playlistId}}">\n                        <span class="mus_card_add"></span>{{=it.l10nCmn._add}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__success">\n                        <span class="mus_card_add __added"></span>{{=it.l10n.alb_mn_success}}\n                    </span>\n                    {{?}}\n                    <span class="mus_card_ac_i mus_card_ac_i__more" data-handler="collection" data-id="{{=item.id}}">\n                        <span class="mus_card_more"></span>{{=it.l10nCmn._more}}\n                    </span>\n                </div>\n            </div>\n        </div>\n        <div class="mus_card_n_w">\n            {{? item.name }}\n            <div class="mus_card_n textWrap">\n                <span class="mus_card_n_a" title="{{! item.name }}">{{! item.name }}</span>\n            </div>\n            {{?}}\n        </div>\n        {{? item.isNew }}\n        <div class="mus_card_new"></div>\n        {{?}}\n    </div>\n</div>';});define("text!t/music/collectionList.dot",[],function(){return'<div class="m_c_s_alb m_collection">\n    <div class="m_c_s_header">\n        <div class="m_c_s_headerWrapper">\n            {{? it.content.collection.playlistId }}\n            <div class="m_c_s_header_title">{{=it.l10n.offPlaylistHeader}}</div>\n            {{??}}\n            <div class="m_c_s_header_title">{{!collection.name}}</div>&nbsp;\n            <div class="m_c_s_header_description">{{=it.l10n.m_collection_text}}</div>\n            {{?}}\n        </div>\n    </div>\n    <div class="m_c_s_scrollable mus-custom-scrolling">\n        <div class="mus_content_w">\n            <div class="mus_album">\n                <div class="mus_album_i__absolute">\n                    <div class="mus_album_i_w">\n                        <div class="mus_card_img_w">\n                            <img alt="" src="{{!it.content.collection.image || \'/res/i/music/stub/album__redesign@2x.png\'}}" class="mus_card_img"></img>\n                        </div>\n                    </div>\n                    <!--     :   -->\n                    <div class="m_c_col-data">\n                        {{? it.playCount }}\n                        <div class="m_c_col-data_counter">\n                            <span class="m_c_col-data_amount">{{= it.playCount.replace(/(\\d)(?=(\\d\\d\\d)+([^\\d]|$))/g, \'$1 \')}}</span>&nbsp;<span class="m_c_col-data_tx">{{=it.l10n[it.countKey]}}</span>\n                        </div>\n                        {{?}}\n                        {{? it.allowSubscribe || it.allowShare }}\n                        <div {{? it.playCount }}class="m_c_col-data_ac"{{?}}>\n                            {{? it.allowSubscribe }}\n                            <span class="mus-dl m_su m_c_col-data_ac_i" data-id="{{=it.content.collection.playlistId}}">\n                                <i class="m_c_col-data_add"></i><span>{{=it.l10n.subscribe_to_ppl}}</span>\n                            </span>\n                            {{?}}\n                            {{? it.allowShare }}\n                            <span class="mus-dl m_sh m_c_col-data_ac_i" data-id="{{=it.content.collection.playlistId}}">\n                                <i class="m_c_col-data_share"></i><span class="js-link-text">{{=it.l10n.share_ppl}}</span>\n                            </span>\n                            {{?}}\n                        </div>\n                        {{?}}\n                    </div>\n                </div>\n                {{? it.content.collection.playlistId }}\n                <div>\n                    <div class="mus_h2 mb-x">\n                        <span class="mus_h2_tx ellip">{{!it.content.collection.name}}</span>\n                    </div>\n                </div>\n                <div>\n                    {{? it.groupId }}\n                    <div class="mb-2x">\n                        <span class="m_c_s_c_go_to" data-gid="{{=it.groupId}}">{{=it.l10n.m_go_to_group}}</span>\n                    </div>\n                    {{?}}\n                </div>\n                {{?}}\n                <div class="mus_album_gap"></div>\n            </div>\n            {{? it.similar && it.similar.length }}\n            <div class="m_c_col-similar m_hidden">\n                <div class="mus_h2">{{=it.l10n.m_otherCollections_header}}</div>\n                <div class="mus_content_w">\n                    {{~it.similar :item}}\n                    {{# def.collection }}\n                    {{~}}\n                </div>\n            </div>\n            {{?}}\n        </div>\n    </div>\n</div>';});define("t/music/collectionList",["doT","text!t/music/collection.dot","text!t/music/collectionList.dot"],function(a,c,b){return a.template(b,undefined,{collection:c});});define("text!t/music/collectionItems.dot",[],function(){return'{{? it.tracks}}\n    {{~it.tracks :item}}\n    {{? item.track }}\n    <div class="mus-tr_i __has-video{{? item.active}} __active{{?}} soh-s{{? item.track.fileName }} __filename{{?}}{{? item.track.playRestricted }} __disabled{{?}}"\n        {{? item.track.playRestricted || item.track.copyrightDbg }}\n        title="{{? item.track.playRestricted}}{{=it.l10n.m_copy_right_error_key}}{{?}} {{!item.track.copyrightDbg}}"\n        {{?}}\n        id="tri_m_sec_collection_{{=item.position}}"\n        data-query=\'{"trackId":{{=item.track.id}},"pos":{{=item.position}}{{? item.track.musicVideoId }},"vid":{{=item.track.musicVideoId}}{{?}}}\'>\n        {{# def.track }}\n        {{? item.track.musicVideoId }}\n        <div class="mus-tr_video" onmouseover="odklMusic.showVideoPopup(\'tri_m_sec_collection_{{=item.position}}\')" onmouseleave="odklMusic.removeVideoLabel(\'tri_m_sec_collection_{{=item.position}}\')"\n            data-handler="video" data-id="{{=item.track.musicVideoId}}">\n            <div class="mml_dropdown_w">\n                <div class="mml_dropdown"></div>\n                <div class="mml_dropdown_video-ic" data-handler="video" data-id="{{=item.track.musicVideoId}}"></div>\n            </div>\n        </div>\n        {{?}}\n        {{? item.track.giftPrice }}\n            <span class="mus-tr_present" data-handler="present" data-id="{{=item.track.id}}" title="{{=it.l10n.m_present_track}}"></span>\n        {{?}}\n    </div>\n    {{?}}\n    {{~}}\n{{?}}';});define("t/music/collectionItems",["doT","text!t/music/track.dot","text!t/music/collectionItems.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("OK/music/collection",["OK/logger","t/music/collectionList","t/music/collectionItems","PTS/data-pane.music","PTS/gwt.resources.common","OK/utils/dom","OK/music/bus","OK/music/model"],function(G,A,w,U,S,b,n,e){var D="mus-tr_i",v="mus-tr_play",B="__active",I="__success",V="collection",h=300,F=145,l=99,f=/^group:\/\/(\d+)/,a,J,u,o,N,k,t,E,g=0,O=0,r,L;function q(aa){var Y=Math.floor(aa/60),Z=Math.floor(aa%60);return Y+":"+(Z<10?"0":"")+Z;}function s(Z){var Y={};if(Z){Z.forEach(function(aa){Y[aa.id]=aa;});}return Y;}function M(ab){var Z=J.scrollTop,Y=J.clientHeight,aa=ab.offsetTop+u.offsetTop,ac=ab.clientHeight;if(Z>aa){J.scrollTop=aa;}else{if(Z+Y<aa+ac){J.scrollTop=aa+ac-Y;}}}function z(aa){if(!aa){return aa;}var Y={},Z;for(Z in aa){if(aa.hasOwnProperty(Z)){Y[Z]=aa[Z];}}return Y;}function T(aa,Y){var Z=e.trackData().track;if(Z){return Z.playlistType===V&&Z.paramsObj.collectionId==g&&Z.songObj.id===aa&&Z.songNum===Y;}return false;}function W(ab){var aa=ab.playlistObj.content,Z=e.playlists(),Y=e.trackData().track;if(!aa.collections){return null;}return aa.collections.slice(0,32).map(function(ad){var ac=z(ad);if(Y){ac.active=Y.playlistType===V&&Y.paramsObj.collectionId==ad.id;}ac.allowSubscribe=!!ad.playlistId;if(ac.allowSubscribe){ac.added=Z.findIndex(function(ae){return ae.id===ad.playlistId;})!==-1;}return ac;});}function X(ab){var aa=ab.playlistObj.content,Y=s(aa.albums),Z=s(aa.friends);r=aa.chunk?aa.chunk.more:false;return aa.tracks.map(function(ae){var ad=z(ae),ac={track:ad};ac.position=O;O+=1;ac.active=T(ad.id,ac.position);if(ac.active){ac.isPlaying=e.trackData().isPlaying;}if(ad.albumId){ac.album=Y[ad.albumId];}if(ad.uid){ac.friend=Z[ad.uid];}ac.fmt_duration=q(ad.duration||0);return ac;});}function d(Y){u.insertAdjacentHTML("beforeend",w({l10n:U,section:"collection",pid:Y.paramsObj.pid||"",tracks:X(Y)}));if(!r&&t){t.classList.remove("m_hidden");}}function K(){if(E){J.removeChild(E);E=null;}}function y(){return J.scrollHeight-J.scrollTop<J.clientHeight*1.2;}function m(){if(r&&!L&&y()){K();L=true;E=document.createElement("div");E.className="mus_loading_scroll";J.appendChild(E);e.loadMore(V,O);}}function c(){return Math.max(h,document.documentElement.clientHeight-F)-l;}function R(){J.style.height=c()+"px";}function j(Y){if(V===Y.playlist.type){K();L=false;d(Y.playlist);}}function C(Z){var Y=function(ac){return ac.getAttribute("data-handler");},aa=Z.target,ab=Y(aa);if(!ab){aa=b.traverseParents(aa,Y,J);if(aa){ab=Y(aa);}}if(ab){require(["OK/music/act/"+ab],function(ac){ac.handle(aa);});}}function Q(aa,Y){var Z=b.firstByClass(aa,v);if(Z){Z.classList.toggle("__pause",Y);Z.classList.toggle("__play",!Y);}}function i(Y,Z){if(Y&&Y.playlistType===V&&Y.paramsObj.collectionId==g){var aa=b.byClass(u,D),ab,ac=Y.songNum;if(ac<aa.length){ab=aa[ac];ab.classList.toggle(B,Z);Q(ab,Z);if(Z){M(ab);}}}}function H(Y){if(Y.prev){i(Y.prev,false);}i(Y.now,true);}function x(Y){i(Y.track,false);}function P(Z){var Y=e.trackData().track,aa=false;i(Y,Z.isPlaying);if(t){b.byClass(t,"mus_card").forEach(function(ab){aa=Z.isPlaying;if(aa&&Y){aa=Y.playlistType===V&&Y.paramsObj.collectionId==ab.getAttribute("data-id");}ab.classList.toggle("mus_card__playing",aa);});}}function p(ac,ab){var af=ab.playlistObj.content,ad=af.collection,aa=0,Z=af.playCount||"",ae=false,ag=false,Y=e.trackData();if(ad){g=ad.id;if(ad.playlistId){ae=e.playlists().findIndex(function(ah){return ah.id===ad.playlistId;})===-1;ag=e.getCfg().sPPL;}if(ad.link&&f.test(ad.link)){aa=f.exec(ad.link)[1];}}else{g=0;}ac.innerHTML=A({l10n:U,l10nCmn:S,content:ab.playlistObj.content,groupId:aa,playCount:""+Z,countKey:"_playcount"+OK.util.plurals(Z),allowSubscribe:ae,allowShare:ag,similar:W(ab)});J=b.firstByClass(ac,"m_c_s_scrollable");u=b.firstByClass(J,"mus_album_gap");o=b.firstByClass(J,"m_su");N=b.firstByClass(J,"m_sh");k=b.firstByClass(J,"m_c_s_c_go_to");t=b.firstByClass(J,"m_c_col-similar");O=0;d(ab);R();if(Y&&Y.isPlaying){i(Y.track,true);}J.addEventListener("scroll",m);J.addEventListener("click",C);if(o){o.addEventListener("click",function(){if(!o.classList.contains(I)){o.classList.add(I);e.addCollection(this.getAttribute("data-id"));b.forEach(o.getElementsByTagName("span"),function(ah){ah.textContent=U.subscribed_to_ppl;});}});}if(N){N.addEventListener("click",function(){if(!N.classList.contains(I)){N.classList.add(I);var ah=b.firstByClass(N,"js-link-text");if(ah){ah.textContent=U.shared_ppl;}e.sharePlaylist(this.getAttribute("data-id"));G.success("musicusage","clkShareColPPL");}});}if(k){k.addEventListener("click",function(){navigateOnUrlFromJS("/group/"+aa);});}if(!a){a=true;window.addEventListener("resize",R);n.subscribe("mf_lcAdditionalTracksRequested",j);n.subscribe("mf_lcSetPlayerState",P);n.subscribe("mf_lcNewSongStarted",H);n.subscribe("mf_stop",x);}}return{activate:p};});define("text!t/music/sections.dot",[],function(){return'{{~it.sections :item}}\n<li class="mml_cat_li" tsid="LMSection_{{= item.cid }}" data-type="{{= item.type }}" data-section="{{= item.section }}">\n    <div class="mml_cat_btn">\n        <span class="tico">\n            <span class="tico_img"><i class="mml_ic {{= item.icon }}"></i></span>\n            <span class="mml_cat_n">{{= item.name }}</span>\n        </span>\n        {{? item.bubble }}\n        <span class="mml_notif mml_notif__count __on">new</span>\n        {{?}}\n    </div>\n</li>\n{{~}}';});define("t/music/sections",["doT","text!t/music/sections.dot"],function(a,b){return a.template(b);});define("text!t/music/subSections.dot",[],function(){return'<ul class="mml_subcat_ul __inner m_hidden">\n    {{~it.sections :item}}\n    <li class="mml_subcat_li" data-type="{{= item.type }}" data-section="{{= item.section }}">\n        <div class="mml_subcat_btn">\n            <div class="mml_ucard">\n                <div class="mml_ucard_img">\n                    <img class="mml_ucard_img_cnt" src="{{= item.image }}">\n                </div>\n                <div class="mml_ucard_n va_target">\n                    <div class="mml_ucard_n_f ellip">{{= item.name }}</div>\n                </div>\n            </div>\n        </div>\n    </li>\n    {{~}}\n</ul>';});define("t/music/subSections",["doT","text!t/music/subSections.dot"],function(a,b){return a.template(b);});define("text!t/music/tabs.dot",[],function(){return'<div class="mus_album-list" style="margin-bottom:-48px;">\n    {{~it.sections :item}}\n    <div class="mus_card_i" data-type="{{= item.type }}" data-section="{{= item.section }}">\n        <div class="mus_card __s">\n            <div class="mus_card_img_w mus_card_img_w__col" style="background-image:url({{=item.image}});background-size:100%;"></div>\n            <div class="mus_card_n_w">\n                <div class="mus_card_n textWrap">\n                    <span class="mus_card_n_a" title="{{! item.name }}">{{= item.name }}</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    {{~}}\n</div>';});define("t/music/tabs",["doT","text!t/music/tabs.dot"],function(a,b){return a.template(b);});define("text!t/music/collectionsList.dot",[],function(){return'<div class="m_c_s_alb">\n    <div class="m_c_s_header">\n        <div class="m_c_s_headerWrapper">\n            <div class="m_c_s_header_title">{{=it.l10n.m_global_collections_header}}</div>\n        </div>\n    </div>\n    <div class="m_c_s_scrollable mus-custom-scrolling">\n        {{? it.collections && it.collections.length }}\n        <div class="mus_content_w">\n            {{~it.collections :item}}\n            {{# def.collection }}\n            {{~}}\n        </div>\n        {{?}}\n    </div>\n</div>';});define("t/music/collectionsList",["doT","text!t/music/collection.dot","text!t/music/collectionsList.dot"],function(a,c,b){return a.template(b,undefined,{collection:c});});define("OK/music/collections",["module","OK/logger","t/music/sections","t/music/subSections","t/music/tabs","t/music/collectionsList","PTS/data-pane.music","PTS/gwt.resources.common","OK/utils/dom","OK/utils/delegate","OK/music/bus","OK/music/wmf","OK/music/model"],function(d,A,w,j,g,t,P,O,a,N,k,C,c){var u="__active",R="m_hidden",L="mus_card",G="mus_card__playing",n="mml_cat_btn",o="mml_subcat_btn",Q="collections",e=300,z=145,h=99,y,S,x,D,E,q="",p=d.config().bubble!==0,f=d.config().tabs||0,J=new Promise(function(U){k.subscribe("mf_lcPlaylistLoaded",function(W){if(W&&W.type==="pop"&&OK.flash.useNative){var V=W.playlistObj.content;U(V.collectionsSections);}});});function s(W){if(!W){return W;}var U={},V;for(V in W){if(W.hasOwnProperty(V)){U[V]=W[V];}}return U;}function B(V){var U=c.trackData().track;if(U){return U.playlistType==="collection"&&U.paramsObj.collectionId==V;}return false;}function T(W){var V=W.playlistObj.content,U=c.playlists();if(!V.collections){return null;}return V.collections.map(function(Y){var X=s(Y);X.active=B(Y.id);X.allowSubscribe=!!Y.playlistId;if(X.allowSubscribe){X.added=U.findIndex(function(Z){return Z.id===Y.playlistId;})!==-1;}return X;});}function b(){return Math.max(e,document.documentElement.clientHeight-z)-h;}function M(){if(E){E.style.height=b()+"px";}}function v(V){var U=function(Y){return Y.getAttribute("data-handler");},W=V.target,X=U(W);if(!X){W=a.traverseParents(W,U,E);if(W){X=U(W);}}if(X){require(["OK/music/act/"+X],function(Y){Y.handle(W);});}}function K(U){if(E){var V=false;a.byClass(E,L).forEach(function(W){V=U.isPlaying;if(V){V=B(W.getAttribute("data-id"));}W.classList.toggle(G,V);});}}function F(U){if(!D){return;}D.innerHTML=t({l10n:P,l10nCmn:O,collections:T(U)});E=a.firstByClass(D,"m_c_s_scrollable");M();E.addEventListener("click",v);}function l(U,V){D=U;if(OK.flash.useNative){var W=V?"shortName="+encodeURIComponent(V):"";C.request(Q,W).then(function(X){F({type:Q,playlistObj:{content:X}});});}else{window.__getMusicFlash().lcLoadCollections();}}function r(U){if(U){S.insertAdjacentHTML("beforeend",j({sections:U.map(function(V){return{type:Q,section:V.shortName,name:V.name,image:V.image};})}));y=true;x=S.lastElementChild;}}function i(){a.byClass(S,n).forEach(function(U){U.classList.remove(u);});a.byClass(S,o).forEach(function(U){U.classList.remove(u);});}function I(U){U.classList.add(u);}function m(U){S=U;S.insertAdjacentHTML("beforeend",w({sections:[{cid:"m_sec_collections",type:Q,section:"",icon:"m_ic_collections",name:P.m_sec_collections,bubble:p}]}));J.then(r);new N(S).on("click","li",function(){var X=this.getAttribute("data-type"),W=a.firstByClass(this,n)||a.firstByClass(this,o),V=X;q=this.getAttribute("data-section");if(q){V+="."+q;}if(y&&!q){if(W.classList.contains(u)){x.classList.toggle(R);}else{x.classList.remove(R);}}if(!W.classList.contains(u)){c.open(X,q);i();I(W);A.success("musicusage","clkSec",V);}});k.subscribe("m_setSection",function(X){if(X){i();if(X.type===Q){var V=Array.prototype.slice.call(S.getElementsByTagName("li")),W;if(V){V.forEach(function(Y){if(Y.getAttribute("data-section")===X.id){W=a.firstByClass(Y,n)||a.firstByClass(Y,o);I(W);}});}if(y&&X.id){x.classList.remove(R);}}}});}function H(U){if(f){J.then(function(V){U.innerHTML=g({sections:V.slice(0,f).map(function(W){return{type:Q,section:W.shortName,name:W.name,image:W.image};})});new N(U).on("click",".mus_card_i",function(){var X=this.getAttribute("data-type"),Y=this.getAttribute("data-section"),W=X+".tab."+Y;c.open(X,Y);A.success("musicusage","clkSec",W);});});}}k.subscribe("mf_lcPlaylistLoaded",function(U){if(U){if(U.type===Q){F(U);}}});k.subscribe("mf_lcSetPlayerState",K);window.addEventListener("resize",M);return{activate:l,attach:m,append:H};});define("text!t/music/subGrowl.dot",[],function(){return'<div class="growl __active m_hidden">\n    <a class="growl_lnk"></a>\n    <div class="growl_ava">\n        <div class="growl_ava_ic __pro-music"></div>\n    </div>\n    <div class="growl_cnt">\n        <div class="growl_tx">\n            <div class="al">{{=it.l10n.buyNoAd}}</div>\n        </div>\n    </div>\n    <span class="ic ic12 ic12_close growl_close"></span>\n</div>';});define("t/music/subGrowl",["doT","text!t/music/subGrowl.dot"],function(a,b){return a.template(b);});define("text!t/music/subPortlet.dot",[],function(){return'<div class="portlet __pro-music m_hidden">\n    <div class="pro-music_ic-w">\n        <div class="pro-music_ic"></div>\n        <div class="pro-music_h">{{=it.l10n.subHeader}}</div>\n    </div>\n    <div class="pro-music_list">\n        <div class="pro-music_i">\n            <div class="pro-music_i_ic __no-ads"></div>\n            <div class="pro-music_i_n">{{=it.l10n.subNoAds}}</div>\n        </div>\n        <div class="pro-music_i">\n            <div class="pro-music_i_ic __background"></div>\n            <div class="pro-music_i_n">{{=it.l10n.subBackground}}</div>\n        </div>\n        <div class="pro-music_i">\n            <div class="pro-music_i_ic __exclusive"></div>\n            <div class="pro-music_i_n">{{=it.l10n.subExclusive}}</div>\n        </div>\n        <div class="pro-music_i">\n            <div class="pro-music_i_ic __offline"></div>\n            <div class="pro-music_i_n">{{=it.l10n.subOffline}}</div>\n        </div>\n    </div>\n\n    <a class="pro-music_ac button-pro __wide">{{=it.l10n.trySubscription}}</a>\n</div>';});define("t/music/subPortlet",["doT","text!t/music/subPortlet.dot"],function(a,b){return a.template(b);});define("OK/utils/vanilla",["OK/AjaxNavigationLog","OK/utils/screens"],function(e,b){function o(r){var p=[],t=function(u,v){p.push(encodeURIComponent(u)+"="+encodeURIComponent(v));};for(var q in r){if(r.hasOwnProperty(q)){var s=r[q];if(Array.isArray(s)){s.forEach(t.bind(null,q));}else{t(q,r[q]);}}}return p.join("&");}function n(p){var t={},r=p&&p.indexOf("?");if(r>-1){var s=p.substr(r+1),q=s.split("&");q.forEach(function(v){if(v.indexOf("=")>-1){var u=v.split("="),w=u[0],x=u[1];x=decodeURIComponent(x.replace(/\+/g,"%20"));t[w]=x;}});}return t;}function l(u,p){var y=u.type||"POST",w=u.data||{},r=u.url||"",q=/^(https?:)?\/\//.test(r),x={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},t=u.headers||{},s={},z=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,B=u.beforeOpen,A=new XMLHttpRequest();if(!p){p=function(D){if(OK.navigation.redirect){OK.navigation.redirect(D);}else{document.location.href=decodeURIComponent(D);}};}if((y==="POST")&&(typeof w!=="string")){if(u.isFileUpload){t["Content-Type"]="application/octet-stream";var v=(w.name||"1.jpg").replace(/[^\u0000-\u007F]+/gi,"_").substring(0,255);t["Content-Disposition"]='attachment; filename="'+v+'"';}else{t["Content-Type"]="application/x-www-form-urlencoded";if(window.pageCtx.gwtHash){w["gwt.requested"]=window.pageCtx.gwtHash;}w=o(w);}}if(u.contentType&&x.hasOwnProperty(u.contentType)&&!t.hasOwnProperty("Content-Type")){t["Content-Type"]=x[u.contentType];}if(u.dataType&&x.hasOwnProperty(u.dataType)&&!t.hasOwnProperty("Accept")){t.Accept=u.dataType==="*"?x[u.dataType]:x[u.dataType]+", */*; q=0.01";}if(!q&&!t.hasOwnProperty("TKN")){t.TKN=OK.tkn.get();}var C=new Promise(function(F,E){var D=Date.now();if(B){B({xhr:A});}A.open(y,r,true);for(var G in t){if(t.hasOwnProperty(G)){A.setRequestHeader(G,t[G]);}}if(!q){b.apply(A);}A.onreadystatechange=function(){if(A.readyState===XMLHttpRequest.HEADERS_RECEIVED){var K=A.getAllResponseHeaders(),I;while(I=z.exec(K)){s[I[1].toLowerCase()]=I[2];}if(!q&&s["redirect-location"]){p(s["redirect-location"]);E(A,A.statusText,"Redirect");return;}}if(A.readyState!==XMLHttpRequest.DONE){return;}if(A.status>=200&&A.status<300||A.status===304){e.log(Date.now()-D,r);var H=A.responseText,L=H;if(u.dataType==="json"){try{L=JSON.parse(H);}catch(J){E(J);}}if(!q&&s.tkn){OK.tkn.set(s.tkn);}F({response:L,xhr:A});}else{E(A);}};A.onerror=function(){E(A);};A.send(w);});C.xhr=A;return C;}function j(p,q){return l({type:"GET",dataType:"json",url:p,data:q});}function f(q,p,r){if(!q||q.nodeType===3||q.nodeType===8){return;}var s=document.createEvent("CustomEvent");s.initCustomEvent(p,true,true,r);q.dispatchEvent(s);}function d(q){var p=document.createElement("div");p.innerText=q;return p.innerHTML;}function a(q){var p=q.getResponseHeader(OK.navigation.HEADER);if(p){return p.split(",");}return null;}function i(r,q){var p=r.split(OK.navigation.SPLITER);p.forEach(function(s,t){if(q[t]){OK.hookModel.setHookContent(q[t],s);}});}function h(p){return p.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'");}function m(p){return p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");}function c(p){return p.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ");}function g(q){var p=a(q.xhr);if(p){i(q.response,p);}}function k(p){return Array.prototype.slice.apply(p.getElementsByTagName("input")).reduce(function(r,q){if(q.name){r[q.name]=q.type==="checkbox"?(q.checked?"on":"off"):q.value;}return r;},{});}return{ajax:l,getJSON:j,trigger:f,encodeHtml:d,extractParams:n,stringifyParams:o,getBlockIds:a,updateBlocks:i,updateBlockModelCallback:g,getFormData:k,unescapeXml:h,escapeXml:m,formatNumber:c};});define("OK/music/subscribe",["module","t/music/subGrowl","t/music/subPortlet","PTS/data-pane.music","OK/logger","OK/utils/dom","OK/utils/vanilla","OK/music/bus"],function(b,a,m,n,l,f,i,j){var e="m_hidden",d,k,h=true;function c(o){l.success("musicusage","subscribe",o);if(!h){i.ajax({url:"/dk",data:{cmd:"PopLayer","st.layer.cmd":"PopLayerPaymentWizardOuter","st.layer.origin":41,"st.layer.srv":26,"st.layer.stJsCb":"ms"}}).then(function(p){return i.updateBlockModelCallback(p);});}}(function g(){var o;o=document.getElementById("hook_ToolbarIconMusic_ToolbarIconMusic");if(o){o.insertAdjacentHTML("beforeend",a({l10n:n}));d=f.firstByClass(o,"growl");if(d){f.firstByClass(d,"growl_lnk").addEventListener("click",function(p){c("growl");p.stopPropagation();});f.firstByClass(d,"growl_close").addEventListener("click",function(p){d.classList.add(e);p.stopPropagation();});}}o=document.getElementById("mmpcw");if(o){o=f.firstByClass(o,"layer_hld");if(o){o.insertAdjacentHTML("beforeend",m({l10n:n}));k=f.firstByClass(o,"__pro-music");if(k){f.firstByClass(k,"pro-music_ac").addEventListener("click",function(){c("portlet");});}}}}());j.subscribe("mf_lcAdStarted",function(){if(OK&&OK.Layers&&!OK.Layers.isLayerOpened("music")){if(d&&!h){d.classList.remove(e);}}});j.subscribe("mf_lcAdFinished",function(){if(d){d.classList.add(e);}});j.subscribe("pay_ms",function(o){h=!!o.subscribed;if(d){if(!d.classList.contains(e)){k.classList.toggle(e,h);}}if(k){k.classList.toggle(e,h);}if(o.buy){c("auto");}});return{buy:c};});define("OK/music/controls",["OK/logger","PTS/data-pane.music","OK/utils/dom","OK/utils/utils","OK/music/bus","OK/music/player","OK/music/model","OK/music/subscribe"],function(P,aX,E,ah,I,aQ,D,ab){var Y="musicusage",m="controlsjs",x="__play",a3="__play_disabled",aj="__empty",Q="__disabled",w="__active",r="__ac",ap="__overlay",aM="__movie",aO="__pro",au="m_hidden",ar=68,C=538,L=0,a0=1,c=2,aI,aP,al,aq,az,aN,g,ag,A,X,aR,ad,an,aw,n,b,aU,f,a1,k,aA,H,a5,V,B,aF,aC,i,q,ac,aK,av,d,aJ,a2,R=0.5,am,S,M=0,u,ax,j,aY=L,ak=true,y;function aS(e){if(e<0){return 0;}if(e>1){return 1;}return e;}function aT(a7){var e=Math.floor(a7/60),a6=Math.floor(a7%60);return e+":"+(a6<10?"0":"")+a6;}function W(){if(d){al.classList.remove(x);al.classList.remove(a3);}else{al.classList.add(aJ&&!y?a3:x);}ag.classList.toggle(r,d);X.classList.toggle("__playing",d);al.setAttribute("title",al.getAttribute(d?"data-t-pause":"data-t-play"));}function aE(e){a2=e;aq.classList.toggle("__mute",a2);az.classList.toggle(aj,a2);}function aD(e){aE(e===0);R=e;aN.style.width=g.style.left=Math.round(R*ar)+"px";aq.classList.toggle("__middle",R<0.5);az.classList.toggle(Q,R===0);}function h(e){aD(e);aQ.setVolume(e);}function ay(a6){var e=(a6.clientX-az.getBoundingClientRect().left)/ar;h(aS(e));}function aG(e){aD(aS(e.value||0));}function K(e){if(e){if(u&&e.indexOf("/res/default/Images/music/bg/stub_album.png")>-1){e="/res/i/music/stub/stub_album_novideo.png";}A.src=e;}A.classList.toggle(au,!e);X.classList.toggle(au,!!e);}function a(e){ax=aS(e);aw.style.width=Math.round(ax*C)+"px";}function a4(a6){var e=aS(a6);n.style.width=b.style.left=Math.round(e*C)+"px";aF.textContent=M?aT(Math.round(e*M)):"";}function at(e){if(e>ax){P.success(Y,m,"seekOuter");}else{P.success(Y,m,"seekInner");}a4(e);aQ.setPosition(e);}function l(a6){var e=a6.clientX-an.getBoundingClientRect().left;return aS(e/C);}function J(e){aI.classList.toggle(Q,!e.prev);aP.classList.toggle(Q,!e.next);}function aW(e){K(e.image);}function aZ(e){d=e.isPlaying;W();}function af(e){aY=e;q.classList.toggle(w,aY===a0);q.classList.toggle("__one",aY===c);}function t(){aY+=1;if(aY>c){aY=L;}af(aY);}function v(e){S=e;aJ=S===null;u=S?S.songObj.musicVideoId:0;M=S?S.songObj.duration:0;W();ag.classList.toggle(ap,!!u);ag.classList.toggle(aM,!!u);if(aJ){a(0);}a4(0);an.classList.toggle(aj,!S);an.classList.toggle(Q,!S);aU.classList.toggle(au,!S);if(S){if(S.songObj.fileName){f.classList.add(au);a1.classList.add(au);k.classList.add(Q);k.textContent=S.songObj.fileName;}else{f.textContent=S.songObj.ensemble||"";k.textContent=S.songObj.name||"";f.classList.remove(au);a1.classList.remove(au);k.classList.remove(Q);}}aC.textContent=M?"/ "+aT(M):"";var a6=!S;if(!a6){if("myRadio"===S.playlistType){a6=true;if(aY===c){t();aQ.repeat();}}}i.classList.toggle(Q,a6);q.classList.toggle(Q,a6);}function aV(e){av=true;v(e.now);}function aa(){v(null);K("");ag.classList.remove("__pro");}function O(e){a(e.loadProgress);}function aL(e){if(!j){if(e.totalTime){M=e.totalTime;aC.textContent="/ "+aT(M);a4(e.curTime/M);}else{M=0;aC.textContent="";a4(0);}}}function ao(e){if(e.shuffle){i.classList.toggle(w);aQ.shuffle();}if(aY===L&&e.repeat){t();aQ.repeat();}}function p(e){i.classList.toggle(w,!!e.state);}function U(e){af(e.state);}function N(e){var a6=D.trackData().track;if(a6){v(a6);}else{if(e.curSongObj){v(e.curSongObj);}if(e.lastPlayedStatus){K(e.lastPlayedStatus.imageUrl||"");}}}function ae(e){y=true;a4(0);a(0);d=true;W();J({next:false,prev:false});ag.classList.add(r,ap,aO);K(e.image);if(e.url){aR.href=e.url;H.href=e.url;H.classList.remove(Q);}else{aR.removeAttribute("href");H.removeAttribute("href");H.classList.add(Q);}a5.textContent=e.text||"";a5.title=a5.textContent;aA.classList.remove(au);if(!ak){V.classList.remove(au);}aU.classList.add(aO);aU.classList.remove(au);ad.classList.add(aO);an.classList.remove(aj);an.classList.remove(Q);i.classList.add(Q);q.classList.add(Q);}function F(){y=false;ag.classList.remove(r,ap,aO);K("");aR.removeAttribute("href");H.removeAttribute("href");H.classList.add(Q);a5.textContent=a5.title="";aA.classList.add(au);V.classList.add(au);aU.classList.remove(aO);ad.classList.remove(aO);i.classList.remove(Q);q.classList.remove(Q);}function ai(a6){aI=E.firstByClass(a6,"__back");aP=E.firstByClass(a6,"__forward");al=E.firstByClass(a6,"__pause");aq=E.firstByClass(a6,"mus_player-volume_ic");az=E.byClass(a6,"mus_player-slider")[0];aN=E.firstByClass(az,"mus_player-slider_drag");g=E.firstByClass(az,"mus_player-slider_tooltip");ag=E.firstByClass(a6,"mus_player_cover");A=E.firstByClass(a6,"mus_player_cover-img");X=E.firstByClass(a6,"mus_player_cover-empty");aR=E.firstByClass(a6,"mus_player_cover-overlay");ad=E.byClass(a6,"mus_player-slider_w")[1];an=E.byClass(a6,"mus_player-slider")[1];aw=E.firstByClass(an,"mus_player-slider_fill");n=E.firstByClass(an,"mus_player-slider_drag");b=E.firstByClass(an,"mus_player-slider_tooltip");aU=E.firstByClass(a6,"mus_player_seek-artist");f=E.firstByClass(aU,"mus_player_artist");a1=E.firstByClass(aU,"js-artist-song-divider");k=E.firstByClass(aU,"mus_player_song");aA=E.firstByClass(a6,"mus_player_pro");H=E.firstByClass(aA,"mus_player_pro-title");a5=E.firstByClass(aA,"mus_player_pro-text");V=E.firstByClass(a6,"mus_player_info-link");B=E.firstByClass(a6,"mus_player_time");aF=B.firstChild;aC=E.firstByClass(B,"mus_player_duration");i=E.firstByClass(a6,"mus_player_shuffle");q=E.firstByClass(a6,"mus_player_repeat");ac=E.firstByClass(a6,"mus_player_playing-cnt");aK=E.firstByClass(a6,"mml_ic_help");aD(aQ.getVolume());aI.addEventListener("click",function(){if(y){P.success(Y,m,"adv-controls-prev");}if(!aI.classList.contains(Q)){aQ.prev();}});al.addEventListener("click",function(){if(y){P.success(Y,m,"adv-controls-play");if(d){aQ.pause();}else{aQ.resume();}return;}if(aJ){return;}if(d){aQ.pause();}else{if(S){if(av){aQ.resume();}else{aQ.play(S.songObj.id,S.playlistType,S.songNum,S.paramsObj.pid);}}}});aP.addEventListener("click",function(){if(y){P.success(Y,m,"adv-controls-next");}if(!aP.classList.contains(Q)){aQ.next(true);}});aq.addEventListener("click",function(){if(y){P.success(Y,m,"adv-controls-mute");}if(a2){h(R||0.5);}else{aE(true);aQ.setVolume(0);}});ag.addEventListener("click",function(a8){if(y){P.success(Y,"ad","cover");return;}if(u){ah.ajax({url:"/dk",data:{cmd:"PopLayerVideo","st.vpl.vs":"musicVideos","st.vpl.id":u}}).done(ah.updateBlockModelCallback);}else{P.success(Y,"coverClick");var a7=document.createEvent("MouseEvents");a7.initMouseEvent("click",true,true,window,a8.detail,a8.screenX,a8.screenY,a8.clientX,a8.clientY,a8.ctrlKey,a8.altKey,a8.shiftKey,a8.metaKey,a8.button,null);ac.dispatchEvent(a7);}});az.addEventListener("mousedown",function(a7){am=true;az.classList.add(w);ay(a7);});az.addEventListener("wheel",function(a8){var a7=(R*ar-a8.deltaY)/ar;h(aS(a7));});an.addEventListener("click",function(a7){if(y){return;}if(S){at(l(a7));}});an.addEventListener("mousedown",function(a7){if(y){return;}if(S){j=true;an.classList.add(w);B.classList.add(w);a4(l(a7));}});var e=function(a7){if(am){ay(a7);}else{if(j){a4(l(a7));}}};document.addEventListener("mousemove",e);document.addEventListener("mouseover",e);document.addEventListener("mouseup",function(a7){if(am){am=false;az.classList.remove(w);}else{if(j){j=false;an.classList.remove(w);B.classList.remove(w);if(y){return;}at(l(a7));}}});f.addEventListener("click",function(){var a7=S.songObj.masterArtistId;if(a7>0){D.artist(a7);}else{D.search(S.songObj.ensemble);}});k.addEventListener("click",function(){if(k.classList.contains(Q)){return;}D.search(S.songObj.ensemble+" "+S.songObj.name);});H.addEventListener("click",function(){if(y){P.success(Y,"ad","link");}});V.textContent=aX.buyNoAd;V.addEventListener("click",function(){ab.buy("player");});i.addEventListener("click",function(){if(!i.classList.contains(Q)){i.classList.toggle(w);ah.ajax({url:"/dk",data:{cmd:"SetMusicFlagRBlock",uon:"SHUFFLE_ENABLED",uov:i.classList.contains(w)}});aQ.shuffle();P.success(Y,"clickOnShuffle",S.playlistType);}});q.addEventListener("click",function(){if(!q.classList.contains(Q)){t();ah.ajax({url:"/dk",data:{cmd:"SetMusicFlagRBlock",uon:"REPEAT_ENABLED",uov:aY!==L}});aQ.repeat();P.success(Y,"clickOnRepeat",S.playlistType);}});aK.addEventListener("click",function(){ah.ajax({url:"/dk",data:{cmd:"PopLayer","st.layer.cmd":"PopLayerHelpFeedback","st.layer.categorynew":"SITE_SECTION","st.layer.subcategory":"VIDEO_AND_MUSIC","st.layer.categoryValue":"MUSIC","st.layer.origin":"MUSIC_LAYER"}}).done(ah.updateBlockModelCallback);});I.subscribe("m_init",N);I.subscribe("m_play",aW);I.subscribe("mf_lcChangeButtonState",J);I.subscribe("mf_lcSetPlayerState",aZ);I.subscribe("mf_lcNewSongStarted",aV);I.subscribe("mf_stop",aa);I.subscribe("mf_lcLoadProgress",O);I.subscribe("mf_lcCurTime",aL);I.subscribe("mf_setVolume",aG);I.subscribe("m_init_options",ao);I.subscribe("mf_setShuffle",p);I.subscribe("mf_setRepeat",U);I.subscribe("mf_lcAdStarted",ae);I.subscribe("mf_lcAdFinished",F);I.subscribe("pay_ms",function(a7){ak=!!a7.subscribed;});}if(document.getElementById("_html5audioTest")){var s=document.createElement("audio"),Z=!!(s.canPlayType),G=Z?[]:null,o=null,aB=false,aH,z;try{o=new Audio("");aB=!!(o.canPlayType);if(aB){aH=[];}}catch(T){o=null;}["audio/mpeg","audio/ogg","audio/aac"].forEach(function(e){if(Z){try{z=("no"!=s.canPlayType(e))&&(""!=s.canPlayType(e));if(z){G.push(e);}}catch(a6){}}if(aB){try{z=("no"!=o.canPlayType(e))&&(""!=o.canPlayType(e));if(z){aH.push(e);}}catch(a6){}}});ah.ajax({url:"/web-api/music/log",data:{tag:G,obj:aH}});}return{activate:ai};});define("OK/music/flash",["module","OK/logger","OK/cookie","OK/music/bus","OK/music/garbage","OK/music/model","OK/music/wmf","OK/music/playlist","OK/music/player"],function(aX,I,T,B,ad,x,d,ai,aM){var X="flash",k="musicerror",ap="__getMusicFlash",aN=aX.config().limit||2000,aA=aX.config().interval||200,g=aX.config().force||256,V=aX.config().host||"https://wmf1.ok.ru",W=8,aU=27,aw,P,M="ru",aR,w=0,u=[null,"album",null,"collection","friend",null,null,null,"pop","history","my","artist",null,null,"personalpl",null,"downloaded",null,"subscriptionpl",null,"similarTracksForArtist",null,null,null,null,null,null,"track"],aD=Promise.resolve({}),H=[null,function(){if(!(+aR)){I.success(k,X,"load_1");return aD;}return ai.load("album",{albumId:+aR});},null,function(){if(!(+aR)){I.success(k,X,"load_3");return aD;}return ai.load("collection",{collectionId:+aR});},function(){if(!(+aR)){I.success(k,X,"load_4");return aD;}return ai.load("friend",{uid:aR});},null,null,null,function(){return ai.load("pop",{locale:M});},function(){return ai.load("history");},function(){return ai.load("my");},function(){if(!(+aR)){I.success(k,X,"load_11");return aD;}return ai.load("artist",{artistId:aR});},null,null,function(){if(!(+aR)){I.success(k,X,"load_14");return aD;}return ai.load("personalpl",{pid:+aR});},null,function(){return ai.load("downloaded");},null,null,null,function(){if(!(+aR)){I.success(k,X,"load_20");return aD;}return ai.load("similarTracksForArtist",{artistId:aR});},null,null,null,null,null,null,function(){if(!(+aR)){I.success(k,X,"load_27");return aD;}return ai.load("track",{pid:""+aR,ids:aR});}],ay={},aV;function aQ(){return performance.now();}function s(a0){var aZ=T.readCookie("dme");if((aZ&&("true"===aZ.toLowerCase()))||document.getElementById("__gwtd__m")){console.log(a0);}}function aB(){}function f(aZ){return function(){s("-- Call "+aZ);I.success(k,X,aZ);};}function ax(aZ){M=aZ;}function Z(a1,a0){var aZ={};switch(a1){case"album":aZ.pid=+a0;aZ.albumId=+a0;break;case"collection":aZ.pid=+a0;aZ.collectionId=+a0;break;case"friend":aZ.pid=a0;aZ.friendId=a0;break;case"pop":aZ.pid=2;break;case"history":aZ.pid=3;break;case"my":aZ.pid=1;break;case"artist":aZ.pid=+a0;aZ.artistId=+a0;break;case"personalpl":aZ.pid=a0;aZ.id=a0;aZ.playlistId=a0;break;case"downloaded":aZ.pid=4;break;case"similarTracksForArtist":aZ.pid=+a0;aZ.artistId=+a0;break;case"track":aZ.pid=a0;aZ.ids=a0;break;}return aZ;}function aH(a0,aZ){s("-- DO lcAskInit ("+a0+")");if(aZ){ax(aZ);}d.request("init").then(function(a8){var a4=a8.lastPlayedStatus,a3=+a4.type||W,a7=a4.trackId,a2,a1=H[W](),a5,a6;aR=a4.playlistId;if(u.length>a3){a2=u[a3];}if(!a2){a8.lastPlayedStatus=null;a3=W;a2=u[W];}if(a3===aU){aR=""+a7;}if(a3===W){a5=a1;}else{if(H.length>a3&&H[a3]){a5=H[a3]();}else{I.success(k,X,"define_"+a2);a5=a1;a2=u[W];}}B.publish("pay_ms",{buy:a8.subscriptionBanner,subscribed:document.getElementById("hook_ToolbarIconMusic_ToolbarIconMusic").hasAttribute("data-is")||a8.subscribed});Promise.all([a1,a5]).then(function(ba){var a9=ba[0],bb=ba[1];if(!bb.tracks||bb.tracks.length===0){bb=a9;a2="pop";}if(bb.tracks&&bb.tracks.length){if(a7){a6=bb.tracks.find(function(bc){if(bc){return bc.id===a7;}});}if(!a6){a6=bb.tracks[0];}if(a0){setTimeout(function(){aM.play(a6.id,a2,a6.songNum,aR);},1500);}a8.curSongObj={playlistType:a2,paramsObj:Z(a2,aR),isItFromCurList:true,songNum:0,songObj:a6};}a8.curPlayListObj={playlistObj:{content:bb},paramsObj:Z(a2,aR),type:a2,curItemNum:0};from1x1("lcInit",a8);},function(a9){s(a9);});});}function aE(a0,aZ){s("-- DO lcGetFriends");d.request("friends","start="+a0+"&count="+aZ).then(function(a1){from1x1("setFriends",a1);});}function aG(aZ){s("-- DO lcLoadFriendList ("+aZ+")");return ai.load("friend",{uid:aZ});}function U(aZ){s("-- DO lcLoadFeatured ("+aZ+")");if(!aZ||aZ==="m_sec_best"){ai.load("pop",{locale:M});}else{ai.load("pop",{locale:M,tuner:aZ});}}function D(){s("-- DO lcLoadCollections");d.request("collections").then(function(aZ){from1x1("lcPlaylistLoaded",{type:"collections",playlistObj:{content:aZ}});});}function Y(aZ){s("-- DO lcLoadCollection");ai.load("collection",{collectionId:aZ});}function aY(){s("-- DO lcLoadMyTuners");d.request("myTuners","locale="+M).then(function(aZ){from1x1("lcMyTunersLoaded",aZ);});}function aj(a2){s("-- DO lcLoadMyRadio ("+a2+")");var aZ=ai.getTracks("myRadio"),a1,a0={locale:M};if(a2){a0.tuner=a2.toString();}if(aZ&&aZ.length){a1=w+1;if(a1<aZ.length){aZ.length=a1;ai.load("myRadio",a0);}}else{ai.load("myRadio",a0);}}function at(){s("-- DO lcLoadMyMusic");ai.load("my");}function ao(aZ){s("-- DO lcLoadArtist ("+aZ+")");if(!aZ||"null"===aZ){I.success(k,X,"null_artist");return;}ai.load("artist",{artistId:aZ});}function ag(aZ){s("-- DO lcLoadAlbum ("+aZ+")");ai.load("album",{albumId:aZ});}function av(aZ,a0){s("-- DO lcPlaylistContent ("+aZ+","+a0+")");return ai.load("personalpl",{pid:a0});}function R(a0,a2,a1){s("-- DO loadPlaylist ("+a0+","+JSON.stringify(a2)+")");if(a0==="pplRecTracks"){var aZ=a0;if(a2.pid!=="my"){aZ+=":"+a2.pid;}ai.load(a0,{pid:a2.pid,ids:a2.tids,plid:aZ});}else{if(a0==="track"){ai.load(a0,{pid:""+a2.tids,ids:a2.tids,plid:a0});}else{f("loadPlaylist");}}}function aK(a0,aZ){s("-- DO lcLoadFeedPlaylist ("+a0+", "+aZ+")");ai.load("feed",{ids:a0,friendId:aZ});}function j(){s("-- DO lcLoadDownloaded");ai.load("downloaded");}function t(aZ){s("-- DO lcCheckTrackIsBought ("+aZ+")");d.request("isDownloaded","tid="+aZ).then(function(a0){from1x1("lcIsTrackBought",a0);});}function C(aZ){s("-- DO lcDownload ("+aZ+")");d.request("download","tid="+aZ).then(function(a0){var a2=a0.track.ensemble+" - "+a0.track.name+".mp3",a1;a2=ad.translit(a2);a2=a2.split(" ").join("_");a2=a2.charAt(0).toUpperCase()+a2.substr(1);for(a1=0;a1<a2.length;a1+=1){if(a2.charAt(a1)==="_"){a2=a2.substring(0,a1+1)+a2.charAt(a1+1).toUpperCase()+a2.substr(a1+2);}}a2=a2.replace(/[,;()<>@:\\\/\[\]?={}\x0D\x0A]/g,"");a0.play=ad.calc(a0.play)+"&fn="+encodeURIComponent(a2);from1x1("lcStartDownload",a0);});}function ah(a3){var a2=2000,a0=120000,aZ=function(){ay[a3]=null;},a1=function(a5){var a6=ay[a3];if(aQ()-a6<a0){setTimeout(a5,a2);}else{aZ();}},a4=function(){d.request("isDownloaded","tid="+a3).then(function(a5){if(a5.isBought){aZ();from1x1("lcPaymentStatusReceived",{trackId:a3});}else{a1(a4);}},function(){a1(a4);});};setTimeout(a4,a2);}function v(aZ){s("-- DO lcSearchRequest "+aZ);if(!ay[aZ]){ay[aZ]=aQ();ah(aZ);}}function c(aZ){s("-- DO lcSearchRequest ("+aZ+")");ai.load("search_relevant",{q:decodeURIComponent(aZ)});}function q(a2,a0,a3,aZ){s("-- DO lcRelevantTracks ("+a2+","+a0+","+a3+","+aZ+")");var a1=ai.load("search_tracks",{q:decodeURIComponent(a2),location:a0},null,"attach"===a0);a1.then(function(){if(a3){a(+a3,"relevant",5);}else{if(typeof aZ==="number"){am(aZ||0,"relevant",5);}}});return a1;}function b(aZ){s("-- DO lcRelevantArtists ("+aZ+")");ai.load("search_artists",{q:decodeURIComponent(aZ)});}function A(aZ,a1,a4){s("-- DO lcRequestAdditionalArtists ("+aZ+","+a1+","+JSON.stringify(a4)+")");var a2=ai.getPlaylist("search_artists"),a0,a5=0,a3={};if(a2){a0=a2.playlistObj.content.artists;if(a0){a5=a0.length;}ai.load("search_artists",{start:a5,count:a1,q:a4.query},null,true).then(function(a6){a3={type:a4.location||"",query:encodeURIComponent(a4.query),subType:"artists",pid:7};from1x1("lcAdditionalArtistsRequested",{playlistObj:{content:a6},paramsObj:a3,type:"relevant",curItemNum:0});});}}function Q(aZ){s("-- DO lcRelevantAlbums ("+aZ+")");ai.load("search_albums",{q:decodeURIComponent(aZ)});}function S(aZ){s("-- DO lcRelevantPlaylists ("+aZ+")");ai.load("search_playlists",{q:decodeURIComponent(aZ)});}function L(aZ,a1,a4){s("-- DO lcRequestAdditionalAlbums ("+aZ+","+a1+","+JSON.stringify(a4)+")");var a2=ai.getPlaylist("search_albums"),a0,a5=0,a3={};if(a2){a0=a2.playlistObj.content.albums;if(a0){a5=a0.length;}ai.load("search_albums",{start:a5,count:a1,q:a4.query},null,true).then(function(a6){a3={type:a4.location||"",query:encodeURIComponent(a4.query),subType:"albums",pid:6};from1x1("lcAdditionalAlbumsRequested",{playlistObj:{content:a6},paramsObj:a3,type:"relevant",curItemNum:0});});}}function o(a0,a4,a1,a3){s("-- DO lcRequestAdditionalTracks ("+a0+","+a4+","+a1+","+JSON.stringify(a3)+")");var a2={start:a4,count:a1},aZ=a3.pid;if(a0==="collection"){a2.collectionId=aZ;}else{if(a0==="personalpl"){a2.pid=aZ;}else{if(a0==="artist"){a2.artistId=aZ;}else{if(a0==="album"){a2.albumId=aZ;}else{if(a0==="friend"){a2.uid=aZ;}else{if(a0==="relevant"){switch(a3.pid){case 5:a0="search_tracks";break;case 6:a0="search_albums";break;case 7:a0="search_artists";break;case 8:a0="search_playlists";break;case 0:a0="search_relevant";break;}s("Correct relevant to "+a0);a2.q=a3.query;}else{if(a0==="myRadio"){a2.locale=M;if(a3.tuners){a2.tuner=a3.tuners;}}}}}}}}ai.load(a0,a2);}function aq(aZ,a1,a3){s("DO proxyRequest ("+aZ+","+JSON.stringify(a1)+")");var a0,a2=[];if("friends"===aZ&&"lcLoadFriendSearch"===a3){a1.q=decodeURIComponent(a1.q);}for(a0 in a1){if(a1.hasOwnProperty(a0)){a2.push(a0+"="+encodeURIComponent(a1[a0]));}}d.request(aZ,a2.join("&")).then(function(a4){if("similarTracksForPlaylist"===aZ){f("proxyRequest_similarTracksForPlaylist");}if("playlistsSet"===aZ&&a3==="lcPLImageSet"){f("proxyRequest_playlistsSet");}from1x1(a3,a4);});}function al(a0,a1){s("-- DO removePlaylistFromCache ("+a0+","+JSON.stringify(a1)+")");var aZ=a0;if(a1.pid){aZ+="_"+a1.pid;}if(aZ!==aM.getPlaylist()){ai.removeTracks(aZ);}}function ar(a3,a4){var a6=+a4.chunk.start||0,a7=a3.playlistObj.content.tracks,a5=a4.tracks,aZ=[],a0,a2=function(a8){return a0===a8.id;},a1;if(!a7){a7=a3.playlistObj.content.tracks=[];}if(a5){a5.reverse();Array.prototype.push.apply(aZ,a5);aZ.forEach(function(a8){a0=a8.id;a1=a5.findIndex(a2);a5.splice(a1,1);a1=a7.findIndex(a2);if(a1>-1){s("Removed "+JSON.stringify(a8));a7.splice(a1,1);}s("Added "+JSON.stringify(a8));a7.splice(a6,0,a8);a6+=1;});ai.mergeChunk(a3,a4);a6=0;a7.forEach(function(a8){a8.songNum=a6;a6+=1;});a3.playlistObj.content.totalTracks=a4.totalTracks;}}function ac(a0,aZ){ar(a0,aZ);from1x1("lcPlaylistMyMusicUpdated",JSON.parse(JSON.stringify(a0)));}function z(a1){s("-- DO lcAddSong "+JSON.stringify(a1));var aZ=ai.getPlaylist("my"),a0=[];if(aZ){a0.push("pos=0");a0.push("start=0");a0.push("count=1");a0.push("tid="+a1.songId);if(a1.playlistType){a0.push("type="+a1.playlistType);}if(a1.ctx){a0.push("ctx="+encodeURIComponent(a1.ctx));}d.request("like",a0.join("&")).then(function(a2){ac(aZ,a2);});}else{a0.push("pos=0");a0.push("start=0");a0.push("count=100");a0.push("tid="+a1.songId);if(a1.playlistType){a0.push("type="+a1.playlistType);}if(a1.ctx){a0.push("ctx="+encodeURIComponent(a1.ctx));}d.request("like",a0.join("&")).then(function(a2){ai.load("my",null,null,false).then(function(){from1x1("lcPlaylistMyMusicUpdated",{type:"my",paramsObj:{pid:1},playlistObj:{content:a2}});});});}}function F(a1){s("-- DO lcRestoreSong "+JSON.stringify(a1));var aZ=ai.getPlaylist("my"),a2=a1.pos||0,a0=[];if(aZ){if(a2>aZ.playlistObj.content.tracks.length){a2=aZ.playlistObj.content.tracks.length;}a0.push("pos="+a2);a0.push("start="+a2);a0.push("count=1");a0.push("tid="+a1.songId);d.request("repaire",a0.join("&")).then(function(a3){ac(aZ,a3);});}else{f("lcRestoreSong_2");}}function au(a3,a2){var a4=0,aZ=a3.playlistObj.content.tracks,a0=function(a5){return a2===a5.id;},a1;if(aZ){a1=aZ.findIndex(a0);if(a1>-1){s("Removed "+a2);aZ.splice(a1,1);a4=0;aZ.forEach(function(a5){a5.songNum=a4;a4+=1;});a3.playlistObj.content.totalTracks-=1;}}}function N(a1){s("-- DO lcDelSong "+JSON.stringify(a1));var aZ=ai.getPlaylist("my"),a0=[];if(aZ){a0.push("start=0");a0.push("count=1");a0.push("tid="+a1.songId);d.request("dislike",a0.join("&")).then(function(a2){au(aZ,a1.songId);from1x1("lcPlaylistMyMusicUpdated",JSON.parse(JSON.stringify(aZ)));});}}function an(){var aZ=d.request("playlistsGet",null);aZ.then(function(a0){a0.type="my";from1x1("lcMultiplePlaylistUpdated",a0);});return aZ;}function aJ(a0,aZ){ar(a0,aZ);from1x1("lcPlaylistItemAdded",JSON.parse(JSON.stringify(a0)));}function aL(a2,a5,a0,a3,aZ,a1){s("-- DO lcAddItemToPlaylist ("+a2+","+a5+","+a0+","+a3+","+aZ+","+a1+")");a0=a0||0;var a4=ai.getPlaylist("personalpl_"+a2),a6=["pid="+a2,"pos="+a0,"start="+a0,"count="+(""+a5).split(",").length,"tid="+a5];if(a3){a6.push("type="+a3);}if(a1){a6.push("ctx="+encodeURIComponent(a1));}if(a4){d.request("like",a6.join("&")).then(function(a7){aJ(a4,a7);an();});}else{d.request("like",a6.join("&")).then(an);}}function aI(aZ,a1){s("-- DO lcRemoveItemInPlaylist ("+aZ+","+a1+")");var a0=ai.getPlaylist("personalpl_"+aZ),a2=["pid="+aZ,"start=0","count=1","tid="+a1];if(a0){d.request("dislike",a2.join("&")).then(function(){au(a0,a1);from1x1("lcPlaylistItemRemoved",JSON.parse(JSON.stringify(a0)));});}}function G(a0,a1,aZ){s("-- DO lcRestoreItemToPlaylist ("+a0+","+a1+","+aZ+")");aL(a0,a1,aZ,null,null);}function ab(a1){s("-- DO lcPlaylistItemClicked "+JSON.stringify(a1));var a0=a1.playlistType,aZ="";if(a1.paramsObj){if("custom"===a0&&0===a1.paramsObj.pid){a0="chatpl";}else{if(a1.paramsObj.pid){aZ=a1.paramsObj.pid;}}}aM.play(a1.tid,a0,a1.itemNum,aZ);}function a(a3,a2,aZ){var a1=a2+(aZ?"_"+aZ:""),a0=ai.getTracks(a1),a4;if(a0){a4=a0.findIndex(function(a5){return a3===a5.id;});if(a4>-1){aM.play(a3,a2,a4,aZ);}}}function aO(a0){s("-- DO lcPlayStatus "+JSON.stringify(a0));var aZ=+a0.songId;ai.load("statuspl",{tid:aZ}).then(function(){a(aZ,"statuspl",5);});}function r(a2,a3){s("-- DO lcPlayMediatopic "+JSON.stringify(a2)+" ,"+a3);var a1=a2.trackIds,aZ=a2.id||a2.uid,a0=a2.topicId;ai.load("playlistMT",{ids:a1,userId:a2.userId,location:a2.location,pid:aZ,topicId:a0}).then(function(){a(+a3,"playlistMT",aZ);});}function E(a0,a1,aZ){s("-- DO lcPlayFeedPlaylist ("+a0+","+a1+","+aZ+")");ai.load("feed",{ids:a0,friendId:aZ,count:10000}).then(function(){a(+a1,"feed",aZ);});}function am(aZ,a3,a0){var a2=a3+(a0?"_"+a0:""),a1=ai.getTracks(a2);if(a1&&a1.length>aZ){aM.play(a1[aZ].id,a3,aZ,a0);}}function aP(a0,aZ){am(0,a0,aZ);}function aW(aZ){s("-- DO lcPlayCollection "+JSON.stringify(aZ));var a0=aZ.collectionId;ai.load("collection",{collectionId:a0}).then(function(){aP("collection",a0);});}function af(a1,a0,aZ){s("-- DO lcPlayArtist ("+a1+","+a0+","+aZ+")");ai.load("artist",{artistId:a1}).then(function(){if(a0){a(+a0,"artist",a1);}else{am(aZ||0,"artist",a1);}});}function K(a1,a0,aZ){s("-- DO lcPlayAlbum ("+JSON.stringify(a1)+","+a0+","+aZ+")");var a2=a1.albumId;ai.load("album",{albumId:a2}).then(function(){if(a0){a(+a0,"album",a2);}else{am(aZ||0,"album",a2);}});}function y(aZ){s("-- DO lcPlayPlaylist ("+JSON.stringify(aZ)+")");var a0=aZ.id;ai.load("personalpl",{pid:a0}).then(function(){aP("personalpl",a0);});}function az(a2,a3,a1,a0){s("-- DO lcPlayPortalPlaylist ("+a2+","+a3+","+a1+","+a0+")");var aZ;if(a1==="musicGifts"){aZ="gifts";}else{if(a0==="messaging"){aZ=a0;}else{f("lcPlayPortalPlaylist_"+a1);aZ="unknown";}}ai.load("custom",{ids:a2,pid:a1,plid:aZ,location:a0}).then(function(){a(+a3,"custom",a1);});}function m(aZ){s("-- DO lcPlaySimilarTracksForArtist "+aZ);ai.load("similarTracksForArtist",{artistId:aZ}).then(function(){aP("similarTracksForArtist",aZ);});}function aT(a0,aZ){s("-- DO lcPlayTrack ("+JSON.stringify(a0)+","+aZ+")");if("m_sec_add_tracks_to_ppl"===aZ){var a1=+a0.songId;ai.load("formaddpl",{tid:a1}).then(function(){a(a1,"formaddpl",a1);});}else{f("lcPlayTrack_"+aZ);}}function ak(){s("-- DO lcResume");aM.resume();}function aC(){s("-- DO lcPause");aM.pause();}function n(){s("-- DO lcStop");aM.pause();}function aF(aZ){s("-- DO lcNewVolumeLevel ("+aZ+")");aM.setVolume(aZ);}function ae(aZ){s("-- DO lcPostStatus ("+JSON.stringify(aZ)+")");var a0=aZ.songId;d.request("postStatus","songId="+a0).then(function(a1){from1x1("lcStatusPosted",{posted:a1.status});});}function i(a0,a4,aZ){s("-- DO moveTrack ("+a0+","+a4+","+aZ+")");var a2=(a0?"personalpl_"+a0:"my"),a1=ai.getTracks(a2),a3,a5;if(a1){if(aZ>=a1.length){aZ=a1.length-1;}d.request("reorder","tid="+a4+"&pos="+aZ+(a0?"&pid="+a0:"")).then(function(){a5=a1.findIndex(function(a6){return a4===a6.id;});a3=a1.splice(a5,1);a1.splice(aZ,0,a3[0]);a5=0;a1.forEach(function(a6){a6.songNum=a5;a5+=1;});from1x1("lcPlaylistReordered",JSON.parse(JSON.stringify(ai.getPlaylist(a2))));});}}function l(a3,aZ,a1,a7,a0){s("-- DO renameTrack ("+a3+","+aZ+","+a1+","+a7+","+a0+")");var a5=(1!==a3?"personalpl_"+a3:"my"),a6=ai.getPlaylist(a5),a4,a2;if(a6){d.request("edit","tid="+aZ+"&tit="+encodeURIComponent(a7)+"&art="+encodeURIComponent(a1)+"&alb="+encodeURIComponent(a0)+(1!==a3?"&pid="+a3:"")).then(function(a8){a4=a6.playlistObj.content.tracks;if(a4){a2=a4.findIndex(function(a9){return aZ===a9.id;});if(a2>-1){a4[a2].name=a7;a4[a2].ensemble=a1;a4[a2].id=a8.edited.id;a4[a2].albumId=a8.edited.albumId;if(a4[a2].fileName){delete a4[a2].fileName;}}}a4=a6.playlistObj.content.albums;if(!a4){a4=a6.playlistObj.content.albums=[];}a2=a4.findIndex(function(a9){return a8.edited.albumId===a9.id;});if(a2===-1){a4.push({});a2=a4.length-1;}a4[a2].id=a8.edited.albumId;a4[a2].name=a0;from1x1("lcTrackRenamed",JSON.parse(JSON.stringify(a6)));});}}function aS(a1,a0,a2,aZ){s("-- DO lcCreateNewPlaylist ("+a1+","+a0+","+a2+","+aZ+")");d.request("playlistsAdd","publicPlaylist=true&name="+a1+(a2?"&tid="+a2:"")).then(function(a3){a3.sourceCreating=aZ;from1x1("lcPlaylistAdded",a3);});}function J(aZ){s("-- DO lcAddPlaylist ("+aZ+")");d.request("playlistsAdd","pid="+aZ).then(function(a0){from1x1("lcPlaylistAdded",a0);});}function p(a0){s("-- DO lcRemovePlaylist ("+a0+")");var aZ="personalpl_"+a0;if(aZ===aM.getPlaylist()){aM.pause();B.publish("mf_stop",{});}d.request("playlistsRemove","pid="+a0).then(function(a1){from1x1("lcPlaylistRemoved",a1);});}function e(a0,aZ){s("-- DO lcRenamePlaylist ("+a0+","+aZ+")");d.request("playlistsSet","pid="+a0+"&name="+aZ).then(function(a1){from1x1("lcPlaylistRenamed",a1);});}function O(a3,aZ,a2,a1,a0){s("-- DO lcUpdatePlaylist ("+a3+","+aZ+","+a2+","+a1+","+a0+")");e(a3,aZ);if(a2){aL(a3,a2,0,a1,null);}}P={isReadyToUploadNextFile:f("isReadyToUploadNextFile"),lcAddItemToPlaylist:aL,lcAddPlaylist:J,lcAddSong:z,lcAskInit:aH,lcCheckIfFlashInited:aB,lcCheckPaymentStatus:v,lcCheckTrackIsBought:t,lcCreateNewPlaylist:aS,lcDelSong:N,lcDownload:C,lcGetFriends:aE,lcLoadAlbum:ag,lcLoadArtist:ao,lcLoadCollection:Y,lcLoadCollections:D,lcLoadCustomPlaylist:f("lcLoadCustomPlaylist"),lcLoadDownloaded:j,lcLoadFeatured:U,lcLoadFeedPlaylist:aK,lcLoadFriendList:aG,lcLoadFriendPlaylist:f("lcLoadFriendPlaylist"),lcLoadMediatopicPlaylist:f("lcLoadMediatopicPlaylist"),lcLoadMyHistory:f("lcLoadMyHistory"),lcLoadMyMusic:at,lcLoadMyRadio:aj,lcLoadMyTuners:aY,lcLoadPortalPlaylist:f("lcLoadPortalPlaylist"),lcLoadTops:f("lcLoadTops"),lcNewVolumeLevel:aF,lcNext:f("lcNext"),lcPause:aC,lcPlay:f("lcPlay"),lcPlayAlbum:K,lcPlayArtist:af,lcPlayCollection:aW,lcPlayFeedPlaylist:E,lcPlaylistContent:av,lcPlaylistItemClicked:ab,lcPlaylistItemClickedFromPartlet:f("lcPlaylistItemClickedFromPartlet"),lcPlayMediatopic:r,lcPlayPlaylist:y,lcPlayPortalPlaylist:az,lcPlaySimilarTracksForArtist:m,lcPlayStatus:aO,lcPlayTrack:aT,lcPostStatus:ae,lcPrev:f("lcPrev"),lcRelevantAlbums:Q,lcRelevantArtists:b,lcRelevantPlaylists:S,lcRelevantTracks:q,lcReloadUserPlaylists:an,lcRemoveItemInPlaylist:aI,lcRemovePlaylist:p,lcRenamePlaylist:e,lcRepeat:f("lcRepeat"),lcRequestAdditionalAlbums:L,lcRequestAdditionalArtists:A,lcRequestAdditionalTracks:o,lcRestoreItemToPlaylist:G,lcRestoreSong:F,lcResume:ak,lcSearchRequest:c,lcShuffle:f("lcShuffle"),lcStop:n,lcTimelineNewLevel:f("lcTimelineNewLevel"),lcUpdatePlaylist:O,lcUpdateURLPathes:aB,loadPlaylist:R,moveTrack:i,proxyRequest:aq,removePlaylistFromCache:al,renameTrack:l,uploadFile:f("uploadFile")};s("OK/music/flash loaded");window[ap]=function(){if(OK.flash.useNative){return P;}if(!aw){aw=document.getElementById("_music_player");}return aw;};function aa(a5){if(!aV){aV={start:aQ(),done:null,subscribers:[],notify:function(){this.done=aQ();this.subscribers.forEach(function(a6){a6();});}};var a4=function(){if(OK.flash.musicFlashExist){s(aQ()+"--- Flash ready ---");aV.notify();}else{if(aQ()-aV.start>aN){s(aQ()+"--- No Flash ---");I.success("musicusage","mfstub","show");OK.flash.useNative=true;aV.notify();}else{try{window[ap]().lcCheckIfFlashInited();}catch(a6){}setTimeout(a4,aA);}}},a0=x.uid(),aZ=false,a1,a3;if((a0%256)<=g){aZ=false;}else{s(aQ()+"--- Check native support ---");try{a1=new Audio("");if(!!(a1.canPlayType)){aZ=("no"!=a1.canPlayType("audio/mpeg"))&&(""!=a1.canPlayType("audio/mpeg"));}}catch(a2){aZ=false;}if(!aZ){I.success("musicusage","flash","nonative");}s(aQ()+"--- Native support = "+aZ);}if(!aZ){s(aQ()+"--- Starting Flash initializer ---");I.success("musicusage","flash","try");a3=document.getElementById("_music_flash_container");if(a3&&a3.childElementCount===0){s(aQ()+"--- Stream Flash ---");a3.innerHTML='<object id="_music_player" width="1" height="1" type="application/x-shockwave-flash" data="//st.mycdn.me/static/musicplayer/2-3-15/player1x1.swf"><param name="allownetworking" value="all"><param name="bgcolor" value="#FFF"><param name="allowScriptAccess" value="always"><param name="loop" value="false"><param name="scale" value="noScale"><param name="wmode" value="transparent"><param name="menu" value="false"><param name="flashvars" value="aATS=10&aE=false&aMTS=4&serverURL='+V+'&aMSA=60&aLTO=true&encodeJSON=false"></object>';}setTimeout(a4,aA);}else{s(aQ()+"--- Force Native ---");I.success("musicusage","flash","reject");OK.flash.useNative=true;aV.notify();}}if(a5){if(aV.done){a5();}else{aV.subscribers.push(a5);}}if(aX.config().pts){require(["PTS/data-pane.music"],function(a6){});}}function h(a1,aZ){var a0=(aZ?"personalpl_"+aZ:"my"),a2="start=0&count="+a1;if(aZ){a2+="&pid="+aZ;}d.request("my",a2).then(function(a4){var a7=ai.getPlaylist(a0),a6=a7.playlistObj.content,a3=a6.tracks,a5=a4.tracks||[],a8;if(!a3){a3=a6.tracks=[];}else{if(a3.length){a8=a5.findIndex(function(a9){return a3[0].id===a9.id;});if(a8!==-1){a5.splice(a8,Number.MAX_VALUE);}}}for(a8=0;a8<a5.length;a8+=1){a3.splice(a8,0,a5[a8]);}a7.playlistObj.content.images=a4.images;["albums","artists"].forEach(function(a9){if(a4[a9]){if(!a6[a9]){a6[a9]=[];}Array.prototype.push.apply(a6[a9],a4[a9]);}});a6.totalTracks=a4.totalTracks||0;from1x1("lcPlaylistItemAdded",JSON.parse(JSON.stringify(a7)));});}return{setRadioPosition:function(aZ){w=aZ;},upPlaylist:h,activate:aa};});define("text!t/music/historyList.dot",[],function(){return'<div class="mus_history">\n    <div class="m_c_s_header">\n        <div class="m_c_s_headerWrapper">\n            <div class="m_c_s_header_title">{{=it.l10n.m_sec_history}}</div>\n        </div>\n    </div>\n    {{? it.stub }}\n    <div class="layer mml_popup mus_stub">\n        <div class="layer_hld">\n            <div class="layer_cnt">\n                <div class="portlet_h">{{=it.l10n.m_stub_history_title}}</div>\n                <div class="mb-4x">\n                     <span>{{=it.l10n.m_stub_history_text1}}</span>\n                     <span class="mus_stub_play"></span>\n                     <span>{{=it.l10n.m_stub_history_text2}}</span>\n                </div>\n            <div class="mus_stub_empty-history"></div>\n        </div>\n    </div>\n    {{??}}\n    <div class="m_c_s_scrollable mus-custom-scrolling">\n        <div class="mus_history_cnt">\n        </div>\n    </div>\n    {{?}}\n</div>';});define("t/music/historyList",["doT","text!t/music/historyList.dot"],function(a,b){return a.template(b);});define("text!t/music/historyItems.dot",[],function(){return'{{? it.history}}\n    {{~it.history :item}}\n    {{? item.fmt_timestamp}}\n    <div class="mus_timestamp">\n        <div class="mus_timestamp_cnt">\n            <div class="mus_timestamp_tx">\n            {{=item.fmt_timestamp}}\n            </div>\n        </div>\n    </div>\n    {{?}}\n    {{? item.track }}\n    <div class="mus-tr_i __has-video{{? item.active}} __active{{?}} soh-s{{? item.track.fileName }} __filename{{?}}{{? item.track.playRestricted }} __disabled{{?}}"\n        {{? item.track.playRestricted || item.track.copyrightDbg }}title="\n        {{? item.track.playRestricted}}{{=it.l10n.m_copy_right_error_key}}{{?}} {{!item.track.copyrightDbg}}\n        "{{?}}\n        id="tri_m_sec_history_{{=item.position}}"\n        data-query=\'{"trackId":{{=item.track.id}},"pos":{{=item.position}}{{? item.track.musicVideoId }},"vid":{{=item.track.musicVideoId}}{{?}}}\'>\n        {{# def.track }}\n        {{? item.track.musicVideoId }}\n        <div class="mus-tr_video" onmouseover="odklMusic.showVideoPopup(\'tri_m_sec_history_{{=item.position}}\')" onmouseleave="odklMusic.removeVideoLabel(\'tri_m_sec_history_{{=item.position}}\')"\n            data-handler="video" data-id="{{=item.track.musicVideoId}}">\n            <div class="mml_dropdown_w">\n                <div class="mml_dropdown"></div>\n                <div class="mml_dropdown_video-ic" data-handler="video" data-id="{{=item.track.musicVideoId}}"></div>\n            </div>\n        </div>\n        {{?}}\n        {{? item.track.giftPrice }}\n            <span class="mus-tr_present" data-handler="present" data-id="{{=item.track.id}}" title="{{=it.l10n.m_present_track}}"></span>\n        {{?}}\n    </div>\n    {{?}}\n    {{~}}\n{{?}}';});define("t/music/historyItems",["doT","text!t/music/track.dot","text!t/music/historyItems.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("OK/music/history",["OK/logger","t/music/historyList","t/music/historyItems","PTS/data-pane.music","OK/utils/dom","OK/music/bus","OK/music/model"],function(H,z,v,T,b,m,e){var D="mus-tr_i",t="mus-tr_play",A="__active",V="history",C=24*60*60*1000,g=300,G=145,k=99,a,J,s,E,u,U=new Date().getTimezoneOffset()*60*1000,o=0,O=0,q,M;function K(Z){var Y=Z-U;Y-=Y%C;return Y+U;}function p(aa){var Y=Math.floor(aa/60),Z=Math.floor(aa%60);return Y+":"+(Z<10?"0":"")+Z;}function X(ad){var aa=new Date(ad),Z=aa.getDate(),ac=1+aa.getMonth(),ab=aa.getFullYear(),Y="";if(Z<10){Y+="0";}Y+=Z+".";if(ac<10){Y+="0";}Y+=ac+"."+ab;return Y;}function r(Z){var Y={};if(Z){Z.forEach(function(aa){Y[aa.id]=aa;});}return Y;}function y(aa){if(!aa){return aa;}var Y={},Z;for(Z in aa){if(aa.hasOwnProperty(Z)){Y[Z]=aa[Z];}}return Y;}function S(aa,Y){var Z=e.trackData().track;if(Z){return Z.playlistType===V&&Z.songObj.id===aa&&Z.songNum===Y;}return false;}function W(ae){var ad=ae.playlistObj.content,aa=r(ad.tracks),Z=r(ad.albums),ab=r(ad.friends),Y=K(Date.now()),ac=Y-C;q=ad.chunk?ad.chunk.more:false;if(!ad.history){return null;}return ad.history.map(function(ai){var ag=y(aa[ai.id]),af={},ah=K(ai.added);if(ag){af.track=ag;af.position=O;O+=1;af.active=S(ag.id,af.position);if(af.active){af.isPlaying=e.trackData().isPlaying;}if(o!==ah){if(ah===Y){af.fmt_timestamp=u.today;}else{if(ah===ac){af.fmt_timestamp=u.yesterday;}else{af.fmt_timestamp=X(ah);}}o=ah;}if(ag.albumId){af.album=Z[ag.albumId];}if(ag.uid){af.friend=ab[ag.uid];}af.fmt_duration=p(ag.duration||0);}return af;});}function d(Y){s.insertAdjacentHTML("beforeend",v({l10n:T,section:"history",history:W(Y)}));}function L(){if(E){J.removeChild(E);E=null;}}function x(){return J.scrollHeight-J.scrollTop<J.clientHeight*1.2;}function l(){if(q&&!M&&x()){L();M=true;E=document.createElement("div");E.className="mus_loading_scroll";J.appendChild(E);e.loadMore();}}function B(Y){var Z=Y.target,aa=Z.getAttribute("data-handler");if(aa){require(["OK/music/act/"+aa],function(ab){ab.handle(Z);});}}function c(){return Math.max(g,document.documentElement.clientHeight-G)-k;}function R(){J.style.height=c()+"px";}function j(Y){if(V===Y.playlist.type){L();M=false;d(Y.playlist);}}function N(ab){var Z=J.scrollTop,Y=J.clientHeight,aa=ab.offsetTop,ac=ab.clientHeight;if(Z>aa){J.scrollTop=aa;}else{if(Z+Y<aa+ac){J.scrollTop=aa+ac-Y;}}}function Q(aa,Y){var Z=b.firstByClass(aa,t);if(Z){Z.classList.toggle("__pause",Y);Z.classList.toggle("__play",!Y);}}function f(Y){if(Y&&Y.playlistType===V){var Z=b.byClass(J,D),aa=Y.songNum;if(aa<Z.length){return Z[aa];}}}function P(Z){var Y=f(e.trackData().track);if(Y){Q(Y,Z.isPlaying);}}function i(Y,Z){if(Y.playlistType===V){var aa=b.byClass(J,D),ab,ac=Y.songNum;if(ac<aa.length){ab=aa[ac];ab.classList.toggle(A,Z);Q(ab,Z);if(Z){N(ab);}}}}function I(Y){if(Y.prev){i(Y.prev,false);}i(Y.now,true);}function w(Z){var Y=f(Z.track);if(Y){Y.classList.remove(A);Q(Y,false);}}function h(aa,Y){var Z=b.firstByClass(aa,t);if(Z){Z.classList.toggle("__buffering",Y);}}function F(Z){var Y=f(e.trackData().track);if(Y){h(Y,Z.active);}}function n(Z,Y,aa){u=Y;var ab=!aa.playlistObj.content.history;Z.innerHTML=z({l10n:T,stub:ab});if(ab){return;}J=b.firstByClass(Z,"m_c_s_scrollable");s=b.firstByClass(J,"mus_history_cnt");O=o=0;d(aa);R();J.addEventListener("scroll",l);s.addEventListener("click",B);if(!a){a=true;window.addEventListener("resize",R);m.subscribe("mf_lcAdditionalTracksRequested",j);m.subscribe("mf_lcSetPlayerState",P);m.subscribe("mf_lcNewSongStarted",I);m.subscribe("mf_stop",w);m.subscribe("mf_lcBuffering",F);}}return{activate:n};});define("text!t/music/importDialog.dot",[],function(){return'<div class="layer_cnt mus_import">\n    {{? it.imp.error }}\n    <div class="portlet_h">{{=it.l10n.m_import_error_header}}</div>\n    <div class="mus_import_info">{{=it.l10n.m_import_error_info}}</div>\n    {{??}}\n    <div class="portlet_h">{{=it.l10n.m_import_header}}</div>\n    <div class="mus_import_info">{{=it.l10n.m_import_info}}</div>\n    <div class="mus_import_cnt mus-custom-scrolling">\n        {{? it.imp.playlists && it.imp.playlists.length }}\n            {{~it.imp.playlists :item}}\n            <div class="mus_card_i selectable-card" data-payload="{{=item.payload}}" data-count="{{=item.tracksCount}}">\n                <!-- selectable-card __selected    -->\n                <div class="mus_card">\n                    <div class="col-card">\n                        <span class="selectable-card_ic"></span>\n                        <div class="mus_card_img_w mus_card_img_w__col">\n                            {{? item.imageUrl }}\n                            <img src="{{=item.imageUrl}}" class="mus_card_img">\n                            {{?}}\n                        </div>\n                    </div>\n                    <div class="mus_card_n_w">\n                        <div class="mus_card_n textWrap">\n                            <span class="mus_card_n_a" title="{{!item.title}}">{{!item.title}}</span>\n                        </div>\n                        <div class="mus_card_n_artist ellip">\n                            {{? item.tracksCount}}\n                                {{ var msgKey = \'m_user_tracks_\' + OK.util.plurals(item.tracksCount); }}\n                                {{=item.tracksCount}} {{=it.l10n[msgKey]}} <!-- X track(s) -->\n                            {{??}}\n                                {{=it.l10n.m_user_tracks_0}} <!-- no tracks -->\n                            {{?}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            {{~}}\n        {{??}}\n        <div class="mus_import_empty-stub">\n            {{=it.l10n.m_import_empty}}\n        </div>\n        {{?}}\n    </div>\n    <div class="form-actions">\n        <div class="irc_l mb-2x">\n            <span class="input_w">\n                <input id="musicImportAll" type="checkbox" class="irc" />\n            </span>\n            <label for="musicImportAll">\n                {{=it.l10n.m_import_selectAll}}\n            </label>\n        </div>\n        <span class="vl_btn __disabled">{{=it.l10n.m_import_proceed}}</span>\n        <span class="vl_a-sw ml-4x curPointer">{{= it.l10nCmn.Cancel }}</span>\n    </div>\n    {{?}}\n    <div class="layer_close ic ic_close"></div>\n</div>\n';});define("t/music/importDialog",["doT","text!t/music/importDialog.dot"],function(a,b){return a.template(b);});define("OK/NewsFetchCoordinator",["OK/logger","OK/cookie"],function(J,Q){var ab="/push?cmd=PeriodicManager&gwt.requested="+window.pageCtx.gwtHash,aG="p_sId",b="p_NLP",D="<!--SP-->",f="<!--SSP-->",aF=0,F=1,H=2,Z="TZD",aC="TZ",at="TD",e=30,ae={responseText:"",open:function(){},setRequestHeader:function(){},send:function(){},abort:function(){},getResponseHeader:function(){}},ao={pos:0,size:0,adaptive:0,tmzOffset:0,sum:0,values:[],updateDiff:function(aL){var aK=new Date(),aJ;var aM=aK.getTime()-aL;this.tmzOffset=-aK.getTimezoneOffset();this.values[this.pos++]=aM;this.pos%=20;this.sum+=aM;if(this.size<20){this.size++;}else{this.sum-=this.values[this.pos];}aJ=~~(this.sum/this.size);if(this.adaptive!==aJ){this.adaptive=aJ;return true;}return false;},getTimeZoneHh:function(){var aJ=~~(this.tmzOffset/e);if(aJ<-24||aJ>28){J.error("NFCI_TZ");}return aJ;},getTimeDiff:function(){if(isNaN(this.adaptive)){J.error("NFCI_TD");}return this.adaptive;}},G=100,o=5000,ad=0,a=0,w=false,aw=2097152,y=2,d=[],u=0,an=150000,s=180000,E=180000,k=0,ak=60000,p=180000,av={},aj=[],X=null,aq=null,aE=null,R=false,al=ae,au=0,am=0,I=aF,i=0,n=0,ay=0,U=0,aH="",C=0,r="LP",m,Y,A,L,B,aD=false,x=false,j=function(){try{return new window.XMLHttpRequest();}catch(aK){J.success("push","xhr");try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(aJ){J.error("NFCI_AXO");return ae;}}},g=function(aJ){if(aJ>=1000){aJ=1000;}else{if(aJ>=500){aJ=500;}else{if(aJ>=100){aJ=100;}else{if(aJ>=50){aJ=50;}else{if(aJ>=10){aJ=10;}}}}}return aJ;},ar=function(aJ){try{if(ao.updateDiff(aJ)){var aK=ao.getTimeZoneHh(),aM=ao.getTimeDiff();Q.setCookie(Z,aK+"."+aM,0,"/");if(x){Q.setCookie(aC,aK,0,"/");Q.setCookie(at,aM,0,"/");}}}catch(aL){J.error("NFCI_AST");}},V=function(){var aJ="",aK;for(aK in av){if(av.hasOwnProperty(aK)){aJ+=aK+"="+av[aK]+"&";}}aJ+="blocks="+aj.join(",")+"&";return aJ+b+"="+a;},af=function(){return aG+"="+ad;},aA=function(){if(R||!ax()){q(o);}},M=function(){if(r==="SSE"){var aK=Date.now();var aJ=I===aF?ak:p;if(aK-aJ<au){p=aB();aE=setTimeout(M,p);return;}if(I===aF){N("Restore connection");J.success("push","restoresse");}if(aD||!S(al.responseText||"")){l("heartbeat-sse-"+aH+n);J.success("push","chunks",n+"_"+g(ay));J.success("push","chunks-all",n+"_"+g(U));if(++n>=y){r="LP";am=aK;}ai(G);}else{aD=true;X=setTimeout(t,0);aE=setTimeout(M,E);J.success("push","check");}}else{R=false;ad=0;l("heartbeat-lp");c(G);}},q=function(aJ){clearTimeout(aq);aq=setTimeout(aA,aJ);},t=function(){if(I!==aF){if(al.readyState===3){ag();}X=setTimeout(t,1000);}},c=function(aJ){G=aJ;q(G);},az=function(){clearTimeout(aq);aq=null;clearTimeout(aE);aE=null;R=false;if(I!==aF){l("stop-sse");}K();},ai=function(aJ){R=false;if(aq){q(aJ);}},aB=function(){return r==="SSE"?(ad==0?s:E):an;},ax=function(){try{N("send");if(r==="LP"&&k>0&&U>2&&w&&Date.now()-am>k){C++;J.success("push","recovery",C+"-"+g(U));aD=false;n=0;ad=0;r="SSE";}var aJ=r==="SSE";if(m){if(m()){return false;}}else{J.error("NFCI_ER","foe-udf");}clearTimeout(aE);p=aB();aE=setTimeout(M,p);R=true;if(Y){P(aJ);}else{J.error("NFCI_ER","prc-udf");ai(o);}}catch(aK){R=false;J.error("NFCI_ER","trc");return false;}return true;},P=function(aJ){al=j();al.open("POST",ab+(aJ?"&sse=true":"")+"&"+af(),true);al.setRequestHeader("Content-Type","application/x-www-form-urlencoded");al.setRequestHeader("Cache-Control","no-cache");al.setRequestHeader("TKN",OK.tkn.get());if(aJ){al.onreadystatechange=al.onprogress=ag;i=0;ay=0;I=F;}else{al.onreadystatechange=ah;}al.send(V());if(aJ&&aD){clearTimeout(X);X=setTimeout(t,0);}},ah=function(){if(al.readyState!==4){return;}if(al.status===200){if(O(al.getResponseHeader("Redirect-Location"))){J.success("push","redirect");ai(o);return;}z(al);ai(G);}else{J.success("push","status",""+al.status);ai(o);}},z=function(aL){var aJ=OK.lss&&OK.lss.isMaster(),aK=""+[aJ?OK.lss.getId():"",aL.responseText,aL.getResponseHeader("Rendered-Blocks"),aL.getResponseHeader("TKN")].join(D);if(aJ){T(aK);}Y(aK,false);},ag=function(){if(al.readyState<3){return;}if(I===F){if(al.status===200){if(O(al.getResponseHeader("Redirect-Location"))){l("redirect-sse");ai(o);return;}I=H;}else{l("status-sse-"+al.status);ai(o);}}else{if(I===H){switch(al.readyState){case 3:S(al.responseText||"");break;case 4:var aJ=G;if(al.status===0){aJ=o;}else{if(!S(al.responseText||"")&&al.getResponseHeader("Rendered-Blocks")){z(al);}}I=aF;ai(aJ);break;}}}},S=function(aM){var aN,aL,aJ,aK=false;while(~(aN=aM.indexOf(f,i))){aL=aM.substring(i,aN);if(aL){aJ=OK.lss&&OK.lss.isMaster();aL=""+[aJ?OK.lss.getId():"",aL].join(D);if(aJ){T(aL);}Y(aL,false);}i=aN+f.length;au=Date.now();aK=true;if(ay<1000){ay++;}if(U<1000){U++;}n=0;}if(i>aw){J.success("push","overflow");}return aK;},T=function(aM){try{localStorage.setItem("firePushContent",aM);}catch(aN){if(A){A();}else{J.error("NFCI_ER","dop-udf");}try{var aP=aN.message||"";var aJ=aM.length,aR="pushData";for(var aQ in localStorage){if(localStorage.hasOwnProperty(aQ)){var aL=localStorage.getItem(aQ).length;aP+="\n"+aQ+"="+aL;if(aL>aJ){aJ=aL;aR=aQ;}}}var aK=aJ;if(aK>3000000){aK=3000000;}else{if(aK>2000000){aK=2000000;}else{if(aK>1000000){aK=1000000;}else{if(aK>500000){aK=500000;}else{if(aK>100000){aK=100000;}else{if(aK>10000){aK=10000;}else{aK=1000;}}}}}}J.clob("push",aP,"NFCI_LSIS_"+aR,""+aK);}catch(aO){J.clob("push",aO.stack,"NFCI_LSISE");}}},l=function(aJ){if(r==="SSE"){I=aF;ad=0;}al.abort();J.success("push","abort",aJ);},O=function(aJ){if(aJ){if(OK.navigation.redirect){OK.navigation.redirect(aJ);}else{document.location.href=decodeURIComponent(aJ);}return true;}return false;},v=0,ap=0,W=0,h=null,aa=function(){var aJ=Date.now();if(v!=0&&aJ-v>ap){if(aE){clearTimeout(aE);aE=setTimeout(M,100);N("wakeup");}}if(v!=0&&!aE&&r==="SSE"){if(aJ-p>au){if(!m||!m()){J.success("push","noconnection");}}}v=aJ;},aI=function(aJ,aK){if(aJ>0&&OK.lss&&OK.lss.isMaster()){if(aJ!=W||!h){K();h=setInterval(aa,aJ);}}else{K();}W=aJ;ap=aK;},K=function(){if(h){clearInterval(h);h=null;}},ac=function(){var aJ=Q.readCookie("dme");return(aJ&&("true"===aJ.toLowerCase()))||document.getElementById("__gwtd__m");},N=function(aJ){if(ac()&&console){console.log(new Date(),aJ);}};return{isMaster:function(){return OK.lss&&OK.lss.isMaster();},getClientServerTimeDiff:function(){return ao.adaptive;},getCurrentServerTime:function(){return Date.now()-this.getClientServerTimeDiff();},updateParam:function(aJ,aK){av[aJ]=aK;},addBlock:function(aJ){aj.push(aJ);if(L){L();}for(var aK=0;aK<d.length;aK++){if(aJ===d[aK]){return;}}if(r==="SSE"){l("upd-block-"+aJ);ai(G);}},removeBlock:function(aK){var aJ=aj.indexOf(aK);if(aJ>-1){aj.splice(aJ,1);}},setConfiguration:function(aJ){var aM,aL;ad=aJ[aG]||ad;a=aJ[b]||a;an=aJ.p_LPR||150000;G=aJ.fetchTime||100;o=aJ.p_DFF||5000;aw=aJ.p_PSB||2097152;E=aJ.p_SRT||180000;s=aJ.p_SFRRT||180000;k=aJ.p_SLPT||0;y=aJ.p_SMF||2;ak=aJ.p_SWT||60000;x=aJ.sTZDc===true;d=(aJ.cBlocks||"").split(",");p=aB();aM=aJ.p_PSE===true;if(w!==aM){n=0;au=0;if(w&&I!==aF){az();r="LP";c(G);}w=aM;r=w?"SSE":"LP";}if(aJ.serverTime){ar(aJ.serverTime);}aL=aJ.p_CES||0;if(aL!==u){u=aL;B(u);}aI(aJ.p_WDI||0,aJ.p_WDTL||120000);var aK=aJ.params;if(aK){var aN;for(aN in aK){if(aK.hasOwnProperty(aN)){av[aN]=aK[aN];}}}},init:function(aK,aN,aL,aJ,aM){m=aK;Y=aN;A=aL;L=aJ;B=aM;aD=false;},getStateParamString:af,scheduleFetch:function(){ad=0;c(G);aI(W,ap);},stopScheduling:az};});define("OK/music/import",["module","OK/logger","t/music/importDialog","PTS/data-pane.music","PTS/gwt.resources.common","OK/NewsFetchCoordinator","OK/utils/dom","OK/utils/delegate","OK/music/garbage","OK/music/wmf"],function(e,r,i,F,C,g,a,A,m,s){var G="hidden",t="__selected",v="__disabled",z="mus_card_i",n="data-count",b=e.config().oauth||"https://oauth.vk.com/authorize?scope=audio&client_id=5456066",p=e.config().redirectPath||"/web-api/socialAuth",H=e.config().redirectParam||"redirect_uri",x=e.config().authParam||"authCode",w=e.config().authParam||"socialAuthCallback",u,I,f,J,L;function d(){window[w]=undefined;}function B(){return H+"="+encodeURIComponent(document.location.origin+p);}function k(){return new Promise(function(P,O){var N,M=b+"&"+B();window[w]=function(Q,R){if(R===N){d();if(!Q.error){P(Q.code);}O(new Error(Q.error));}};N=window.open(M,"","width=700, height=700");});}function y(){if(f){f.off();}if(I){a.remove(I);}if(u){u.classList.add(G);}}function D(P){if(J.classList.contains(v)){return;}var N=a.byClass(I,z),M=[],O="payloads=";N.forEach(function(Q){if(Q.classList.contains(t)&&Q.getAttribute(n)){M.push(Q.getAttribute("data-payload"));}});if(M.length){y();O+=encodeURIComponent(M.join(","));O+="&statusId="+P;s.request("importExternalPlaylists",O).then(function(Q){from1x1("lcPlaylistAdded",Q);});}}function E(N,O){if(!O.getAttribute(n)){return;}O.classList.toggle(t);var M=a.byClass(I,t);J.classList.toggle(v,M.length===0);}function K(O,P){var N=a.byClass(I,z),M=false;N.forEach(function(Q){if(Q.getAttribute(n)){M=P.checked;Q.classList.toggle(t,M);}});J.classList.toggle(v,!M);}function q(M){if(u){I=document.createElement("div");I.classList.add("layer_hld");I.innerHTML=i({imp:M,l10n:F,l10nCmn:C});u.appendChild(I);OK.Layers.register("musicImport",y);f=new A(I);f.on("click","."+z,E).on("change","input",K);J=a.firstByClass(I,"vl_btn");if(J){J.addEventListener("click",function(){D(M.statusId);});}L=a.firstByClass(I,"vl_a-sw");if(L){L.addEventListener("click",y);}u.classList.remove(G);}}function j(M){var N=["socialProvider=VK",B()];if(M){N.push(x+"="+encodeURIComponent(M));}return s.request("getExternalPlaylists",N.join("&"));}function o(){r.success("musicusage","importjs","start");k().then(j).then(q).then(null,function(M){r.success("musicerror","importjs",M);});}function h(N){var M=document.getElementById("mmpcw");if(M){u=a.firstByClass(M,"mml_popup");}N.addEventListener("click",o);}function c(){d();}function l(M){m.getImpl().then(function(N){N.lcReloadUserPlaylists();});}g.addBlock("MIP");return{activate:h,deactivate:c,setNewContent:l};});define("OK/utils/throttle",[],function(){
/*!
     * jQuery throttle / debounce - v1.1 - 3/7/2010
     * http://benalman.com/projects/jquery-throttle-debounce-plugin/
     *
     * Copyright (c) 2010 "Cowboy" Ben Alman
     * Dual licensed under the MIT and GPL licenses.
     * http://benalman.com/about/license/
     */
return function a(c,d,h,g){var f,b=0;if(typeof d!=="boolean"){g=h;h=d;d=undefined;}return function e(){var m=this,k=Date.now()-b,l=arguments;function j(){b=Date.now();h.apply(m,l);}function i(){f=undefined;}if(g&&!f){j();}if(f){clearTimeout(f);}if(g===undefined&&k>c){j();}else{if(d!==true){f=setTimeout(g?i:j,g===undefined?c-k:c);}}};};});define("OK/Carousel",["jquery","OK/utils/throttle"],function(c,i){var j="slideShown",d="animate-left",a="hidden",e={aniSpeed:750,interval:0,moveLength:780,showSlidesCount:1,loop:false,activeSlide:0},f={};function g(l,m){this.$element=c("#"+l);this.options=c.extend(true,{},e,m);this.$prevBtn=this.$element.find(".slider_ctrl.__prev");this.$nextBtn=this.$element.find(".slider_ctrl.__next");this._timeout=null;this.$slides=this.$element.find(".slider_i");this.options.activeSlide=Math.max(this.options.activeSlide,0);var o=this.$slides.length;this.activeSlide=Math.min(this.options.activeSlide,Math.max(0,o-this.options.showSlidesCount));this._slideFunction=b.call(this);if(this.options.interval){this.$element.on({"mouseenter.ok.carousel":this.pause.bind(this),"mouseleave.ok.carousel":this.start.bind(this)});}var n=null;this.$prevBtn.add(this.$nextBtn).on("click.ok.carousel",function(p){n=p.clientX+"x"+p.clientY;});this.$element.on("click.ok.carousel",".slider_i",function(p){if(p.clientX+"x"+p.clientY===n){p.stopImmediatePropagation();}else{n=null;}});this.$prevBtn.on("click.ok.carousel",this.prev.bind(this));this.$nextBtn.on("click.ok.carousel",this.next.bind(this));this.options.onSlideClick&&this.$element.on("click.ok.carousel",".slider_i",this.options.onSlideClick);this.options.onSlideShow&&this.$element.on(j+".ok.carousel",".slider_i",this.options.onSlideShow);this.$slides.on("webkitTransitionEnd.ok.carousel oTransitionEnd.ok.carousel msTransitionEnd.ok.carousel transitionend.ok.carousel",function(p){c(p.target).removeClass(d);}.bind(this));c(window).on({"blur.ok.carousel":this.pause.bind(this),"focus.ok.carousel":this.start.bind(this)});this._forceShowActiveSlide();this.$element.removeClass(a);this.start();}g.prototype._forceShowActiveSlide=function(){var p=this.$slides.length,m=this.$slides.eq(this.activeSlide),l=Math.min(this.options.showSlidesCount,p);m.siblings().addClass(a);for(var o=0;o<l;o++){var n=(this.activeSlide+o)%p;this.$slides.eq(n).css({left:this.options.moveLength*o}).removeClass(a);}if(!this.options.loop){if(this.activeSlide<=0){this.$prevBtn.hide();}else{this.$prevBtn.show();}if(this.activeSlide>=p-this.options.showSlidesCount){this.$nextBtn.hide();}else{this.$nextBtn.show();}}m.trigger(j);};g.prototype.pause=function(){if(!this.options.interval){return;}this._timeout=clearTimeout(this._timeout);};g.prototype.start=function(){if(this._timeout||!this.options.interval){return;}this._timeout=setTimeout(function l(){if(this._timeout){this.next();this._timeout=setTimeout(l.bind(this),this.options.interval);}}.bind(this),this.options.interval);};g.prototype.getSlide=function(l){var m=this.$slides.length;l=(l+m)%m;return this.$slides.eq(l);};g.prototype.next=function(){this._slideFunction("next");};g.prototype.prev=function(){this._slideFunction("prev");};g.prototype.select=function(l){var o=this.$slides.length,m=o-this.options.showSlidesCount,n=(l+o)%o;if(n>m){this.activeSlide=m;}else{if(n>0&&o>this.options.showSlidesCount){this.activeSlide=n-1;}else{this.activeSlide=n;}}this._forceShowActiveSlide();};g.prototype.destroy=function(){clearTimeout(this._timeout);this.$element.off(".ok.carousel");this.$prevBtn.off(".ok.carousel");this.$nextBtn.off(".ok.carousel");this.$slides.off(".ok.carousel");c(window).off(".ok.carousel");};function b(){var o=this.$slides,p=o.length,m=this.options,l,n;return i(m.aniSpeed,true,function(r){if(r=="prev"){var q=(this.activeSlide-1+p)%p;o.eq(q).css({left:-m.moveLength}).width();setTimeout(function(){for(n=0;n<=m.showSlidesCount;n++){l=(this.activeSlide+n)%p;o.eq(l).addClass(d).removeClass(a).css({left:m.moveLength*n});}}.bind(this),0);if(!m.loop&&p>m.showSlidesCount){this.$nextBtn.show();if(!q){this.$prevBtn.hide();}}o.eq(q).trigger(j);this.activeSlide=q;}else{var s=(this.activeSlide+m.showSlidesCount)%p;o.eq(s).css({left:m.moveLength*m.showSlidesCount}).width();setTimeout(function(){for(n=-1;n<m.showSlidesCount;n++){l=(this.activeSlide+n+p)%p;o.eq(l).addClass(d).removeClass(a).css({left:m.moveLength*n});}}.bind(this),0);if(!m.loop&&p>m.showSlidesCount){this.$prevBtn.show();if(s+1===p){this.$nextBtn.hide();}}o.eq(s).trigger(j);this.activeSlide=(this.activeSlide+1)%p;}}.bind(this));}function k(l,m){var n=f[l];if(!n){f[l]=n=new g(l,m);}return n;}function h(l){var m=f[l];if(m){m.destroy();delete f[l];}}return{init:k,destroy:h};});define("OK/music/musicSlider",["OK/Carousel"],function(c){function a(d){c.init(d.id,{interval:Number(d.getAttribute("data-interval"))*1000||0,loop:true});}function b(d){c.destroy(d.id);}return{activate:a,deactivate:b};});define("text!t/music/portletLayoutWide.dot",[],function(){return'{{? !it.withTracks && !it.withPlaylists }}\n<div class="stub-empty __music">\n    <div class="stub-empty_img"></div>\n    <div class="stub-empty_t">{{=it.l10n.m_no_music}}</div>\n</div>\n{{??}}\n<div class="l-wrapper">\n    <div class="l-sidebar">\n        <div class="portlet">\n            <div class="nav-side">\n                {{? it.cover }}\n                <div class="nav-side_i __l" data-pid="">\n                    <div class="ucard-v __xxs __h __middle">\n                        <div class="section">\n                            <div class="photo">\n                                <img src="{{! it.cover }}" class="photo_img" />\n                            </div>\n                        </div>\n                        <div class="caption">\n                            <div class="ellip" title="{{=it.l10n.m_all_tracks}}">\n                                {{=it.l10n.m_all_tracks}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                {{?}}\n                {{? it.playlists && it.playlists.length }}\n                {{~it.playlists :item}}\n                <div class="nav-side_i __l" data-pid="{{=item.id}}">\n                    <div class="ucard-v __xxs __h __middle">\n                        <div class="section">\n                            <div class="photo">\n                                <img src="{{! it.getPlaylistCover(item)}}" class="photo_img" />\n                            </div>\n                        </div>\n                        <div class="caption">\n                            <div class="mb-x ellip" {{? item.name}}title="{{! item.name }}"{{?}}>\n                                {{? item.name }}\n                                    {{! item.name }}\n                                {{?}}\n                            </div>\n                            <div class="fs-12 lstp-t">\n                                {{? item.count }}\n                                    {{= item.count}} {{= it.l10n[item.countKey]}}\n                                {{?}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                {{~}}\n                {{?}}\n            </div>\n        </div>\n    </div>\n    <div class="l-main">\n    </div>\n</div>\n{{?}}';});define("t/music/portletLayoutWide",["doT","text!t/music/portletLayoutWide.dot"],function(a,b){return a.template(b);});define("text!t/music/portletContentWide.dot",[],function(){return'{{? it.withTracks }}\n<div class="portlet mus_album">\n    <div class="mus_album_i__absolute">\n        <div class="mus_album_i_w">\n            <div class="mus_album_side_w">\n                <div class="mus_album_side mus_album_side__c">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n                <div class="mus_album_side mus_album_side__a">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n                <div class="mus_album_side mus_album_side__b">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n            </div>\n        </div>\n        <div class="lp mt-x"></div>\n    </div>\n    <div class="mus-tr_lst">\n    </div>\n</div>\n{{?}}\n{{? it.withPlaylists }}\n<div class="portlet">\n    <div class="portlet_h">{{=it.l10n.m_sec_comp}}</div>\n    <div class="mus_album-list">\n        {{~it.playlists :item}}\n        <div class="mus_card_i">\n            <div class="mus_card" data-pid="{{=item.id}}">\n                <div class="col-card">\n                    <div class="mus_card_img_w mus_card_img_w__col">\n                        {{? item.images && item.images.imageUrl }}\n                        <img src="{{! item.images.imageUrl }}" class="mus_card_img"></img>\n                        {{?}}\n                    </div>\n                </div>\n                <div class="mus_card_n_w">\n                    {{? item.name }}\n                    <div class="mus_card_n textWrap">\n                        <span class="mus_card_n_a" title="{{! item.name }}">{{! item.name }}</span>\n                    </div>\n                    {{?}}\n                </div>\n            </div>\n        </div>\n        {{~}}\n    </div>\n</div>\n{{?}}\n';});define("t/music/portletContentWide",["doT","text!t/music/portletContentWide.dot"],function(a,b){return a.template(b);});define("text!t/music/portletCollectionWide.dot",[],function(){return'<div class="portlet mus_album mus_subinfo __actions">\n    {{? it.playlist }}\n    <div class="mus_album_i__absolute">\n        <div class="mus_album_i_w">\n            <div class="mus_card_img_w">\n                {{? it.playlist.images && it.playlist.images.imageUrl }}\n                <img src="{{! it.playlist.images.imageUrl }}" class="mus_card_img"></img>\n                {{?}}\n            </div>\n        </div>\n        <div class="m_c_col-data">\n            {{? it.playlist.playCount }}\n            <div class="m_c_col-data_counter">\n                <span class="m_c_col-data_amount">{{=it.playlist.playCount}}</span>\n                &nbsp;\n                <span class="m_c_col-data_tx">{{=it.l10n[it.playlist.countKey]}}</span>\n            </div>\n            {{?}}\n            <div class="m_c_col-data_ac">\n                {{? it.playlist.added}}\n                <a class="mus-dl m_c_col-data_ac_i m_hidden">\n                    <i class="m_c_col-data_add"></i>\n                    <span></span>\n                </a>\n                {{??}}\n                <a class="mus-dl m_c_col-data_ac_i">\n                    <i class="m_c_col-data_add"></i>\n                    <span>{{=it.l10n.subscribe_to_ppl}}</span>\n                </a>\n                {{?}}\n            </div>\n        </div>\n    </div>\n    <div class="mus_h2 mb-x">\n        <div class="m_ppl_title">{{! it.playlist.name }}</div>\n    </div>\n    {{?}}\n    <div class="mus-tr_lst">\n    </div>\n</div>\n\n';});define("t/music/portletCollectionWide",["doT","text!t/music/track.dot","text!t/music/portletCollectionWide.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("text!t/music/portletItems.dot",[],function(){return'{{? it.tracks }}\n    {{~it.tracks :item}}\n    {{? item.track }}\n    <div class="mus-tr_i {{? item.active}} __active{{?}} soh-s{{? item.track.fileName }} __filename{{?}}{{? item.track.playRestricted }} __disabled{{?}}"\n        {{? item.track.playRestricted || item.track.copyrightDbg }}title="\n        {{? item.track.playRestricted}}{{=it.l10n.m_copy_right_error_key}}{{?}} {{!item.track.copyrightDbg}}\n        "{{?}}>\n        {{# def.track }}\n    </div>\n    {{?}}\n    {{~}}\n    {{? it.limited }}\n        <div class="mt-2x">\n            <span class="lp">{{=it.l10n.m_track_request_more}}</span>\n        </div>\n    {{?}}\n{{?}}\n';});define("t/music/portletItems",["doT","text!t/music/track.dot","text!t/music/portletItems.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("OK/music/portletWide",["OK/logger","t/music/portletLayoutWide","t/music/portletContentWide","t/music/portletCollectionWide","t/music/portletItems","PTS/data-pane.music","OK/utils/dom","OK/utils/delegate","OK/music/bus","OK/music/model"],function(z,T,s,Z,ak,aw,q,al,v,p){var E="mus-tr_i",C="mus-tr_play",n="__active",f="__success",U="m_hidden",az="mus_album_side_w__animated",ae="mus_album_side_w__turnback",ab="mus_album_side_w__turn",Q="/res/i/music/stub/n/stub_artist.png",ao="friend",am="personalpl",ac,aa,I,t,M,L,K,k,m,aA,x,ag=60,X,A,ad=0,a,y,F,ah,av,aq,Y,R;function at(aD){var aB=Math.floor(aD/60),aC=Math.floor(aD%60);return aB+":"+(aC<10?"0":"")+aC;}function aj(aC){var aB={};if(aC){aC.forEach(function(aD){aB[aD.id]=aD;});}return aB;}function r(aD){if(!aD){return aD;}var aB={},aC;for(aC in aD){if(aD.hasOwnProperty(aC)){aB[aC]=aD[aC];}}return aB;}function g(aD){var aB=p.trackData().track,aC=av?am:ao;if(aB){return aB.playlistType===aC&&aB.songObj.id===aD;}return false;}function S(aB){if(aB.playlistObj){aB=aB.playlistObj.content;}return aB.tracks&&aB.tracks.length;}function an(aB){if(aB.playlistObj){aB=aB.playlistObj.content;}return aB.playlists&&aB.playlists.length;}function w(aE){if(aE.playlistObj){aE=aE.playlistObj.content;}var aC=aj(aE.tracks),aB=aj(aE.albums),aD=aj(aE.friends);y=aE.chunk?(aE.chunk.more||false):false;if(!aE.tracks){return null;}return aE.tracks.map(function(aH){var aG=r(aC[aH.id]),aF={};if(aG){if(!X){X=aG;}aF.track=aG;aF.position=ad;ad+=1;aF.active=g(aG.id);if(aF.active){aF.isPlaying=p.trackData().isPlaying;}if(aG.albumId){aF.album=aB[aG.albumId];}if(aG.uid){aF.friend=aD[aG.uid];}aF.fmt_duration=at(aG.duration||0);}return aF;});}function u(aC){if(aC.playlistObj){aC=aC.playlistObj.content;}if(!aC.tracks||!aC.tracks.length){return null;}var aB=aC.tracks[0];return aB.imageUrl||Q;}function i(aB){if(aB.images&&aB.images.imageUrl){return aB.images.imageUrl;}return Q;}function e(aB){aA.insertAdjacentHTML("beforeend",ak({l10n:aw,section:av?am:ao,pid:av||ah,tracks:w(aB),limited:false}));}function o(aC){var aB=p.trackData().track;if(aB){return aB.playlistType==="personalpl"&&aB.paramsObj.id==aC;}return false;}function D(aB){if(!aB){aB=p.playlists();if(!aB){return false;}}return aB.findIndex(function(aC){return""+aC.id===av;})!==-1;}function ap(aB,aC){if(aB.playlistObj){aB=aB.playlistObj.content;}return{name:aB.name,images:aB.images,added:D(),playCount:aB.playCount||0,countKey:"_playcount"+OK.util.plurals(aB.playCount||0)};}function d(aB,aC){if(aB.playlistObj){aB=aB.playlistObj.content;}if(!aB.playlists){return null;}return aB.playlists.map(function(aE){var aD=r(aE);aD.active=o(aE.id);aD.added=D(aC);aD.countKey="m_user_tracks_"+OK.util.plurals(aE.count||0);return aD;});}function c(){if(x){q.remove(x);x=null;}}function l(){return window.pageYOffset>aA.offsetHeight-document.documentElement.clientHeight*1.2;}function ar(){if(y&&!F&&l()){c();F=true;x=document.createElement("div");x.className="mus_loading_scroll";aA.appendChild(x);p.loadMore(av?am:ao,ad,{pid:av||ah});}}function N(aC){var aB=av?am:ao,aD=av||ah;if(aB===aC.playlist.type&&aC.playlist.paramsObj.pid===aD){c();F=false;e(aC.playlist);}}function P(aB){var aC=aB.target,aD=aC.getAttribute("data-handler");if(aD){if(aC.getAttribute("data-open")){odklMusic.openMusic();}require(["OK/music/act/"+aD],function(aE){aE.handle(aC);});}}function V(aB){if(av){return;}A=aB;var aD=aB.imageUrl||Q,aC=aB.ensemble||"";k.innerText=aC;L.src=aD;t.classList.add(az);t.classList.add(ab);setTimeout(function(){M.src=aD;t.classList.remove(az,ae,ab);},500);}function j(aD,aB){var aC=q.firstByClass(aD,C);if(aC){aC.classList.toggle("__pause",aB);aC.classList.toggle("__play",!aB);}}function O(aB){if(aB){if(av){return aB.playlistType===am&&aB.paramsObj.id===av;}return aB.playlistType===ao&&aB.paramsObj.friendId===ah;}return false;}function af(aB,aC){if(O(aB)){var aD=q.byClass(aa,E),aE,aF=aB.songNum;if(aF<aD.length){aE=aD[aF];aE.classList.toggle(n,aC);j(aE,aC);}return true;}return false;}function au(aB){if(aB.prev){af(aB.prev,false);}if(af(aB.now,true)){V(aB.now.songObj);}}function H(aB){if(af(aB.track,false)){V(X);}}function ax(aC){var aB=p.trackData().track;af(aB,aC.isPlaying);}function B(){window.scrollTo(window.pageXOffset,ag);}function ay(){return new Promise(function(aE,aD){var aC=0,aB=function(){var aF=window.__getMusicFlash;if(aF){aE(aF());}else{aC+=1;if(aC<=50){setTimeout(aB,500);}else{aD(new Error("Timeout expired"));}}};aB();});}function G(){q.byClass(aa,"nav-side_i").forEach(function(aB){aB.classList.toggle("__ac",aB.getAttribute("data-pid")===av);});}function h(){G();X=A=null;ad=0;var aB=ay().then(function(aC){return aC.lcPlaylistContent(ah,av);});Promise.all([Y,aB]).then(function(aC){var aE=aC[0],aD=aC[1];I.innerHTML=Z({l10n:aw,playlist:ap(aD,aE)});aA=q.firstByClass(I,"mus-tr_lst");e(aD);m=q.firstByClass(I,"m_c_col-data_ac_i");m.addEventListener("click",function(){p.addCollection(av);});});B();}function b(){G();X=A=null;ad=0;Promise.all([Y,R]).then(function(aB){var aD=aB[0],aC=aB[1];I.innerHTML=s({l10n:aw,withTracks:S(aC),withPlaylists:an(aC),playlists:d(aC,aD)});if(S(aC)){t=q.firstByClass(I,"mus_album_side_w");M=q.firstByClass(t,"mus_album_side__a").firstElementChild;L=q.firstByClass(t,"mus_album_side__b").firstElementChild;K=q.firstByClass(t,"mus_album_side__c").firstElementChild;k=q.firstByClass(I,"lp");k.addEventListener("click",function(){odklMusic.openMusic();var aE=A.masterArtistId;if(aE>0){p.artist(aE);}else{p.search(A.ensemble);}});aA=q.firstByClass(I,"mus-tr_lst");e(aC);if(X){V(X);}}});B();}function ai(aB){return new Promise(function(aC){Promise.all([Y,R]).then(function(aD){var aF=aD[0],aE=aD[1];aB.innerHTML=T({l10n:aw,withTracks:S(aE),withPlaylists:an(aE),cover:u(aE),playlists:d(aE,aF),getPlaylistCover:i});I=q.firstByClass(aB,"l-main");aC(S(aE)||an(aE));});});}function W(aC,aD){var aE=aD.getAttribute("data-pid"),aB=aq+"/music";if(aD.classList.contains("mus_card")&&!aE){return;}if(av!==aE){av=aE;I.innerHTML=a;if(av){h();aB+="/playlist/"+av;}else{b();}OK.historyManager.pushState(aB);}}function J(aB){ag=window.pageYOffset;aa=aB;a=aB.innerHTML;y=false;F=false;ah=aB.getAttribute("data-uid");av=aB.getAttribute("data-pid");aq=aB.getAttribute("data-alias")||("/profile/"+ah);if(p.playlists()){Y=Promise.resolve(p.playlists());}else{Y=ay().then(function(aC){return aC.lcReloadUserPlaylists();}).then(function(aC){return Promise.resolve(aC.playlists);});}R=ay().then(function(aC){return aC.lcLoadFriendList(ah);});ai(aB).then(function(aC){if(av){h();}else{if(aC){b();}}});aa.addEventListener("click",P);new al(aa).on("click",".nav-side_i",W).on("click",".mus_card",W);if(!ac){ac=true;v.subscribe("mf_lcAdditionalTracksRequested",N);v.subscribe("mf_lcSetPlayerState",ax);v.subscribe("mf_lcNewSongStarted",au);v.subscribe("mf_stop",H);v.subscribe("m_updateMyPlaylists",function(aE){if(av&&m){var aD=D(aE.playlists),aC=m.getElementsByTagName("span")[0];m.classList.toggle(f,aD);aC.textContent=aD?aw.subscribed_to_ppl:aw.subscribe_to_ppl;if(!aD){m.classList.remove(U);}}});window.addEventListener("scroll",ar);}}return{activate:J};});define("text!t/music/radioList.dot",[],function(){return'<div class="m_c_s_myRadio">\n    <div class="mus_radio_w">\n        <div class="mus_radio">\n            <div class="mus_radio_noise">\n                <div class="mus_radio_dec">\n                    <div class="mus_radio_top-grad"></div>\n                    <div class="mus_radio_bot-grad"></div>\n                    <div class="mus_radio_active-track"></div>\n                </div>\n                <div class="mus_album_frame usel-off">\n                    <div class="mus_album_i_w">\n                        <div class="mus_album_side_w curPointer">\n                            <div class="mus_album_side mus_album_side__c">\n                                <img class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                            </div>\n                            <div class="mus_album_side mus_album_side__a">\n                                <img class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                            </div>\n                            <div class="mus_album_side mus_album_side__b">\n                                <img class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                            </div>\n                        </div>\n                        <div class="mus_album_i_play"></div>\n                    </div>\n                </div>\n                <div class="mus_album">\n                    <div class="mus_radio_tracks">\n                        <div class="mus-tr_lst"></div>\n                    </div>\n                </div>\n                {{? it.promo }}\n                <div class="radio_wlcm">\n                    <div class="radio_wlcm_dec">\n                        <div class="mus_album_frame usel-off">\n                            <div class="mus_album_i_w">\n                                <div class="radio_wlcm_cover">\n                                    <div class="mus_album_i_play"></div>\n                                    {{=it.l10n.radio_promo_pl}}\n                                </div>\n                            </div>\n                        </div>\n                        <div class="radio_wlcm_msg">{{=it.l10n.radio_promo}}</div>\n                    </div>\n                </div>\n                {{?}}\n            </div>\n        </div>\n        <div class="mus_radio_stations_w usel-off">\n            <div class="mus_radio_stations_top-fader"></div>\n            <div class="mus_radio_stations mus-custom-scrolling">\n                <div class="mus_h2">\n                    <span>{{=it.l10n.stat_ttl}}</span>\n                </div>\n                <div class="mus_radio_stations_lst"></div>\n            </div>\n        </div>\n    </div>\n</div>';});define("t/music/radioList",["doT","text!t/music/radioList.dot"],function(a,b){return a.template(b);});define("text!t/music/radioItems.dot",[],function(){return'{{? it.radio}}\n    {{~it.radio :item}}\n    {{? item.track }}\n    <div class="mus-tr_i{{? item.active}} __active{{?}} soh-s{{? item.track.fileName }} __filename{{?}}{{? item.track.playRestricted }} __disabled{{?}}"\n        {{? item.track.playRestricted || item.track.copyrightDbg }}title="\n        {{? item.track.playRestricted}}{{=it.l10n.m_copy_right_error_key}}{{?}} {{!item.track.copyrightDbg}}\n        "{{?}}\n        {{? it.opacity !== 1 }}style="opacity: {{=it.opacity}}"{{?}}>\n        {{# def.track }}\n    </div>\n    {{?}}\n    {{~}}\n{{?}}';});define("t/music/radioItems",["doT","text!t/music/track.dot","text!t/music/radioItems.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("text!t/music/radioStations.dot",[],function(){return'{{? it.tuners}}\n    {{~it.tuners :item}}\n    {{? item.name }}\n    <div class="mus_radio_stations_i {{? item.active }}__active{{?}}" data-tune="{{!item.data}}">\n        <div class="mus_radio_stations_i_b">\n            <div class="mus_radio_station_h ellip">{{!item.name}}</div>\n            <div class="mus_radio_station_d_w">\n                <div class="mus_radio_station_d ellip">{{!item.artists}}</div>\n                <div class="mus_radio_station_d_l">{{=it.l10n.air_load}}</div>\n            </div>\n        </div>\n    </div>\n    {{?}}\n    {{~}}\n{{?}}';});define("t/music/radioStations",["doT","text!t/music/radioStations.dot"],function(a,b){return a.template(b);});define("OK/music/radio",["OK/logger","t/music/radioList","t/music/radioItems","t/music/radioStations","PTS/data-pane.music","PTS/gwt.resources.common","OK/utils/dom","OK/utils/utils","OK/utils/delegate","OK/music/bus","OK/music/model","OK/music/player","OK/music/flash"],function(F,u,aj,g,av,W,w,M,am,B,v,ap,D){var K="mus-tr_i",H="mus-tr_play",s="__active",ay="mus_album_side_w__animated",ae="mus_album_side_w__turnback",ab="mus_album_side_w__turn",V="/res/i/music/stub/stub_artist@2x.png",N="mus_album_i_play",t="mus_album_i_play__pause",P="mus_radio_stations_i",p="myRadio",c=30,z=3,ac,aa,G,A,T,S,R,n,x,X,e,az,ag,ad=0,J=0,l={},I,k=false,r=false,ar=false,E,q=1;function at(aC){var aA=Math.floor(aC/60),aB=Math.floor(aC%60);return aA+":"+(aB<10?"0":"")+aB;}function ah(aB){var aA={};if(aB){aB.forEach(function(aC){aA[aC.id]=aC;});}return aA;}function j(aA,aB){if(!aB||J===aA){return;}var aD=-(aA*c),aE=aA<J,aC=aB.imageUrl||V;J=aA;l=aB;D.setRadioPosition(J);x.style.top=aD+"px";if(aE){R.src=aC;}else{S.src=aC;}A.classList.add(ay);A.classList.add(aE?ae:ab);setTimeout(function(){T.src=aC;A.classList.remove(ay,ae,ab);},500);}function y(aC){if(!aC){return aC;}var aA={},aB;for(aB in aC){if(aC.hasOwnProperty(aB)){aA[aB]=aC[aB];}}return aA;}function d(aC,aA){var aB=v.trackData().track;if(aB){return aB.playlistType===p&&aB.songObj.id===aC&&aB.songNum===aA;}return false;}function f(aD){var aC=aD.playlistObj.content,aA=ah(aC.albums),aB=ah(aC.friends);return aC.tracks.filter(function(aE,aF){return aF>=ad;}).map(function(aG){var aF=y(aG),aE={track:aF};aE.position=ad;ad+=1;aE.active=d(aF.id,aE.position);if(aE.active){aE.isPlaying=v.trackData().isPlaying;}if(aF.albumId){aE.album=aA[aF.albumId];}if(aF.uid){aE.friend=aB[aF.uid];}aE.fmt_duration=at(aF.duration||0);return aE;});}function b(aB){var aA=f(aB);X.insertAdjacentHTML("beforeend",aj({l10n:av,section:"myRadio",opacity:q,radio:aA}));if(aA.length){I=aA[0];}else{I=null;}}function Z(aB){function aA(aD){var aC;if(aD){aC=aD.map(function(aE){return aE.name;}).join(", ");}aC+=" "+W.andOthers;return aC;}if(!aB.tuners){return;}return aB.tuners.map(function(aD,aE){var aC={};if(aD){aC.data=aD.data;if(aD.name){aC.name=aD.name;aC.artists=aA(aD.artists);}else{if(aD.artists&&aD.artists.length){aC.name=aD.artists[0].name;aC.artists=aA(aD.artists.slice(1));}}if(aE===0&&!e){aC.active=true;}}return aC;});}function m(aA){if(ag.childElementCount){return;}ag.insertAdjacentHTML("beforeend",g({l10n:av,tuners:Z(aA)}));}function o(){var aA=Math.floor(G.clientHeight/c)-z+1;return J>=ad-aA;}function a(){if(!r&&o()){r=true;var aA=w.firstByClass(ag,s).getAttribute("data-tune");v.loadMore(p,0,{tuners:aA});}}function an(){return Math.max(223,document.documentElement.clientHeight-222);}function ax(aB){var aC=160,aA=aB*0.4;while(aC+c<aA){aC+=c;}return aC;}function C(){var aA=an(),aB=ax(aA);aa.style.height=aA+"px";G.style.height=aB+"px";az.style.top=aB+"px";a();}function U(aA){var aB=aA.target,aC=aB.getAttribute("data-handler");if(aC){require(["OK/music/act/"+aC],function(aD){aD.handle(aB);});}}function i(aC,aA){var aB=w.firstByClass(aC,H);if(aB){aB.classList.toggle("__pause",aA);aB.classList.toggle("__play",!aA);}}function af(aA,aB){if(aA&&aA.playlistType===p){var aC=w.byClass(x,K),aD,aE=aA.songNum;if(aE<aC.length){aD=aC[aE];i(aD,aB);if(aB){j(aE,aA.songObj);}aD.classList.toggle(s,aE===J);}n.classList.toggle(t,aB);}}function au(aA){af(aA.now,true);af(aA.prev,false);a();}function L(aA){af(aA.track,false);}function aw(aB){var aA=v.trackData().track;af(aA,aB.isPlaying);}function aq(aB){var aA=z,aC=v.trackData().track;if(aC&&aC.playlistType===p){aA=aC.songNum;}return Math.min(aA,aB);}function al(){var aA=w.byClass(X,K);if(aA){aA.slice(J+1).forEach(function(aB){w.remove(aB);});}}function Y(){var aA=w.byClass(X,K);if(aA){aA.slice(J+1).forEach(function(aB){aB.style.opacity=q;});}}function ai(){q+=0.04;if(q>1){q=1;}Y();if(q<1){setTimeout(ai,10);}else{if(ar){if(n.classList.contains(t)){ap.next();}else{if(I){ap.play(I.track.id,p,I.position);}}}}}function Q(){if(E){al();q=0;ad=J+1;b(E);ai();E=null;}}function h(){q-=0.04;if(q<0){q=0;}Y();if(q>0){setTimeout(h,10);}else{Q();}}function ak(aA,aB){E=aA;ar=aB;if(!aB||q===0){Q();}}function ao(aA){w.byClass(ag,P).forEach(function(aB){aB.classList.remove(s);});aA.classList.add(s);if(e&&!e.classList.contains("radio_wlcm__hide")){e.classList.add("radio_wlcm__hide");setTimeout(function(){e.style.display="none";},1000);M.ajax({url:"/dk",data:{cmd:"SetMusicFlagRBlock",uon:"RADIO_DESCRIPTION_ALREADY_SEEN",uov:true}});}F.success("musicusage","clkTuner","true");}function O(aE,aG,aH,aD){aE.innerHTML=u({l10n:av,promo:aD});aa=w.firstByClass(aE,"mus_radio_w");G=w.firstByClass(aa,"mus_radio");A=w.firstByClass(G,"mus_album_side_w");T=w.firstByClass(A,"mus_album_side__a").firstElementChild;S=w.firstByClass(A,"mus_album_side__b").firstElementChild;R=w.firstByClass(A,"mus_album_side__c").firstElementChild;n=w.firstByClass(G,N);x=w.firstByClass(G,"mus_album");X=w.firstByClass(x,"mus-tr_lst");e=w.firstByClass(G,"radio_wlcm");az=w.firstByClass(aa,"mus_radio_stations_w");ag=w.firstByClass(az,"mus_radio_stations_lst");ad=J=0;l={};q=1;E=null;m(aH);b(aG);var aB=aG.playlistObj.content.tracks,aA=aB?aB.length:0,aC=0,aF;if(aA){aC=aq(aA-1);aF=aB[aC];}j(aC,aF);C();n.addEventListener("click",function(){if(n.classList.contains(t)){ap.pause();}else{ap.play(l.id,p,J);}});x.addEventListener("click",U);if(e){w.firstByClass(e,N).addEventListener("click",function(){var aI=w.firstByClass(ag,P);ao(aI);ap.play(l.id,p,J);});}new am(ag).on("click","."+P,function(){ao(this);q=1;h();E=null;k=true;ap.tune([this.getAttribute("data-tune")]);});if(!ac){ac=true;window.addEventListener("resize",C);B.subscribe("mf_lcSetPlayerState",aw);B.subscribe("mf_lcNewSongStarted",au);B.subscribe("mf_stop",L);B.subscribe("mf_lcPlaylistLoaded",function(aI){if(aI&&aI.type===p){if(k){ak(aI,true);k=false;}else{if(r){ak(aI);r=false;}}}});}}return{activate:O};});define("text!t/music/playlist.dot",[],function(){return'<div class="mus_card_i">\n    <div class="mus_card{{? item.active}} mus_card__playing{{?}}{{? item.added}} mus_card__added{{?}}"\n        data-handler="playlist" data-id="{{=item.id}}" data-uid="{{=item.owner}}">\n        <div class="col-card">\n            <div class="mus_card_img_w mus_card_img_w__col">\n                {{? item.images && item.images.imageUrl }}\n                <img src="{{! item.images.imageUrl }}" class="mus_card_img"></img>\n                {{?}}\n                <div class="mus_card_ac_lst">\n                    <span class="mus_card_ac_i mus_card_ac_i__pl" data-handler="playPlaylist" data-id="{{=item.id}}" data-uid="{{=item.owner}}">\n                        <span class="mus_card_play"></span>{{=it.l10n.alb_mn_play}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__ps" data-handler="pauseCollection" data-id="{{=item.id}}">\n                        <span class="mus_card_play __pause"></span>{{=it.l10n.alb_mn_pause}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__add" data-handler="addCollection" data-id="{{=item.id}}">\n                        <span class="mus_card_add"></span>{{=it.l10nCmn._add}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__success">\n                        <span class="mus_card_add __added"></span>{{=it.l10n.alb_mn_success}}\n                    </span>\n                    <span class="mus_card_ac_i mus_card_ac_i__more" data-handler="playlist" data-id="{{=item.id}}" data-uid="{{=item.owner}}">\n                        <span class="mus_card_more"></span>{{=it.l10nCmn._more}}\n                    </span>\n                </div>\n            </div>\n        </div>\n        <div class="mus_card_n_w">\n            {{? item.name }}\n            <div class="mus_card_n textWrap">\n                <span class="mus_card_n_a" title="{{! item.name }}">{{! item.name }}</span>\n            </div>\n            {{?}}\n        </div>\n    </div>\n</div>';});define("text!t/music/searchPlaylists.dot",[],function(){return"{{? it.playlists && it.playlists.length }}\n    {{~it.playlists :item}}\n    {{# def.playlist }}\n    {{~}}\n{{?}}\n";});define("t/music/searchPlaylists",["doT","text!t/music/playlist.dot","text!t/music/searchPlaylists.dot"],function(a,c,b){return a.template(b,undefined,{playlist:c});});define("OK/music/searchPlaylists",["OK/logger","t/music/searchPlaylists","PTS/data-pane.music","PTS/gwt.resources.common","OK/utils/dom","OK/music/bus","OK/music/model"],function(B,r,e,p,w,s,f){var u="mus_card",i="mus_card__playing",l,o,y,k,A=0,j,b,d;function z(E){if(!E){return E;}var C={},D;for(D in E){if(E.hasOwnProperty(D)){C[D]=E[D];}}return C;}function v(D){var C=f.trackData().track;if(C){return"personalpl"===C.playlistType&&C.paramsObj.id==D;}return false;}function q(E){var D=E.playlistObj.content,C=f.playlists();j=decodeURIComponent(E.paramsObj.query);d=false;b=D.chunk?D.chunk.more:false;if(!D.playlists){return null;}return D.playlists.map(function(G){var F=z(G);A+=1;F.active=v(G.id);F.added=C.findIndex(function(H){return H.id===G.id;})!==-1;return F;});}function x(C){y.insertAdjacentHTML("beforeend",r({l10n:e,l10nCmn:p,playlists:q(C)}));}function n(){if(k){y.removeChild(k);k=null;}}function h(){return o.scrollHeight-o.scrollTop<o.clientHeight*1.2;}function m(){if(b&&!d&&h()){n();d=true;k=document.createElement("div");k.className="mus_loading_scroll";y.appendChild(k);f.loadMore("relevant",A,{pid:8,query:j,count:12});}}function g(D){var C=function(G){return G.getAttribute("data-handler");},E=D.target,F=C(E);if(!F){E=w.traverseParents(E,C,o);if(E){F=C(E);}}if(F){require(["OK/music/act/"+F],function(G){G.handle(E);});}}function a(C){if("relevant"===C.playlist.type){var D=C.playlist.paramsObj;if("playlists"===D.subType&&j===decodeURIComponent(D.query)){n();d=false;x(C.playlist);}}}function t(C){var D=false;w.byClass(o,u).forEach(function(E){D=C.isPlaying;if(D){D=v(E.getAttribute("data-id"));}E.classList.toggle(i,D);});}function c(C,D){A=0;C.innerHTML=r({l10n:e,l10nCmn:p,playlists:q(D)});y=C;o=w.parent(y,"m_c_s_scrollable");o.addEventListener("scroll",m);y.addEventListener("click",g);if(!l){l=true;s.subscribe("mf_lcAdditionalTracksRequested",a);s.subscribe("mf_lcSetPlayerState",t);}}return{activate:c};});define("OK/music/upload",["module","OK/logger","FileAPI","OK/utils/dom","OK/utils/md5","OK/music/sid","OK/music/flash"],function(a,w,c,s,d,e,k){var v="musicusage",l="musicerror",f="uploadjs",r="error.notloggedin",m="error.service.not.available",i=a.config().host,o=a.config().min||245760,p=a.config().max||100663296,g=a.config().chunk||1,t=a.config().retry||5;function q(){var y=new XMLHttpRequest(),x=new Promise(function(A,z){e.get().then(function(B){y.open("GET",i+"/api/v1/upload/init;jsessionid="+B+"?rnd="+performance.now());y.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");y.onload=function(){if(y.status===200){try{var E=JSON.parse(y.responseText),D=E.uploadId;if(D){A(D);}else{w.success(l,f,"init");z(new Error("NoUploadId"));}}catch(C){z(C);}}else{z(new Error(y.statusText));}};y.onerror=z;y.send();},z);});x.xhr=y;return x;}function u(y,x){return new Promise(function(A,z){var B=Date.now();Promise.all([e.get(),q()]).then(function(C){var D=C[0],E=C[1];c.upload({url:i+"/api/v1/upload/chunked;jsessionid="+D+"?uploadId="+E+(y?"&pid="+y:""),files:{audio:x},chunkSize:c.MB*g,chunkUploadRetry:t,fileupload:function(G,H,F){c.log('Start upload "'+G.name+'"');},filecomplete:function(H,K,G,F){var I=Date.now()-B,J="upload";if(H&&H!=="OK"){J+="_"+H;c.log('Upload "'+G.name+'" failed with '+H);z(new Error(H));}else{c.log('Upload "'+G.name+'" done');A(E);}w.duration(v,I,f,J);}});},z);});}function n(y){var z=new XMLHttpRequest(),x=new Promise(function(B,A){e.get().then(function(C){z.open("GET",i+"/api/v1/upload/status;jsessionid="+C+"?uploadIds="+y.join(","));z.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");z.onload=function(){if(z.status===200){try{var E=JSON.parse(z.responseText);B(E);}catch(D){A(D);}}else{A(new Error(z.statusText));}};z.onerror=A;z.send();},A);});x.xhr=z;return x;}function h(B,z,x,A){var y=(z+x)/A;from1x1("mp3UploadProgress",{progress:y,playlistId:B,filesLoaded:z,filesSkipped:x,filesTotal:A});return y;}function j(C,y){if(y){var F=y.length,A=0,E=0,x=[],G=function(){if(h(C,A,E,F)===1&&A>0){k.upPlaylist(A,C);}},H,D=0,I=function(J){var K;if(J){if(J.stack){w.clob("musicclob.error",J.stack,f,"checkStatus");}K=J.message;if(K===m){D=10;}else{if(K===r){e.reset();}}}D+=1;if(D<3){return true;}w.success(l,f,"checkStatus"+(K?"_"+K:""));return false;},z=function(){if(H&&H.xhr){H.xhr.abort();}H=n(x);H.then(function(J){if(J){x=x.filter(function(M){var L=J[M],K;if(L){K=L.status;if("ok_completed"===K){A+=1;w.success(v,f,"process");return false;}if("token_issued"===K){E+=1;w.success(l,f,"status_token");return false;}if("failure_completed"===K){E+=1;w.success(l,f,"status_"+L.errorReason);return false;}}return true;});if(x.length){setTimeout(z,500);}G();}},function(J){if(I(J)){setTimeout(z,500);}});},B=function(J){if(J){if(H&&H.xhr){H.xhr.abort();}x.push(J);}z();};if(F){G();y.forEach(function(K){var J=K.size;if(J<o){E+=1;w.success(v,f,"limit_min");G();return;}if(J>p){E+=1;w.success(v,f,"limit_max");G();return;}u(C,K).then(function(L){if(L){B(L);}else{w.success(l,f,"queue_null");E+=1;G();}},function(L){E+=1;G();});});}}}function b(x){var y=s.firstByClass(x,"vl_btn_it"),z=x.getAttribute("data-pid");c.event.on(y,"change",function(A){j(z,c.getFiles(A));});}return{activate:b};});define("OK/music/ntf/added",["OK/utils/dom","PTS/data-pane.music"],function(c,a){function b(f){var e=c.parent(f,"mus-tr_hld"),d=c.parent(f,"mus-tr_right-controls");e.classList.add("__pr-l");d.innerHTML='<span class="muc-tr_right-controls_tx"><span class="mus-tr_right-controls_message">'+a.m_track_added_to_my+"</span></span>";}return{handle:b};});define("OK/music/act/add",["OK/logger","OK/music/garbage","OK/music/model","OK/music/ntf/added"],function(b,d,a,c){function e(i){var j=i.getAttribute("data-id"),h=i.getAttribute("data-section"),f=i.getAttribute("data-ctx"),g;if(j){g=d.operation("add",+j,h);if(g){b.success("musicusage",g,h);}else{b.success("musicerror","track_source_error");}a.add(j,null,f);c.handle(i);}}return{handle:e};});define("OK/music/ntf/addedCollection",["OK/utils/dom"],function(b){function a(d){var c=b.parent(d,"mus_card");if(c){c.classList.add("mus_card__added");}}return{handle:a};});define("OK/music/act/addCollection",["OK/music/model","OK/music/ntf/addedCollection"],function(a,b){function c(d){var e=d.getAttribute("data-id");if(e){a.addCollection(e);b.handle(d);}}return{handle:c};});define("OK/music/act/album",["OK/music/model"],function(a){function c(d){var e=d.getAttribute("data-id");if(e){a.open("album",e);}}function b(d){d.addEventListener("click",function(e){odklMusic.openMusic();c(this);e.stopPropagation();});}return{activate:b,handle:c};});define("OK/music/act/artist",["OK/music/model"],function(a){function c(d){var e=d.getAttribute("data-id");if(e){a.artist(e);}}function b(d){d.addEventListener("click",function(e){odklMusic.openMusic();c(this);e.stopPropagation();});}return{activate:b,handle:c};});define("OK/music/act/collection",["OK/music/model"],function(a){function b(c){var d=c.getAttribute("data-id");if(d){a.collection(d);}}return{handle:b};});define("text!t/music/dropdown.dot",[],function(){return'<div class="mml_dropdown_w {{? it.up}}__up{{?}} __active">\n    <div class="mml_dropdown">\n        <ul class="mml_dropdown_lst">\n            {{? it.playlists && it.playlists.length }}\n                {{~it.playlists :item:ind}}\n                <li class="mml_dropdown_i">\n                    <a class="mml_dropdown_a mus-tr_a ellip" data-pid="{{=item.id}}">{{!item.name}}</a>\n                </li>\n                {{~}}\n            {{??}}\n                <div class="textWrap mml_dropdown_txt">{{=it.l10n.ppl_no_dd}}</div>\n            {{?}}\n            <li class="mml_dropdown_i">\n                <div class="mml_dropdown_f">\n                    <a class="mml_dropdown_f_a">\n                        <span class="ic12 __inline ic12_add-o"></span>\n                        <label class="mus-tr_il">{{=it.l10n.m_add_personal_pl}}</label>\n                    </a>\n                    <div class="m_add_ppl_input_cont">\n                        <div class="m_add_ppl_input_wrapper">\n                            <input class="m_add_ppl_input" maxlength="100">\n                            <div class="m_ppl_input_enter">\n                                <i class="tico_img m_enter_ppl_ico"></i>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</div>\n';});define("t/music/dropdown",["doT","text!t/music/dropdown.dot"],function(a,b){return a.template(b);});define("OK/music/act/dropdown",["OK/logger","OK/music/garbage","OK/music/model","OK/utils/dom","OK/music/ntf/added","PTS/data-pane.music","t/music/dropdown"],function(A,q,d,t,k,c,z){var v="__has-menu",s=155,b,f,m,y,e,l,i,j,a,h,p;function o(){if(j){clearTimeout(j);j=null;}if(f){f.classList.remove(v);f=null;}if(b){var B=b.parentNode;if(B){B.replaceChild(b.cloneNode(false),b);}b=null;}}function g(){k.handle(b);o();}function w(){var B=l.value.trim();if(B){d.createPlaylist(B,a);g();}else{e.style.borderColor="red";}}function r(B){b=B;a=b.getAttribute("data-id");p=b.getAttribute("data-ctx");h=b.getAttribute("data-section");m=t.firstByClass(b,"mml_dropdown_f");y=t.firstByClass(m,"mml_dropdown_f_a");e=t.firstByClass(m,"m_add_ppl_input_cont");l=t.firstByClass(m,"m_add_ppl_input");i=t.firstByClass(m,"m_ppl_input_enter");b.addEventListener("mouseover",function(){if(j){clearTimeout(j);j=null;}});b.addEventListener("mouseout",function(){j=setTimeout(o,2000);});b.addEventListener("click",function(E){var D=E.target.getAttribute("data-pid"),C;if(D){C=q.operation("add",+a,h);if(C){A.success("musicusage",C,h);}else{A.success("musicerror","track_source_error");}d.add(a,D,p);g();}E.stopPropagation();});y.addEventListener("click",function(){m.classList.add("mml_dropdown_f__active");l.focus();});l.addEventListener("keypress",function(C){if(C.key==="Enter"||C.keyCode===13){w();}else{e.style.borderColor="#000";}});i.addEventListener("click",w);}function u(){var D=t.parent(f,"m_c_s_scrollable"),C,B,E,F;if(D){C=D.scrollTop;B=D.clientHeight;E=f.offsetTop;F=f.clientHeight;if(C+B<E+F+s){return(E-C)>s;}}return false;}function n(C){var B=d.playlists();o();if(B){B=B.filter(function(D){return D.owner===d.uid();});}f=t.parent(C,"mus-tr_i");C.innerHTML=z({up:u(),playlists:B,l10n:c});f.classList.add(v);r(C);}function x(B){if(b===B){o();}else{n(B);}}return{handle:x};});define("OK/music/act/open",["OK/music/model"],function(a){function c(e){var f=e.getAttribute("data-id"),d=e.getAttribute("data-section");if(d&&f){a.open(d,f);}}function b(d){d.addEventListener("click",function(e){odklMusic.openMusic();c(this);e.stopPropagation();});}return{activate:b,handle:c};});define("OK/music/ntf/stopped",["OK/utils/dom"],function(b){function a(d){var c=b.parent(d,"mus_card");if(c){c.classList.remove("mus_card__playing");}}return{handle:a};});define("OK/music/act/pauseCollection",["OK/music/player","OK/music/ntf/stopped"],function(b,a){function c(d){var e=d.getAttribute("data-id");if(e){b.pause();a.handle(d);}}return{handle:c};});define("OK/music/act/play",["OK/logger","OK/music/garbage","OK/music/player"],function(a,c,b){function d(i){if(i.classList.contains("__disabled")){return;}if(i.classList.contains("__pause")){b.pause();}else{var j=i.getAttribute("data-id"),h=i.getAttribute("data-section"),e=i.getAttribute("data-pos"),g=i.getAttribute("data-pid"),f=c.operation("play",+j,h);if(f){a.success("musicusage",f,c.range(+e));}else{a.success("musicerror","track_source_error");}b.play(j,h,e,g);}}return{handle:d};});define("OK/music/act/playlist",["OK/music/model"],function(a){function b(d){var e=d.getAttribute("data-id"),c=d.getAttribute("data-uid");if(e){a.playlist(e,c);}}return{handle:b};});define("OK/music/act/playCollection",["OK/music/model","OK/music/player"],function(a,b){function c(e){var f=e.getAttribute("data-id"),d=a.trackData().track;if(f){a.collection(f);if(d&&d.playlistType==="collection"&&d.paramsObj.collectionId==f){b.resume();}else{a.playCollection(f);}}}return{handle:c};});define("OK/music/act/playPlaylist",["OK/music/model","OK/music/player"],function(a,b){function c(f){var g=f.getAttribute("data-id"),e=f.getAttribute("data-uid"),d=a.trackData().track;if(g){a.playlist(g,e);if(d&&d.playlistType==="personalpl"&&d.paramsObj.id==g){b.resume();}else{a.playPlaylist(g);}}}return{handle:c};});define("OK/music/act/present",["OK/music/model"],function(a){function b(c){var d=c.getAttribute("data-id");a.present(d);}return{handle:b};});define("OK/music/act/search",["OK/logger","OK/music/model"],function(b,a){function d(g){var f=g.getAttribute("data-query"),e=g.getAttribute("data-location");if(f){a.search(f);}if(e){b.success("musicusage","searchFromPortal",e);}}function c(e){e.addEventListener("click",function(f){odklMusic.openMusic();d(this);f.stopPropagation();});}return{activate:c,handle:d};});define("OK/music/act/start",["OK/music/model"],function(a){function c(e){var f=e.getAttribute("data-id"),d=e.getAttribute("data-section");if(d&&f){a.start(d,f);}}function b(d){d.addEventListener("click",function(e){odklMusic.openMusic();c(this);e.stopPropagation();});}return{activate:b,handle:c};});define("OK/music/act/user",["OK/music/model"],function(a){function b(c){var d=c.getAttribute("data-id");if(d){a.user(d);}}return{handle:b};});define("OK/music/act/video",["OK/utils/dom","OK/utils/utils"],function(d,b){var a="mus-tr_i";function c(k){var e=d.parent(k,a),f,g,j,i=k.getAttribute("data-id"),l=[],h={cmd:"PopLayerVideo","st.vpl.vs":"musicVideos","st.vpl.id":i};if(e){j="mVP_"+e.getAttribute("id")+"_"+i;g=document.getElementById(j);if(g){if(g.call){g.call("pause");}if(g.getState){h["st.vpl.ft"]=g.getState().currentTime;}if(g.parentNode){g.parentNode.removeChild(g);}}f=d.byClass(e.parentNode,a);f.forEach(function(m){var o=m.getAttribute("data-query"),n=o?JSON.parse(o):null;if(n&&n.vid&&l.length<100){l.push(n.vid);}});if(l.length){h["st.vpl.vp"]=l.join(",");}b.ajax({url:"/dk",data:h}).done(b.updateBlockModelCallback);}}return{handle:c};});define("OK/music/ntf/started",["OK/utils/dom"],function(b){function a(d){var c=b.parent(d,"mus_card");if(c){c.classList.add("mus_card__playing");}}return{handle:a};});define("text!t/music/banner.dot",[],function(){return'{{?it.banners.length > 1}}\n    <div class="slider_w h-mod" data-module="music/musicSlider" id="musicSlider" data-interval="{{=it.timeoutSec}}">\n        <div class="slider">\n            {{~it.banners :value}}\n                <div class="slider_i">\n                    <img src="{{=value.imageUrl}}" class="slider_img h-mod"\n                        data-module="music/act/open" data-id="{{=value.target}}" data-section="{{=value.type}}" />\n\n                    <div class="slider_top-slot">\n                        <div class="button-pro __small __ic h-mod"\n                            data-module="music/act/start" data-id="{{=value.target}}" data-section="{{=value.type}}">\n                            <div class="tico">\n                                <div class="tico_img"><div class="ic ic_ust-play_w"></div></div>\n                                {{=value.buttonText}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            {{~}}\n        </div>\n        <span class="slider_ctrl __prev"><span class="arw_ic"></span></span>\n        <span class="slider_ctrl __next"><span class="arw_ic"></span></span>\n    </div>\n{{??}}\n    <div class="slider_w">\n        <div class="slider">\n            <div class="slider_i">\n                <img src="{{=it.banners[0].imageUrl}}" class="slider_img h-mod"\n                     data-module="music/act/open" data-id="{{=it.banners[0].target}}" data-section="{{=it.banners[0].type}}" />\n\n                <div class="slider_top-slot">\n                    <div class="button-pro __small __ic h-mod"\n                         data-module="music/act/start" data-id="{{=it.banners[0].target}}" data-section="{{=it.banners[0].type}}">\n                        <div class="tico">\n                            <div class="tico_img"><div class="ic ic_ust-play_w"></div></div>\n                            {{=it.banners[0].buttonText}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n{{?}}';});define("t/music/banner",["doT","text!t/music/banner.dot"],function(a,b){return a.template(b);});define("text!t/music/controls.dot",[],function(){return'<div class="mus_player-controls mus_header_i">\n    <div class="mus_player-controls_i __back" title="{{=it.l10n.prev}}" tsid="pBack"></div>\n    <div class="mus_player-controls_i __pause __play" title="{{=it.l10n.play}}"\n        data-t-play="{{=it.l10n.play}}" data-t-pause="{{=it.l10n.pause}}" tsid="pPlay"></div>\n    <div class="mus_player-controls_i __forward" title="{{=it.l10n.next}}" tsid="pNext"></div>\n</div>\n<div class="mus_player-volume mus_header_i">\n    <div class="mus_player-volume_ic mus_player-volume_i" title="{{=it.l10n.mute}}"></div>\n    <div class="mus_player-slider_w mus_player-volume_i">\n        <div class="mus_player-slider __volume">\n            <div class="mus_player-slider_fill"></div>\n            <div class="mus_player-slider_drag" style="width:34px"></div>\n            <div class="mus_player-slider_tooltip" style="left:34px"></div>\n        </div>\n    </div>\n</div>\n<div class="mml_ac">\n    <a class="mml_ac_i ic mml_ic_help" title="{{=it.l10n.help}}" tsid="pHelp"></a>\n    <span class="mml_ac_i ic mml_ic_close js-close-layer" title="{{=it.l10n.close}}" tsid="pClose"></span>\n</div>\n<div class="mus_player mus_header_i">\n    <div class="mus_player_cover mus_player_i">\n        <img class="mus_player_cover-img m_hidden"></img>\n        <div class="mus_player_cover-empty"></div>\n        <a class="mus_player_cover-overlay" target="_blank"></a>\n    </div>\n    <div class="mus_player_seek mus_player_i">\n        <div class="mus_player_seek mus_player_i" tsid="pTrackSeek">\n            <div class="mus_player-slider_w">\n                <div class="mus_player-slider __player __empty __disabled">\n                    <div class="mus_player-slider_fill"></div>\n                    <div class="mus_player-slider_drag"></div>\n                    <div class="mus_player-slider_tooltip"></div>\n                </div>\n            </div>\n        </div>\n        <div class="mus_player_seek-artist ellip m_hidden">\n            <div class="mus_player_artist-cnt">\n                <span class="mus_player_artist" tsid="pArtist"></span>\n            </div>\n            <span class="js-artist-song-divider mus_player_song-divider">&nbsp;&ndash;&nbsp;</span>\n            <span class="mus_player_song" tsid="pTrack"></span>\n            <div class="mus_player_pro ellip">\n                <a class="mus_player_pro-title __disabled" target="_blank">{{=it.l10n.adv}}</a>\n                <span class="mus_player_pro-text"></span>\n            </div>\n        </div>\n        <div class="mus_player_time">\n            <span></span>&nbsp;<span class="mus_player_duration"></span>\n        </div>\n        <div class="mus_player_info __pro">\n          <a class="mus_player_info-link m_hidden">{{=it.l10n.buyNoAd}}</a>\n        </div>\n    </div>\n    <div class="mus_player_i mus_player_shuffle" title="{{=it.l10n.shuffle}}"></div>\n    <div class="mus_player_i mus_player_repeat" title="{{=it.l10n.repeat}}"></div>\n</div>';});define("t/music/controls",["doT","text!t/music/controls.dot"],function(a,b){return a.template(b);});define("text!t/music/portletCollection.dot",[],function(){return'<div class="portlet mus_album mus_subinfo __actions">\n    {{? it.playlist }}\n    <div class="mus_album_i__absolute">\n        <div class="mus_album_i_w">\n            <div class="mus_card_img_w">\n                {{? it.playlist.images && it.playlist.images.imageUrl }}\n                <img src="{{! it.playlist.images.imageUrl }}" class="mus_card_img"></img>\n                {{?}}\n            </div>\n        </div>\n        <div class="m_c_col-data">\n            {{? it.playlist.playCount }}\n            <div class="m_c_col-data_counter">\n                <span class="m_c_col-data_amount">{{=it.playlist.playCount}}</span>\n                &nbsp;\n                <span class="m_c_col-data_tx">{{=it.l10n[it.playlist.countKey]}}</span>\n            </div>\n            {{?}}\n            <div class="m_c_col-data_ac">\n                {{? it.playlist.added}}\n                <a class="mus-dl m_c_col-data_ac_i m_hidden">\n                    <i class="m_c_col-data_add"></i>\n                    <span></span>\n                </a>\n                {{??}}\n                <a class="mus-dl m_c_col-data_ac_i">\n                    <i class="m_c_col-data_add"></i>\n                    <span>{{=it.l10n.subscribe_to_ppl}}</span>\n                </a>\n                {{?}}\n            </div>\n        </div>\n    </div>\n    <div class="mus_h2 mb-x">\n        <div class="m_ppl_title">{{! it.playlist.name }}</div>\n    </div>\n    {{?}}\n    <div class="mus-tr_lst">\n    </div>\n</div>\n{{? it.playlists && it.playlists.length }}\n<div class="portlet">\n    <div class="portlet_h">{{=it.l10n.m_other_ppls_label}}</div>\n    <div class="mus_album-list">\n        {{~it.playlists :item}}\n        <div class="mus_card_i">\n            <div class="mus_card" data-pid="{{=item.id}}">\n                <div class="col-card">\n                    <div class="mus_card_img_w mus_card_img_w__col">\n                        {{? item.images && item.images.imageUrl }}\n                        <img src="{{! item.images.imageUrl }}" class="mus_card_img"></img>\n                        {{?}}\n                    </div>\n                </div>\n                <div class="mus_card_n_w">\n                    {{? item.name }}\n                    <div class="mus_card_n textWrap">\n                        <span class="mus_card_n_a" title="{{! item.name }}">{{! item.name }}</span>\n                    </div>\n                    {{?}}\n                </div>\n            </div>\n        </div>\n        {{~}}\n    </div>\n</div>\n{{?}}\n';});define("t/music/portletCollection",["doT","text!t/music/track.dot","text!t/music/portletCollection.dot"],function(b,a,c){return b.template(c,undefined,{track:a});});define("text!t/music/portletContent.dot",[],function(){return'{{? it.stub }}\n<div class="stub-empty __music">\n    <div class="stub-empty_img"></div>\n    <div class="stub-empty_t">{{=it.l10n.m_no_music}}</div>\n</div>\n{{??}}\n<div class="portlet mus_album">\n    <div class="mus_album_i__absolute">\n        <div class="mus_album_i_w">\n            <div class="mus_album_side_w">\n                <div class="mus_album_side mus_album_side__c">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n                <div class="mus_album_side mus_album_side__a">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n                <div class="mus_album_side mus_album_side__b">\n                    <img alt="" class="mus_album_i" src="/res/i/music/stub/stub_artist@2x.png">\n                </div>\n            </div>\n        </div>\n        <div class="lp mt-x"></div>\n    </div>\n    <div class="mus-tr_lst">\n    </div>\n</div>\n{{?}}\n\n{{? it.playlists && it.playlists.length }}\n<div class="portlet">\n    <div class="portlet_h">{{=it.l10n.m_sec_comp}}</div>\n    <div class="mus_album-list">\n        {{~it.playlists :item}}\n        <div class="mus_card_i">\n            <div class="mus_card" data-pid="{{=item.id}}">\n                <div class="col-card">\n                    <div class="mus_card_img_w mus_card_img_w__col">\n                        {{? item.images && item.images.imageUrl }}\n                        <img src="{{! item.images.imageUrl }}" class="mus_card_img"></img>\n                        {{?}}\n                    </div>\n                </div>\n                <div class="mus_card_n_w">\n                    {{? item.name }}\n                    <div class="mus_card_n textWrap">\n                        <span class="mus_card_n_a" title="{{! item.name }}">{{! item.name }}</span>\n                    </div>\n                    {{?}}\n                </div>\n            </div>\n        </div>\n        {{~}}\n    </div>\n</div>\n{{?}}';});define("t/music/portletContent",["doT","text!t/music/portletContent.dot"],function(a,b){return a.template(b);});define("b/music",["OK/utils/md5","OK/music/autoplay","OK/music/attach","OK/music/bus","OK/music/chat","OK/music/collection","OK/music/collections","OK/music/controls","OK/music/flash","OK/music/garbage","OK/music/history","OK/music/import","OK/music/model","OK/music/musicSlider","OK/music/player","OK/music/playerA","OK/music/playlist","OK/music/portletWide","OK/music/radio","OK/music/searchPlaylists","OK/music/sid","OK/music/subscribe","OK/music/upload","OK/music/wmf","OK/music/act/add","OK/music/act/addCollection","OK/music/act/album","OK/music/act/artist","OK/music/act/collection","OK/music/act/dropdown","OK/music/act/open","OK/music/act/pauseCollection","OK/music/act/play","OK/music/act/playlist","OK/music/act/playCollection","OK/music/act/playPlaylist","OK/music/act/present","OK/music/act/search","OK/music/act/start","OK/music/act/user","OK/music/act/video","OK/music/ntf/added","OK/music/ntf/addedCollection","OK/music/ntf/started","OK/music/ntf/stopped","t/music/attachContent","t/music/attachItems","t/music/banner","t/music/collectionItems","t/music/collectionList","t/music/collectionsList","t/music/controls","t/music/dropdown","t/music/historyItems","t/music/historyList","t/music/importDialog","t/music/portletCollection","t/music/portletCollectionWide","t/music/portletContent","t/music/portletContentWide","t/music/portletItems","t/music/portletLayoutWide","t/music/radioItems","t/music/radioList","t/music/radioStations","t/music/searchPlaylists","t/music/sections","t/music/subSections","t/music/subGrowl","t/music/subPortlet","t/music/tabs"],{});