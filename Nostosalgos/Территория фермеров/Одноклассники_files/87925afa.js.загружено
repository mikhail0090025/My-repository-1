define(["module","OK/logger","OK/utils/vanilla"],function(e,F,u){var A={},b=[],d={},D,o="$Hash$",c=e.config().timeout||300000;function q(H){var I=d[H]||[],G=I.length;while(G--){I[G]();}}function j(G){return A.hasOwnProperty(G);}function v(H){var G=A[H];if(Object.keys(G).length===0&&OK.fn.isDebug()){console.error('Пакет "'+H+'" отсутствует. Наверно, не удалось загрузить');}return A[H];}function x(G,H){A[G]=new B(G,H);q(G);return v(G);}function B(G,H){this.pkg=G;this.messages=H;this.parsedResources={};}B.prototype={has:function(G){return this.messages.hasOwnProperty(G);},getLMsg:function(I,H){if(!I&&!H){return this.messages;}var J=this.messages[I];if(typeof J!=="string"){F.success("pts.miss",this.pkg,I);return this.pkg+"."+I;}if(H){var G=this.parsedResources[I];if(!G){G=f(J);this.parsedResources[I]=G;}return G.getResource(H);}return J;},subscribe:function(H){var G=this.pkg;if(!d[G]){d[G]=[];}d[G].push(H);}};function w(G){this.text=G;}w.prototype.getResource=function(){return u.encodeHtml(this.text);};function n(G){this.argName=G;}n.prototype.getResource=function(G){var H=G[this.argName];return H||H===0?H:"";};function g(H,G){this.argName=H;this.values=G;}g.prototype.getResource=function(J){var G=J[this.argName],I=G,H=this.argName.substr(-"Plural".length)==="Plural";if(H){I=p.getIndex(G);}var K=this.values[I];if(K){return K.getResource(J);}return"";};function s(H,G){this.argName=H;this.values=G;}s.prototype.getResource=function(H){var G=H[this.argName],I=this.values[G];return I?I.getResource(H):"";};function a(G){G=Math.abs(G);if(G%10===1&&G%100!==11){return 0;}if((G%10>=2&&G%10<=4)&&(G%100<10||G%100>=20)){return 1;}return 2;}function C(G){return(G===1)?0:1;}function m(G){return 0;}var p={ru:a,uk:a,en:C,hy:C,mo:C,ro:C,de:C,uz:m,az:m,kk:m,ka:m,ky:m,tg:m,tr:m,getIndex:function(H){var G=document.body.parentElement.getAttribute("lang");var I=p[G];if(!I){I=a;}return I(H);}};function l(G){this.children=G;}l.prototype.getResource=function(H){var G="";for(var I=0;I<this.children.length;I++){G+=this.children[I].getResource(H);}return G;};function f(I){var G=[];var J=0;for(;;){var H=i(G,I,J);if(H===I.length){break;}if(J===H){H++;}J=H;}return E(G);}function i(I,O,J){var L;L=h(O,J,"|[]");if(L===-1){L=h(O,J,"]");if(L===-1){I.push(new w(O.substr(J)));return O.length;}I.push(new w(O.substr(J,L-J)));return L;}if(L>J){I.push(new w(O.substr(J,L-J)));return L;}if(O[L]==="["){J=L+1;L=h(O,J,":?]");if(L===-1){J--;I.push(new w(O.substr(J)));return O.length;}var G=y(O.substr(J,L-J));if(O[L]==="]"){I.push(new n(G));return L+1;}var H=O[L],K=H==="?",N=K?{}:[];if(H!=="?"&&H!==":"){L=h(O,J,"]");I.push(new w(O.substr(J-1,L)));return O.length;}for(;;){J=L+1;var P=[],M;if(K){L=h(O,J,"=");if(L>J){M=O.substr(J,L-J);J=L+1;}else{L=h(O,J,"]");I.push(new w(O.substr(J,L)));return O.length;}}for(;;){L=i(P,O,J);if(L===O.length){break;}if(O[L]==="|"||O[L]==="]"){break;}if(J==L){L++;}J=L;}if(K){N[M]=E(P);}else{N.push(E(P));}if(L===O.length||O[L]==="]"){break;}}if(K){I.push(new s(G,N));}else{I.push(new g(G,N));}if(L===O.length){return O.length;}return L+1;}return L;}function y(G){return G?G.replace(/^\s+|\s+$/gm,""):"";}function E(G){if(G.length===0){return new w("");}if(G.length===1){return G[0];}return new l(G);}function h(I,K,J){for(var H=K;H<I.length;H++){for(var G=0;G<J.length;G++){if(J[G]===I[H]){return H;}}}return -1;}function z(){var K=[],I,H=0,G=b.length;for(;H<G;H+=1){I=b[H];var J=v(I);K.push({pkg:I,hash:J&&J.messages[o]||"0"});}return JSON.stringify(K);}function k(){u.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:z(),dataType:"json"}).then(function(I){var J=I.response,L=Object.keys(J),K,H=0,G=L.length;for(;H<G;H+=1){K=L[H];x(K,J[K]);}});}function r(G){if(!G){return;}if(b.indexOf(G)===-1){b.push(G);}if(!D&&(c>0)){D=window.setInterval(k,c);}}if(typeof window!=="undefined"){window.l10n={getPkg:function(G){r(G);return v(G);}};if(window.inline_resources!==undefined&&window.inline_resources.pts!==undefined){for(var t in window.inline_resources.pts){x(t,window.inline_resources.pts[t]);r(t);}window.inline_resources.pts={};}}return{load:function(H,I,J,G){if(G.isBuild){J();return;}if(j(H)){J(v(H));}else{I(["PTS/"+H],function(K){x(H,K);J(v(H));});}}};});