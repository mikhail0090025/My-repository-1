define(["jquery","OK/utils/throttle"],function(e,d){var h=e(window);var g=document.documentElement;var f={toTop:false,padding:0,container:h,bound:null,throttle:{scroll:10,resize:100}};var c=false;var b=0;if(e("#sc").length){b=OK.scrollBar.width;}var a=function(){};a.prototype.isStickyOn=function(){return this.activated&&this.panel.hasClass("__on");};a.prototype.activateWithOptions=function(u,m){u=e(u);if(!u.length){return;}this.panel=u;m=e.extend({},f,m||{});var v=e(m.container);if(!v.length){return;}this.scrollingContainer=v;var C=e(m.bound);if(!C.length){C=v;}var B,n,s=u.parent(),t,j,D,A,r,z=false,y=false;this.activated=true;var l=function(){n=v.get(0).getBoundingClientRect();t=h.height();c=(g.scrollWidth-h.innerWidth())>1;r=t-n.bottom+(c?b:0);k();},i=function(E){u.toggleClass("__on",E).toggleClass("__off",!E);},o=null,w=function(){if(o!==null){return o;}var G=u.hasClass("__on"),E,F;i(true);E=u.outerHeight();i(false);F=u.outerHeight();i(G);o=E-F;return o;},k=function(){if(!y){return;}var G=C.get(0).getBoundingClientRect(),L=s.get(0).getBoundingClientRect();var M=u.outerHeight(),H=false;if(m.toTop){H=L.top<=n.top+m.padding;var I=H?Math.min(G.bottom-M,m.padding):"";if(D!==I){D=I;u.css({top:I});}}else{var F=(L.top-G.top)===0,J=w();if(!F){if(z){J=J>0?J:0;}else{J=J<0?J:0;}H=n.bottom<(L.bottom+J);}var E;if(!H){E="";}else{var K=Math.min(n.bottom-M-G.top,0);E=r+K;}if(A!==E){A=E;u.css({bottom:E});}}if(H){if(!z||(z&&M!==j)){s.css({minHeight:M});}j=M;}else{s.css({minHeight:""});j=undefined;}if(z!==H){i(H);z=H;}B=false;},q=function(){if(B){return;}B=true;requestAnimationFrame(k);};this.resetPanelDelta=function(){o=null;};this.updatePosition=k;var x=d(m.throttle.scroll,q);this.throttledOnScroll=x;var p=d(m.throttle.resize,l);this.throttledOnWindowResize=p;setTimeout(function(){y=true;v.get(0).addEventListener("scroll",x);window.addEventListener("resize",p);q();l();},1);};a.prototype.callUpdatePosition=function(){this.updatePosition();};a.prototype.refresh=function(){this.resetPanelDelta();this.updatePosition();};a.prototype.activate=function(k){var j={};var i=k.getAttribute("data-container");if(i){j.container=document.querySelector(i);}j.toTop="true"===k.getAttribute("data-to-top");var l=k.getAttribute("data-bound");if(l){j.bound=e(l);}this.activateWithOptions(k,j);};a.prototype.deactivate=function(){if(!this.activated){return;}this.scrollingContainer.get(0).removeEventListener("scroll",this.throttledOnScroll);window.removeEventListener("resize",this.throttledOnWindowResize);};a.prototype.scrollIntoView=function(k){if(k.nodeType===Node.TEXT_NODE){k=k.parentNode;}var l=this.scrollingContainer[0],j=k.getBoundingClientRect(),i=this.panel[0].getBoundingClientRect(),m=j.y+j.height-i.y;if((m>0)||((j.top<0)&&(m<0))){l.scrollTo(0,l.scrollTop+m);}};a.prototype.getScrollHeight=function(){return this.scrollingContainer[0].scrollHeight;};a.prototype.getScrollTop=function(){return this.scrollingContainer[0].scrollTop;};a.prototype.setScrollTop=function(i){this.scrollingContainer[0].scrollTop=i;};return a;});