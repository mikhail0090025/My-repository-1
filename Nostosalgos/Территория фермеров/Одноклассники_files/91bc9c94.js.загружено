define(["OK/reactions/Reaction","OK/reactions/ReactionController","OK/ReactComponent","OK/ShortcutMenuReact"],function(g,d,b,f){var e="react.sent_private_count";var c=6;function a(){this.onClick=this.onClick.bind(this);this.onUpdate=this.onUpdate.bind(this);}a.prototype={activate:function(h){this.el=h;this.refId=h.getAttribute("data-like-reference-id");this.owner=h.getAttribute("data-owner");this.shortcutMenuId=h.getAttribute("data-shortcut-menu-id");this.currentReactionId=g.parseReactionId(h.getAttribute("data-reaction-selected"));this.initReactionId=this.currentReactionId;this.superClickCount=parseInt(h.getAttribute("data-react-super-click-count"),10)||c;this.reactions=this.initReactions();this.reactions.forEach(function(i){i.clickEvent.attach(this.onClick);}.bind(this));d.subscribe(this.refId,this.onUpdate);this.displayReactionHint();},initReactions:function(){var i=[];var l=this.superClickCount;var k=this.el.getAttribute("data-anim")==="true";var j=this.el.getAttribute("data-click-anim")==="true";var h=this.el.querySelectorAll(".reaction");Array.prototype.slice.call(h).forEach(function(m){i.push(new g(m,{id:g.parseReactionId(m.getAttribute("data-reaction-id")),superId:g.parseReactionId(m.getAttribute("data-super-reaction-id")),superClickCount:l,animationEnabled:k,clickAnimationEnabled:j}));});return i;},deactivate:function(){if(this.initReactionId!==this.currentReactionId){var h=f.getReactComponent(this.shortcutMenuId);h&&h.changeReaction(this.currentReactionId,this.initReactionId,{mode:d.orderModes.ONLY_SAVE});}this.reactions.forEach(function(i){i.clickEvent.detach(this.onClick);i.deactivate();}.bind(this));d.unsubscribe(this.refId,this.onUpdate);},getReaction:function(h){return this.reactions.find(function(i){return i.id===h||i.superId===h;});},onClick:function(j){var h=j.reactionId;var i=f.getReactComponent(this.shortcutMenuId);i&&i.changeReaction(h,this.currentReactionId,{mode:d.orderModes.ONLY_DRAW});},onUpdate:function(h){if(h.stage===h.stages.BEFORE_SAVE){this.initReactionId=h.reactionId;}if(h.stage!==h.stages.INIT||h.mode===h.modes.ONLY_SAVE){return;}var i=this.getReaction(this.currentReactionId);if(i&&h.reactionId!==i.getWrapper().id){i.unselect();}var j=this.getReaction(h.reactionId);if(j){j.select(h.reactionId);}this.currentReactionId=h.reactionId;},displayReactionHint:function(){var h=this;var i=false;Array.prototype.slice.call(this.el.querySelectorAll(".js-react-info")).forEach(function(j){i=i||h._initReactionHint(j);});},_initReactionHint:function(h){try{var i=h.getAttribute("data-key");var l=i.indexOf("private")!==-1;var o="react."+i+"-count";var m=parseInt(h.getAttribute("data-limit"),10)||10;var k=l?e:o;var j=parseInt(window.localStorage.getItem(k),10)||0;if(++j>m){return false;}window.localStorage.setItem(k,j+"");h.classList.add("visible");return true;}catch(n){OK.logger.error("react","err-init-info");return false;}}};return a;});