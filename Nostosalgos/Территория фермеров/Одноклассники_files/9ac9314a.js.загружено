define(["OK/logger"],function(b){function d(e){b.success("messagesLayer","images_load",e);}function a(f,g){var e;for(e=0;e<f.length;e++){if(f[e]===g){return true;}}return false;}function c(){this.count=0;this.images=null;this.loaded=[];}c.prototype={run:function(g,h){if(!g||!h){return;}this.callback=h;var f=this,e=document.getElementById(g);this.images=Array.prototype.slice.call(e.getElementsByTagName("img"));if(!this.images||this.images.length===0){d("no-images-1");this.done();return;}this.images.forEach(function(j){var k=j.getAttribute("src"),i=parseInt(j.getAttribute("height"),10)||0;if(k&&i===0&&!j.complete&&!j.error){f.count++;j.addEventListener("load",f);j.addEventListener("error",f);}});if(this.count===0){d("no-images-2");this.done();}else{d("count-"+this.count);}},done:function(){var e=this;if(this.callback){this.callback.call();}if(this.images){this.images.forEach(function(f){f.removeEventListener("load",e);f.removeEventListener("error",e);});}this.images=null;this.loaded=null;},handleEvent:function(h){var f=h.target,g=a(this.loaded,f);if(!g){this.loaded.push(f);}if(this.loaded.length===this.count){this.done();}},removeCallback:function(){this.callback=null;}};return c;});