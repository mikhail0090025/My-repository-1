define(["OK/logger","OK/utils/dom","OK/utils/utils"],function(c,d,b){var a=1000;return{activate:function(e){this.element=e;this.submitToggle=d.firstByClass(this.element,"wp-button");if(!this.submitToggle){return;}this.closeListener=this.close.bind(this);this.submitListener=this.deactivate.bind(this);this.element.addEventListener("click",this.closeListener);this.submitToggle.addEventListener("click",this.submitListener);(function f(){this.updateState(Notification.permission==="denied");this.timeoutId=setTimeout(f.bind(this),a);}).bind(this)();},submit:function(e){e.stopPropagation();if(Notification.permission==="denied"){return;}this.deactivate();},close:function(e){if(e.target!==this.element){return false;}this.deactivate();},deactivate:function(){if(!this.element){return;}this.element.classList.add("invisible");if(this.submitToggle){this.submitToggle.removeEventListener("click",this.submitListener);this.submitToggle=null;}if(this.element){this.element.removeEventListener("click",this.closeListener);this.element=null;}if(this.timeoutId){clearTimeout(this.timeoutId);}c.success("webpush.popup.close",Notification.permission==="denied"?"denied":"allowed");if(typeof this.onClose==="function"){this.onClose();}},open:function(e){c.success("webpush.popup.open");this.onClose=e;return b.ajax({type:"POST",url:"/dk?cmd=PopLayerOver&st.layer.cmd=NotificationPermissionBlock"}).then(b.updateBlockModelCallback);},updateState:function(e){this.submitToggle.classList.toggle("__disabled",e);}};});