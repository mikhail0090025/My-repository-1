OK.hooks={};(function(){OK.hooks.AbstractHook={code:0,activate:OK.fn.empty,deactivate:OK.fn.empty,sinkEvents:function(d,e,c){this.m_handlers=this.m_handlers||{};var g=OK.fn.delegate(e,[],c);for(var b=0;b<d.length;b++){var f=d[b];var a=this.m_handlers[f]||[];a.push(g);this.m_handlers[f]=a;}delete this.m_events;},_init:function(a,b,d,e){var c=jQuery;this.params=d;this.fallback=e;this.hookEl=a;this.gwt=b;this.j_hookEl=c(this.hookEl);this.j_hookParentEl=c(this.hookEl.parentNode);this.activate();},_destroy:function(){this.deactivate();delete this.gwt;delete this.hookEl;delete this.m_handlers;delete this.m_events;delete this.params;},_getSinkingEvents:function(){if(this.m_events==null){this.m_events=OK.util.keys(this.m_handlers);}return this.m_events;},_handleEvent:function(c){var a=this.m_handlers[c]||[];for(var b=0;b<a.length;b++){a[b].call(this,c);}}};}());(function(f){var e=function(o){var n=0;var m=o;if(m.offsetParent){do{n+=m.offsetTop;}while(m=m.offsetParent);}return n;};var j=document.documentElement.classList.contains("small-toolbar")?48:76;var b=function(){return window.innerHeight-j;};var k=function(m,n,o){var p="";if(o){if(o==="auto"){}else{p=n+": "+m.calcString(o.replace("px",""),"px")+"; ";}}return p;};var g=function(n,m){var q=Object.getOwnPropertyNames(n);var o=Object.getOwnPropertyNames(m);if(q.length!==o.length){return false;}for(var p=0;p<q.length;p++){var r=q[p];if(n[r]!==m[r]){return false;}}return true;};var d=Object.create(OK.hooks.AbstractHook);OK.util.extend(d,{activate:function(){this.sinkEvents(["scroll","resize","toggle4Col","dataload","navigate","bannerState"],this.doReflow,this);this.sinkEvents(["resize"],this.doResize,this);var m=jQuery;this.j_topPanel=m("#topPanel");var n=this;require(["OK/Smokescreen"],function(o){n.StickyBannerCnt=o.getById("hook_Block_ViewportHeightAwareBanner");if(n.StickyBannerCnt!=null){n.StickyBannerCntTop=e(n.StickyBannerCnt);}n.doReflow();n.doResize();});},deactivate:function(){},doReflow:function(){},doResize:function(){}});var l=Object.create(d);var a=0;OK.util.extend(l,{code:2,doResize:function(){this.WindowHeight=document.body.parentNode.clientHeight;},doReflow:function(m){var n=this;require(["OK/Smokescreen"],function(q){var p=q.getById("hook_Block_ViewportHeightAwareBanner");if(p!=null&&n.StickyBannerCnt){var s={};var t=n.StickyBannerCnt.clientHeight;n.StickyBanner=q.getById("hook_Block_StickyBannerContainer");if(a!=t){s.StickyBannerMinHeight=t+"px";a=t;}var v=n.StickyBanner.getBoundingClientRect();var r=v.top;var o=j+12;var x=12;var w=document.getElementById("footer");var u=w.getBoundingClientRect();if(r<=o){s.StickyBannerCntPosition="fixed";if(t+o+x<u.top){s.StickyBannerCntTop=o+"px";s.StickyBannerCntBottom="auto";}else{s.StickyBannerCntTop="auto";s.StickyBannerCntBottom=n.WindowHeight-u.top+"px";}}else{s.StickyBannerCntPosition="static";}if(!n.updateStyle){n.updateStyle=n._changeStickyBannerStyleInline;}n.updateStyle(s);}});},applySmokescreen:function(m){this.locator=m;var n=document.head.querySelector("#stickyBannerCnt_style");if(!n){n=document.createElement("style");n.id="stickyBannerCnt_style";n=document.head.appendChild(n);}this.StickyBannerStyle=n;this.updateStyle=this._changeStickyBannerStyleSmokescreen;},_changeStickyBannerStyleInline:function(m){if(m.StickyBannerMinHeight){this.StickyBanner.style.minHeight=m.StickyBannerMinHeight;}if(m.StickyBannerCntPosition){this.StickyBannerCnt.style.position=m.StickyBannerCntPosition;}if(m.StickyBannerCntTop){this.StickyBannerCnt.style.top=m.StickyBannerCntTop;}if(m.StickyBannerCntBottom){this.StickyBannerCnt.style.bottom=m.StickyBannerCntBottom;}},previousSmokescreenStyle:{},_changeStickyBannerStyleSmokescreen:function(q){if(this.locator&&this.StickyBannerStyle){this.StickyBanner.removeAttribute("style");this.StickyBannerCnt.removeAttribute("style");var s=!g(q,this.previousSmokescreenStyle);if(!s){return;}var n=this.StickyBannerStyle.sheet;for(var m=n.cssRules.length-1;m>=0;m--){n.deleteRule(0);}var r="";if(q.StickyBannerMinHeight){r=" #"+this.StickyBanner.id+" {"+k(this.locator,"min-height",q.StickyBannerMinHeight)+"}";n.insertRule(r,0);}if(q.StickyBannerCntBottom||q.StickyBannerCntTop){r=" #"+this.StickyBannerCnt.id+" {"+k(this.locator,"bottom",q.StickyBannerCntBottom)+k(this.locator,"top",q.StickyBannerCntTop)+"} ";n.insertRule(r,0);}var o=this.locator.transform("position-static");var p=this.locator.transform("position-fixed");if(q.StickyBannerCntPosition==="static"){this.StickyBannerCnt.classList.remove(p);this.StickyBannerCnt.classList.add(o);}else{if(q.StickyBannerCntPosition==="fixed"){this.StickyBannerCnt.classList.remove(o);this.StickyBannerCnt.classList.add(p);}else{this.StickyBannerCnt.classList.remove(o);this.StickyBannerCnt.classList.remove(p);}}this.previousSmokescreenStyle=q;}else{this._changeStickyBannerStyleInline.apply(q);}}});OK.hooks.StickyBannerHookFactory=function(m){if(!m.mobile){return Object.create(l);}else{return null;}};var h=Object.create(d);OK.util.extend(h,{activate:function(){d.activate.call(this);this.j_hookParentEl.css("min-height",Math.round(this.j_hookEl.innerHeight())+"px");this.toolbarHeight=this.j_topPanel.outerHeight();},doReflow:function(p){var n=this.j_hookEl;var q=window.pageYOffset;if(n.hasClass("sticky_cnt__off")){n.toggleClass("sticky_cnt__on",false);}else{if(n.hasClass("sticky_cnt__bottom")){var o=this.j_hookParentEl.offset().top+this.j_hookParentEl.height();n.toggleClass("sticky_cnt__on",o>window.innerHeight+q);}else{var m=this.j_hookParentEl.offset().top;n.toggleClass("sticky_cnt__on",m<this.toolbarHeight+q);}}}});OK.hooks.StickyPanelHookFactory=function(m){if(!m.mobile){return Object.create(h);}else{return null;}};var c=Object.create(d);OK.util.extend(c,{activate:function(){d.activate.call(this);},doReflow:function(){$("#facets").trigger("reflow");}});OK.hooks.PSStickyFiltersHookFactory=function(m){if(!m.mobile){return Object.create(c);}else{return null;}};var i=Object.create(d);OK.util.extend(i,{activate:function(){var n=this;var m=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;this.setLogAttribute();this.sinkEvents(["bannerState","toggle4Col","resize","scroll"],this.gwtEventsWrapper,this);require(["OK/StickyBlock","OK/utils/debounce","OK/Smokescreen"],function(r,p,q){if(!n.hookEl){return;}var o=q.getById("hook_Block_FrOln4thCol");n.stickyBlockFactory=r;n.stickyBlock=n.stickyBlockFactory.activate(n.hookEl);n.stickyFooter=n.hookEl.querySelector(".online-fr_footer");n.list=document.getElementById("online-fr_cards");n.originalList=document.getElementById("FriendStreamContent");if(typeof OK.showOnlineUsers!=="undefined"){OK.showOnlineUsers.doResize=n.doModernResize.bind(n);}if(o&&typeof m==="function"){n.bannerObserver=new m(p(200,function(){n.stickyBlock.init(false);n.doModernResize();n.renderSticky();})).observe(o,{attributes:true,subtree:true});}n.hookEl.addEventListener("animationend",OK.showOnlineUsers.doResize);});},deactivate:function(){if(this.bannerObserver){this.bannerObserver.disconnect();}if(this.stickyBlockFactory){this.hookEl.removeEventListener("animationend",OK.showOnlineUsers.doResize);this.stickyBlockFactory.deactivate(this.hookEl);}},gwtEventsWrapper:function(m){if(this.stickyBlock){switch(m){case"bannerState":this.stickyBlock.init(false);this.doModernResize();this.renderSticky();break;case"toggle4Col":this.stickyBlock.init(false);this.doModernResize();this.renderSticky();this.setLogAttribute();require(["OK/FriendStream"],function(n){n.toggleState();});break;case"resize":this.doModernResize();this.renderSticky();break;case"scroll":this.renderSticky();break;}}},renderSticky:function(){if(!this.stickyFooter){return false;}if(!OK.util.is4ColumnActive()){this.stickyFooter.classList.remove("__sticky");}else{var n=120;var m=this.stickyBlock.stickyContainer.getBoundingClientRect();if(m.height>b()){this.stickyFooter.classList.toggle("__sticky",((window.innerHeight-m.top)>n));}else{this.stickyFooter.classList.remove("__sticky");}}},doModernResize:function(){var n=document.getElementsByClassName("online-fr_i");var r=document.getElementById("hook_Block_FrOln4thCol");var p=document.getElementById("mainContent");var s=document.getElementById("footer");var u;if(OK.util.is4ColumnActive()){var t=p.clientHeight+s.clientHeight;var v=r?r.clientHeight:0;var q=this.originalList.clientHeight+v;if(q>t){u=t-v-80;}else{u=this.originalList.clientHeight;}}else{u=b()-60;}for(var o=0,m=0;(m<u)&&(o<n.length);o++){m+=n[o].clientHeight;}if(m){if(m>u){m-=n[o-1].clientHeight;}this.list.style.maxHeight=m+"px";}this.stickyBlock.onResize();},setLogAttribute:function(){var m={collapsed:!OK.util.is4ColumnActive(),target:"friendStream"};this.hookEl.setAttribute("data-l",JSON.stringify(m));}});OK.hooks.FriendsStreamHookFactory=function(m){if(!m.mobile){return Object.create(i);}else{return null;}};require(["OK/banners/moneySave"],function(m){m.onHooksReady();});}(window));