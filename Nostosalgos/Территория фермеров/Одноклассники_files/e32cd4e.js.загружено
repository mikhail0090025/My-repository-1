/*! FileAPI 2.0.3n18 - BSD | git://github.com/mailru/FileAPI.git
 * FileAPI — a set of  javascript tools for working with files. Multiupload, drag'n'drop and chunked file upload. Images: crop, resize and auto orientation by EXIF.
 */
define(["OK/logger"],function(a){var c=function(e){a.success("fileapi.calls",e);};var f=function(e,g){a.success("fileapi.flags",e,g);};var b=false;try{b=document.createElement("canvas").toDataURL("image/jpeg",0.9).indexOf("data:image/jpeg")>-1;}catch(d){}f("qualitySupported",b);(function(i){var j=i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype,h=i.Blob&&(function(){try{return Boolean(new Blob());}catch(l){return false;}}()),k=h&&i.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100;}catch(l){return false;}}()),g=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder,e=(h||g)&&i.atob&&i.ArrayBuffer&&i.Uint8Array&&function(m){FileAPI.log("DataURI to blob called",m.length);var r,o,q,n,l,p;if(m.split(",")[0].indexOf("base64")>=0){r=atob(m.split(",")[1]);}else{r=decodeURIComponent(m.split(",")[1]);}o=new ArrayBuffer(r.length);q=new Uint8Array(o);for(n=0;n<r.length;n+=1){q[n]=r.charCodeAt(n);}l=m.split(",")[0].split(":")[1].split(";")[0];if(h){FileAPI.log("Using blob constructor",l,k,q.length,o.byteLength);return new Blob([k?q:o],{type:l});}FileAPI.log("Using blob constructor",l,o.byteLength);p=new g();p.append(o);return p.getBlob(l);};if(i.HTMLCanvasElement&&!j.toBlob){if(j.mozGetAsFile){j.toBlob=function(n,l,m){if(b&&m&&j.toDataURL&&e){n(e(this.toDataURL(l,m)));}else{n(this.mozGetAsFile("blob",l));}};}else{if(j.toDataURL&&e){j.toBlob=function(n,l,m){n(e(this.toDataURL(l,m)));};}}}i.dataURLtoBlob=e;})(window);(function(e){var k=e.require.s.contexts._.config,j=k.config.FileAPI;var i=!!e.createObjectURL||!!(e.URL&&e.URL.revokeObjectURL)||!!e.webkitURL,l=!!(e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.toBlob);var m=e.okFlashVersion;var h=m&&m.length===3&&(m[0]>10||(m[0]===10&&m[1]>=0));var g=i&&l&&b;f("isSuitableFlashVersion",h);f("isEffectiveImageUploadSupported",l);f("isURLSupported",i);f("useHtml5",g);e.FileAPI={debug:j.debug,cors:true,multiPassResize:true,uploadRetry:3,staticPath:j.staticPath,flashAbortTimeout:60*60*1000,flashEagerLoad:h,flashEnabled:h,withCredentials:false,checkBlack:true,html5:g||function(n){return n.accept==="video/*"||(g&&!!e.FileAPI.support.apiURL);},html5ExceptPhoto:function(n){return n.accept==="video/*";}};}(window));(function(S,E){var Q=1,aa=function(){},m=S.document,B=m.doctype||{},I=S.navigator.userAgent,k=(S.createObjectURL&&S)||(S.URL&&URL.revokeObjectURL&&URL)||(S.webkitURL&&webkitURL);f("apiURL",!!k);var u=S.Blob,s=S.File,N=S.FileReader,F=S.FormData,W=S.XMLHttpRequest,z=S.jQuery,P=!!(s&&(N&&(S.Uint8Array||F||W.prototype.sendAsBinary)))&&!(/safari\//i.test(I)&&!/chrome\//i.test(I)&&/windows/i.test(I));f("html5",P);var x=P&&("withCredentials" in (new W));f("cors",x);var L=P&&!!u&&!!(u.prototype.webkitSlice||u.prototype.mozSlice||u.prototype.slice),U=S.dataURLtoBlob,ac=/img/i,Z=/canvas/i,Y=/img|canvas/i,l=/input/i,R=/^data:[^,]+,/,C=S.Math,n=function(ad){ad=new S.Number(C.pow(1024,ad));ad.from=function(ae){return C.round(ae*this);};return ad;},H={},q=[],g="abort progress error load loadend",w="status statusText readyState response responseXML responseText responseBody".split(" "),t="currentTarget",M="preventDefault",ab=function(ad){return ad&&("length" in ad);},V=function(ah,ag,ad){if(ah){if(ab(ah)){for(var af=0,ai=ah.length;af<ai;af++){if(af in ah){ag.call(ad,ah[af],af,ah);}}}else{for(var ae in ah){if(ah.hasOwnProperty(ae)){ag.call(ad,ah[ae],ae,ah);}}}}},D=function(ag){var ad=arguments,ae=1,af=function(ai,ah){ag[ah]=ai;};for(;ae<ad.length;ae++){V(ad[ae],af);}return ag;},G=function(ag,af,ae){if(ag){var ad=j.uid(ag);if(!H[ad]){H[ad]={};}var ah=(N&&ag)&&(ag instanceof N);V(af.split(/\s+/),function(ai){if(z&&!ah){c("jQuery.event.add");z.event.add(ag,ai,ae);}else{if(!H[ad][ai]){H[ad][ai]=[];}H[ad][ai].push(ae);if(ag.addEventListener){ag.addEventListener(ai,ae,false);}else{if(ag.attachEvent){ag.attachEvent("on"+ai,ae);}else{ag["on"+ai]=ae;}}}});}},T=function(ah,ag,af){if(ah){var ae=j.uid(ah),ad=H[ae]||{};var ai=(N&&ah)&&(ah instanceof N);V(ag.split(/\s+/),function(al){if(z&&!ai){z.event.remove(ah,al,af);}else{var ak=ad[al]||[],aj=ak.length;while(aj--){if(ak[aj]===af){ak.splice(aj,1);break;}}if(ah.addEventListener){ah.removeEventListener(al,af,false);}else{if(ah.detachEvent){ah.detachEvent("on"+al,af);}else{ah["on"+al]=null;}}}});}},p=function(ag,af,ae){G(ag,af,function ad(ah){T(ag,af,ad);ae(ah);});},y=function(ad){if(!ad.target){ad.target=S.event&&S.event.srcElement||m;}if(ad.target.nodeType===3){ad.target=ad.target.parentNode;}return ad;},K=function(ad){var ae=m.createElement("input");ae.setAttribute("type","file");return ad in ae;},j={version:"2.0.3n18",cors:false,html5:true,media:false,formData:true,multiPassResize:true,debug:false,trace:false,pingUrl:false,multiFlash:false,flashAbortTimeout:0,flashEagerLoad:false,flashEnabled:true,withCredentials:true,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(ae,ad){return ae+(ad!=null?"["+ad+"]":"");},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5000,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2000,KB:n(1),MB:n(2),GB:n(3),TB:n(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(ad){return ad?(ad[j.expando]=ad[j.expando]||j.uid()):(++Q,j.expando+Q);},log:function(){if(j.debug&&S.console&&console.log){if(console.log.apply){console.log.apply(console,arguments);}else{console.log([].join.call(arguments," "));}}function ag(ai){return ai.length>1?ai:("0"+ai);}if(j.isArray(j.trace)){var ad=new Date(),af=ad.getHours(),ah=ad.getMinutes(),ae=ad.getSeconds();j.trace.push("["+ag(af)+":"+ag(ah)+":"+ag(ae)+"]: "+[].join.call(arguments," "));}},startTrace:function(){j.trace=[];},stopTrace:function(){j.trace=false;},getTrace:function(){return j.isArray(j.trace)?j.trace:[];},newImage:function(af,ae){var ad=m.createElement("img");if(ae){j.event.one(ad,"error load",function(ag){ae(ag.type=="error",ad);ad=null;});}ad.src=af;return ad;},getXHR:function(){var ae;if(W){ae=new W;}else{if(S.ActiveXObject){try{ae=new ActiveXObject("MSXML2.XMLHttp.3.0");}catch(ad){ae=new ActiveXObject("Microsoft.XMLHTTP");}}}return ae;},isArray:ab,support:{dnd:x&&("ondrop" in m.createElement("div")),cors:x,html5:P,chunked:L,dataURI:true,apiURL:!!k,accept:K("accept"),multiple:K("multiple")},event:{on:G,off:T,one:p,fix:y},throttle:function(af,ae){var ah,ad;return function ag(){ad=arguments;if(!ah){af.apply(S,ad);ah=setTimeout(function(){ah=0;af.apply(S,ad);},ae);}};},F:function(){},parseJSON:function(ae){var ad;if(S.JSON&&JSON.parse){ad=JSON.parse(ae);}else{ad=(new Function("return ("+ae.replace(/([\r\n])/g,"\\$1")+");"))();}return ad;},trim:function(ad){ad=String(ad);return ad.trim?ad.trim():ad.replace(/^\s+|\s+$/g,"");},defer:function(){var af=[],ad,ae,ag={resolve:function(ai,ah){ag.resolve=aa;ae=ai||false;ad=ah;while(ah=af.shift()){ah(ae,ad);}},then:function(ah){if(ae!==E){ah(ae,ad);}else{af.push(ah);}}};return ag;},isDeferred:function(ad){return ad&&typeof ad.then==="function"&&typeof ad.resolve==="function";},queue:function(ag){var ae=0,ai=0,ah=false,af=false,ad={inc:function(){ai++;},next:function(){ae++;setTimeout(ad.check,0);},check:function(){(ae>=ai)&&!ah&&ad.end();},isFail:function(){return ah;},fail:function(aj){!ah&&ag(ah=(aj||true));},end:function(){if(!af){af=true;ag();}}};return ad;},each:V,afor:function(ah,ag){var ae=0,af=ah.length;if(ab(ah)&&af--){(function ad(){ag(af!=ae&&ad,ah[ae],ae++);})();}else{ag(false);}},extend:D,isFile:function(ad){return P&&ad&&(ad instanceof s);},isBlob:function(ad){return P&&ad&&(ad instanceof u);},isCanvas:function(ad){return ad&&Z.test(ad.nodeName);},getFilesFilter:function(ad){ad=typeof ad=="string"?ad:(ad.getAttribute&&ad.getAttribute("accept")||"");return ad?new RegExp("("+ad.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./;},readAsDataURL:function(ad,ae){j.log("api.readAsDataUrl");if(j.isCanvas(ad)){v(ad,ae,"load",j.toDataURL(ad));}else{r(ad,ae,"DataURL");}},readAsBinaryString:function(ad,ae){j.log("api.readAsBinaryString");if(A("BinaryString")){r(ad,ae,"BinaryString");}else{r(ad,function(af){if(af.type=="load"){try{af.result=j.toBinaryString(af.result);}catch(ag){af.type="error";af.message=ag.toString();}}ae(af);},"DataURL");}},readAsArrayBuffer:function(ad,ae){r(ad,ae,"ArrayBuffer");},readAsText:function(ad,af,ae){if(!ae){ae=af;af="utf-8";}r(ad,ae,"Text",af);},toDataURL:function(ae,ad){if(typeof ae=="string"){return ae;}else{if(ae.toDataURL){return ae.toDataURL(ad||"image/png");}}},toBinaryString:function(ad){return S.atob(j.toDataURL(ad).replace(R,""));},readAsImage:function(ae,ak,ad){if(j.isFile(ae)){j.log("readAsImage.isFile");if(k){j.log("readAsImage.apiURL");var ai=k.createObjectURL(ae);if(ai===E){v(ae,ak,"error");}else{j.log("readAsImage.apiURL.create url = "+ai);j.readAsImage(ai,ak,ad);}}else{j.log("readAsImage.dataURL");j.readAsDataURL(ae,function(am){if(am.type=="load"){j.readAsImage(am.result,ak,ad);}else{if(ad||am.type=="error"){v(ae,ak,am,null,{loaded:am.loaded,total:am.total});}}});}}else{if(j.isCanvas(ae)){j.log("readAsImage.isCanvas");v(ae,ak,"load",ae);}else{if(ac.test(ae.nodeName)){j.log("readAsImage.isImg");if(ae.complete){j.log("readAsImage.isImg.completed");v(ae,ak,"load",ae);}else{j.log("readAsImage.isImg.pending");var al="error abort load",aj;var ag=false;var af=function(am){j.log("readAsImage.isImg.callback."+am.type);if(ag){return;}ag=true;if(am.type=="load"&&k){j.log("readAsImage.isImg.revoke url = "+ae.src);k.revokeObjectURL(ae.src);}if(aj){clearTimeout(aj);aj=null;}T(ae,al,af);v(ae,ak,am,ae);};p(ae,al,af);aj=setTimeout(function(){aj=null;if(ae.complete){j.log("readAsImage.isImg.timeout");af({type:"load"});}},500);}}else{if(ae.iframe){j.log("readAsImage.isIFrame");v(ae,ak,{type:"error"});}else{j.log("readAsImage.else");var ah=j.newImage(ae.dataURL||ae);j.log("readAsImage.else.newImage");setTimeout(function(){j.log("readAsImage.else.timeout");j.readAsImage(ah,ak,ad);},0);}}}}},checkFileObj:function(ad){var af={},ae=j.accept;if(typeof ad=="object"){af=ad;}else{af.name=(ad+"").split(/\\|\//g).pop();}if(af.type==null){af.type=af.name.split(".").pop();}V(ae,function(ah,ag){ah=new RegExp(ah.replace(/\s/g,"|"),"i");if(ah.test(af.type)||j.ext2mime[af.type]){af.type=j.ext2mime[af.type]||(ag.split("/")[0]+"/"+af.type);}});return af;},getDropFiles:function(ae,ai){var af=[],ah=O(ae),ag=ab(ah.items)&&ah.items[0]&&X(ah.items[0]),ad=j.queue(function(){ai(af);});V((ag?ah.items:ah.files)||[],function(ak){ad.inc();try{if(ag){o(ak,function(am,al){if(am){j.log("[err] getDropFiles:",am);}else{af.push.apply(af,al);}ad.next();});}else{i(ak,function(al){al&&af.push(ak);ad.next();});}}catch(aj){ad.next();j.log("[err] getDropFiles: ",aj);}});ad.check();},getFiles:function(ad,ae,ag){var af=[];if(ag){j.filterFiles(j.getFiles(ad),ae,ag);return null;}if(ad.jquery){ad.each(function(){af=af.concat(j.getFiles(this));});ad=af;af=[];}if(typeof ae=="string"){ae=j.getFilesFilter(ae);}if(ad.originalEvent){ad=y(ad.originalEvent);}else{if(ad.srcElement){ad=y(ad);}}if(ad.dataTransfer){ad=ad.dataTransfer;}else{if(ad.target){ad=ad.target;}}if(ad.files){af=ad.files;if(!P){af[0].blob=ad;af[0].iframe=true;}}else{if(!P&&J(ad)){if(j.trim(ad.value)){af=[j.checkFileObj(ad.value)];af[0].blob=ad;af[0].iframe=true;}}else{if(ab(ad)){af=ad;}}}return j.filter(af,function(ah){return !ae||ae.test(ah.name);});},getTotalSize:function(af){var ae=0,ad=af&&af.length;while(ad--){ae+=af[ad].size;}return ae;},getInfo:function(af,ag){var ah={},ae=q.concat();if(j.isFile(af)){(function ad(){var ai=ae.shift();j.log("Reader shifted");if(ai){j.log("Reader found");if(ai.test(af.type)){j.log("Reader matched");ai(af,function(ak,aj){j.log("Reader callback");if(ak){j.log("Reader err");ag(ak);}else{j.log("Reader suc");D(ah,aj);ad();}});}else{j.log("Reader skipped");ad();}}else{j.log("Readers none");ag(false,ah);}})();}else{ag("not_support_info",ah);}},addInfoReader:function(ae,ad){ad.test=function(af){return ae.test(af);};q.push(ad);},filter:function(ae,ag){var ad=[],af=0,ai=ae.length,ah;for(;af<ai;af++){if(af in ae){ah=ae[af];if(ag.call(ah,ah,af,ae)){ad.push(ah);}}}return ad;},filterFiles:function(aj,ak,ai){if(aj.length){var af=aj.concat(),ah,ae=[],ad=[];(function ag(){if(af.length){ah=af.shift();j.getInfo(ah,function(al,am){(ak(ah,al?false:am)?ae:ad).push(ah);ag();});}else{ai(ae,ad);}})();}else{ai([],aj);}},upload:function(ag){ag=D({jsonp:"callback",prepare:j.F,beforeupload:j.F,upload:j.F,fileupload:j.F,fileprogress:j.F,filecomplete:j.F,progress:j.F,complete:j.F,pause:j.F,imageOriginal:true,chunkSize:j.chunkSize,chunkUploadRetry:j.chunkUploadRetry,retryDelay:j.networkDownRetryTimeout,uploadRetry:j.uploadRetry},ag);if(ag.imageAutoOrientation&&!ag.imageTransform){ag.imageTransform={rotate:"auto"};}var ah=new j.XHR(ag),ad=this._getFilesDataArray(ag.files),ak=this,ae=0,ai=0,aj,af=false;V(ad,function(al){ae+=al.size;});ah.files=[];V(ad,function(al){ah.files.push(al.file);});ah.total=ae;ah.loaded=0;ah.filesLeft=ad.length;ag.beforeupload(ah,ag);aj=function(){var ao=ad.shift(),an=ao&&ao.file,am=false,al=e(ag);ah.filesLeft=ad.length;if(an&&an.name===j.expando){an=null;j.log("[warn] FileAPI.upload() — called without files");}if((ah.statusText!="abort"||ah.current)&&ao){af=false;ah.currentFile=an;al.file=an;j.log("Preparing file to upload");var aq=an&&ag.prepare(an,al);if(aq===false){j.log("Skipping file");aj.call(ak);}else{var ap=function(){j.log("Getting formData for the file");ak._getFormData(al,ao,function(ar){j.log("Got formData for the file");if(!ai){ag.upload(ah,ag);}j.log("Preparing XHR for the file");var at=new j.XHR(D({},al,{upload:an?function(){ag.fileupload(an,at,al);}:aa,progress:an?function(au){if(!am&&au.total!==0){am=(au.loaded===au.total);ag.fileprogress({type:"progress",total:ao.total=au.total,loaded:ao.loaded=au.loaded},an,at,al);ag.progress({type:"progress",total:ae,loaded:ah.loaded=(ai+ao.size*(au.loaded/au.total))|0},an,at,al);}}:aa,complete:function(au){j.log("Completed XHR for the file");V(w,function(av){ah[av]=at[av];});if(an){ao.total=(ao.total||ao.size);ao.loaded=ao.total;this.progress(ao);am=true;ai+=ao.size;ah.loaded=ai;ag.filecomplete(au,at,an,al);}setTimeout(function(){aj.call(ak);},0);}}));ah.abort=function(au){if(!au){ad.length=0;}this.current=au;at.abort();};j.log("Sending XHR for the file");at.send(ar);j.log("Sent XHR for the file");});};if(j.isDeferred(aq)){aq.then(function(at,ar){if(ar!==false){j.log("Prepared file");ap();}else{j.log("Skipping file 2");aj.call(ak);}});}else{ap();}}}else{ag.complete(ah.status==200||ah.status==201?false:(ah.statusText||"error"),ah,ag);af=true;}};setTimeout(aj,0);ah.append=function(al,am){al=j._getFilesDataArray([].concat(al));V(al,function(an){ae+=an.size;ah.files.push(an.file);if(am){ad.unshift(an);}else{ad.push(an);}});ah.statusText="";if(af){aj.call(ak);}};ah.remove=function(an){var am=ad.length,al;while(am--){if(ad[am].file==an){al=ad.splice(am,1);ae-=al.size;}}return al;};return ah;},_getFilesDataArray:function(ag){var af=[],ad={};if(J(ag)){var ae=j.getFiles(ag);ad[ag.name||"file"]=ag.getAttribute("multiple")!==null?ae:ae[0];}else{if(ab(ag)&&J(ag[0])){V(ag,function(ai){ad[ai.name||"file"]=j.getFiles(ai);});}else{ad=ag;}}V(ad,function ah(aj,ai){if(ab(aj)){V(aj,function(ak){ah(ak,ai);});}else{if(aj&&(aj.name||aj.image)){af.push({name:ai,file:aj,size:aj.size,total:aj.size,loaded:0});}}});if(!af.length){af.push({file:{name:j.expando}});}return af;},_getFormData:function(aq,ak,an){var ai=ak.file,ae=ak.name,ad=ai.name,am=ai.type,ap=j.support.transform&&aq.imageTransform,ag=new j.Form,al=j.queue(function(){an(ag);}),ah=ap&&h(ap),aj=j.postNameConcat;(function af(at){if(at.image){al.inc();at.toData(function(av,aw){ad=ad||(new Date).getTime()+".png";af(aw);al.next();});}else{if(j.Image&&ap&&(/^image/.test(at.type)||Y.test(at.nodeName))){al.inc();if(ah){ap=[ap];}var au=/android 4/i.test(I);var ar=(!U||au)&&!j.flashEngine;j.log("Transforming with"+(ar?"":"out")+" multipart");j.Image.transform(at,ap,aq.imageAutoOrientation,function(ax,av){if(ah&&!ax){if(ar){ag.multipart=true;}ag.append(ae,av[0],ad,ap[0].type||am);}else{var aw=0;if(!ax){V(av,function(az,ay){if(ar){j.log("Using multipart");ag.multipart=true;}if(!ap[ay].postName){aw=1;}ag.append(ap[ay].postName||aj(ae,ay),az,ad,ap[ay].type||am);});}if(ax||aq.imageOriginal){if(ax){j.log("Fallback to original image because of error");at.__fails=at.__fails||{};at.__fails.tx=at.__fails.tx||[];at.__fails.tx.push(ax);}ag.append(aj(ae,(aw?"original":null)),at,ad,am);}}al.next();});}else{if(ad!==j.expando){ag.append(ae,at,ad);}}}if(aq.attachExif){j.getInfo(at,function(av,aw){var ax=!av&&aw&&aw.exif&&aw.exif.V2&&aw.exif.toString();if(ax){ag.append("exif",ax);}});}})(ai);V(aq.data,function ao(at,ar){if(typeof at=="object"){V(at,function(au,av){ao(au,aj(ar,av));});}else{ag.append(ar,at);}});al.check();},reset:function(af,ad){var ae,ag;if(z){ag=z(af).clone(true).insertBefore(af).val("")[0];if(!ad){z(af).remove();}}else{ae=af.parentNode;ag=ae.insertBefore(af.cloneNode(true),af);ag.value="";if(!ad){ae.removeChild(af);}V(H[j.uid(af)],function(ah,ai){V(ah,function(aj){T(af,ai,aj);G(ag,ai,aj);});});}return ag;},load:function(ad,ae){var af=j.getXHR();if(af){af.open("GET",ad,true);if(af.overrideMimeType){af.overrideMimeType("text/plain; charset=x-user-defined");}G(af,"progress",function(ag){if(ag.lengthComputable){ae({type:ag.type,loaded:ag.loaded,total:ag.total},af);}});af.onreadystatechange=function(){if(af.readyState==4){af.onreadystatechange=null;if(af.status==200){ad=ad.split("/");var ag={name:ad[ad.length-1],size:af.getResponseHeader("Content-Length"),type:af.getResponseHeader("Content-Type")};ag.dataURL="data:"+ag.type+";base64,"+j.encode64(af.responseBody||af.responseText);ae({type:"load",result:ag},af);}else{ae({type:"error"},af);}}};af.send(null);}else{ae({type:"error"});}return af;},encode64:function(ag){var ad="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ae="",af=0;if(typeof ag!=="string"){ag=String(ag);}while(af<ag.length){var ak=ag.charCodeAt(af++)&255,ai=ag.charCodeAt(af++)&255,ah=ag.charCodeAt(af++)&255,an=ak>>2,am=((ak&3)<<4)|(ai>>4),al,aj;if(isNaN(ai)){al=aj=64;}else{al=((ai&15)<<2)|(ah>>6);aj=isNaN(ah)?64:ah&63;}ae+=ad.charAt(an)+ad.charAt(am)+ad.charAt(al)+ad.charAt(aj);}return ae;}};function v(ai,ah,ae,af,ag){var ad={type:ae.type||ae,target:ai,result:af};D(ad,ag);ah(ad);}function A(ad){return N&&!!N.prototype["readAs"+ad];}function r(ae,af,ad,ah){if(j.isBlob(ae)&&A(ad)){var ak=new N;var ai=0;j.log("readAs"+ad+" [Start]");G(ak,g,function aj(al){var an=al.type;if(an=="progress"){j.log("readAs"+ad+" [Progress]");var am=Date.now();if(am-ai>400){ai=am;v(ae,af,al,al.target.result,{loaded:al.loaded,total:al.total});}}else{if(an=="loadend"){j.log("readAs"+ad+" [End]");T(ak,g,aj);ak=null;}else{v(ae,af,al,al.target.result);}}});try{if(ah){ak["readAs"+ad](ae,ah);}else{ak["readAs"+ad](ae);}}catch(ag){v(ae,af,"error",E,{error:ag.toString()});}}else{v(ae,af,"error",E,{error:"filreader_not_support_"+ad});}}function i(ad,ag){if(!ad.type&&(ad.size%4096)===0&&(ad.size<=102400)){if(N){try{var af=new N();p(af,g,function(ah){var ai=ah.type!="error";ag(ai);if(ai){af.abort();}});af.readAsDataURL(ad);}catch(ae){ag(false);}}else{ag(null);}}else{ag(true);}}function X(ae){var ad;if(ae.getAsEntry){ad=ae.getAsEntry();}else{if(ae.webkitGetAsEntry){ad=ae.webkitGetAsEntry();}}return ad;}function o(af,ag){if(!af){ag("invalid entry");}else{if(af.isFile){af.file(function(ah){ah.fullPath=af.fullPath;ag(false,[ah]);},function(ah){ag("FileError.code: "+ah.code);});}else{if(af.isDirectory){var ae=af.createReader(),ad=[];ae.readEntries(function(ah){j.afor(ah,function(ai,aj){o(aj,function(al,ak){if(al){j.log(al);}else{ad=ad.concat(ak);}if(ai){ai();}else{ag(false,ad);}});});},function(ah){ag("directory_reader: "+ah);});}else{o(X(af),ag);}}}}function e(ad){var ae={};V(ad,function(ag,af){if(ag&&(typeof ag==="object")&&(ag.nodeType===void 0)){ag=D({},ag);}ae[af]=ag;});return ae;}function J(ad){return l.test(ad&&ad.tagName);}function O(ad){return(ad.originalEvent||ad||"").dataTransfer||{};}function h(ae){var ad;for(ad in ae){if(ae.hasOwnProperty(ad)){if(!(ae[ad] instanceof Object||ad==="overlay"||ad==="filter")){return true;}}}return false;}j.addInfoReader(/^image/,function(ad,af){j.log("Dimension reader started");if(!ad.__dimensions){var ae=ad.__dimensions=j.defer();j.log("Dimension reader readAsImage");j.readAsImage(ad,function(ag){var ah=ag.target;j.log("Dimension reader readAsImage.callback");ae.resolve(ag.type=="load"?false:"error",{width:ah.width,height:ah.height});ah.src=j.EMPTY_PNG;ah=null;});}else{j.log("Dimension reader already done");}ad.__dimensions.then(af);});j.event.dnd=function(ag,ah,ad){var af,ae;if(!ad){ad=ah;ah=j.F;}if(N){G(ag,"dragenter dragleave dragover",function(ai){var ak=O(ai).types,aj=ak&&ak.length,al=false;while(aj--){if(~ak[aj].indexOf("File")){ai[M]();if(ae!==ai.type){ae=ai.type;if(ae!="dragleave"){ah.call(ai[t],true,ai);}al=true;}break;}}if(al){clearTimeout(af);af=setTimeout(function(){ah.call(ai[t],ae!="dragleave",ai);},50);}});G(ag,"drop",function(ai){ai[M]();ae=0;ah.call(ai[t],false,ai);j.getDropFiles(ai,function(aj){ad.call(ai[t],aj,ai);});});}else{j.log("Drag'n'Drop -- not supported");}};j.event.dnd.off=function(ae,af,ad){T(ae,"dragenter dragleave dragover",af);T(ae,"drop",ad);};if(z&&!z.fn.dnd){z.fn.dnd=function(ae,ad){c("jQuery.fn.dnd");return this.each(function(){c("jQuery.dnd");j.event.dnd(this,ae,ad);});};z.fn.offdnd=function(ae,ad){return this.each(function(){j.event.dnd.off(this,ae,ad);});};}S.FileAPI=D(j,S.FileAPI);j.log("FileAPI: "+j.version);j.log("protocol: "+S.location.protocol);j.log("doctype: ["+B.name+"] "+B.publicId+" "+B.systemId);V(m.getElementsByTagName("meta"),function(ad){if(/x-ua-compatible/i.test(ad.getAttribute("http-equiv"))){j.log("meta.http-equiv: "+ad.getAttribute("content"));}});if(!j.flashUrl){j.flashUrl=j.staticPath+"FileAPI"+(j.debug?".debug":"")+".flash.swf";}if(!j.flashImageUrl){j.flashImageUrl=j.staticPath+"FileAPI.flash.image.swf";}if(!j.flashWebcamUrl){j.flashWebcamUrl=j.staticPath+"FileAPI.flash.camera.swf";}})(window,void 0);(function(k,n,i){var j=Math.min,r=Math.round,o=function(){return n.createElement("canvas");},q=false,g=false,p={8:270,3:180,6:90};try{q=o().toDataURL("image/png").indexOf("data:image/png")>-1;}catch(l){}try{g=o().toDataURL("image/webp").indexOf("data:image/webp")>-1;}catch(l){}function m(t){var s=0;for(var e=0;e<t.length;e+=4){if(t[e]||t[e+1]||t[e+2]){s++;}}return s;}function h(s){if(s instanceof h){var e=new h(s.file);k.extend(e.matrix,s.matrix);return e;}else{if(!(this instanceof h)){return new h(s);}}this.file=s;this.size=s.size||100;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0};}h.prototype={image:true,constructor:h,set:function(e){k.extend(this.matrix,e);return this;},crop:function(e,u,s,t){if(s===i){s=e;t=u;e=u=0;}return this.set({sx:e,sy:u,sw:s,sh:t||s});},resize:function(e,s,t){if(/min|max/.test(s)){t=s;s=e;}return this.set({dw:e,dh:s||e,resize:t});},preview:function(e,s){return this.resize(e,s||e,"preview");},rotate:function(e){return this.set({deg:e});},filter:function(e){return this.set({filter:e});},overlay:function(e){return this.set({overlay:e});},clone:function(){return new h(this);},_load:function(t,s){var e=this;if(/img|video/i.test(t.nodeName)){s.call(e,null,t);}else{k.readAsImage(t,function(u){s.call(e,u.type!="load",u.result);});}},_apply:function(B,t){var e=o(),D=this.getMatrix(B),E=e.getContext("2d"),C=B.videoWidth||B.width,A=B.videoHeight||B.height,y=D.deg,z=D.dw,L=D.dh,v=C,J=A,x=D.filter,G,H=B,M=D.overlay,F=k.queue(function(){B.src=k.EMPTY_PNG;t(false,e);}),N=k.renderImageToCanvas;B._type=this.file.type;while(D.multipass&&j(v/z,J/L)>2){v=(v/2+0.5)|0;J=(J/2+0.5)|0;G=o();G.width=v;G.height=J;if(H!==B){N(G,H,0,0,H.width,H.height,0,0,v,J);H=G;}else{H=G;N(H,B,D.sx,D.sy,D.sw,D.sh,0,0,v,J);D.sx=D.sy=D.sw=D.sh=0;}}e.width=(y%180)?L:z;e.height=(y%180)?z:L;e.type=D.type;e.quality=D.quality;E.rotate(y*Math.PI/180);N(E.canvas,H,D.sx,D.sy,D.sw||H.width,D.sh||H.height,(y==180||y==270?-z:0),(y==90||y==180?-L:0),z,L);z=e.width;L=e.height;if(k.checkBlack&&typeof E.getImageData==="function"&&z>1&&L>1){var I=false;try{var u=E.getImageData(Math.max(z/2-10,0),Math.max(L/2-10,0),Math.min(z/2+10,z),Math.min(L/2+10,L));if(m(u.data)<3){var s=E.getImageData(0,0,z,z);I=m(s.data)<3;}}catch(K){k.log("Exception while detecting black picture",K.name,K.message);}if(I){k.log("Found absolutely black picture",C,A,z,L,y);throw"AbsolutelyBlackImg";}}M&&k.each([].concat(M),function(P){F.inc();var w=new window.Image,O=function(){var R=P.x|0,V=P.y|0,S=P.w||w.width,T=P.h||w.height,Q=P.rel;R=(Q==1||Q==4||Q==7)?(z-S+R)/2:(Q==2||Q==5||Q==8?z-(S+R):R);V=(Q==3||Q==4||Q==5)?(L-T+V)/2:(Q>=6?L-(T+V):V);k.event.off(w,"error load abort",O);try{E.globalAlpha=P.opacity||1;E.drawImage(w,R,V,S,T);}catch(U){}F.next();};k.event.on(w,"error load abort",O);w.src=P.src;if(w.complete){O();}});if(x){F.inc();h.applyFilter(e,x,F.next);}F.check();},getMatrix:function(t){var s=k.extend({},this.matrix),C=s.sw=s.sw||t.videoWidth||t.naturalWidth||t.width,x=s.sh=s.sh||t.videoHeight||t.naturalHeight||t.height,e=s.dw=s.dw||C,z=s.dh=s.dh||x,y=C/x,A=e/z,u=s.resize;if(u=="preview"){if(e!=C||z!=x){var B,v;if(A>=y){B=C;v=B/A;}else{v=x;B=v*A;}if(B!=C||v!=x){s.sx=~~((C-B)/2);s.sy=~~((x-v)/2);C=B;x=v;}}}else{if(u){if(!(C>e||x>z)){e=C;z=x;}else{if(u=="min"){e=r(y<A?j(C,e):j(x,z)*y);z=r(y<A?e/y:j(x,z));}else{e=r(y>=A?j(C,e):j(x,z)*y);z=r(y>=A?e/y:j(x,z));}}}}s.sw=C;s.sh=x;s.dw=e;s.dh=z;s.multipass=k.multiPassResize;return s;},_trans:function(e){this._load(this.file,function(s,t){if(s){e(s);}else{try{this._apply(t,e);}catch(s){k.log("[err] FileAPI.Image.fn._apply:",s);e(s);}}});},get:function(s){if(k.support.transform){var t=this,e=t.matrix;if(e.deg=="auto"){k.getInfo(t.file,function(u,v){e.deg=p[v&&v.exif&&v.exif.Orientation]||0;t._trans(s);});}else{t._trans(s);}}else{s("not_support_transform");}return this;},toData:function(e){return this.get(e);}};h.exifOrientation=p;h.transform=function(u,t,s,v){function e(z,y){var x={},w=k.queue(function(A){v(A,x);});k.log("Image._transform");if(!z){k.log("Image._transform !err");k.each(t,function(D,B){k.log("Image._transform @"+B+"@each: "+w.isFail());if(!w.isFail()){var A=new h(y.nodeType?y:u);if(typeof D=="function"){D(y,A);}else{if(D.width){A[D.preview?"preview":"resize"](D.width,D.height,D.strategy);}else{if(D.maxWidth&&(y.width>D.maxWidth||y.height>D.maxHeight)){A.resize(D.maxWidth,D.maxHeight,"max");}}}if(D.crop){var C=D.crop;A.crop(C.x|0,C.y|0,C.w||C.width,C.h||C.height);}if(D.rotate===i&&s){D.rotate="auto";}A.set({deg:D.rotate,type:D.type||u.type||"image/png",quality:D.quality||1,overlay:D.overlay,filter:D.filter});w.inc();k.log("Image._transform before toData");A.toData(function(E,F){k.log("Image._transform after toData ["+E+"]");if(E){w.fail(E);}else{x[B]=F;w.next();}});}});}else{w.fail(z);}}if(u.width){e(false,u);}else{k.getInfo(u,e);}};k.each(["TOP","CENTER","BOTTOM"],function(e,s){k.each(["LEFT","CENTER","RIGHT"],function(u,t){h[e+"_"+u]=s*3+t;h[u+"_"+e]=s*3+t;});});h.toCanvas=function(s){var e=n.createElement("canvas");e.width=s.videoWidth||s.width;e.height=s.videoHeight||s.height;e.getContext("2d").drawImage(s,0,0);return e;};h.fromDataURL=function(t,s,u){var e=k.newImage(t);k.extend(e,s);u(e);};h.applyFilter=function(e,s,t){if(typeof s=="function"){s(e,t);}else{if(window.Caman){window.Caman(e.tagName=="IMG"?h.toCanvas(e):e,function(){if(typeof s=="string"){this[s]();}else{k.each(s,function(u,v){this[v](u);},this);}this.render(t);});}}};k.renderImageToCanvas=function(s,t,y,x,z,u,B,A,e,w){try{return s.getContext("2d").drawImage(t,y,x,z,u,B,A,e,w);}catch(v){k.log("renderImageToCanvas failed");throw v;}};k.support.canvas=k.support.transform=q;k.support.webp=g;k.Image=h;})(FileAPI,document);(function(e){e(FileAPI);}(function(g){if(!window.navigator||!window.navigator.platform||!(/iP(hone|od|ad)/).test(window.navigator.platform)){return;}var e=g.renderImageToCanvas;g.detectSubsampling=function(h){var i,j;if(h.width*h.height>1024*1024){i=document.createElement("canvas");i.width=i.height=1;j=i.getContext("2d");j.drawImage(h,-h.width+1,0);return j.getImageData(0,0,1,1).data[3]===0;}return false;};g.detectVerticalSquash=function(l,o){var q=l.naturalHeight||l.height,i=document.createElement("canvas"),h=i.getContext("2d"),k,n,m,p,j;if(o){q/=2;}i.width=1;i.height=q;h.drawImage(l,0,0);k=h.getImageData(0,0,1,q).data;n=0;m=q;p=q;while(p>n){j=k[(p-1)*4+3];if(j===0){m=p;}else{n=p;}p=(m+n)>>1;}return(p/q)||1;};g.renderImageToCanvas=function(m,y,u,t,s,l,x,w,n,p){if(y._type==="image/jpeg"){var k=m.getContext("2d"),i=document.createElement("canvas"),r=1024,h=i.getContext("2d"),j,v,q,o;i.width=r;i.height=r;k.save();j=g.detectSubsampling(y);if(j){u/=2;t/=2;s/=2;l/=2;}v=g.detectVerticalSquash(y,j);if(j||v!==1){t*=v;n=Math.ceil(r*n/s);p=Math.ceil(r*p/l/v);w=0;o=0;while(o<l){x=0;q=0;while(q<s){h.clearRect(0,0,r,r);h.drawImage(y,u,t,s,l,-q,-o,s,l);k.drawImage(i,0,0,r,r,x,w,n,p);q+=r;x+=n;}o+=r;w+=p;}k.restore();return m;}}return e(m,y,u,t,s,l,x,w,n,p);};}));(function(i,j){var e=j.document,l=j.FormData,h=function(){this.items=[];},k=j.encodeURIComponent;h.prototype={append:function(n,m,o,p){this.items.push({name:n,blob:m&&m.blob||(m==void 0?"":m),file:m&&(o||m.name),type:m&&(p||m.type)});},each:function(o){var m=0,p=this.items.length;for(;m<p;m++){o.call(this,this.items[m]);}},toData:function(n,m){m._chunked=i.support.chunked&&m.chunkSize>0&&i.filter(this.items,function(o){return o.file;}).length==1;if(!i.support.html5){i.log("FileAPI.Form.toHtmlData");this.toHtmlData(n);}else{if(!i.formData||this.multipart||!l){i.log("FileAPI.Form.toMultipartData");this.toMultipartData(n);}else{if(m._chunked){i.log("FileAPI.Form.toPlainData");this.toPlainData(n);}else{i.log("FileAPI.Form.toFormData");this.toFormData(n);}}}},_to:function(q,o,p,n){var m=i.queue(function(){o(q);});this.each(function(r){p(r,q,m,n);});m.check();},toHtmlData:function(m){this._to(e.createDocumentFragment(),m,function(o,q){var n=o.blob,p;if(o.file){i.reset(n,true);n.name=o.name;q.appendChild(n);}else{p=e.createElement("input");p.name=o.name;p.type="hidden";p.value=n;q.appendChild(p);}});},toPlainData:function(m){this._to({},m,function(o,p,n){if(o.file){p.type=o.file;}if(o.blob.toBlob){n.inc();g(o,function(r,q){p.name=r.name;p.file=q;p.size=q.length||q.size;p.type=r.type;n.next();});}else{if(o.file){p.name=o.blob.name;p.file=o.blob;p.size=o.blob.size;p.type=o.type;}else{if(!p.params){p.params=[];}p.params.push(k(o.name)+"="+k(o.blob));}}p.start=-1;p.end=p.file&&p.file.FileAPIReadPosition||-1;p.retry=0;});},toFormData:function(m){this._to(new l,m,function(o,p,n){if(o.blob&&o.blob.toBlob){i.log("FileAPI.Form.toFormData Blob",typeof o,typeof o.blob,o.blob.tagName);n.inc();g(o,function(r,q){i.log("FileAPI.Form.toFormData after convert",typeof q,q.constructor.name);p.append(r.name,q,r.file);n.next();});}else{if(o.file){i.log("FileAPI.Form.toFormData File",typeof o,typeof o.blob);p.append(o.name,o.blob,o.file);}else{i.log("FileAPI.Form.toFormData Other",typeof o,typeof o.blob);p.append(o.name,o.blob);}}if(o.file){i.log("FileAPI.Form.toFormData _file",typeof o,typeof o.blob);p.append("_"+o.name,o.file);}});},toMultipartData:function(m){this._to([],m,function(o,p,n,q){n.inc();g(o,function(s,r){p.push("--_"+q+('\r\nContent-Disposition: form-data; name="'+s.name+'"'+(s.file?'; filename="'+k(s.file)+'"':"")+(s.file?"\r\nContent-Type: "+(s.type||"application/octet-stream"):"")+"\r\n\r\n"+(s.file?r:k(r))+"\r\n"));n.next();},true);},i.expando);}};function g(q,t,r){var m=q.blob,n=q.file;i.log("_convertFile",n,r);if(n){if(!m.toDataURL){i.readAsBinaryString(m,function(v){if(v.type=="load"){t(q,v.result);}});return;}var o={"image/jpeg":".jpe?g","image/png":".png"},s=o[q.type]?q.type:"image/png",p=o[s]||".png",u=m.quality||1;if(!n.match(new RegExp(p+"$","i"))){n+=p.replace("?","");}q.file=n;q.type=s;if(!r&&m.toBlob){m.toBlob(function(v){t(q,v);},s,u);}else{t(q,i.toBinaryString(m.toDataURL(s,u)));}}else{t(q,m);}}i.Form=h;})(FileAPI,window);(function(j,g){var i=function(){},e=j.document,h=function(l){this.uid=g.uid();this.xhr={abort:i,getResponseHeader:i,getAllResponseHeaders:i};this.options=l;},k={"":1,XML:1,Text:1,Body:1};h.prototype={status:0,statusText:"",constructor:h,getResponseHeader:function(l){return this.xhr.getResponseHeader(l);},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{};},end:function(l,n){var o=this,m=o.options;o.end=o.abort=i;o.status=l;if(n){o.statusText=n;}g.log("xhr.end:",l,n);m.complete(l==200||l==201?false:o.statusText||"unknown",o);if(o.xhr&&o.xhr.node){setTimeout(function(){var p=o.xhr.node;try{p.parentNode.removeChild(p);}catch(q){}try{delete j[o.uid];}catch(q){}j[o.uid]=o.xhr.node=null;},9);}},abort:function(){this.end(0,"abort");if(this.xhr){this.xhr.aborted=true;this.xhr.abort();}},send:function(m){var n=this,l=this.options;m.toData(function(o){l.upload(l,n);n._send.call(n,l,o);},l);},_send:function(B,s){var t=this,z,u=t.uid,m=B.url;g.log("XHR._send:",typeof s);if(!B.cache){m+=(~m.indexOf("?")?"&":"?")+g.uid();}if(s.nodeName){g.log("XHR.iframe upload");var w=B.jsonp;m=m.replace(/([a-z]+)=(\?)/i,"$1="+u);z=e.createElement("div");z.innerHTML='<form target="'+u+'" action="'+m+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+u+'" src="javascript:false;"></iframe>'+(w&&(B.url.indexOf("=?")<0)?'<input value="'+u+'" name="'+w+'" type="hidden"/>':"")+"</form>";var o=z.getElementsByTagName("form")[0],q=z.getElementsByTagName("iframe")[0];o.appendChild(s);e.body.appendChild(z);t.xhr.node=z;var v=function(D){g.log("Post message received");if(~m.indexOf(D.origin)){try{g.log("Post message matches origin");var C=g.parseJSON(D.data);if(C.id==u){g.log("Post message matches id");n(C.status,C.statusText,C.response);}}catch(E){n(0,E.message);}}},n=j[u]=function(C,E,D){t.readyState=4;t.responseText=D;t.end(C,E||"jsonp_empty");g.event.off(j,"message",v);j[u]=z=q=q.onload=null;o=null;};t.xhr.abort=function(){try{if(q.stop){q.stop();}else{if(q.contentWindow.stop){q.contentWindow.stop();}else{q.contentWindow.document.execCommand("Stop");}}}catch(C){}n(0,"abort");};g.event.on(j,"message",v);var y=0,r=100;q.onload=function(){try{g.log("Transport onload received");var F=q.contentWindow,E=F.document,C=F.result||g.parseJSON(E.body.innerHTML);if(!C&&y<30){setTimeout(q.onload,Math.max(r+=r,2500));y++;return;}n(C.status,C.statusText,C.response);}catch(D){g.log("[transport.onload]",D);n(0,"[transport.onload]");}};t.readyState=2;o.submit();}else{m=m.replace(/([a-z]+)=(\?)&?/i,"");if(this.xhr&&this.xhr.aborted){g.log("Error: already aborted");return;}z=t.xhr=g.getXHR();if(s.params){m+=(m.indexOf("?")<0?"?":"&")+s.params.join("&");}z.open("POST",m,true);if(g.withCredentials){z.withCredentials="true";}if(!B.headers||!B.headers["X-Requested-With"]){z.setRequestHeader("X-Requested-With","XMLHttpRequest");}g.each(B.headers,function(D,C){z.setRequestHeader(C,D);});if(B._chunked){if(z.upload){z.upload.addEventListener("progress",g.throttle(function(C){if(!s.retry){B.progress({type:C.type,total:s.size,loaded:s.start+C.loaded,totalSize:s.size},t,B);}},100),false);}z.onreadystatechange=function(){var D=parseInt(z.getResponseHeader("X-Last-Known-Byte"),10);t.status=z.status;t.statusText=z.statusText;t.readyState=z.readyState;if(z.readyState==4){for(var C in k){t["response"+C]=z["response"+C];}z.onreadystatechange=null;if(!z.status||z.status-201>0){g.log("XHR Error: "+z.status);if(((!z.status&&!z.aborted)||500==z.status||416==z.status)&&++s.retry<=B.chunkUploadRetry){var E=z.status?0:g.chunkNetworkDownRetryTimeout;B.pause(s.file,B);g.log("X-Last-Known-Byte: "+D);if(D){s.end=D;}else{s.end=s.start-1;if(416==z.status){s.end=s.end-B.chunkSize;}}setTimeout(function(){t._send(B,s);},E);}else{t.end(z.status,"retr_exceeded");}}else{s.retry=0;if(s.end==s.size-1){t.end(z.status);}else{g.log("X-Last-Known-Byte: "+D);if(D){s.end=D;}s.file.FileAPIReadPosition=s.end;setTimeout(function(){t._send(B,s);},0);}}z=null;}};s.start=s.end+1;s.end=Math.max(Math.min(s.start+B.chunkSize,s.size)-1,s.start);var p=s.file,x=(p.slice||p.mozSlice||p.webkitSlice).call(p,s.start,s.end+1);if(s.size&&!x.size){setTimeout(function(){t.end(-1);});}else{z.setRequestHeader("Content-Range","bytes "+s.start+"-"+s.end+"/"+s.size);z.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(s.name));z.setRequestHeader("Content-Type","application/octet-stream");z.send(x);}p=x=null;}else{if(z.upload){z.upload.addEventListener("progress",g.throttle(function(C){B.progress(C,t,B);},100),false);}z.onreadystatechange=function(){t.status=z.status;t.statusText=z.statusText;t.readyState=z.readyState;if(z.readyState==4){for(var C in k){t["response"+C]=z["response"+C];}z.onreadystatechange=null;if(!z.status||z.status>201){g.log("Error: "+z.status);if(((!z.status&&!z.aborted)||500==z.status)&&(B.retry||0)<B.uploadRetry){B.retry=(B.retry||0)+1;B.pause(B.file,B);setTimeout(function(){t._send(B,s);},B.retryDelay);}else{t.end(z.status,z.aborted?undefined:(z.statusText||"retr_exceeded"));}}else{t.end(z.status);}z=null;}};if(g.isArray(s)){z.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+g.expando);var l=s.join("")+"--_"+g.expando+"--";if(z.sendAsBinary){z.sendAsBinary(l);}else{var A=Array.prototype.map.call(l,function(C){return C.charCodeAt(0)&255;});if(j.Uint8Array){z.send(new Uint8Array(A).buffer);}else{setTimeout(function(){t.end(-2,"Unsupported Uint8Array");});}}}else{z.send(s);}}}}};g.XHR=h;})(window,FileAPI);(function(k,l,j){var e=k.document,h=k.location,g=k.navigator,i=j.each;j.support.flash=(function(){var n=g.mimeTypes,m=false;if(g.plugins&&typeof g.plugins["Shockwave Flash"]=="object"){m=g.plugins["Shockwave Flash"].description&&!(n&&n["application/x-shockwave-flash"]&&!n["application/x-shockwave-flash"].enabledPlugin);}else{try{m=!!(k.ActiveXObject&&new ActiveXObject("ShockwaveFlash.ShockwaveFlash"));}catch(o){j.log("Flash -- does not supported.");}}if(m&&/^file:/i.test(h)){j.log("[warn] Flash does not work on `file:` protocol.");}f("flashSupported",m);return m;})();j.flashInit=j.support.flash?function(){c("flashInit");if(j.Flash){return;}var r=j.uid(),o=0,p={},m=/^https?:/i,t={_fn:{},readyState:0,init:function(B){c("flashInit.init");var D=e.body&&e.body.firstChild;t.readyState=1;if(D){do{if(D.nodeType==1){j.log("FlashAPI.state: awaiting");t.readyState=2;var C=e.createElement("div");C.id="_"+r;w(C,{top:B?B.top:1,right:B?B.right:1,width:B?B.width:5,height:B?B.height:5,position:"absolute",overflow:"hidden",zIndex:1000000+""});D.parentNode.insertBefore(C,D);t.publish(C,r);return;}}while(D=D.nextSibling);}if(o<10){setTimeout(t.init,++o*50);}},publish:function(B,D,C){c("flashInit.publish");C=C||{};t.readyState=3;B.innerHTML=s({id:D,width:2048,height:256,src:n(j.flashUrl,"r="+j.version),wmode:C.camera?"":"transparent",flashvars:"callback="+(C.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+D+"&storeKey="+g.userAgent.match(/\d/ig).join("")+"_"+j.version+(t.isReady||(j.pingUrl?"&ping="+j.pingUrl:""))+"&timeout="+j.flashAbortTimeout+(C.camera?"&useCamera="+n(j.flashWebcamUrl):"")+"&debug="+(j.debug?"1":"")},C);t.readyState=4;if(j.flashEagerLoad){t.startTracking();}},__disabled:false,disable:function(){j.log("FlashAPI.state: disable");t.__disabled=true;w(t.getEl(),{top:1,left:1,width:5,height:5});},ready:function(){j.log("FlashAPI.state: ready");t.ready=j.F;t.isReady=true;t.readyState=5;t.patch();t.readyState=6;t.patchCamera&&t.patchCamera();t.startTracking();},startTracking:function(){if(t.isTracking){return;}t.isTracking=true;j.event.on(e,"mouseover",t.mouseover);j.event.on(e,"click",function(B){if(t.mouseover(B)){B.preventDefault?B.preventDefault():(B.returnValue=true);}});},getEl:function(){return e.getElementById("_"+r);},getWrapper:function(B){do{if(/js-fileapi-wrapper/.test(B.className)){return B;}}while((B=B.parentNode)&&(B!==e.body));},getHoverTargetElement:function(E){var D=E,B=0,C;do{D=D.parentNode;B++;C=D.hasAttribute("data-fileapi-hover-class");}while(D!==null&&B<4&&!C);if(C){return D;}},isFlashTarget:function(B){return(/input/i).test(B.nodeName)&&B.type==="file"&&(!j.support.html5||j.html5===false||typeof j.html5==="function"&&j.html5(B)!==true);},mouseover:function(J){if(t.__disabled){return false;}var H=j.event.fix(J).target;if(H.className&&/fileapi-uploader/.test(H.className)){do{H=H.nextSibling;}while(H!==null&&H.nodeType!=1);}if(H===null){return;}if(t.isFlashTarget(H)){var C=H.getAttribute(r),B=t.getWrapper(H);if(j.multiFlash){f("multiFlash",j.multiFlash);if(C=="i"||C=="r"){return false;}else{if(C!="p"){H.setAttribute(r,"i");var E=e.createElement("div");if(!B){j.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");return;}w(E,{top:0,left:0,width:H.offsetWidth+100,height:H.offsetHeight+100,position:"absolute",overflow:"hidden",zIndex:1000000+""});B.appendChild(E);t.publish(E,j.uid());H.setAttribute(r,"p");}}return true;}else{if(B){var D=t.getEl();var F=z(B);t.curInp=H;if(D!=null){w(D,F);}var I=t.getHoverTargetElement(B);if(I){var G=I.getAttribute("data-fileapi-hover-class");if(!new RegExp(G).test(I.className)){I.className+=" "+G;}}if(!/js-fileapi-hover/.test(B.className)){B.className+=" js-fileapi-hover";}}}}else{if(!/object|embed/i.test(H.nodeName)){w(t.getEl(),{top:1,left:1,width:5,height:5});}}},onEvent:function(B){var C=B.type;if(C=="ready"){try{t.getInput(B.flashId).setAttribute(r,"r");}catch(D){}t.ready();setTimeout(function(){t.mouseenter(B);},50);return true;}else{if(C==="ping"){j.log("(flash -> js).ping:",[B.status,B.savedStatus],B.error);}else{if(C==="log"){j.log("(flash -> js).log:",B.target);}else{if(C in t){setTimeout(function(){j.log("FlashAPI.event."+B.type+":",B);t[C](B);},1);}}}}},mouseenter:function(B){var E=t.getInput(B.flashId);if(E){t.cmd(B,"multiple",E.getAttribute("multiple")!=null);var D=[],C={};i((E.getAttribute("accept")||"").split(/,\s*/),function(I){j.accept[I]&&i(j.accept[I].split(" "),function(J){C[J]=1;});});i(C,function(I,J){D.push(J);});t.cmd(B,"accept",D.length?D.join(",")+","+D.join(",").toUpperCase():"*");var H=t.getWrapper(E);if(H){var F=t.getHoverTargetElement(H);if(F){var G=F.getAttribute("data-fileapi-hover-class");if(!new RegExp(G).test(F.className)){F.className+=" "+G;}}if(!/js-fileapi-hover/.test(H.className)){H.className+=" js-fileapi-hover";}}}},mouseleave:function(B){if(t.__disabled){return;}var C=t.getInput(B.flashId);if(C){var F=t.getWrapper(C);if(F){var D=t.getHoverTargetElement(F);if(D){var E=D.getAttribute("data-fileapi-hover-class");D.className=D.className.replace(new RegExp("\\s"+E),"");}if(F.className){F.className=F.className.replace(/\sjs-fileapi-hover/,"");}}}},get:function(B){return e[B]||k[B]||e.embeds[B];},getInput:function(D){if(j.multiFlash){try{var B=t.getWrapper(t.get(D));if(B){return B.getElementsByTagName("input")[0];}}catch(C){j.log('[err] Can not find "input" by flashId:',D,C);}}else{return t.curInp;}},select:function(B){if(t.__disabled){return;}var F=t.getInput(B.flashId),C=j.uid(F),E=B.target.files,D;i(E,function(G){j.checkFileObj(G);});p[C]=E;if(e.createEvent){D=e.createEvent("Event");D.files=E;D.initEvent("change",true,true);F.dispatchEvent(D);}else{if(l){l(F).trigger({type:"change",files:E});}else{D=e.createEventObject();D.files=E;F.fireEvent("onchange",D);}}},__browsing:false,cancel:function(B){if(t.__browsing){t.disable();}},browse:function(B){t.__browsing=true;k.setTimeout(function(){t.__browsing=false;},10);},cmd:function(F,B,D,C){try{j.log("(js -> flash)."+B+":",D);return t.get(F.flashId||F).cmd(B,D);}catch(E){j.log("(js -> flash).onError:",E);if(!C){setTimeout(function(){t.cmd(F,B,D,true);},50);}}},patch:function(){j.flashEngine=true;v(j,{getFiles:function(B,C,E){if(E){j.filterFiles(j.getFiles(B),C,E);return null;}var D=j.isArray(B)?B:p[j.uid(B.target||B.srcElement||B)];if(!D){return this.parent.apply(this,arguments);}if(C){C=j.getFilesFilter(C);D=j.filter(D,function(F){return C.test(F.name);});}return D;},getInfo:function(C,D){if(u(C)){this.parent.apply(this,arguments);}else{if(C.isShot){D(null,C.info={width:C.width,height:C.height});}else{if(!C.__info){var E=C.__info=j.defer();t.cmd(C,"getFileInfo",{id:C.id,callback:y(function B(F,G){A(B);E.resolve(F,C.info=G);})});}C.__info.then(D);}}}});j.support.transform=true;j.Image&&v(j.Image.prototype,{get:function(C,B){this.set({scaleMode:B||"noScale"});return this.parent(C);},_load:function(B,C){j.log("FlashAPI.Image._load:",B);if(u(B)){this.parent.apply(this,arguments);}else{var D=this;j.getInfo(B,function(E){C.call(D,E,B);});}},_apply:function(D,E){j.log("FlashAPI.Image._apply:",D);if(u(D)){this.parent.apply(this,arguments);}else{var B=this.getMatrix(D.info),F=E;t.cmd(D,"imageTransform",{id:D.id,matrix:B,callback:y(function C(H,G){j.log("FlashAPI.Image._apply.callback:",H);A(C);if(H){F(H);}else{if(!j.support.html5&&(!j.support.dataURI||G.length>30000)){q({width:(B.deg%180)?B.dh:B.dw,height:(B.deg%180)?B.dw:B.dh,scale:B.scaleMode},G,F);}else{if(B.filter){F=function(J,I){if(J){E(J);}else{j.Image.applyFilter(I,B.filter,function(){E(J,this.canvas);});}};}j.newImage("data:"+D.type+";base64,"+G,F);}}})});}},toData:function(D){j.log("FlashAPI.Image.toData");if(u(this.file)){this.parent.apply(this,arguments);}else{var C=this.file,E=C.info,B=this.getMatrix(E);if(B.deg=="auto"){B.deg=j.Image.exifOrientation[E&&E.exif&&E.exif.Orientation]||0;}D.call(this,!C.info,{id:C.id,flashId:C.flashId,name:C.name,type:C.type,matrix:B});}}});j.Image&&v(j.Image,{fromDataURL:function(C,B,D){if(!j.support.dataURI||C.length>30000){q(j.extend({scale:"exactFit"},B),C.replace(/^data:[^,]+,/,""),function(F,E){D(E);});}else{this.parent(C,B,D);}}});v(j.Form.prototype,{toData:function(D){var B=this.items,C=B.length;for(;C--;){if(B[C].file&&u(B[C].blob)){return this.parent.apply(this,arguments);}}j.log("FlashAPI.Form.toData");D(B);}});v(j.XHR.prototype,{_send:function(D,H){if(H.nodeName||(H.append||j.isFile(H.file))&&j.support.html5||j.isArray(H)&&(typeof H[0]==="string")){return this.parent.apply(this,arguments);}var G={},F={},I=this,E,C;i(H,function(J){if(J.file){F[J.name]=J=x(J.blob);C=J.id;E=J.flashId;}else{G[J.name]=J.blob;}});if(!C){E=r;}if(!E){j.log("[err] FlashAPI._send: flashId -- undefined");return this.parent.apply(this,arguments);}else{j.log("FlashAPI.XHR._send: "+E+" -> "+C);}I.xhr={headers:{},abort:function(){t.cmd(E,"abort",{id:C});},getResponseHeader:function(J){return this.headers[J];},getAllResponseHeaders:function(){return this.headers;}};var B=j.queue(function(){t.cmd(E,"upload",{url:n(D.url.replace(/([a-z]+)=(\?)&?/i,"")),data:G,files:C?F:null,headers:D.headers||{},callback:y(function J(L){var M=L.type,K=L.result;j.log("FlashAPI.upload."+M);if(M=="progress"){L.loaded=Math.min(L.loaded,L.total);L.lengthComputable=true;D.progress(L);}else{if(M=="complete"){A(J);if(typeof K=="string"){I.responseText=K.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%");}I.end(L.status||200);}else{if(M=="abort"||M=="error"){I.end(L.status||0,L.message);A(J);}}}})});});i(F,function(J){B.inc();j.getInfo(J,B.next);});B.check();}});}};function s(B){c("_makeFlashHTML");return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(B.width||"100%")+'" height="'+(B.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(B.width||"100%")+'" height="'+(B.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/ig,function(C,D){return B[D];});}function w(D,C){if(D&&D.style){var B,F;for(B in C){F=C[B];if(typeof F=="number"){F+="px";}try{D.style[B]=F;}catch(E){}}}}function v(C,B){i(B,function(E,D){var F=C[D];C[D]=function(){this.parent=F;return E.apply(this,arguments);};});}function u(B){return B&&!B.flashId;}function y(B){var C=B.wid=j.uid();t._fn[C]=B;return"FileAPI.Flash._fn."+C;}function A(B){try{t._fn[B.wid]=null;delete t._fn[B.wid];}catch(C){}}function n(B,D){if(!m.test(B)){if(/^\.\//.test(B)||"/"!=B.charAt(0)){var C=h.pathname;C=C.substr(0,C.lastIndexOf("/"));B=(C+"/"+B).replace("/./","/");}if("//"!=B.substr(0,2)){B="//"+h.host+B;}if(!m.test(B)){B=h.protocol+B;}}if(D){B+=(/\?/.test(B)?"&":"?")+D;}return B;}function q(B,D,E){c("_makeFlashImage");var G,H=j.uid(),C=e.createElement("div"),J=10;for(G in B){C.setAttribute(G,B[G]);C[G]=B[G];}w(C,B);B.width="100%";B.height="100%";C.innerHTML=s(j.extend({id:H,src:n(j.flashImageUrl,"r="+j.uid()),wmode:"opaque",flashvars:"scale="+B.scale+"&callback="+y(function I(){A(I);if(--J>0){F();}return true;})},B));function F(){try{var K=t.get(H);K.setImage(D);}catch(L){j.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',L);}}E(false,C);C=null;}function x(B){return{id:B.id,name:B.name,matrix:B.matrix,flashId:B.flashId};}function z(C){var D=C.getBoundingClientRect(),B=e.body,E=(C&&C.ownerDocument).documentElement;return{top:D.top+(k.pageYOffset||E.scrollTop)-(E.clientTop||B.clientTop||0),left:D.left+(k.pageXOffset||E.scrollLeft)-(E.clientLeft||B.clientLeft||0),width:D.right-D.left,height:D.bottom-D.top};}j.Flash=t;j.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(C,B){j.support.dataURI=!(B.width!=1||B.height!=1);t.init();});}:function(){};if(j.flashEnabled&&(0||j.html5!==true||!j.support.html5||(j.cors&&!j.support.cors)||(j.media&&!j.support.media))){j.flashInit();}})(window,window.jQuery,FileAPI);(function(){!function g(h,m,k){function j(r,p){if(!m[r]){if(!h[r]){var n="function"==typeof require&&require;if(!p&&n){return n(r,!0);}if(e){return e(r,!0);}var q=new Error("Cannot find module '"+r+"'");throw q.code="MODULE_NOT_FOUND",q;}var i=m[r]={exports:{}};h[r][0].call(i.exports,function(o){var s=h[r][1][o];return j(s?s:o);},i,i.exports,g,h,m,k);}return m[r].exports;}for(var e="function"==typeof require&&require,l=0;l<k.length;l++){j(k[l]);}return j;}({1:[function(i,e,W){function aa(af){return this instanceof aa?(this.length=0,this.parent=void 0,"number"==typeof af?l(this,af):"string"==typeof af?C(this,af,arguments.length>1?arguments[1]:"utf8"):ab(this,af)):arguments.length>1?new aa(af,arguments[1]):new aa(af);}function l(ah,ag){if(ah=O(ah,0>ag?0:0|F(ag)),!aa.TYPED_ARRAY_SUPPORT){for(var af=0;ag>af;af++){ah[af]=0;}}return ah;}function C(ai,af,ah){("string"!=typeof ah||""===ah)&&(ah="utf8");var ag=0|j(af,ah);return ai=O(ai,ag),ai.write(af,ah),ai;}function ab(ag,af){if(aa.isBuffer(af)){return L(ag,af);}if(D(af)){return U(ag,af);}if(null==af){throw new TypeError("must start with number, buffer, array or string");}return"undefined"!=typeof ArrayBuffer&&af.buffer instanceof ArrayBuffer?p(ag,af):af.length?ac(ag,af):u(ag,af);}function L(ah,af){var ag=0|F(af.length);return ah=O(ah,ag),af.copy(ah,0,0,ag),ah;}function U(ah,ai){var ag=0|F(ai.length);ah=O(ah,ag);for(var af=0;ag>af;af+=1){ah[af]=255&ai[af];}return ah;}function p(ah,ai){var ag=0|F(ai.length);ah=O(ah,ag);for(var af=0;ag>af;af+=1){ah[af]=255&ai[af];}return ah;}function ac(ah,ai){var ag=0|F(ai.length);ah=O(ah,ag);for(var af=0;ag>af;af+=1){ah[af]=255&ai[af];}return ah;}function u(ai,af){var aj,ah=0;"Buffer"===af.type&&D(af.data)&&(aj=af.data,ah=0|F(aj.length)),ai=O(ai,ah);for(var ag=0;ah>ag;ag+=1){ai[ag]=255&aj[ag];}return ai;}function O(ah,ag){aa.TYPED_ARRAY_SUPPORT?ah=aa._augment(new Uint8Array(ag)):(ah.length=ag,ah._isBuffer=!0);var af=0!==ag&&ag<=aa.poolSize>>>1;return af&&(ah.parent=N),ah;}function F(af){if(af>=S){throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+S.toString(16)+" bytes");}return 0|af;}function m(ag,ah){if(!(this instanceof m)){return new m(ag,ah);}var af=new aa(ag,ah);return delete af.parent,af;}function j(af,ag){if("string"!=typeof af&&(af=String(af)),0===af.length){return 0;}switch(ag||"utf8"){case"ascii":case"binary":case"raw":return af.length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*af.length;case"hex":return af.length>>>1;case"utf8":case"utf-8":return G(af).length;case"base64":return P(af).length;default:return af.length;}}function q(ah,ag,am,al){am=Number(am)||0;var aj=ah.length-am;al?(al=Number(al),al>aj&&(al=aj)):al=aj;var ak=ag.length;if(ak%2!==0){throw new Error("Invalid hex string");}al>ak/2&&(al=ak/2);for(var ai=0;al>ai;ai++){var af=parseInt(ag.substr(2*ai,2),16);if(isNaN(af)){throw new Error("Invalid hex string");}ah[am+ai]=af;}return ai;}function ae(ag,af,ai,ah){return V(G(af,ag.length-ai),ag,ai,ah);}function s(ag,af,ai,ah){return V(E(af),ag,ai,ah);}function Q(ag,af,ai,ah){return s(ag,af,ai,ah);}function R(ag,af,ai,ah){return V(P(af),ag,ai,ah);}function I(ag,af,ai,ah){return V(M(af,ag.length-ai),ag,ai,ah);}function Z(ag,ah,af){return x.fromByteArray(0===ah&&af===ag.length?ag:ag.slice(ah,af));}function n(ag,ak,af){var aj="",ai="";af=Math.min(ag.length,af);for(var ah=ak;af>ah;ah++){ag[ah]<=127?(aj+=o(ai)+String.fromCharCode(ag[ah]),ai=""):ai+="%"+ag[ah].toString(16);}return aj+o(ai);}function A(ah,aj,af){var ag="";af=Math.min(ah.length,af);for(var ai=aj;af>ai;ai++){ag+=String.fromCharCode(127&ah[ai]);}return ag;}function Y(ah,aj,af){var ag="";af=Math.min(ah.length,af);for(var ai=aj;af>ai;ai++){ag+=String.fromCharCode(ah[ai]);}return ag;}function z(ai,ak,ag){var af=ai.length;(!ak||0>ak)&&(ak=0),(!ag||0>ag||ag>af)&&(ag=af);for(var ah="",aj=ak;ag>aj;aj++){ah+=t(ai[aj]);}return ah;}function B(ah,ak,ag){for(var af=ah.slice(ak,ag),aj="",ai=0;ai<af.length;ai+=2){aj+=String.fromCharCode(af[ai]+256*af[ai+1]);}return aj;}function k(ah,af,ag){if(ah%1!==0||0>ah){throw new RangeError("offset is not uint");}if(ah+af>ag){throw new RangeError("Trying to access beyond buffer length");}}function y(ag,aj,ak,ai,af,ah){if(!aa.isBuffer(ag)){throw new TypeError("buffer must be a Buffer instance");}if(aj>af||ah>aj){throw new RangeError("value is out of bounds");}if(ak+ai>ag.length){throw new RangeError("index out of range");}}function X(ag,ai,ak,aj){0>ai&&(ai=65535+ai+1);for(var ah=0,af=Math.min(ag.length-ak,2);af>ah;ah++){ag[ak+ah]=(ai&255<<8*(aj?ah:1-ah))>>>8*(aj?ah:1-ah);}}function r(ag,ai,ak,aj){0>ai&&(ai=4294967295+ai+1);for(var ah=0,af=Math.min(ag.length-ak,4);af>ah;ah++){ag[ak+ah]=ai>>>8*(aj?ah:3-ah)&255;}}function v(ag,aj,ak,ai,af,ah){if(aj>af||ah>aj){throw new RangeError("value is out of bounds");}if(ak+ai>ag.length){throw new RangeError("index out of range");}if(0>ak){throw new RangeError("index out of range");}}function w(af,ag,aj,ai,ah){return ah||v(af,ag,aj,4,3.4028234663852886e+38,-3.4028234663852886e+38),ad.write(af,ag,aj,ai,23,4),aj+4;}function T(af,ag,aj,ai,ah){return ah||v(af,ag,aj,8,1.7976931348623157e+308,-1.7976931348623157e+308),ad.write(af,ag,aj,ai,52,8),aj+8;}function H(af){if(af=h(af).replace(K,""),af.length<2){return"";}for(;af.length%4!==0;){af+="=";}return af;}function h(af){return af.trim?af.trim():af.replace(/^\s+|\s+$/g,"");}function t(af){return 16>af?"0"+af.toString(16):af.toString(16);}function G(ai,ag){ag=ag||1/0;for(var ah,al=ai.length,ak=null,af=[],aj=0;al>aj;aj++){if(ah=ai.charCodeAt(aj),ah>55295&&57344>ah){if(!ak){if(ah>56319){(ag-=3)>-1&&af.push(239,191,189);continue;}if(aj+1===al){(ag-=3)>-1&&af.push(239,191,189);continue;}ak=ah;continue;}if(56320>ah){(ag-=3)>-1&&af.push(239,191,189),ak=ah;continue;}ah=ak-55296<<10|ah-56320|65536,ak=null;}else{ak&&((ag-=3)>-1&&af.push(239,191,189),ak=null);}if(128>ah){if((ag-=1)<0){break;}af.push(ah);}else{if(2048>ah){if((ag-=2)<0){break;}af.push(ah>>6|192,63&ah|128);}else{if(65536>ah){if((ag-=3)<0){break;}af.push(ah>>12|224,ah>>6&63|128,63&ah|128);}else{if(!(2097152>ah)){throw new Error("Invalid code point");}if((ag-=4)<0){break;}af.push(ah>>18|240,ah>>12&63|128,ah>>6&63|128,63&ah|128);}}}}return af;}function E(ah){for(var af=[],ag=0;ag<ah.length;ag++){af.push(255&ah.charCodeAt(ag));}return af;}function M(ak,ag){for(var al,ah,aj,af=[],ai=0;ai<ak.length&&!((ag-=2)<0);ai++){al=ak.charCodeAt(ai),ah=al>>8,aj=al%256,af.push(aj),af.push(ah);}return af;}function P(af){return x.toByteArray(H(af));}function V(ai,aj,ah,ag){for(var af=0;ag>af&&!(af+ah>=aj.length||af>=ai.length);af++){aj[af+ah]=ai[af];}return af;}function o(ag){try{return decodeURIComponent(ag);}catch(af){return String.fromCharCode(65533);}}var x=i("base64-js"),ad=i("ieee754"),D=i("is-array");W.Buffer=aa,W.SlowBuffer=m,W.INSPECT_MAX_BYTES=50,aa.poolSize=8192;var S=1073741823,N={};aa.TYPED_ARRAY_SUPPORT=function(){try{var ag=new ArrayBuffer(0),af=new Uint8Array(ag);return af.foo=function(){return 42;},42===af.foo()&&"function"==typeof af.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength;}catch(ah){return !1;}}(),aa.isBuffer=function(af){return !(null==af||!af._isBuffer);},aa.compare=function(ai,ah){if(!aa.isBuffer(ai)||!aa.isBuffer(ah)){throw new TypeError("Arguments must be Buffers");}if(ai===ah){return 0;}for(var ag=ai.length,ak=ah.length,aj=0,af=Math.min(ag,ak);af>aj&&ai[aj]===ah[aj];){++aj;}return aj!==af&&(ag=ai[aj],ak=ah[aj]),ak>ag?-1:ag>ak?1:0;},aa.isEncoding=function(af){switch(String(af).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return !0;default:return !1;}},aa.concat=function(aj,ai){if(!D(aj)){throw new TypeError("list argument must be an Array of Buffers.");}if(0===aj.length){return new aa(0);}if(1===aj.length){return aj[0];}var ag;if(void 0===ai){for(ai=0,ag=0;ag<aj.length;ag++){ai+=aj[ag].length;}}var af=new aa(ai),ak=0;for(ag=0;ag<aj.length;ag++){var ah=aj[ag];ah.copy(af,ak),ak+=ah.length;}return af;},aa.byteLength=j,aa.prototype.length=void 0,aa.prototype.parent=void 0,aa.prototype.toString=function(ag,ai,af){var ah=!1;if(ai=0|ai,af=void 0===af||af===1/0?this.length:0|af,ag||(ag="utf8"),0>ai&&(ai=0),af>this.length&&(af=this.length),ai>=af){return"";}for(;;){switch(ag){case"hex":return z(this,ai,af);case"utf8":case"utf-8":return n(this,ai,af);case"ascii":return A(this,ai,af);case"binary":return Y(this,ai,af);case"base64":return Z(this,ai,af);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,ai,af);default:if(ah){throw new TypeError("Unknown encoding: "+ag);}ag=(ag+"").toLowerCase(),ah=!0;}}},aa.prototype.equals=function(af){if(!aa.isBuffer(af)){throw new TypeError("Argument must be a Buffer");}return this===af?!0:0===aa.compare(this,af);},aa.prototype.inspect=function(){var ag="",af=W.INSPECT_MAX_BYTES;return this.length>0&&(ag=this.toString("hex",0,af).match(/.{2}/g).join(" "),this.length>af&&(ag+=" ... ")),"<Buffer "+ag+">";},aa.prototype.compare=function(af){if(!aa.isBuffer(af)){throw new TypeError("Argument must be a Buffer");}return this===af?0:aa.compare(this,af);},aa.prototype.indexOf=function(ah,ag){function af(ai,al,ak){for(var am=-1,aj=0;ak+aj<ai.length;aj++){if(ai[ak+aj]===al[-1===am?0:aj-am]){if(-1===am&&(am=aj),aj-am+1===al.length){return ak+am;}}else{am=-1;}}return -1;}if(ag>2147483647?ag=2147483647:-2147483648>ag&&(ag=-2147483648),ag>>=0,0===this.length){return -1;}if(ag>=this.length){return -1;}if(0>ag&&(ag=Math.max(this.length+ag,0)),"string"==typeof ah){return 0===ah.length?-1:String.prototype.indexOf.call(this,ah,ag);}if(aa.isBuffer(ah)){return af(this,ah,ag);}if("number"==typeof ah){return aa.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,ah,ag):af(this,[ah],ag);}throw new TypeError("val must be string, number or Buffer");},aa.prototype.get=function(af){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(af);},aa.prototype.set=function(af,ag){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(af,ag);},aa.prototype.write=function(af,ak,ai,ah){if(void 0===ak){ah="utf8",ai=this.length,ak=0;}else{if(void 0===ai&&"string"==typeof ak){ah=ak,ai=this.length,ak=0;}else{if(isFinite(ak)){ak=0|ak,isFinite(ai)?(ai=0|ai,void 0===ah&&(ah="utf8")):(ah=ai,ai=void 0);}else{var aj=ah;ah=ak,ak=0|ai,ai=aj;}}}var ag=this.length-ak;if((void 0===ai||ai>ag)&&(ai=ag),af.length>0&&(0>ai||0>ak)||ak>this.length){throw new RangeError("attempt to write outside buffer bounds");}ah||(ah="utf8");for(var al=!1;;){switch(ah){case"hex":return q(this,af,ak,ai);case"utf8":case"utf-8":return ae(this,af,ak,ai);case"ascii":return s(this,af,ak,ai);case"binary":return Q(this,af,ak,ai);case"base64":return R(this,af,ak,ai);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,af,ak,ai);default:if(al){throw new TypeError("Unknown encoding: "+ah);}ah=(""+ah).toLowerCase(),al=!0;}}},aa.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)};},aa.prototype.slice=function(ak,ag){var af=this.length;ak=~~ak,ag=void 0===ag?af:~~ag,0>ak?(ak+=af,0>ak&&(ak=0)):ak>af&&(ak=af),0>ag?(ag+=af,0>ag&&(ag=0)):ag>af&&(ag=af),ak>ag&&(ag=ak);var aj;if(aa.TYPED_ARRAY_SUPPORT){aj=aa._augment(this.subarray(ak,ag));}else{var ai=ag-ak;aj=new aa(ai,void 0);for(var ah=0;ai>ah;ah++){aj[ah]=this[ah+ak];}}return aj.length&&(aj.parent=this.parent||this),aj;},aa.prototype.readUIntLE=function(ak,af,ai){ak=0|ak,af=0|af,ai||k(ak,af,this.length);for(var aj=this[ak],ah=1,ag=0;++ag<af&&(ah*=256);){aj+=this[ak+ag]*ah;}return aj;},aa.prototype.readUIntBE=function(aj,af,ah){aj=0|aj,af=0|af,ah||k(aj,af,this.length);for(var ai=this[aj+ --af],ag=1;af>0&&(ag*=256);){ai+=this[aj+ --af]*ag;}return ai;},aa.prototype.readUInt8=function(ag,af){return af||k(ag,1,this.length),this[ag];},aa.prototype.readUInt16LE=function(ag,af){return af||k(ag,2,this.length),this[ag]|this[ag+1]<<8;},aa.prototype.readUInt16BE=function(ag,af){return af||k(ag,2,this.length),this[ag]<<8|this[ag+1];},aa.prototype.readUInt32LE=function(ag,af){return af||k(ag,4,this.length),(this[ag]|this[ag+1]<<8|this[ag+2]<<16)+16777216*this[ag+3];},aa.prototype.readUInt32BE=function(ag,af){return af||k(ag,4,this.length),16777216*this[ag]+(this[ag+1]<<16|this[ag+2]<<8|this[ag+3]);},aa.prototype.readIntLE=function(ak,af,ai){ak=0|ak,af=0|af,ai||k(ak,af,this.length);for(var aj=this[ak],ah=1,ag=0;++ag<af&&(ah*=256);){aj+=this[ak+ag]*ah;}return ah*=128,aj>=ah&&(aj-=Math.pow(2,8*af)),aj;},aa.prototype.readIntBE=function(ak,af,ai){ak=0|ak,af=0|af,ai||k(ak,af,this.length);for(var ag=af,ah=1,aj=this[ak+ --ag];ag>0&&(ah*=256);){aj+=this[ak+ --ag]*ah;}return ah*=128,aj>=ah&&(aj-=Math.pow(2,8*af)),aj;},aa.prototype.readInt8=function(ag,af){return af||k(ag,1,this.length),128&this[ag]?-1*(255-this[ag]+1):this[ag];},aa.prototype.readInt16LE=function(ah,af){af||k(ah,2,this.length);var ag=this[ah]|this[ah+1]<<8;return 32768&ag?4294901760|ag:ag;},aa.prototype.readInt16BE=function(ah,af){af||k(ah,2,this.length);var ag=this[ah+1]|this[ah]<<8;return 32768&ag?4294901760|ag:ag;},aa.prototype.readInt32LE=function(ag,af){return af||k(ag,4,this.length),this[ag]|this[ag+1]<<8|this[ag+2]<<16|this[ag+3]<<24;},aa.prototype.readInt32BE=function(ag,af){return af||k(ag,4,this.length),this[ag]<<24|this[ag+1]<<16|this[ag+2]<<8|this[ag+3];},aa.prototype.readFloatLE=function(ag,af){return af||k(ag,4,this.length),ad.read(this,ag,!0,23,4);},aa.prototype.readFloatBE=function(ag,af){return af||k(ag,4,this.length),ad.read(this,ag,!1,23,4);},aa.prototype.readDoubleLE=function(ag,af){return af||k(ag,8,this.length),ad.read(this,ag,!0,52,8);},aa.prototype.readDoubleBE=function(ag,af){return af||k(ag,8,this.length),ad.read(this,ag,!1,52,8);},aa.prototype.writeUIntLE=function(ah,ak,af,aj){ah=+ah,ak=0|ak,af=0|af,aj||y(this,ah,ak,af,Math.pow(2,8*af),0);var ai=1,ag=0;for(this[ak]=255&ah;++ag<af&&(ai*=256);){this[ak+ag]=ah/ai&255;}return ak+af;},aa.prototype.writeUIntBE=function(ah,ak,af,aj){ah=+ah,ak=0|ak,af=0|af,aj||y(this,ah,ak,af,Math.pow(2,8*af),0);var ag=af-1,ai=1;for(this[ak+ag]=255&ah;--ag>=0&&(ai*=256);){this[ak+ag]=ah/ai&255;}return ak+af;},aa.prototype.writeUInt8=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,1,255,0),aa.TYPED_ARRAY_SUPPORT||(af=Math.floor(af)),this[ah]=af,ah+1;},aa.prototype.writeUInt16LE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,2,65535,0),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af,this[ah+1]=af>>>8):X(this,af,ah,!0),ah+2;},aa.prototype.writeUInt16BE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,2,65535,0),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af>>>8,this[ah+1]=af):X(this,af,ah,!1),ah+2;},aa.prototype.writeUInt32LE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,4,4294967295,0),aa.TYPED_ARRAY_SUPPORT?(this[ah+3]=af>>>24,this[ah+2]=af>>>16,this[ah+1]=af>>>8,this[ah]=af):r(this,af,ah,!0),ah+4;},aa.prototype.writeUInt32BE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,4,4294967295,0),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af>>>24,this[ah+1]=af>>>16,this[ah+2]=af>>>8,this[ah+3]=af):r(this,af,ah,!1),ah+4;},aa.prototype.writeIntLE=function(aj,am,ag,al){if(aj=+aj,am=0|am,!al){var af=Math.pow(2,8*ag-1);y(this,aj,am,ag,af-1,-af);}var ah=0,ak=1,ai=0>aj?1:0;for(this[am]=255&aj;++ah<ag&&(ak*=256);){this[am+ah]=(aj/ak>>0)-ai&255;}return am+ag;},aa.prototype.writeIntBE=function(aj,am,ag,al){if(aj=+aj,am=0|am,!al){var af=Math.pow(2,8*ag-1);y(this,aj,am,ag,af-1,-af);}var ah=ag-1,ak=1,ai=0>aj?1:0;for(this[am+ah]=255&aj;--ah>=0&&(ak*=256);){this[am+ah]=(aj/ak>>0)-ai&255;}return am+ag;},aa.prototype.writeInt8=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,1,127,-128),aa.TYPED_ARRAY_SUPPORT||(af=Math.floor(af)),0>af&&(af=255+af+1),this[ah]=af,ah+1;},aa.prototype.writeInt16LE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,2,32767,-32768),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af,this[ah+1]=af>>>8):X(this,af,ah,!0),ah+2;},aa.prototype.writeInt16BE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,2,32767,-32768),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af>>>8,this[ah+1]=af):X(this,af,ah,!1),ah+2;},aa.prototype.writeInt32LE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,4,2147483647,-2147483648),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af,this[ah+1]=af>>>8,this[ah+2]=af>>>16,this[ah+3]=af>>>24):r(this,af,ah,!0),ah+4;},aa.prototype.writeInt32BE=function(af,ah,ag){return af=+af,ah=0|ah,ag||y(this,af,ah,4,2147483647,-2147483648),0>af&&(af=4294967295+af+1),aa.TYPED_ARRAY_SUPPORT?(this[ah]=af>>>24,this[ah+1]=af>>>16,this[ah+2]=af>>>8,this[ah+3]=af):r(this,af,ah,!1),ah+4;},aa.prototype.writeFloatLE=function(af,ah,ag){return w(this,af,ah,!0,ag);},aa.prototype.writeFloatBE=function(af,ah,ag){return w(this,af,ah,!1,ag);},aa.prototype.writeDoubleLE=function(af,ah,ag){return T(this,af,ah,!0,ag);},aa.prototype.writeDoubleBE=function(af,ah,ag){return T(this,af,ah,!1,ag);},aa.prototype.copy=function(ai,aj,ak,ag){if(ak||(ak=0),ag||0===ag||(ag=this.length),aj>=ai.length&&(aj=ai.length),aj||(aj=0),ag>0&&ak>ag&&(ag=ak),ag===ak){return 0;}if(0===ai.length||0===this.length){return 0;}if(0>aj){throw new RangeError("targetStart out of bounds");}if(0>ak||ak>=this.length){throw new RangeError("sourceStart out of bounds");}if(0>ag){throw new RangeError("sourceEnd out of bounds");}ag>this.length&&(ag=this.length),ai.length-aj<ag-ak&&(ag=ai.length-aj+ak);var af=ag-ak;if(1000>af||!aa.TYPED_ARRAY_SUPPORT){for(var ah=0;af>ah;ah++){ai[ah+aj]=this[ah+ak];}}else{ai._set(this.subarray(ak,ak+af),aj);}return af;},aa.prototype.fill=function(aj,ak,ah){if(aj||(aj=0),ak||(ak=0),ah||(ah=this.length),ak>ah){throw new RangeError("end < start");}if(ah!==ak&&0!==this.length){if(0>ak||ak>=this.length){throw new RangeError("start out of bounds");}if(0>ah||ah>this.length){throw new RangeError("end out of bounds");}var ai;if("number"==typeof aj){for(ai=ak;ah>ai;ai++){this[ai]=aj;}}else{var ag=G(aj.toString()),af=ag.length;for(ai=ak;ah>ai;ai++){this[ai]=ag[ai%af];}}return this;}},aa.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(aa.TYPED_ARRAY_SUPPORT){return new aa(this).buffer;}for(var ag=new Uint8Array(this.length),ah=0,af=ag.length;af>ah;ah+=1){ag[ah]=this[ah];}return ag.buffer;}throw new TypeError("Buffer.toArrayBuffer not supported in this browser");};var J=aa.prototype;aa._augment=function(af){return af.constructor=aa,af._isBuffer=!0,af._set=af.set,af.get=J.get,af.set=J.set,af.write=J.write,af.toString=J.toString,af.toLocaleString=J.toString,af.toJSON=J.toJSON,af.equals=J.equals,af.compare=J.compare,af.indexOf=J.indexOf,af.copy=J.copy,af.slice=J.slice,af.readUIntLE=J.readUIntLE,af.readUIntBE=J.readUIntBE,af.readUInt8=J.readUInt8,af.readUInt16LE=J.readUInt16LE,af.readUInt16BE=J.readUInt16BE,af.readUInt32LE=J.readUInt32LE,af.readUInt32BE=J.readUInt32BE,af.readIntLE=J.readIntLE,af.readIntBE=J.readIntBE,af.readInt8=J.readInt8,af.readInt16LE=J.readInt16LE,af.readInt16BE=J.readInt16BE,af.readInt32LE=J.readInt32LE,af.readInt32BE=J.readInt32BE,af.readFloatLE=J.readFloatLE,af.readFloatBE=J.readFloatBE,af.readDoubleLE=J.readDoubleLE,af.readDoubleBE=J.readDoubleBE,af.writeUInt8=J.writeUInt8,af.writeUIntLE=J.writeUIntLE,af.writeUIntBE=J.writeUIntBE,af.writeUInt16LE=J.writeUInt16LE,af.writeUInt16BE=J.writeUInt16BE,af.writeUInt32LE=J.writeUInt32LE,af.writeUInt32BE=J.writeUInt32BE,af.writeIntLE=J.writeIntLE,af.writeIntBE=J.writeIntBE,af.writeInt8=J.writeInt8,af.writeInt16LE=J.writeInt16LE,af.writeInt16BE=J.writeInt16BE,af.writeInt32LE=J.writeInt32LE,af.writeInt32BE=J.writeInt32BE,af.writeFloatLE=J.writeFloatLE,af.writeFloatBE=J.writeFloatBE,af.writeDoubleLE=J.writeDoubleLE,af.writeDoubleBE=J.writeDoubleBE,af.fill=J.fill,af.inspect=J.inspect,af.toArrayBuffer=J.toArrayBuffer,af;};var K=/[^+\/0-9A-z\-]/g;},{"base64-js":2,ieee754:3,"is-array":4}],2:[function(h,i,e){var j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(p){function k(w){var x=w.charCodeAt(0);return x===r||x===v?62:x===l||x===n?63:o>x?-1:o+10>x?x-o+26+26:t+26>x?x-t:m+26>x?x-m+26:void 0;}function q(w){function F(G){C[E++]=G;}var A,z,x,B,y,C;if(w.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4");}var D=w.length;y="="===w.charAt(D-2)?2:"="===w.charAt(D-1)?1:0,C=new s(3*w.length/4-y),x=y>0?w.length-4:w.length;var E=0;for(A=0,z=0;x>A;A+=4,z+=3){B=k(w.charAt(A))<<18|k(w.charAt(A+1))<<12|k(w.charAt(A+2))<<6|k(w.charAt(A+3)),F((16711680&B)>>16),F((65280&B)>>8),F(255&B);}return 2===y?(B=k(w.charAt(A))<<2|k(w.charAt(A+1))>>4,F(255&B)):1===y&&(B=k(w.charAt(A))<<10|k(w.charAt(A+1))<<4|k(w.charAt(A+2))>>2,F(B>>8&255),F(255&B)),C;}function u(w){function C(E){return j.charAt(E);}function D(E){return C(E>>18&63)+C(E>>12&63)+C(E>>6&63)+C(63&E);}var A,y,B,z=w.length%3,x="";for(A=0,B=w.length-z;B>A;A+=3){y=(w[A]<<16)+(w[A+1]<<8)+w[A+2],x+=D(y);}switch(z){case 1:y=w[w.length-1],x+=C(y>>2),x+=C(y<<4&63),x+="==";break;case 2:y=(w[w.length-2]<<8)+w[w.length-1],x+=C(y>>10),x+=C(y>>4&63),x+=C(y<<2&63),x+="=";}return x;}var s="undefined"!=typeof Uint8Array?Uint8Array:Array,r="+".charCodeAt(0),l="/".charCodeAt(0),o="0".charCodeAt(0),m="a".charCodeAt(0),t="A".charCodeAt(0),v="-".charCodeAt(0),n="_".charCodeAt(0);p.toByteArray=q,p.fromByteArray=u;}("undefined"==typeof e?this.base64js={}:e);},{}],3:[function(h,i,e){e.read=function(q,p,l,k,u){var v,o,n=8*u-k-1,t=(1<<n)-1,j=t>>1,x=-7,r=l?u-1:0,w=l?-1:1,y=q[p+r];for(r+=w,v=y&(1<<-x)-1,y>>=-x,x+=n;x>0;v=256*v+q[p+r],r+=w,x-=8){}for(o=v&(1<<-x)-1,v>>=-x,x+=k;x>0;o=256*o+q[p+r],r+=w,x-=8){}if(0===v){v=1-j;}else{if(v===t){return o?0/0:(y?-1:1)*(1/0);}o+=Math.pow(2,k),v-=j;}return(y?-1:1)*o*Math.pow(2,v-k);},e.write=function(r,z,q,l,k,v){var w,o,y,n=8*v-k-1,u=(1<<n)-1,j=u>>1,p=23===k?Math.pow(2,-24)-Math.pow(2,-77):0,t=l?0:v-1,x=l?1:-1,A=0>z||0===z&&0>1/z?1:0;for(z=Math.abs(z),isNaN(z)||z===1/0?(o=isNaN(z)?1:0,w=u):(w=Math.floor(Math.log(z)/Math.LN2),z*(y=Math.pow(2,-w))<1&&(w--,y*=2),z+=w+j>=1?p/y:p*Math.pow(2,1-j),z*y>=2&&(w++,y/=2),w+j>=u?(o=0,w=u):w+j>=1?(o=(z*y-1)*Math.pow(2,k),w+=j):(o=z*Math.pow(2,j-1)*Math.pow(2,k),w=0));k>=8;r[q+t]=255&o,t+=x,o/=256,k-=8){}for(w=w<<k|o,n+=k;n>0;r[q+t]=255&w,t+=x,w/=256,n-=8){}r[q+t-x]|=128*A;};},{}],4:[function(i,j,h){var e=Array.isArray,k=Object.prototype.toString;j.exports=e||function(l){return !!l&&"[object Array]"==k.call(l);};},{}],5:[function(h,i,e){var j=h("./index"),k=function(){return this;}();k.ExifParser=j;},{"./index":6}],6:[function(i,k,e){function j(){return this;}var l=i("./lib/parser"),h=i("./lib/exif");k.exports={create:function(m,o){if(o=o||j(),m instanceof o.ArrayBuffer){var n=i("./lib/dom-bufferstream");return new l(new n(m,0,m.byteLength,!0,o));}var p=i("./lib/bufferstream");return new l(new p(m,0,m.length,!0));},createOK:function(m,o){var p=i("../buffer/index"),r=i("./lib/bufferstream"),n=p.Buffer(m,"binary"),q=new r(n,0,o,!0);return new l(q);},IFD0:h.IFD0,IFD1:h.IFD1,GPSIFD:h.GPSIFD,SubIFD:h.SubIFD,InteropIFD:h.InteropIFD};},{"../buffer/index":1,"./lib/bufferstream":7,"./lib/dom-bufferstream":9,"./lib/exif":11,"./lib/parser":13}],7:[function(h,i,e){function j(k,n,l,m){this.buffer=k,this.offset=n||0,l="number"==typeof l?l:k.length,this.endPosition=this.offset+l,this.setBigEndian(m);}j.prototype={setBigEndian:function(k){this.bigEndian=!!k;},nextUInt8:function(){var k=this.buffer.readUInt8(this.offset);return this.offset+=1,k;},nextInt8:function(){var k=this.buffer.readInt8(this.offset);return this.offset+=1,k;},nextUInt16:function(){var k=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,k;},nextUInt32:function(){var k=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,k;},nextInt16:function(){var k=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,k;},nextInt32:function(){var k=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,k;},nextFloat:function(){var k=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,k;},nextDouble:function(){var k=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,k;},nextBuffer:function(k){var l=this.buffer.slice(this.offset,this.offset+k);return this.offset+=k,l;},remainingLength:function(){return this.endPosition-this.offset;},nextString:function(k){var l=this.buffer.toString("ascii",this.offset,this.offset+k);return this.offset+=k,l;},mark:function(){var k=this;return{openWithOffset:function(l){return l=(l||0)+this.offset,new j(k.buffer,l,k.endPosition-l,k.bigEndian);},offset:this.offset};},offsetFrom:function(k){return this.offset-k.offset;},skip:function(k){this.offset+=k;},branch:function(l,k){return k="number"==typeof k?k:this.endPosition-(this.offset+l),new j(this.buffer,this.offset+l,k,this.bigEndian);}},i.exports=j;},{}],8:[function(j,e,l){function m(q){return parseInt(q,10);}function i(r,s){r=r.map(m),s=s.map(m);var q=new Date;q.setUTCFullYear(r[0]),q.setUTCMonth(r[1]-1),q.setUTCDate(r[2]),q.setUTCHours(s[0]),q.setUTCMinutes(s[1]),q.setUTCSeconds(s[2]),q.setUTCMilliseconds(0);var t=q.getTime()/1000;return t;}function p(r){var s=r.substr(0,10).split("-"),u=r.substr(11,8).split(":"),q=r.substr(19,6),w=q.split(":").map(m),t=w[0]*o+w[1]*k,v=i(s,u);return v-=t,"number"!=typeof v||isNaN(v)?void 0:v;}function n(q){var u=q.split(" "),r=u[0].split(":"),s=u[1].split(":"),t=i(r,s);return"number"!=typeof t||isNaN(t)?void 0:t;}function h(r){var s=19===r.length&&":"===r.charAt(4),q=25===r.length&&"T"===r.charAt(10);return q?p(r):s?n(r):void 0;}var o=3600,k=60;e.exports={parseDateWithSpecFormat:n,parseDateWithTimezoneFormat:p,parseExifDate:h};},{}],9:[function(i,j,e){function h(l,p,n,o,m,k){this.global=m,p=p||0,n=n||l.byteLength-p,this.arrayBuffer=l.slice(p,p+n),this.view=new m.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(o),this.offset=0,this.parentOffset=(k||0)+p;}h.prototype={setBigEndian:function(k){this.littleEndian=!k;},nextUInt8:function(){var k=this.view.getUint8(this.offset);return this.offset+=1,k;},nextInt8:function(){var k=this.view.getInt8(this.offset);return this.offset+=1,k;},nextUInt16:function(){var k=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,k;},nextUInt32:function(){var k=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,k;},nextInt16:function(){var k=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,k;},nextInt32:function(){var k=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,k;},nextFloat:function(){var k=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,k;},nextDouble:function(){var k=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,k;},nextBuffer:function(k){var l=this.arrayBuffer.slice(this.offset,this.offset+k);return this.offset+=k,l;},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset;},nextString:function(k){var l=this.arrayBuffer.slice(this.offset,this.offset+k);return l=String.fromCharCode.apply(null,new this.global.Uint8Array(l)),this.offset+=k,l;},mark:function(){var k=this;return{openWithOffset:function(l){return l=(l||0)+this.offset,new h(k.arrayBuffer,l,k.arrayBuffer.byteLength-l,!k.littleEndian,k.global,k.parentOffset);},offset:this.offset,getParentOffset:function(){return k.parentOffset;}};},offsetFrom:function(k){return this.parentOffset+this.offset-(k.offset+k.getParentOffset());},skip:function(k){this.offset+=k;},branch:function(l,k){return k="number"==typeof k?k:this.arrayBuffer.byteLength-(this.offset+l),new h(this.arrayBuffer,this.offset+l,k,!this.littleEndian,this.global,this.parentOffset);}},j.exports=h;},{}],10:[function(h,i,e){i.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65000:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}};},{}],11:[function(j,k,h){function e(o,p){switch(o){case 1:return p.nextUInt8();case 3:return p.nextUInt16();case 4:return p.nextUInt32();case 5:return[p.nextUInt32(),p.nextUInt32()];case 6:return p.nextInt8();case 8:return p.nextUInt16();case 9:return p.nextUInt32();case 10:return[p.nextInt32(),p.nextInt32()];case 11:return p.nextFloat();case 12:return p.nextDouble();default:throw new Error("Invalid format while decoding: "+o);}}function n(o){switch(o){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:throw new Error("Invalid format: "+o);}}function m(t,x){var w,s,v=x.nextUInt16(),u=x.nextUInt16(),q=n(u),r=x.nextUInt32(),o=q*r;if(o>4&&(x=t.openWithOffset(x.nextUInt32())),2===u){w=x.nextString(r);var p=w.indexOf("\x00");-1!==p&&(w=w.substr(0,p));}else{if(7===u){w=x.nextBuffer(r);}else{for(w=[],s=0;r>s;++s){w.push(e(u,x));}}}return 4>o&&x.skip(4-o),[v,w,u];}function l(t,s,q){var o,p,r=s.nextUInt16();for(p=0;r>p;++p){o=m(t,s),q(o[0],o[1],o[2]);}}function i(r){var p=r.nextString(6);if("Exif\x00\x00"!==p){throw new Error("Invalid EXIF header");}var q=r.mark(),o=r.nextUInt16();if(18761===o){r.setBigEndian(!1);}else{if(19789!==o){throw new Error("Invalid TIFF header");}r.setBigEndian(!0);}if(42!==r.nextUInt16()){throw new Error("Invalid TIFF data");}return q;}k.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(B,v){var A;try{A=i(B);}catch(x){return !1;}var u,r,y,s=A.openWithOffset(B.nextUInt32()),t=this.IFD0;l(A,s,function(D,E,F){switch(D){case 34853:r=E[0];break;case 34665:u=E[0];break;default:v(t,D,E,F);}});var w=s.nextUInt32();if(0!==w){var o=A.openWithOffset(w);l(A,o,v.bind(null,this.IFD1));}if(r){var z=A.openWithOffset(r);l(A,z,v.bind(null,this.GPSIFD));}if(u){var C=A.openWithOffset(u),q=this.InteropIFD;l(A,C,function(D,E,F){40965===D?y=E[0]:v(q,D,E,F);});}if(y){var p=A.openWithOffset(y);l(A,p,v.bind(null,this.InteropIFD));}return !0;}};},{}],12:[function(h,i,e){i.exports={parseSections:function(m,l){var k,j;for(m.setBigEndian(!0);m.remainingLength()>0&&218!==j;){if(255!==m.nextUInt8()){throw new Error("Invalid JPEG section offset");}j=m.nextUInt8(),k=j>=208&&217>=j||218===j?0:m.nextUInt16()-2,l(j,m.branch(0,k)),m.skip(k);}},getSizeFromSOFSection:function(j){return j.skip(1),{height:j.nextUInt16(),width:j.nextUInt16()};},getSectionName:function(j){var l,k;switch(j){case 216:l="SOI";break;case 196:l="DHT";break;case 219:l="DQT";break;case 221:l="DRI";break;case 218:l="SOS";break;case 254:l="COM";break;case 217:l="EOI";break;default:j>=224&&239>=j?(l="APP",k=j-224):j>=192&&207>=j&&196!==j&&200!==j&&204!==j?(l="SOF",k=j-192):j>=208&&215>=j&&(l="RST",k=j-208);}var m={name:l};return"number"==typeof k&&(m.index=k),m;}};},{}],13:[function(k,l,h){function e(r,q,t,s,p,o,u){this.startMarker=r,this.tags=q,this.imageSize=t,this.thumbnailOffset=s,this.thumbnailLength=p,this.thumbnailType=o,this.app1Offset=u;}function n(o){this.stream=o,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0};}var j=k("./jpeg"),m=k("./exif"),i=k("./simplify");e.prototype={hasThumbnail:function(o){return this.thumbnailOffset&&this.thumbnailLength?"string"!=typeof o?!0:"image/jpeg"===o.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===o.toLowerCase().trim()?1===this.thumbnailType:!1:!1;},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset;},getThumbnailLength:function(){return this.thumbnailLength;},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength);},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset());},getImageSize:function(){return this.imageSize;},getThumbnailSize:function(){var o,p=this._getThumbnailStream();return j.parseSections(p,function(r,q){"SOF"===j.getSectionName(r).name&&(o=j.getSizeFromSOFSection(q));}),o;}},n.prototype={enableBinaryFields:function(o){return this.flags.readBinaryTags=!!o,this;},enablePointers:function(o){return this.flags.hidePointers=!o,this;},enableTagNames:function(o){return this.flags.resolveTagNames=!!o,this;},enableImageSize:function(o){return this.flags.imageSize=!!o,this;},enableReturnTags:function(o){return this.flags.returnTags=!!o,this;},enableSimpleValues:function(o){return this.flags.simplifyValues=!!o,this;},parse:function(){var z,v,t,q,w,s,x,u,r,o=this.stream.mark(),y=o.openWithOffset(0),p=this.flags;return p.resolveTagNames&&(x=k("./exif-tags")),p.resolveTagNames?(z={},u=function(A){return z[A.name];},r=function(A,B){z[A.name]=B;}):(z=[],u=function(B){var A;for(A=0;A<z.length;++A){if(z[A].type===B.type&&z[A].section===B.section){return z.value;}}},r=function(B,C){var A;for(A=0;A<z.length;++A){if(z[A].type===B.type&&z[A].section===B.section){return void (z.value=C);}}}),j.parseSections(y,function(C,B){var D,A=B.offsetFrom(o);225===C?(D=m.parseTags(B,function(I,G,H,J){if(p.readBinaryTags||7!==J){if(513===G){if(t=H[0],p.hidePointers){return;}}else{if(514===G){if(q=H[0],p.hidePointers){return;}}else{if(259===G&&(w=H[0],p.hidePointers)){return;}}}if(p.returnTags){if(p.simplifyValues&&(H=i.simplifyValue(H,J)),p.resolveTagNames){var F=I===m.GPSIFD?x.gps:x.exif,E=F[G];E||(E=x.exif[G]),z[E]=H;}else{z.push({section:I,type:G,value:H});}}}}),D&&(s=A)):p.imageSize&&"SOF"===j.getSectionName(C).name&&(v=j.getSizeFromSOFSection(B));}),p.simplifyValues&&(i.castDegreeValues(u,r),i.castDateValues(u,r)),new e(o,z,v,t,q,w,s);}},l.exports=n;},{"./exif":11,"./exif-tags":10,"./jpeg":12,"./simplify":14}],14:[function(j,k,h){var l=j("./exif"),i=j("./date"),m=[{section:l.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:l.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],e=[{section:l.SubIFD,type:36867,name:"DateTimeOriginal"},{section:l.SubIFD,type:36868,name:"CreateDate"}];k.exports={castDegreeValues:function(o,n){m.forEach(function(r){var s=o(r);if(s){var q=o({section:r.section,type:r.refType,name:r.refName}),p=q===r.posVal?1:-1,u=(s[0]+s[1]/60+s[2]/3600)*p;n(r,u);}});},castDateValues:function(o,n){e.forEach(function(p){var r=o(p);if(r){var q=i.parseExifDate(r);"undefined"!=typeof q&&n(p,q);}});},simplifyValue:function(n,o){return Array.isArray(n)&&(n=n.map(function(p){return 10===o||5===o?p[0]/p[1]:p;}),1===n.length&&(n=n[0])),n;}};},{"./date":8,"./exif":11}]},{},[5]);FileAPI.support.exif=true;FileAPI.addInfoReader(/^image/,function(j,m){if(!j.__exif){var l=j.__exif=FileAPI.defer();var h=j;if(h instanceof Blob&&h.size>128*1024){try{var i=Math.min(h.size,128*1024);h=(h.slice||h.mozSlice||h.webkitSlice).call(h,0,i);}catch(k){FileAPI.log("exception "+k);}}FileAPI.readAsBinaryString(h,function(v){if(v.type=="load"){var n=window.ExifParser.createOK(v.result,h.size);n.enableTagNames(false);n.enableBinaryFields(false);var u,r,t={};var o=function(e){switch(e){case window.ExifParser.IFD0:case window.ExifParser.IFD1:case window.ExifParser.SubIFD:case window.ExifParser.InteropIFD:return 0;case window.ExifParser.GPSIFD:return 1;default:return 2;}};try{u=n.parse();var w;for(var p=0;p<u.tags.length;++p){w=u.tags[p];t[o(w.section)*65536+w.type]=w.value;}}catch(q){r="";}var s={toString:function(){if(r===undefined){r="";var e;for(var x=0;x<u.tags.length;++x){e=u.tags[x];r+=o(e.section)*65536+e.type+":"+e.value+"\n";}}return r;},Orientation:t[274],V2:true};l.resolve(false,{exif:s});}else{if(v.type=="error"){l.resolve("read_as_binary_string_exif");}}});}j.__exif.then(m);});})();return FileAPI;});